{
  "hash": "08d8405eab31826b97857bc1461504ce",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: Hugging Face Datasets\njupyter: python3\n---\n\n::: {#e44914a2 .cell 0='e' 1='x' 2='p' 3='o' 4='r' 5='t' execution_count=1}\n``` {.python .cell-code}\nfrom __future__ import annotations\nimport math,numpy as np,matplotlib.pyplot as plt\nfrom operator import itemgetter\nfrom itertools import zip_longest\nimport fastcore.all as fc\n\nfrom torch.utils.data import default_collate\n\nfrom miniai.training import *\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">ModuleNotFoundError</span>                       Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[1], line 5</span>\n<span class=\"ansi-green-fg ansi-bold\">      3</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">operator</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> itemgetter\n<span class=\"ansi-green-fg ansi-bold\">      4</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">itertools</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> zip_longest\n<span class=\"ansi-green-fg\">----&gt; 5</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">fastcore</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">all</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">as</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">fc</span>\n<span class=\"ansi-green-fg ansi-bold\">      7</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">torch</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">utils</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">data</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> default_collate\n<span class=\"ansi-green-fg ansi-bold\">      9</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">miniai</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">training</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"color:rgb(98,98,98)\">*</span>\n\n<span class=\"ansi-red-fg\">ModuleNotFoundError</span>: No module named 'fastcore'</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#bfd16d39 .cell execution_count=2}\n``` {.python .cell-code}\nimport logging,pickle,gzip,os,time,shutil,torch,matplotlib as mpl\nfrom pathlib import Path\n\nfrom torch import tensor,nn,optim\nfrom torch.utils.data import DataLoader\nimport torch.nn.functional as F\nfrom datasets import load_dataset,load_dataset_builder\n\nimport torchvision.transforms.functional as TF\nfrom fastcore.test import test_close\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">ModuleNotFoundError</span>                       Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[2], line 7</span>\n<span class=\"ansi-green-fg ansi-bold\">      5</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">torch</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">utils</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">data</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> DataLoader\n<span class=\"ansi-green-fg ansi-bold\">      6</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">torch</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">nn</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">functional</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">as</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">F</span>\n<span class=\"ansi-green-fg\">----&gt; 7</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">datasets</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> load_dataset,load_dataset_builder\n<span class=\"ansi-green-fg ansi-bold\">      9</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">torchvision</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">transforms</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">functional</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">as</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">TF</span>\n<span class=\"ansi-green-fg ansi-bold\">     10</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">fastcore</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">test</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> test_close\n\n<span class=\"ansi-red-fg\">ModuleNotFoundError</span>: No module named 'datasets'</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#9f60959c .cell execution_count=3}\n``` {.python .cell-code}\ntorch.set_printoptions(precision=2, linewidth=140, sci_mode=False)\ntorch.manual_seed(1)\nmpl.rcParams['image.cmap'] = 'gray'\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```\n<torch._C.Generator at 0x79405f368550>\n```\n:::\n:::\n\n\n::: {#99ee81ab .cell execution_count=4}\n``` {.python .cell-code}\nlogging.disable(logging.WARNING)\n```\n:::\n\n\n::: {#0bf6876b .cell execution_count=5}\n``` {.python .cell-code}\nname = \"fashion_mnist\"\nds_builder = load_dataset_builder(name)\nprint(ds_builder.info.description)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[5], line 2</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> name <span style=\"color:rgb(98,98,98)\">=</span> <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">fashion_mnist</span><span style=\"color:rgb(175,0,0)\">\"</span>\n<span class=\"ansi-green-fg\">----&gt; 2</span> ds_builder <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">load_dataset_builder</span>(name)\n<span class=\"ansi-green-fg ansi-bold\">      3</span> <span style=\"color:rgb(0,135,0)\">print</span>(ds_builder<span style=\"color:rgb(98,98,98)\">.</span>info<span style=\"color:rgb(98,98,98)\">.</span>description)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'load_dataset_builder' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#6939add3 .cell execution_count=6}\n``` {.python .cell-code}\nds_builder.info.features\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[6], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">ds_builder</span><span style=\"color:rgb(98,98,98)\">.</span>info<span style=\"color:rgb(98,98,98)\">.</span>features\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'ds_builder' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#1df6216c .cell execution_count=7}\n``` {.python .cell-code}\nds_builder.info.splits\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[7], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">ds_builder</span><span style=\"color:rgb(98,98,98)\">.</span>info<span style=\"color:rgb(98,98,98)\">.</span>splits\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'ds_builder' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#0647ddfc .cell execution_count=8}\n``` {.python .cell-code}\ndsd = load_dataset(name)\ndsd\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[8], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> dsd <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">load_dataset</span>(name)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> dsd\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'load_dataset' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#ee013188 .cell execution_count=9}\n``` {.python .cell-code}\ntrain,test = dsd['train'],dsd['test']\ntrain[0]\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[9], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> train,test <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">dsd</span>[<span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">train</span><span style=\"color:rgb(175,0,0)\">'</span>],dsd[<span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">test</span><span style=\"color:rgb(175,0,0)\">'</span>]\n<span class=\"ansi-green-fg ansi-bold\">      2</span> train[<span style=\"color:rgb(98,98,98)\">0</span>]\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'dsd' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#dc903b37 .cell execution_count=10}\n``` {.python .cell-code}\nx,y = ds_builder.info.features\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[10], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> x,y <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">ds_builder</span><span style=\"color:rgb(98,98,98)\">.</span>info<span style=\"color:rgb(98,98,98)\">.</span>features\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'ds_builder' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#53a652ee .cell execution_count=11}\n``` {.python .cell-code}\nx,y\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[11], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">x</span>,y\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'x' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#40b2ec1a .cell execution_count=12}\n``` {.python .cell-code}\nx,y = 'image','label'\nimg = train[0][x]\nimg\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[12], line 2</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> x,y <span style=\"color:rgb(98,98,98)\">=</span> <span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">image</span><span style=\"color:rgb(175,0,0)\">'</span>,<span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">label</span><span style=\"color:rgb(175,0,0)\">'</span>\n<span class=\"ansi-green-fg\">----&gt; 2</span> img <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">train</span>[<span style=\"color:rgb(98,98,98)\">0</span>][x]\n<span class=\"ansi-green-fg ansi-bold\">      3</span> img\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'train' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#1dfb94af .cell execution_count=13}\n``` {.python .cell-code}\nxb = train[:5][x]\nyb = train[:5][y]\nyb\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[13], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> xb <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">train</span>[:<span style=\"color:rgb(98,98,98)\">5</span>][x]\n<span class=\"ansi-green-fg ansi-bold\">      2</span> yb <span style=\"color:rgb(98,98,98)\">=</span> train[:<span style=\"color:rgb(98,98,98)\">5</span>][y]\n<span class=\"ansi-green-fg ansi-bold\">      3</span> yb\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'train' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#60e3c888 .cell execution_count=14}\n``` {.python .cell-code}\nfeaty = train.features[y]\nfeaty\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[14], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> featy <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">train</span><span style=\"color:rgb(98,98,98)\">.</span>features[y]\n<span class=\"ansi-green-fg ansi-bold\">      2</span> featy\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'train' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#8447a536 .cell execution_count=15}\n``` {.python .cell-code}\nfeaty.int2str(yb)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[15], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">featy</span><span style=\"color:rgb(98,98,98)\">.</span>int2str(yb)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'featy' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#6a9573ff .cell execution_count=16}\n``` {.python .cell-code}\ntrain['label'][:5]\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[16], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">train</span>[<span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">label</span><span style=\"color:rgb(175,0,0)\">'</span>][:<span style=\"color:rgb(98,98,98)\">5</span>]\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'train' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#cedcee0b .cell execution_count=17}\n``` {.python .cell-code}\ndef collate_fn(b):\n    return {x:torch.stack([TF.to_tensor(o[x]) for o in b]),\n            y:tensor([o[y] for o in b])}\n```\n:::\n\n\n::: {#df00fab7 .cell execution_count=18}\n``` {.python .cell-code}\ndl = DataLoader(train, collate_fn=collate_fn, batch_size=16)\nb = next(iter(dl))\nb[x].shape,b[y]\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[18], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> dl <span style=\"color:rgb(98,98,98)\">=</span> DataLoader(<span class=\"ansi-yellow-bg\">train</span>, collate_fn<span style=\"color:rgb(98,98,98)\">=</span>collate_fn, batch_size<span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(98,98,98)\">16</span>)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> b <span style=\"color:rgb(98,98,98)\">=</span> <span style=\"color:rgb(0,135,0)\">next</span>(<span style=\"color:rgb(0,135,0)\">iter</span>(dl))\n<span class=\"ansi-green-fg ansi-bold\">      3</span> b[x]<span style=\"color:rgb(98,98,98)\">.</span>shape,b[y]\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'train' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#31acb0ea .cell execution_count=19}\n``` {.python .cell-code}\ndef transforms(b):\n    b[x] = [TF.to_tensor(o) for o in b[x]]\n    return b\n```\n:::\n\n\n::: {#c73a29d8 .cell execution_count=20}\n``` {.python .cell-code}\ntds = train.with_transform(transforms)\ndl = DataLoader(tds, batch_size=16)\nb = next(iter(dl))\nb[x].shape,b[y]\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[20], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> tds <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">train</span><span style=\"color:rgb(98,98,98)\">.</span>with_transform(transforms)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> dl <span style=\"color:rgb(98,98,98)\">=</span> DataLoader(tds, batch_size<span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(98,98,98)\">16</span>)\n<span class=\"ansi-green-fg ansi-bold\">      3</span> b <span style=\"color:rgb(98,98,98)\">=</span> <span style=\"color:rgb(0,135,0)\">next</span>(<span style=\"color:rgb(0,135,0)\">iter</span>(dl))\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'train' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#efa7511c .cell execution_count=21}\n``` {.python .cell-code}\ndef _transformi(b): b[x] = [torch.flatten(TF.to_tensor(o)) for o in b[x]]\n```\n:::\n\n\n::: {#b7545da2 .cell 0='e' 1='x' 2='p' 3='o' 4='r' 5='t' execution_count=22}\n``` {.python .cell-code}\ndef inplace(f):\n    def _f(b):\n        f(b)\n        return b\n    return _f\n```\n:::\n\n\n::: {#ae77ac52 .cell execution_count=23}\n``` {.python .cell-code}\ntransformi = inplace(_transformi)\n```\n:::\n\n\n::: {#1b925946 .cell execution_count=24}\n``` {.python .cell-code}\nr = train.with_transform(transformi)[0]\nr[x].shape,r[y]\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[24], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> r <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">train</span><span style=\"color:rgb(98,98,98)\">.</span>with_transform(transformi)[<span style=\"color:rgb(98,98,98)\">0</span>]\n<span class=\"ansi-green-fg ansi-bold\">      2</span> r[x]<span style=\"color:rgb(98,98,98)\">.</span>shape,r[y]\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'train' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#3f870b7b .cell execution_count=25}\n``` {.python .cell-code}\n@inplace\ndef transformi(b): b[x] = [torch.flatten(TF.to_tensor(o)) for o in b[x]]\n```\n:::\n\n\n::: {#dc3c17cb .cell execution_count=26}\n``` {.python .cell-code}\ntdsf = train.with_transform(transformi)\nr = tdsf[0]\nr[x].shape,r[y]\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[26], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> tdsf <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">train</span><span style=\"color:rgb(98,98,98)\">.</span>with_transform(transformi)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> r <span style=\"color:rgb(98,98,98)\">=</span> tdsf[<span style=\"color:rgb(98,98,98)\">0</span>]\n<span class=\"ansi-green-fg ansi-bold\">      3</span> r[x]<span style=\"color:rgb(98,98,98)\">.</span>shape,r[y]\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'train' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#6fa77477 .cell execution_count=27}\n``` {.python .cell-code}\nd = dict(a=1,b=2,c=3)\nig = itemgetter('a','c')\nig(d)\n```\n\n::: {.cell-output .cell-output-display execution_count=27}\n```\n(1, 3)\n```\n:::\n:::\n\n\n::: {#45520327 .cell execution_count=28}\n``` {.python .cell-code}\nclass D:\n    def __getitem__(self, k): return 1 if k=='a' else 2 if k=='b' else 3\n```\n:::\n\n\n::: {#ca098a33 .cell execution_count=29}\n``` {.python .cell-code}\nd = D()\nig(d)\n```\n\n::: {.cell-output .cell-output-display execution_count=29}\n```\n(1, 3)\n```\n:::\n:::\n\n\n::: {#0e13bc24 .cell execution_count=30}\n``` {.python .cell-code}\nlist(tdsf.features)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[30], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span style=\"color:rgb(0,135,0)\">list</span>(<span class=\"ansi-yellow-bg\">tdsf</span><span style=\"color:rgb(98,98,98)\">.</span>features)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'tdsf' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#95600d7e .cell execution_count=31}\n``` {.python .cell-code}\nbatch = dict(a=[1],b=[2]), dict(a=[3],b=[4])\ndefault_collate(batch)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[31], line 2</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> batch <span style=\"color:rgb(98,98,98)\">=</span> <span style=\"color:rgb(0,135,0)\">dict</span>(a<span style=\"color:rgb(98,98,98)\">=</span>[<span style=\"color:rgb(98,98,98)\">1</span>],b<span style=\"color:rgb(98,98,98)\">=</span>[<span style=\"color:rgb(98,98,98)\">2</span>]), <span style=\"color:rgb(0,135,0)\">dict</span>(a<span style=\"color:rgb(98,98,98)\">=</span>[<span style=\"color:rgb(98,98,98)\">3</span>],b<span style=\"color:rgb(98,98,98)\">=</span>[<span style=\"color:rgb(98,98,98)\">4</span>])\n<span class=\"ansi-green-fg\">----&gt; 2</span> <span class=\"ansi-yellow-bg\">default_collate</span>(batch)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'default_collate' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#3fb414e4 .cell 0='e' 1='x' 2='p' 3='o' 4='r' 5='t' execution_count=32}\n``` {.python .cell-code}\ndef collate_dict(ds):\n    get = itemgetter(*ds.features)\n    def _f(b): return get(default_collate(b))\n    return _f\n```\n:::\n\n\n::: {#f0684f0b .cell execution_count=33}\n``` {.python .cell-code}\ndlf = DataLoader(tdsf, batch_size=4, collate_fn=collate_dict(tdsf))\nxb,yb = next(iter(dlf))\nxb.shape,yb\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[33], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> dlf <span style=\"color:rgb(98,98,98)\">=</span> DataLoader(<span class=\"ansi-yellow-bg\">tdsf</span>, batch_size<span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(98,98,98)\">4</span>, collate_fn<span style=\"color:rgb(98,98,98)\">=</span>collate_dict(tdsf))\n<span class=\"ansi-green-fg ansi-bold\">      2</span> xb,yb <span style=\"color:rgb(98,98,98)\">=</span> <span style=\"color:rgb(0,135,0)\">next</span>(<span style=\"color:rgb(0,135,0)\">iter</span>(dlf))\n<span class=\"ansi-green-fg ansi-bold\">      3</span> xb<span style=\"color:rgb(98,98,98)\">.</span>shape,yb\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'tdsf' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n## Plotting images\n\n::: {#47fec718 .cell execution_count=34}\n``` {.python .cell-code}\nb = next(iter(dl))\nxb = b['image']\nimg = xb[0]\nplt.imshow(img[0]);\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[34], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> b <span style=\"color:rgb(98,98,98)\">=</span> <span style=\"color:rgb(0,135,0)\">next</span>(<span style=\"color:rgb(0,135,0)\">iter</span>(<span class=\"ansi-yellow-bg\">dl</span>))\n<span class=\"ansi-green-fg ansi-bold\">      2</span> xb <span style=\"color:rgb(98,98,98)\">=</span> b[<span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">image</span><span style=\"color:rgb(175,0,0)\">'</span>]\n<span class=\"ansi-green-fg ansi-bold\">      3</span> img <span style=\"color:rgb(98,98,98)\">=</span> xb[<span style=\"color:rgb(98,98,98)\">0</span>]\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'dl' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#45c2e3a2 .cell 0='e' 1='x' 2='p' 3='o' 4='r' 5='t' execution_count=35}\n``` {.python .cell-code}\n@fc.delegates(plt.Axes.imshow)\ndef show_image(im, ax=None, figsize=None, title=None, noframe=True, **kwargs):\n    \"Show a PIL or PyTorch image on `ax`.\"\n    if fc.hasattrs(im, ('cpu','permute','detach')):\n        im = im.detach().cpu()\n        if len(im.shape)==3 and im.shape[0]<5: im=im.permute(1,2,0)\n    elif not isinstance(im,np.ndarray): im=np.array(im)\n    if im.shape[-1]==1: im=im[...,0]\n    if ax is None: _,ax = plt.subplots(figsize=figsize)\n    ax.imshow(im, **kwargs)\n    if title is not None: ax.set_title(title)\n    ax.set_xticks([]) \n    ax.set_yticks([]) \n    if noframe: ax.axis('off')\n    return ax\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[35], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span style=\"color:rgb(175,0,255)\">@fc</span><span style=\"color:rgb(98,98,98)\">.</span>delegates(plt<span style=\"color:rgb(98,98,98)\">.</span>Axes<span style=\"color:rgb(98,98,98)\">.</span>imshow)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">def</span> <span style=\"color:rgb(0,0,255)\">show_image</span>(im, ax<span style=\"color:rgb(98,98,98)\">=</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span>, figsize<span style=\"color:rgb(98,98,98)\">=</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span>, title<span style=\"color:rgb(98,98,98)\">=</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span>, noframe<span style=\"color:rgb(98,98,98)\">=</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">True</span>, <span style=\"color:rgb(98,98,98)\">*</span><span style=\"color:rgb(98,98,98)\">*</span>kwargs):\n<span class=\"ansi-green-fg ansi-bold\">      3</span>     <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">Show a PIL or PyTorch image on `ax`.</span><span style=\"color:rgb(175,0,0)\">\"</span>\n<span class=\"ansi-green-fg ansi-bold\">      4</span>     <span style=\"font-weight:bold;color:rgb(0,135,0)\">if</span> fc<span style=\"color:rgb(98,98,98)\">.</span>hasattrs(im, (<span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">cpu</span><span style=\"color:rgb(175,0,0)\">'</span>,<span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">permute</span><span style=\"color:rgb(175,0,0)\">'</span>,<span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">detach</span><span style=\"color:rgb(175,0,0)\">'</span>)):\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'fc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#094f1f1f .cell execution_count=36}\n``` {.python .cell-code}\nhelp(show_image)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[36], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> help(<span class=\"ansi-yellow-bg\">show_image</span>)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'show_image' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#6a1da2be .cell execution_count=37}\n``` {.python .cell-code}\nshow_image(img, figsize=(2,2));\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[37], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">show_image</span>(img, figsize<span style=\"color:rgb(98,98,98)\">=</span>(<span style=\"color:rgb(98,98,98)\">2</span>,<span style=\"color:rgb(98,98,98)\">2</span>));\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'show_image' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#d4bcda3a .cell execution_count=38}\n``` {.python .cell-code}\nfig,axs = plt.subplots(1,2)\nshow_image(img, axs[0])\nshow_image(xb[1], axs[1]);\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[38], line 2</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> fig,axs <span style=\"color:rgb(98,98,98)\">=</span> plt<span style=\"color:rgb(98,98,98)\">.</span>subplots(<span style=\"color:rgb(98,98,98)\">1</span>,<span style=\"color:rgb(98,98,98)\">2</span>)\n<span class=\"ansi-green-fg\">----&gt; 2</span> <span class=\"ansi-yellow-bg\">show_image</span>(img, axs[<span style=\"color:rgb(98,98,98)\">0</span>])\n<span class=\"ansi-green-fg ansi-bold\">      3</span> show_image(xb[<span style=\"color:rgb(98,98,98)\">1</span>], axs[<span style=\"color:rgb(98,98,98)\">1</span>]);\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'show_image' is not defined</pre>\n```\n:::\n\n:::\n\n::: {.cell-output .cell-output-display}\n![](05_datasets_files/figure-html/cell-39-output-2.png){width=581 height=416}\n:::\n:::\n\n\n::: {#f81575d0 .cell 0='e' 1='x' 2='p' 3='o' 4='r' 5='t' execution_count=39}\n``` {.python .cell-code}\n@fc.delegates(plt.subplots, keep=True)\ndef subplots(\n    nrows:int=1, # Number of rows in returned axes grid\n    ncols:int=1, # Number of columns in returned axes grid\n    figsize:tuple=None, # Width, height in inches of the returned figure\n    imsize:int=3, # Size (in inches) of images that will be displayed in the returned figure\n    suptitle:str=None, # Title to be set to returned figure\n    **kwargs\n): # fig and axs\n    \"A figure and set of subplots to display images of `imsize` inches\"\n    if figsize is None: figsize=(ncols*imsize, nrows*imsize)\n    fig,ax = plt.subplots(nrows, ncols, figsize=figsize, **kwargs)\n    if suptitle is not None: fig.suptitle(suptitle)\n    if nrows*ncols==1: ax = np.array([ax])\n    return fig,ax\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[39], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span style=\"color:rgb(175,0,255)\">@fc</span><span style=\"color:rgb(98,98,98)\">.</span>delegates(plt<span style=\"color:rgb(98,98,98)\">.</span>subplots, keep<span style=\"color:rgb(98,98,98)\">=</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">True</span>)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">def</span> <span style=\"color:rgb(0,0,255)\">subplots</span>(\n<span class=\"ansi-green-fg ansi-bold\">      3</span>     nrows:<span style=\"color:rgb(0,135,0)\">int</span><span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"font-style:italic;color:rgb(95,135,135)\"># Number of rows in returned axes grid</span>\n<span class=\"ansi-green-fg ansi-bold\">      4</span>     ncols:<span style=\"color:rgb(0,135,0)\">int</span><span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(98,98,98)\">1</span>, <span style=\"font-style:italic;color:rgb(95,135,135)\"># Number of columns in returned axes grid</span>\n<span class=\"ansi-green-fg ansi-bold\">      5</span>     figsize:<span style=\"color:rgb(0,135,0)\">tuple</span><span style=\"color:rgb(98,98,98)\">=</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span>, <span style=\"font-style:italic;color:rgb(95,135,135)\"># Width, height in inches of the returned figure</span>\n<span class=\"ansi-green-fg ansi-bold\">      6</span>     imsize:<span style=\"color:rgb(0,135,0)\">int</span><span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(98,98,98)\">3</span>, <span style=\"font-style:italic;color:rgb(95,135,135)\"># Size (in inches) of images that will be displayed in the returned figure</span>\n<span class=\"ansi-green-fg ansi-bold\">      7</span>     suptitle:<span style=\"color:rgb(0,135,0)\">str</span><span style=\"color:rgb(98,98,98)\">=</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span>, <span style=\"font-style:italic;color:rgb(95,135,135)\"># Title to be set to returned figure</span>\n<span class=\"ansi-green-fg ansi-bold\">      8</span>     <span style=\"color:rgb(98,98,98)\">*</span><span style=\"color:rgb(98,98,98)\">*</span>kwargs\n<span class=\"ansi-green-fg ansi-bold\">      9</span> ): <span style=\"font-style:italic;color:rgb(95,135,135)\"># fig and axs</span>\n<span class=\"ansi-green-fg ansi-bold\">     10</span>     <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">A figure and set of subplots to display images of `imsize` inches</span><span style=\"color:rgb(175,0,0)\">\"</span>\n<span class=\"ansi-green-fg ansi-bold\">     11</span>     <span style=\"font-weight:bold;color:rgb(0,135,0)\">if</span> figsize <span style=\"font-weight:bold;color:rgb(175,0,255)\">is</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span>: figsize<span style=\"color:rgb(98,98,98)\">=</span>(ncols<span style=\"color:rgb(98,98,98)\">*</span>imsize, nrows<span style=\"color:rgb(98,98,98)\">*</span>imsize)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'fc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#9efc5101 .cell execution_count=40}\n``` {.python .cell-code}\nfrom nbdev.showdoc import show_doc\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">ModuleNotFoundError</span>                       Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[40], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">nbdev</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">showdoc</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> show_doc\n\n<span class=\"ansi-red-fg\">ModuleNotFoundError</span>: No module named 'nbdev'</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#2856d658 .cell execution_count=41}\n``` {.python .cell-code}\nshow_doc(subplots)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[41], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">show_doc</span>(subplots)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'show_doc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#a69bef76 .cell execution_count=42}\n``` {.python .cell-code}\nfig,axs = subplots(3,3, imsize=1)\nimgs = xb[:8]\nfor ax,img in zip(axs.flat,imgs): show_image(img, ax)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[42], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> fig,axs <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">subplots</span>(<span style=\"color:rgb(98,98,98)\">3</span>,<span style=\"color:rgb(98,98,98)\">3</span>, imsize<span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(98,98,98)\">1</span>)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> imgs <span style=\"color:rgb(98,98,98)\">=</span> xb[:<span style=\"color:rgb(98,98,98)\">8</span>]\n<span class=\"ansi-green-fg ansi-bold\">      3</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">for</span> ax,img <span style=\"font-weight:bold;color:rgb(175,0,255)\">in</span> <span style=\"color:rgb(0,135,0)\">zip</span>(axs<span style=\"color:rgb(98,98,98)\">.</span>flat,imgs): show_image(img, ax)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'subplots' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#dc3c50dd .cell 0='e' 1='x' 2='p' 3='o' 4='r' 5='t' execution_count=43}\n``` {.python .cell-code}\n@fc.delegates(subplots)\ndef get_grid(\n    n:int, # Number of axes\n    nrows:int=None, # Number of rows, defaulting to `int(math.sqrt(n))`\n    ncols:int=None, # Number of columns, defaulting to `ceil(n/rows)`\n    title:str=None, # If passed, title set to the figure\n    weight:str='bold', # Title font weight\n    size:int=14, # Title font size\n    **kwargs,\n): # fig and axs\n    \"Return a grid of `n` axes, `rows` by `cols`\"\n    if nrows: ncols = ncols or int(np.floor(n/nrows))\n    elif ncols: nrows = nrows or int(np.ceil(n/ncols))\n    else:\n        nrows = int(math.sqrt(n))\n        ncols = int(np.floor(n/nrows))\n    fig,axs = subplots(nrows, ncols, **kwargs)\n    for i in range(n, nrows*ncols): axs.flat[i].set_axis_off()\n    if title is not None: fig.suptitle(title, weight=weight, size=size)\n    return fig,axs\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[43], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span style=\"color:rgb(175,0,255)\">@fc</span><span style=\"color:rgb(98,98,98)\">.</span>delegates(subplots)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">def</span> <span style=\"color:rgb(0,0,255)\">get_grid</span>(\n<span class=\"ansi-green-fg ansi-bold\">      3</span>     n:<span style=\"color:rgb(0,135,0)\">int</span>, <span style=\"font-style:italic;color:rgb(95,135,135)\"># Number of axes</span>\n<span class=\"ansi-green-fg ansi-bold\">      4</span>     nrows:<span style=\"color:rgb(0,135,0)\">int</span><span style=\"color:rgb(98,98,98)\">=</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span>, <span style=\"font-style:italic;color:rgb(95,135,135)\"># Number of rows, defaulting to `int(math.sqrt(n))`</span>\n<span class=\"ansi-green-fg ansi-bold\">      5</span>     ncols:<span style=\"color:rgb(0,135,0)\">int</span><span style=\"color:rgb(98,98,98)\">=</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span>, <span style=\"font-style:italic;color:rgb(95,135,135)\"># Number of columns, defaulting to `ceil(n/rows)`</span>\n<span class=\"ansi-green-fg ansi-bold\">      6</span>     title:<span style=\"color:rgb(0,135,0)\">str</span><span style=\"color:rgb(98,98,98)\">=</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span>, <span style=\"font-style:italic;color:rgb(95,135,135)\"># If passed, title set to the figure</span>\n<span class=\"ansi-green-fg ansi-bold\">      7</span>     weight:<span style=\"color:rgb(0,135,0)\">str</span><span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">bold</span><span style=\"color:rgb(175,0,0)\">'</span>, <span style=\"font-style:italic;color:rgb(95,135,135)\"># Title font weight</span>\n<span class=\"ansi-green-fg ansi-bold\">      8</span>     size:<span style=\"color:rgb(0,135,0)\">int</span><span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(98,98,98)\">14</span>, <span style=\"font-style:italic;color:rgb(95,135,135)\"># Title font size</span>\n<span class=\"ansi-green-fg ansi-bold\">      9</span>     <span style=\"color:rgb(98,98,98)\">*</span><span style=\"color:rgb(98,98,98)\">*</span>kwargs,\n<span class=\"ansi-green-fg ansi-bold\">     10</span> ): <span style=\"font-style:italic;color:rgb(95,135,135)\"># fig and axs</span>\n<span class=\"ansi-green-fg ansi-bold\">     11</span>     <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">Return a grid of `n` axes, `rows` by `cols`</span><span style=\"color:rgb(175,0,0)\">\"</span>\n<span class=\"ansi-green-fg ansi-bold\">     12</span>     <span style=\"font-weight:bold;color:rgb(0,135,0)\">if</span> nrows: ncols <span style=\"color:rgb(98,98,98)\">=</span> ncols <span style=\"font-weight:bold;color:rgb(175,0,255)\">or</span> <span style=\"color:rgb(0,135,0)\">int</span>(np<span style=\"color:rgb(98,98,98)\">.</span>floor(n<span style=\"color:rgb(98,98,98)\">/</span>nrows))\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'fc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#384c94f9 .cell execution_count=44}\n``` {.python .cell-code}\nfig,axs = get_grid(8, nrows=3, imsize=1)\nfor ax,img in zip(axs.flat,imgs): show_image(img, ax)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[44], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> fig,axs <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">get_grid</span>(<span style=\"color:rgb(98,98,98)\">8</span>, nrows<span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(98,98,98)\">3</span>, imsize<span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(98,98,98)\">1</span>)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">for</span> ax,img <span style=\"font-weight:bold;color:rgb(175,0,255)\">in</span> <span style=\"color:rgb(0,135,0)\">zip</span>(axs<span style=\"color:rgb(98,98,98)\">.</span>flat,imgs): show_image(img, ax)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'get_grid' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#bb20a5d8 .cell 0='e' 1='x' 2='p' 3='o' 4='r' 5='t' execution_count=45}\n``` {.python .cell-code}\n@fc.delegates(subplots)\ndef show_images(ims:list, # Images to show\n                nrows:int|None=None, # Number of rows in grid\n                ncols:int|None=None, # Number of columns in grid (auto-calculated if None)\n                titles:list|None=None, # Optional list of titles for each image\n                **kwargs):\n    \"Show all images `ims` as subplots with `rows` using `titles`\"\n    axs = get_grid(len(ims), nrows, ncols, **kwargs)[1].flat\n    for im,t,ax in zip_longest(ims, titles or [], axs): show_image(im, ax=ax, title=t)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[45], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span style=\"color:rgb(175,0,255)\">@fc</span><span style=\"color:rgb(98,98,98)\">.</span>delegates(subplots)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">def</span> <span style=\"color:rgb(0,0,255)\">show_images</span>(ims:<span style=\"color:rgb(0,135,0)\">list</span>, <span style=\"font-style:italic;color:rgb(95,135,135)\"># Images to show</span>\n<span class=\"ansi-green-fg ansi-bold\">      3</span>                 nrows:<span style=\"color:rgb(0,135,0)\">int</span><span style=\"color:rgb(98,98,98)\">|</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span><span style=\"color:rgb(98,98,98)\">=</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span>, <span style=\"font-style:italic;color:rgb(95,135,135)\"># Number of rows in grid</span>\n<span class=\"ansi-green-fg ansi-bold\">      4</span>                 ncols:<span style=\"color:rgb(0,135,0)\">int</span><span style=\"color:rgb(98,98,98)\">|</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span><span style=\"color:rgb(98,98,98)\">=</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span>, <span style=\"font-style:italic;color:rgb(95,135,135)\"># Number of columns in grid (auto-calculated if None)</span>\n<span class=\"ansi-green-fg ansi-bold\">      5</span>                 titles:<span style=\"color:rgb(0,135,0)\">list</span><span style=\"color:rgb(98,98,98)\">|</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span><span style=\"color:rgb(98,98,98)\">=</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">None</span>, <span style=\"font-style:italic;color:rgb(95,135,135)\"># Optional list of titles for each image</span>\n<span class=\"ansi-green-fg ansi-bold\">      6</span>                 <span style=\"color:rgb(98,98,98)\">*</span><span style=\"color:rgb(98,98,98)\">*</span>kwargs):\n<span class=\"ansi-green-fg ansi-bold\">      7</span>     <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">Show all images `ims` as subplots with `rows` using `titles`</span><span style=\"color:rgb(175,0,0)\">\"</span>\n<span class=\"ansi-green-fg ansi-bold\">      8</span>     axs <span style=\"color:rgb(98,98,98)\">=</span> get_grid(<span style=\"color:rgb(0,135,0)\">len</span>(ims), nrows, ncols, <span style=\"color:rgb(98,98,98)\">*</span><span style=\"color:rgb(98,98,98)\">*</span>kwargs)[<span style=\"color:rgb(98,98,98)\">1</span>]<span style=\"color:rgb(98,98,98)\">.</span>flat\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'fc' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#e45db5c9 .cell execution_count=46}\n``` {.python .cell-code}\nyb = b['label']\nlbls = yb[:8]\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[46], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> yb <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">b</span>[<span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">label</span><span style=\"color:rgb(175,0,0)\">'</span>]\n<span class=\"ansi-green-fg ansi-bold\">      2</span> lbls <span style=\"color:rgb(98,98,98)\">=</span> yb[:<span style=\"color:rgb(98,98,98)\">8</span>]\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'b' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#0f41e168 .cell execution_count=47}\n``` {.python .cell-code}\nnames = \"Top Trouser Pullover Dress Coat Sandal Shirt Sneaker Bag Boot\".split()\ntitles = itemgetter(*lbls)(names)\n' '.join(titles)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[47], line 2</span>\n<span class=\"ansi-green-fg ansi-bold\">      1</span> names <span style=\"color:rgb(98,98,98)\">=</span> <span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">Top Trouser Pullover Dress Coat Sandal Shirt Sneaker Bag Boot</span><span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(98,98,98)\">.</span>split()\n<span class=\"ansi-green-fg\">----&gt; 2</span> titles <span style=\"color:rgb(98,98,98)\">=</span> itemgetter(<span style=\"color:rgb(98,98,98)\">*</span><span class=\"ansi-yellow-bg\">lbls</span>)(names)\n<span class=\"ansi-green-fg ansi-bold\">      3</span> <span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\"> </span><span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(98,98,98)\">.</span>join(titles)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'lbls' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#e749927a .cell execution_count=48}\n``` {.python .cell-code}\nshow_images(imgs, imsize=1.7, titles=titles)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[48], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">show_images</span>(imgs, imsize<span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(98,98,98)\">1.7</span>, titles<span style=\"color:rgb(98,98,98)\">=</span>titles)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'show_images' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#6d411813 .cell 0='e' 1='x' 2='p' 3='o' 4='r' 5='t' execution_count=49}\n``` {.python .cell-code}\nclass DataLoaders:\n    def __init__(self, *dls): self.train,self.valid = dls[:2]\n\n    @classmethod\n    def from_dd(cls, dd, batch_size, as_tuple=True, **kwargs):\n        f = collate_dict(dd['train'])\n        return cls(*get_dls(*dd.values(), bs=batch_size, collate_fn=f, **kwargs))\n```\n:::\n\n\n## Export -\n\n::: {#8c60fd10 .cell execution_count=50}\n``` {.python .cell-code}\nimport nbdev; nbdev.nbdev_export()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">ModuleNotFoundError</span>                       Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[50], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">nbdev</span>; nbdev<span style=\"color:rgb(98,98,98)\">.</span>nbdev_export()\n\n<span class=\"ansi-red-fg\">ModuleNotFoundError</span>: No module named 'nbdev'</pre>\n```\n:::\n\n:::\n:::\n\n\n",
    "supporting": [
      "05_datasets_files"
    ],
    "filters": [],
    "includes": {}
  }
}