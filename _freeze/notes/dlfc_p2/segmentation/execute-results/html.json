{
  "hash": "6e9de541f7eaf53266d4424d2acaea90",
  "result": {
    "engine": "jupyter",
    "markdown": "---\njupyter: python3\n---\n\n::: {#465bdd50 .cell execution_count=1}\n``` {.python .cell-code}\nimport fastcore.all as fc\n```\n:::\n\n\n::: {#9c272e6c .cell execution_count=2}\n``` {.python .cell-code}\nurl = 'https://s3.amazonaws.com/fast-ai-imagelocal/camvid.tgz'\n```\n:::\n\n\n::: {#771c70b9 .cell execution_count=3}\n``` {.python .cell-code}\nfrom pathlib import Path\nimport pickle,gzip, math,os,time,shutil,matplotlib as mpl,matplotlib.pyplot as plt\nfrom glob import glob\nfrom torch import tensor\n\nfrom miniai.datasets import *\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">ImportError</span>                               Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[3], line 4</span>\n<span class=\"ansi-green-fg ansi-bold\">      2</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">pickle</span><span style=\"color:rgb(98,98,98)\">,</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">gzip</span><span style=\"color:rgb(98,98,98)\">,</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">math</span><span style=\"color:rgb(98,98,98)\">,</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">os</span><span style=\"color:rgb(98,98,98)\">,</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">time</span><span style=\"color:rgb(98,98,98)\">,</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">shutil</span><span style=\"color:rgb(98,98,98)\">,</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">matplotlib</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">as</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">mpl</span><span style=\"color:rgb(98,98,98)\">,</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">matplotlib</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">pyplot</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">as</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">plt</span>\n<span class=\"ansi-green-fg ansi-bold\">      3</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">glob</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> glob\n<span class=\"ansi-green-fg\">----&gt; 4</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">torch</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> tensor\n<span class=\"ansi-green-fg ansi-bold\">      6</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">miniai</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">datasets</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"color:rgb(98,98,98)\">*</span>\n\nFile <span class=\"ansi-green-fg\">~/work/blog/.venv/lib/python3.10/site-packages/torch/__init__.py:237</span>\n<span class=\"ansi-green-fg ansi-bold\">    235</span>     <span style=\"font-weight:bold;color:rgb(0,135,0)\">if</span> USE_GLOBAL_DEPS:\n<span class=\"ansi-green-fg ansi-bold\">    236</span>         _load_global_deps()\n<span class=\"ansi-green-fg\">--&gt; 237</span>     <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">torch</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">_C</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"color:rgb(98,98,98)\">*</span>  <span style=\"font-style:italic;color:rgb(95,135,135)\"># noqa: F403</span>\n<span class=\"ansi-green-fg ansi-bold\">    239</span> <span style=\"font-style:italic;color:rgb(95,135,135)\"># Appease the type checker; ordinarily this binding is inserted by the</span>\n<span class=\"ansi-green-fg ansi-bold\">    240</span> <span style=\"font-style:italic;color:rgb(95,135,135)\"># torch._C module initialization code in C</span>\n<span class=\"ansi-green-fg ansi-bold\">    241</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">if</span> TYPE_CHECKING:\n\n<span class=\"ansi-red-fg\">ImportError</span>: libcudnn.so.8: cannot open shared object file: No such file or directory</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#612211a6 .cell execution_count=4}\n``` {.python .cell-code}\npath = Path('data/camvid')\n```\n:::\n\n\n::: {#7e55e040 .cell execution_count=5}\n``` {.python .cell-code}\nif not path.exists():\n    path_tgz = fc.urlsave(url, 'data')\n    shutil.unpack_archive(str(path_tgz), 'data')\n```\n:::\n\n\n::: {#66d0ad94 .cell execution_count=6}\n``` {.python .cell-code}\npath.ls()\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```\n(#4) [Path('data/camvid/valid.txt'),Path('data/camvid/codes.txt'),Path('data/camvid/images'),Path('data/camvid/labels')]\n```\n:::\n:::\n\n\n::: {#1b051c5d .cell execution_count=7}\n``` {.python .cell-code}\npath_lbl = path/'labels'\npath_img = path/'images'\n```\n:::\n\n\n::: {#b36e474a .cell execution_count=8}\n``` {.python .cell-code}\nfnames = glob(str(path_img/'*.png'))\nlbl_names = glob(str(path_lbl/'*.png'))\n```\n:::\n\n\n::: {#dbe7d8cc .cell execution_count=9}\n``` {.python .cell-code}\nimg_f = Path(fnames[0])\n```\n:::\n\n\n::: {#645a0023 .cell execution_count=10}\n``` {.python .cell-code}\nimg_f\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```\nPath('data/camvid/images/0016E5_08083.png')\n```\n:::\n:::\n\n\n::: {#1d1d128a .cell execution_count=11}\n``` {.python .cell-code}\nfrom torchvision.io import read_image\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">ImportError</span>                               Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[11], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">torchvision</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">io</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> read_image\n\nFile <span class=\"ansi-green-fg\">~/work/blog/.venv/lib/python3.10/site-packages/torchvision/__init__.py:5</span>\n<span class=\"ansi-green-fg ansi-bold\">      2</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">warnings</span>\n<span class=\"ansi-green-fg ansi-bold\">      3</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">modulefinder</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> Module\n<span class=\"ansi-green-fg\">----&gt; 5</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">torch</span>\n<span class=\"ansi-green-fg ansi-bold\">      6</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">torchvision</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> _meta_registrations, datasets, io, models, ops, transforms, utils\n<span class=\"ansi-green-fg ansi-bold\">      8</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">extension</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> _HAS_OPS\n\nFile <span class=\"ansi-green-fg\">~/work/blog/.venv/lib/python3.10/site-packages/torch/__init__.py:237</span>\n<span class=\"ansi-green-fg ansi-bold\">    235</span>     <span style=\"font-weight:bold;color:rgb(0,135,0)\">if</span> USE_GLOBAL_DEPS:\n<span class=\"ansi-green-fg ansi-bold\">    236</span>         _load_global_deps()\n<span class=\"ansi-green-fg\">--&gt; 237</span>     <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">torch</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">_C</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"color:rgb(98,98,98)\">*</span>  <span style=\"font-style:italic;color:rgb(95,135,135)\"># noqa: F403</span>\n<span class=\"ansi-green-fg ansi-bold\">    239</span> <span style=\"font-style:italic;color:rgb(95,135,135)\"># Appease the type checker; ordinarily this binding is inserted by the</span>\n<span class=\"ansi-green-fg ansi-bold\">    240</span> <span style=\"font-style:italic;color:rgb(95,135,135)\"># torch._C module initialization code in C</span>\n<span class=\"ansi-green-fg ansi-bold\">    241</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">if</span> TYPE_CHECKING:\n\n<span class=\"ansi-red-fg\">ImportError</span>: libcudnn.so.8: cannot open shared object file: No such file or directory</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#4ddf08d7 .cell execution_count=12}\n``` {.python .cell-code}\nimg = read_image(str(img_f))/255\nimg.shape\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[12], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> img <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">read_image</span>(<span style=\"color:rgb(0,135,0)\">str</span>(img_f))<span style=\"color:rgb(98,98,98)\">/</span><span style=\"color:rgb(98,98,98)\">255</span>\n<span class=\"ansi-green-fg ansi-bold\">      2</span> img<span style=\"color:rgb(98,98,98)\">.</span>shape\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'read_image' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#cda12899 .cell execution_count=13}\n``` {.python .cell-code}\nshow_image(img);\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[13], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">show_image</span>(img);\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'show_image' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#65b999f7 .cell execution_count=14}\n``` {.python .cell-code}\nshow_image((img*2).clamp_max(1));\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[14], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">show_image</span>((img<span style=\"color:rgb(98,98,98)\">*</span><span style=\"color:rgb(98,98,98)\">2</span>)<span style=\"color:rgb(98,98,98)\">.</span>clamp_max(<span style=\"color:rgb(98,98,98)\">1</span>));\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'show_image' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#5df8b83f .cell execution_count=15}\n``` {.python .cell-code}\nshow_image((img.clamp(0.001,0.999).logit()+1).sigmoid());\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[15], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">show_image</span>((img<span style=\"color:rgb(98,98,98)\">.</span>clamp(<span style=\"color:rgb(98,98,98)\">0.001</span>,<span style=\"color:rgb(98,98,98)\">0.999</span>)<span style=\"color:rgb(98,98,98)\">.</span>logit()<span style=\"color:rgb(98,98,98)\">+</span><span style=\"color:rgb(98,98,98)\">1</span>)<span style=\"color:rgb(98,98,98)\">.</span>sigmoid());\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'show_image' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#a9e3ca76 .cell execution_count=16}\n``` {.python .cell-code}\ndef get_y_fn(x): return path_lbl/f'{x.stem}_P{x.suffix}'\n```\n:::\n\n\n::: {#8daa6a48 .cell execution_count=17}\n``` {.python .cell-code}\nmask_f = get_y_fn(img_f)\n```\n:::\n\n\n::: {#cc4c4d24 .cell execution_count=18}\n``` {.python .cell-code}\nmask = read_image(str(mask_f))\nmask.shape\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[18], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> mask <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">read_image</span>(<span style=\"color:rgb(0,135,0)\">str</span>(mask_f))\n<span class=\"ansi-green-fg ansi-bold\">      2</span> mask<span style=\"color:rgb(98,98,98)\">.</span>shape\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'read_image' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#24de39ea .cell execution_count=19}\n``` {.python .cell-code}\nshow_image(mask, cmap='tab20');\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[19], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">show_image</span>(mask, cmap<span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">tab20</span><span style=\"color:rgb(175,0,0)\">'</span>);\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'show_image' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#04abe6e0 .cell execution_count=20}\n``` {.python .cell-code}\nax = show_image(img)\nshow_image(mask, ax=ax, cmap='tab20', alpha=0.5);\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[20], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> ax <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">show_image</span>(img)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> show_image(mask, ax<span style=\"color:rgb(98,98,98)\">=</span>ax, cmap<span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">tab20</span><span style=\"color:rgb(175,0,0)\">'</span>, alpha<span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(98,98,98)\">0.5</span>);\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'show_image' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#015b5055 .cell execution_count=21}\n``` {.python .cell-code}\ncodes = (path/'codes.txt').read_text().splitlines(False)\n' '.join(codes)\n```\n\n::: {.cell-output .cell-output-display execution_count=21}\n```\n'Animal Archway Bicyclist Bridge Building Car CartLuggagePram Child Column_Pole Fence LaneMkgsDriv LaneMkgsNonDriv Misc_Text MotorcycleScooter OtherMoving ParkingBlock Pedestrian Road RoadShoulder Sidewalk SignSymbol Sky SUVPickupTruck TrafficCone TrafficLight Train Tree Truck_Bus Tunnel VegetationMisc Void Wall'\n```\n:::\n:::\n\n\n::: {#bb7f38e3 .cell execution_count=22}\n``` {.python .cell-code}\ncodes[26]\n```\n\n::: {.cell-output .cell-output-display execution_count=22}\n```\n'Tree'\n```\n:::\n:::\n\n\n::: {#0e1ab198 .cell execution_count=23}\n``` {.python .cell-code}\nsrc_size = tensor(mask.shape[1:])\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[23], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> src_size <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">tensor</span>(mask<span style=\"color:rgb(98,98,98)\">.</span>shape[<span style=\"color:rgb(98,98,98)\">1</span>:])\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'tensor' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#c3978b81 .cell execution_count=24}\n``` {.python .cell-code}\nvalids = set((path/'valid.txt').read_text().splitlines(False))\nlist(valids)[:5]\n```\n\n::: {.cell-output .cell-output-display execution_count=24}\n```\n['0016E5_08053.png',\n '0016E5_08001.png',\n '0016E5_08101.png',\n '0016E5_08011.png',\n '0016E5_08151.png']\n```\n:::\n:::\n\n\n::: {#f060b3fd .cell execution_count=25}\n``` {.python .cell-code}\nimg = read_image(str(img_f))\nimg.shape\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[25], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> img <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">read_image</span>(<span style=\"color:rgb(0,135,0)\">str</span>(img_f))\n<span class=\"ansi-green-fg ansi-bold\">      2</span> img<span style=\"color:rgb(98,98,98)\">.</span>shape\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'read_image' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#715df3ac .cell execution_count=26}\n``` {.python .cell-code}\nfrom fastai.vision.all import *\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">ImportError</span>                               Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[26], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">fastai</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">vision</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">all</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"color:rgb(98,98,98)\">*</span>\n\nFile <span class=\"ansi-green-fg\">~/work/blog/.venv/lib/python3.10/site-packages/fastai/vision/all.py:1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> models\n<span class=\"ansi-green-fg ansi-bold\">      2</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">basics</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"color:rgb(98,98,98)\">*</span>\n<span class=\"ansi-green-fg ansi-bold\">      3</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">callback</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">all</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"color:rgb(98,98,98)\">*</span>\n\nFile <span class=\"ansi-green-fg\">~/work/blog/.venv/lib/python3.10/site-packages/fastai/vision/models/__init__.py:1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> xresnet\n<span class=\"ansi-green-fg ansi-bold\">      2</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> unet\n<span class=\"ansi-green-fg ansi-bold\">      3</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">tvm</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"color:rgb(98,98,98)\">*</span>\n\nFile <span class=\"ansi-green-fg\">~/work/blog/.venv/lib/python3.10/site-packages/fastai/vision/models/xresnet.py:7</span>\n<span class=\"ansi-green-fg ansi-bold\">      3</span> <span style=\"font-style:italic;color:rgb(95,135,135)\"># AUTOGENERATED! DO NOT EDIT! File to edit: ../../../nbs/11_vision.models.xresnet.ipynb.</span>\n<span class=\"ansi-green-fg ansi-bold\">      4</span> \n<span class=\"ansi-green-fg ansi-bold\">      5</span> <span style=\"font-style:italic;color:rgb(95,135,135)\"># %% ../../../nbs/11_vision.models.xresnet.ipynb 2</span>\n<span class=\"ansi-green-fg ansi-bold\">      6</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">__future__</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> annotations\n<span class=\"ansi-green-fg\">----&gt; 7</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">torch_basics</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"color:rgb(98,98,98)\">*</span>\n<span class=\"ansi-green-fg ansi-bold\">      8</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">try</span>: <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">torchvision</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">models</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">utils</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> load_state_dict_from_url\n<span class=\"ansi-green-fg ansi-bold\">      9</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">except</span> <span style=\"font-weight:bold;color:rgb(215,95,95)\">ModuleNotFoundError</span>: <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">torch</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">hub</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> load_state_dict_from_url\n\nFile <span class=\"ansi-green-fg\">~/work/blog/.venv/lib/python3.10/site-packages/fastai/torch_basics.py:1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">torch</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> multiprocessing\n<span class=\"ansi-green-fg ansi-bold\">      2</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">platform</span><span style=\"color:rgb(98,98,98)\">,</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">os</span>\n<span class=\"ansi-green-fg ansi-bold\">      3</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">if</span> platform<span style=\"color:rgb(98,98,98)\">.</span>system()<span style=\"color:rgb(98,98,98)\">==</span><span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">Darwin</span><span style=\"color:rgb(175,0,0)\">'</span>:\n<span class=\"ansi-green-fg ansi-bold\">      4</span>     <span style=\"font-style:italic;color:rgb(95,135,135)\"># Python 3.8 changed to 'spawn' but that doesn't work with PyTorch DataLoader w n_workers&gt;0</span>\n\nFile <span class=\"ansi-green-fg\">~/work/blog/.venv/lib/python3.10/site-packages/torch/__init__.py:237</span>\n<span class=\"ansi-green-fg ansi-bold\">    235</span>     <span style=\"font-weight:bold;color:rgb(0,135,0)\">if</span> USE_GLOBAL_DEPS:\n<span class=\"ansi-green-fg ansi-bold\">    236</span>         _load_global_deps()\n<span class=\"ansi-green-fg\">--&gt; 237</span>     <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">torch</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">.</span><span style=\"font-weight:bold;color:rgb(0,0,255)\">_C</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"color:rgb(98,98,98)\">*</span>  <span style=\"font-style:italic;color:rgb(95,135,135)\"># noqa: F403</span>\n<span class=\"ansi-green-fg ansi-bold\">    239</span> <span style=\"font-style:italic;color:rgb(95,135,135)\"># Appease the type checker; ordinarily this binding is inserted by the</span>\n<span class=\"ansi-green-fg ansi-bold\">    240</span> <span style=\"font-style:italic;color:rgb(95,135,135)\"># torch._C module initialization code in C</span>\n<span class=\"ansi-green-fg ansi-bold\">    241</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">if</span> TYPE_CHECKING:\n\n<span class=\"ansi-red-fg\">ImportError</span>: libcudnn.so.8: cannot open shared object file: No such file or directory</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#67f2380a .cell execution_count=27}\n``` {.python .cell-code}\nbs = 8\n```\n:::\n\n\n::: {#3f05c32b .cell execution_count=28}\n``` {.python .cell-code}\ndblock = DataBlock(blocks=(ImageBlock(), MaskBlock(codes=codes)),\n                   splitter=FuncSplitter(lambda o: o.name in valids),\n                   get_y=get_y_fn,\n                   item_tfms=Resize((720//4,960//4)))\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[28], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> dblock <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">DataBlock</span>(blocks<span style=\"color:rgb(98,98,98)\">=</span>(ImageBlock(), MaskBlock(codes<span style=\"color:rgb(98,98,98)\">=</span>codes)),\n<span class=\"ansi-green-fg ansi-bold\">      2</span>                    splitter<span style=\"color:rgb(98,98,98)\">=</span>FuncSplitter(<span style=\"font-weight:bold;color:rgb(0,135,0)\">lambda</span> o: o<span style=\"color:rgb(98,98,98)\">.</span>name <span style=\"font-weight:bold;color:rgb(175,0,255)\">in</span> valids),\n<span class=\"ansi-green-fg ansi-bold\">      3</span>                    get_y<span style=\"color:rgb(98,98,98)\">=</span>get_y_fn,\n<span class=\"ansi-green-fg ansi-bold\">      4</span>                    item_tfms<span style=\"color:rgb(98,98,98)\">=</span>Resize((<span style=\"color:rgb(98,98,98)\">720</span><span style=\"color:rgb(98,98,98)\">/</span><span style=\"color:rgb(98,98,98)\">/</span><span style=\"color:rgb(98,98,98)\">4</span>,<span style=\"color:rgb(98,98,98)\">960</span><span style=\"color:rgb(98,98,98)\">/</span><span style=\"color:rgb(98,98,98)\">/</span><span style=\"color:rgb(98,98,98)\">4</span>)))\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'DataBlock' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#5d4dc942 .cell execution_count=29}\n``` {.python .cell-code}\nimg_files = get_image_files(path/\"images\")\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[29], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> img_files <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">get_image_files</span>(path<span style=\"color:rgb(98,98,98)\">/</span><span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">images</span><span style=\"color:rgb(175,0,0)\">\"</span>)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'get_image_files' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#8c54a64a .cell execution_count=30}\n``` {.python .cell-code}\ndls = dblock.dataloaders(img_files, path=path, num_workers=4)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[30], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> dls <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">dblock</span><span style=\"color:rgb(98,98,98)\">.</span>dataloaders(img_files, path<span style=\"color:rgb(98,98,98)\">=</span>path, num_workers<span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(98,98,98)\">4</span>)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'dblock' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#bf4302d8 .cell execution_count=31}\n``` {.python .cell-code}\nxb,yb = next(iter(dls.train))\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[31], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> xb,yb <span style=\"color:rgb(98,98,98)\">=</span> <span style=\"color:rgb(0,135,0)\">next</span>(<span style=\"color:rgb(0,135,0)\">iter</span>(<span class=\"ansi-yellow-bg\">dls</span><span style=\"color:rgb(98,98,98)\">.</span>train))\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'dls' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#15788f1c .cell execution_count=32}\n``` {.python .cell-code}\nxb.shape\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[32], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">xb</span><span style=\"color:rgb(98,98,98)\">.</span>shape\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'xb' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#65269cbd .cell execution_count=33}\n``` {.python .cell-code}\ndls.show_batch()\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[33], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">dls</span><span style=\"color:rgb(98,98,98)\">.</span>show_batch()\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'dls' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#ae3e70c1 .cell execution_count=34}\n``` {.python .cell-code}\nname2id = {v:k for k,v in enumerate(codes)}\nvoid_code = name2id['Void']\n```\n:::\n\n\n::: {#0aec2950 .cell execution_count=35}\n``` {.python .cell-code}\ndef acc_camvid(input, target):\n    target = target.squeeze(1)\n    mask = target != void_code\n    return (input.argmax(dim=1)[mask]==target[mask]).float().mean()\n```\n:::\n\n\n::: {#f498a6e3 .cell execution_count=36}\n``` {.python .cell-code}\nlearn = unet_learner(dls, resnet18, metrics=acc_camvid, pretrained=False)\nlearn.fit_one_cycle(8)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[36], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> learn <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">unet_learner</span>(dls, resnet18, metrics<span style=\"color:rgb(98,98,98)\">=</span>acc_camvid, pretrained<span style=\"color:rgb(98,98,98)\">=</span><span style=\"font-weight:bold;color:rgb(0,135,0)\">False</span>)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> learn<span style=\"color:rgb(98,98,98)\">.</span>fit_one_cycle(<span style=\"color:rgb(98,98,98)\">8</span>)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'unet_learner' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#c42fa0c8 .cell execution_count=37}\n``` {.python .cell-code}\nlearn.show_results(max_n=3, figsize=(7,8))\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[37], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">learn</span><span style=\"color:rgb(98,98,98)\">.</span>show_results(max_n<span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(98,98,98)\">3</span>, figsize<span style=\"color:rgb(98,98,98)\">=</span>(<span style=\"color:rgb(98,98,98)\">7</span>,<span style=\"color:rgb(98,98,98)\">8</span>))\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'learn' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#e975c7a0 .cell execution_count=38}\n``` {.python .cell-code}\nlearn = unet_learner(dls, resnet18, metrics=acc_camvid)\nlearn.fine_tune(8)\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[38], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> learn <span style=\"color:rgb(98,98,98)\">=</span> <span class=\"ansi-yellow-bg\">unet_learner</span>(dls, resnet18, metrics<span style=\"color:rgb(98,98,98)\">=</span>acc_camvid)\n<span class=\"ansi-green-fg ansi-bold\">      2</span> learn<span style=\"color:rgb(98,98,98)\">.</span>fine_tune(<span style=\"color:rgb(98,98,98)\">8</span>)\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'unet_learner' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n::: {#b418a355 .cell execution_count=39}\n``` {.python .cell-code}\nlearn.show_results(max_n=3, figsize=(7,8))\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg\">In[39], line 1</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span> <span class=\"ansi-yellow-bg\">learn</span><span style=\"color:rgb(98,98,98)\">.</span>show_results(max_n<span style=\"color:rgb(98,98,98)\">=</span><span style=\"color:rgb(98,98,98)\">3</span>, figsize<span style=\"color:rgb(98,98,98)\">=</span>(<span style=\"color:rgb(98,98,98)\">7</span>,<span style=\"color:rgb(98,98,98)\">8</span>))\n\n<span class=\"ansi-red-fg\">NameError</span>: name 'learn' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n",
    "supporting": [
      "segmentation_files"
    ],
    "filters": [],
    "includes": {}
  }
}