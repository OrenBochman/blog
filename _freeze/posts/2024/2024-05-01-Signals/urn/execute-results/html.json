{
  "hash": "596bfc132bd38f27373301618342ed28",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"urn using numpy\"\n---\n\nLet's create one of the most fundumental models in probability theory - the urn model.\n\nUrn models gor back to the 17th century and were first introduced by Jacob Bernoulli in his book Ars Conjectandi (1713). \n\nThe urn model is a simple model that describes the process of drawing balls from an urn. \n\nThe urn contains balls of different colors, and the goal is to study the probabilities of drawing balls of different colors.\n\n\nAlthough basic urn models can be represented with draws from well known distributions\nan the urn model is useful concrete form for thinking about probability particularly\nwhen implementing simple reinforcement learning algorithms or model with Bayesian updating.\n\nSome more complex processess in probability theory can be set up as urn model\nmaking this a useful model to understand.\n\nWhen it comes to implementing agents, we can quickly set them up for \nreinforcement or Bayesian learning by equipping the agnet with such an urn model.\n\nIn python we can implement the urn model using a numpy array to represent the balls in the urn and their counts.\n\n\n\n## The Basic Urn model \n\n::: {#c28a3f8e .cell require='altair, numpy, matplotlib, seaborn, pandas' results='hold' execution_count=2}\n``` {.python .cell-code}\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport altair as alt\nimport pandas as pd\n\nclass Urn():\n  ''' classic urn model using np array of ball counts\n      for two valls this is a simple binomial distribution\n      for more balls this is a multinomial distribution\n  '''\n  def __init__(self, ball_names=['white','black'], init='ones', weights=None):\n    '''initialize the urn with ball names and weights'''\n    self.ball_names = ball_names\n    \n    if weights is not None:\n      assert type(weights) == np.ndarray, \"Weights must be a numpy array.\"\n      assert weights.shape[0] == (len(self.ball_names)), f\"Weight shape {weights.shape} not the same as the number of balls. {len(self.ball_names)}\"\n      self.weights = weights\n    else:\n      if init == 'ones':\n        self._weights = np.ones((self.ball_colors))\n      elif init == 'zeros':\n        self._weights = np.zeros((self.ball_colors))\n      elif init == 'random':\n        self._weights = np.random.rand(self.ball_colors)\n      else:\n        raise ValueError(\"Initialization parameter must be 'ones', 'zeros', or 'random'.\")\n\n  @property\n  def ball_names(self):\n    return self._ball_names\n  \n  @ball_names.setter\n  def ball_names(self, ball_names):\n    assert type(ball_names) == list, \"Ball names must be a list.\"\n    self._ball_names = ball_names\n    self._num_balls = len(ball_names)\n\n  @property\n  def ball_colors(self):\n    return len(self.ball_names)\n\n  @property\n  def weights(self):\n    return self._weights\n  \n  @weights.setter\n  def weights(self, weights):\n    assert type(weights) == np.ndarray, \"Weights must be a numpy array.\"\n    #assert weights.shape == (self.ball_colors), \"Weights must have the same shape as the number of balls and columns.\"\n    self._weights = weights\n\n  def draw(self,n=1):\n    ''' draw a ball from the urn with replacement'''\n    row_idx = np.random.choice(self.ball_colors, p=self.weights/self.weights.sum(), size=n)\n    result = []\n    for i in range(n):\n      result.append(self.ball_names[row_idx[i]])\n    return result\n```\n:::\n\n\n::: {#45d3d3fa .cell execution_count=3}\n``` {.python .cell-code}\n#some examples\nurn = Urn()\nprint(urn.draw(10))\nprint(urn.draw(10))\nprint(urn.draw(10))\n\nurn.weights = np.array([1., 9.])\n\nprint(urn.draw(10))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n['white', 'white', 'white', 'white', 'black', 'black', 'black', 'black', 'white', 'black']\n['black', 'white', 'black', 'black', 'black', 'white', 'white', 'white', 'black', 'black']\n['black', 'black', 'black', 'black', 'white', 'black', 'black', 'white', 'black', 'black']\n['white', 'black', 'black', 'white', 'black', 'black', 'black', 'black', 'black', 'black']\n```\n:::\n:::\n\n\n::: {#74ac7948 .cell execution_count=4}\n``` {.python .cell-code}\nurn = Urn(ball_names=['red','blue','green'], weights=np.array([3., 9., 1.]))\ndf = pd.DataFrame({'balls': urn.draw(1000)})\n#alt.renderers.enable(\"html\")\nalt.Chart(df).mark_bar().encode(\n    x='balls',\n    y='count()'\n).properties(width=200, height=200)\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n\n<style>\n  #altair-viz-979c58939d2c48b09752b22839abad98.vega-embed {\n    width: 100%;\n    display: flex;\n  }\n\n  #altair-viz-979c58939d2c48b09752b22839abad98.vega-embed details,\n  #altair-viz-979c58939d2c48b09752b22839abad98.vega-embed details summary {\n    position: relative;\n  }\n</style>\n<div id=\"altair-viz-979c58939d2c48b09752b22839abad98\"></div>\n<script type=\"text/javascript\">\n  var VEGA_DEBUG = (typeof VEGA_DEBUG == \"undefined\") ? {} : VEGA_DEBUG;\n  (function(spec, embedOpt){\n    let outputDiv = document.currentScript.previousElementSibling;\n    if (outputDiv.id !== \"altair-viz-979c58939d2c48b09752b22839abad98\") {\n      outputDiv = document.getElementById(\"altair-viz-979c58939d2c48b09752b22839abad98\");\n    }\n    const paths = {\n      \"vega\": \"https://cdn.jsdelivr.net/npm/vega@5?noext\",\n      \"vega-lib\": \"https://cdn.jsdelivr.net/npm/vega-lib?noext\",\n      \"vega-lite\": \"https://cdn.jsdelivr.net/npm/vega-lite@5.16.3?noext\",\n      \"vega-embed\": \"https://cdn.jsdelivr.net/npm/vega-embed@6?noext\",\n    };\n\n    function maybeLoadScript(lib, version) {\n      var key = `${lib.replace(\"-\", \"\")}_version`;\n      return (VEGA_DEBUG[key] == version) ?\n        Promise.resolve(paths[lib]) :\n        new Promise(function(resolve, reject) {\n          var s = document.createElement('script');\n          document.getElementsByTagName(\"head\")[0].appendChild(s);\n          s.async = true;\n          s.onload = () => {\n            VEGA_DEBUG[key] = version;\n            return resolve(paths[lib]);\n          };\n          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);\n          s.src = paths[lib];\n        });\n    }\n\n    function showError(err) {\n      outputDiv.innerHTML = `<div class=\"error\" style=\"color:red;\">${err}</div>`;\n      throw err;\n    }\n\n    function displayChart(vegaEmbed) {\n      vegaEmbed(outputDiv, spec, embedOpt)\n        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));\n    }\n\n    if(typeof define === \"function\" && define.amd) {\n      requirejs.config({paths});\n      require([\"vega-embed\"], displayChart, err => showError(`Error loading script: ${err.message}`));\n    } else {\n      maybeLoadScript(\"vega\", \"5\")\n        .then(() => maybeLoadScript(\"vega-lite\", \"5.16.3\"))\n        .then(() => maybeLoadScript(\"vega-embed\", \"6\"))\n        .catch(showError)\n        .then(() => displayChart(vegaEmbed));\n    }\n  })({\"config\": {\"view\": {\"continuousWidth\": 300, \"continuousHeight\": 300}}, \"data\": {\"name\": \"data-faa77774476fe02fc0b97c5e259680ed\"}, \"mark\": {\"type\": \"bar\"}, \"encoding\": {\"x\": {\"field\": \"balls\", \"type\": \"nominal\"}, \"y\": {\"aggregate\": \"count\", \"type\": \"quantitative\"}}, \"height\": 200, \"width\": 200, \"$schema\": \"https://vega.github.io/schema/vega-lite/v5.16.3.json\", \"datasets\": {\"data-faa77774476fe02fc0b97c5e259680ed\": [{\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"green\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"green\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"green\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"green\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"green\"}, {\"balls\": \"green\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"green\"}, {\"balls\": \"green\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"green\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"green\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}, {\"balls\": \"blue\"}, {\"balls\": \"green\"}, {\"balls\": \"blue\"}, {\"balls\": \"red\"}, {\"balls\": \"blue\"}]}}, {\"mode\": \"vega-lite\"});\n</script>\n```\n:::\n:::\n\n\n::: {#6490abb1 .cell execution_count=5}\n``` {.python .cell-code}\nprint(urn.draw(10))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n['green', 'blue', 'blue', 'blue', 'red', 'blue', 'red', 'red', 'green', 'blue']\n```\n:::\n:::\n\n\n::: {#3b137424 .cell execution_count=6}\n``` {.python .cell-code}\nclass Polya(Urn):\n  ''' Polya urn model'''\n\n  def draw(self,n=1):\n    ''' draw a ball from the urn with replacement and add a new ball of the same color'''\n    result = []\n    for i in range(n):\n      row_idx = np.random.choice(self.ball_colors, p=self.weights/self.weights.sum(), size=n)\n      result.append(self.ball_names[row_idx[i]])\n      self.weights[row_idx[i]] += 1\n    return result\n\nclass Hypergeometric(Urn):\n  ''' Hypergeometric urn model'''\n\n  def draw(self,n=1):\n    ''' draw a ball from the urn without replacement'''\n    result = []\n    for i in range(n):\n      row_idx = np.random.choice(self.ball_colors, p=self.weights/self.weights.sum(), size=n)\n      result.append(self.ball_names[row_idx[i]])\n      self.weights[row_idx[i]] -= 1\n    return result\n\nclass Polya(Urn):\n  ''' \n    The polya urn model is a generalization of the urn model where c is the number of balls of the same color added to the urn\n    for c=0 the polya urn model we get drawing with replacement reulting in binomial and multinomial distributions.\n    for c=1 the polya urn model we get drawing with replacement and adding a new ball of the same color resulting in a  BetaBinomial and Dirichlet distributions.\n    for c=-1 the polya urn model we get drawing withot replacement resulting in a  the hypergeometric distribution.\n  '''\n  \n  def init(self,ball_names=['white','black'], init='ones', weights=None, c=1):\n    '''initialize the urn with ball names and weights'''\n    super().__init__(ball_names, init, weights)\n    self.c = c\n\n  def draw(self,n=1):\n    ''' draw a ball from the urn with replacement and add a new ball of the same color'''\n    result = []\n    for i in range(n):\n      row_idx = np.random.choice(self.ball_colors, p=self.weights/self.weights.sum(), size=n)\n      result.append(self.ball_names[row_idx[i]])\n      self.weights[row_idx[i]] += 1\n    return result\n\nclass Hoppe(Polya):\n  ''' Hoppe urn model'''\n  \n  def __init__(self,ball_names=['0'], init='ones', weights=None, c=1, mutator_mass=1.0):\n    '''initialize the urn with ball names and weights'''\n    super().__init__(ball_names, init, weights, c)\n    self.mutator_mass = mutator_mass\n    if weights is not None:\n      assert type(weights) == np.ndarray, \"Weights must be a numpy array.\"\n      assert weights.shape[0] == (len(self.ball_names)), f\"Weight shape {weights.shape} not the same as the number of balls. {len(self.ball_names)}\"\n      self.weights = weights\n    else:\n      if init == 'ones':\n        self._weights = np.ones((self.ball_colors))\n      elif init == 'zeros':\n        self._weights = np.zeros((self.ball_colors))\n      elif init == 'random':\n        self._weights = np.random.rand(self.ball_colors)\n      else:\n        raise ValueError(\"Initialization parameter must be 'ones', 'zeros', or 'random'.\")\n      #set the weight of the mutator ball to the mutator mass\n      self.weights[0] = self.mutator_mass\n    \n  def draw(self,n=1):\n    ''' draw a ball from the urn with replacement and add a new ball of the same color'''\n    result = []\n    for i in range(n):\n      row_idx = np.random.choice(self.ball_colors, p=self.weights/self.weights.sum(), size=1)\n      if row_idx[i] == 0:\n        #add a new ball color\n        self.ball_names.append(str(len(self.ball_names)))\n        self.weights = np.append(self.weights, c)\n        result.append(self.ball_names[-1])\n      else:\n        result.append(self.ball_names[row_idx[0]])\n        self.weights[row_idx[i]] += c\n        \n    return result\n  \nclass Moran(Polya):\n  ''' Moran urn model'''\n  \n  def draw(self,n=1):\n    ''' draw a ball from the urn with replacement and add a new ball of the same color'''\n    result = []\n    for i in range(n):\n      row_idx = np.random.choice(self.ball_colors, p=self.weights/self.weights.sum(), size=2)\n      self.weights[row_idx[0]] += c\n      self.weights[row_idx[1]] -= c\n      \n      result.append(self.ball_names[row_idx[0]])\n        \n    return result\n```\n:::\n\n\n### Ehrenfest Urn Model\n\nThe Ehrenfest urn model is a simple model that describes the process of moving balls between two urns. I view this as a precursor to compartmental models in epidemiology and other fields and it demostrates how one can extend the urn model can be used to model more complex systems. The more general model is the multiurn model where we have multiple urns and we can move balls between them which is a Markov chain model.\n\n\nThe model consists of two urns, each containing a fixed number of balls. At each time step, a ball is randomly selected from one of the urns and moved to the other urn.\n\n## The MultiUrn model\n\n> \"any problem of probability appears comparable to a suitable problem about bags containing balls, and any random mass phenomenon appears\nas similar in certain essential respects to successive drawings of balls from a system of suitibly combined bags.\" - @polya1954patterns\n\nper polya's suggestion we can think\n\n\nThe MultiUrn model is an extension of the basic Urn model that allows for multiple urns to be used together.\nWe may for example need to learn an urn model per state in our system extending\na bandit algorithm to a contextual bandit algorithm.\n\nWe can represent these using rows of a matrix where each row represents an urn\nand each column represents a ball color.\n\nIn cases where we have hierarchical models we may be able to use additional constraints - for example on both rows and columns to speed up learning.\n\n::: {#cf246056 .cell execution_count=7}\n``` {.python .cell-code}\nclass MultiUrn:\n    def __init__(self, row_names, col_names, init='ones'):\n        self.row_names = row_names\n        self.col_names = col_names\n        self.num_rows = len(row_names)\n        self.num_cols = len(col_names)\n        \n        if init == 'ones':\n            self.weights = np.ones((self.num_rows, self.num_cols))\n        elif init == 'zeros':\n            self.weights = np.zeros((self.num_rows, self.num_cols))\n        elif init == 'random':\n            self.weights = np.random.rand(self.num_rows, self.num_cols)\n        else:\n            raise ValueError(\"Initialization parameter must be 'ones', 'zeros', or 'random'.\")\n    \n    def _convert_to_numeric(self, row_name, col_name):\n        try:\n            row_idx = self.row_names.index(row_name)\n            col_idx = self.col_names.index(col_name)\n            return row_idx, col_idx\n        except ValueError:\n            raise ValueError(\"Invalid row or column name.\")\n    \n    def get_weight(self, row_name, col_name):\n        row_idx, col_idx = self._convert_to_numeric(row_name, col_name)\n        return self.weights[row_idx, col_idx]\n    \n    def set_weight(self, row_name, col_name, value):\n        row_idx, col_idx = self._convert_to_numeric(row_name, col_name)\n        self.weights[row_idx, col_idx] = value\n    \n    def add_weights(self, other_urn):\n        if self.weights.shape != other_urn.weights.shape:\n            raise ValueError(\"Urns must have the same dimensions to add weights.\")\n        return Urn(self.row_names, self.col_names, init=None, weights=self.weights + other_urn.weights)\n    \n    def get_conditional_probabilities(self):\n        row_sums = self.weights.sum(axis=1, keepdims=True)\n        conditional_probs = self.weights / row_sums\n        return conditional_probs\n    \n    def get_conditional_probability(self, row_name, col_name):\n        row_idx, col_idx = self._convert_to_numeric(row_name, col_name)\n        row_sum = self.weights[row_idx, :].sum()\n        conditional_prob = self.weights[row_idx, col_idx] / row_sum\n        return conditional_prob\n\n    def choose_option(self, row_name):\n        row_idx = self.row_names.index(row_name)\n        row_weights = self.weights[row_idx, :]\n        col_idx = np.random.choice(self.num_cols, p=row_weights/row_weights.sum())\n        return self.col_names[col_idx]\n    \n    def update_weights(self, row_name, col_name, reward):\n        row_idx, col_idx = self._convert_to_numeric(row_name, col_name)\n        self.weights[row_idx, col_idx] += reward\n\n    def plot_heatmap(self):\n        for idx, row_name in enumerate(self.row_names):\n            plt.figure(figsize=(10, 1))\n            sns.heatmap(self.weights[idx, :].reshape(1, -1), annot=True, cmap=\"viridis\", cbar=False, xticklabels=self.col_names, yticklabels=[row_name])\n            plt.title(f\"Urn for {row_name}\")\n            plt.show()\n            \n\n    def calculate_expected_reward(self, receiver_urn):\n        result = 0.0\n        sender_probs = self.get_conditional_probabilities()\n        receiver_probs = receiver_urn.get_conditional_probabilities()\n        \n        for sender_state in self.row_names:\n            for sender_signal in self.col_names:\n                p_sender = self.get_conditional_probability(sender_state, sender_signal)\n                for receiver_signal in receiver_urn.row_names:\n                    for receiver_state in receiver_urn.col_names:\n                        p_receiver = receiver_urn.get_conditional_probability(receiver_signal, receiver_state)\n                        if receiver_signal == sender_signal:\n                            result += p_sender * p_receiver\n        return result\n    \n    def add_expected_reward(self, receiver_urn):\n        expected_reward = self.calculate_expected_reward(receiver_urn)\n        for row_name in self.row_names:\n            for col_name in self.col_names:\n                self.update_weights(row_name, col_name, expected_reward)    \n\n    def __str__(self):\n        return str(self.weights)\n\n# Example usage\nrow_names = ['state0', 'state1', 'state2', 'state3', 'state4']\ncol_names = ['a', 'b', 'c', 'd']\n\nurn = MultiUrn(row_names, col_names, init='ones')\n\nprint(\"Initial weights:\")\nprint(urn)\n\nweight_0_a = urn.get_weight('state0', 'a')\nprint(f\"Weight for state0 and signal 'a': {weight_0_a}\")\n\nurn.set_weight('state0', 'a', 2.0)\nprint(\"Weights after setting weight for state0 and signal 'a' to 0.5:\")\nprint(urn)\n\nconditional_probs = urn.get_conditional_probabilities()\nprint(\"Conditional probabilities:\")\nprint(conditional_probs)\n\nstate = 'state0'\nsignal = 'a'\nconditional_prob = urn.get_conditional_probability(state, signal)\nprint(f\"Conditional probability of signal {signal} given {state}: {conditional_prob}\")\n\nstate = 'state1'\nsignal = 'a'\nconditional_prob = urn.get_conditional_probability(state, signal)\nprint(f\"Conditional probability of signal {signal} given {state}: {conditional_prob}\")\n\nchosen_signal = urn.choose_option('state0')\nprint(f\"Chosen signal for state0: {chosen_signal}\")\n\nurn.update_weights('state0', 'a', 1.0)\nprint(\"Weights after updating weight for state0 and signal 'a' with a reward of 0.1:\")\nprint(urn)\n\n\n\n# Plot heatmaps\nurn.plot_heatmap()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nInitial weights:\n[[1. 1. 1. 1.]\n [1. 1. 1. 1.]\n [1. 1. 1. 1.]\n [1. 1. 1. 1.]\n [1. 1. 1. 1.]]\nWeight for state0 and signal 'a': 1.0\nWeights after setting weight for state0 and signal 'a' to 0.5:\n[[2. 1. 1. 1.]\n [1. 1. 1. 1.]\n [1. 1. 1. 1.]\n [1. 1. 1. 1.]\n [1. 1. 1. 1.]]\nConditional probabilities:\n[[0.4  0.2  0.2  0.2 ]\n [0.25 0.25 0.25 0.25]\n [0.25 0.25 0.25 0.25]\n [0.25 0.25 0.25 0.25]\n [0.25 0.25 0.25 0.25]]\nConditional probability of signal a given state0: 0.4\nConditional probability of signal a given state1: 0.25\nChosen signal for state0: a\nWeights after updating weight for state0 and signal 'a' with a reward of 0.1:\n[[3. 1. 1. 1.]\n [1. 1. 1. 1.]\n [1. 1. 1. 1.]\n [1. 1. 1. 1.]\n [1. 1. 1. 1.]]\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-7-output-2.png){width=786 height=135}\n:::\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-7-output-3.png){width=786 height=135}\n:::\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-7-output-4.png){width=786 height=135}\n:::\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-7-output-5.png){width=786 height=135}\n:::\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-7-output-6.png){width=786 height=135}\n:::\n:::\n\n\n::: {#b50a77b4 .cell execution_count=8}\n``` {.python .cell-code}\ns_row_names = ['state0', 'state1', 'state2', 'state3', 'state4']\ns_col_names = ['a', 'b', 'c', 'd']\ns_urn = MultiUrn(s_row_names, s_col_names, init='ones')\ns_urn.plot_heatmap()\n```\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-8-output-1.png){width=786 height=135}\n:::\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-8-output-2.png){width=786 height=135}\n:::\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-8-output-3.png){width=786 height=135}\n:::\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-8-output-4.png){width=786 height=135}\n:::\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-8-output-5.png){width=786 height=135}\n:::\n:::\n\n\n::: {#e53735c3 .cell execution_count=9}\n``` {.python .cell-code}\nr_row_names = ['a', 'b', 'c', 'd']\nr_col_names = ['state0', 'state1', 'state2', 'state3', 'state4']\nr_urn = MultiUrn(r_row_names, r_col_names, init='ones')\nr_urn.plot_heatmap()\n```\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-9-output-1.png){width=786 height=135}\n:::\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-9-output-2.png){width=786 height=135}\n:::\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-9-output-3.png){width=786 height=135}\n:::\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-9-output-4.png){width=786 height=135}\n:::\n:::\n\n\nlets add a method to calculate the expected reward of two urns\n\nresult = 0.0\nfor each sender state sender_state\n  for each sender signal sender_signal\n    p_sender = the conditional probability of the sender_signal given the sender_state\n    for each reciever signal reciever_signal\n      for each reciever state reciever_state\n          p_reciever = the conditional probability of the reciever_state given the reciever_signal \n          if the reciever_signal is the same as the sender_signal\n            result += p_sender * p_reciever\nreturn result\n\n# note I think the expected reward chould be less then one - since the expected reward is the probability of the reciever signal given the sender signal\nand sum of probabilities of the reciever signal given the sender signal is less then one.\n      \n      \n        calculate the expected reward\n        add the expected reward to the urn\nwhere we start with a reciever, chose \n\n::: {#d5ac1ab1 .cell execution_count=10}\n``` {.python .cell-code}\nexpected_reward = s_urn.calculate_expected_reward(r_urn)/(s_urn.num_rows*r_urn.num_cols*s_urn.num_rows*r_urn.num_cols)\nprint(f\"Expected reward: {expected_reward}\")\n\ns_urn.add_expected_reward(r_urn)\nprint(\"Sender Urn weights after adding expected reward:\")\nprint(s_urn)\ns_urn.plot_heatmap()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nExpected reward: 0.007999999999999985\nSender Urn weights after adding expected reward:\n[[6. 6. 6. 6.]\n [6. 6. 6. 6.]\n [6. 6. 6. 6.]\n [6. 6. 6. 6.]\n [6. 6. 6. 6.]]\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-10-output-2.png){width=786 height=135}\n:::\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-10-output-3.png){width=786 height=135}\n:::\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-10-output-4.png){width=786 height=135}\n:::\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-10-output-5.png){width=786 height=135}\n:::\n\n::: {.cell-output .cell-output-display}\n![](urn_files/figure-html/cell-10-output-6.png){width=786 height=135}\n:::\n:::\n\n\nbasic operations:\n\n- draw() draw a ball from the urn\n\n\noperations:\n\n- convert balls/weights to probabilities\n- given the balls counts estimate/simulate probability of drawing some sequence of balls.\n- given n observations of balls estimate the ball proportions and thier confidence intervals.\n\n\nwhat about other urn types\n\n- basic urn - sampling is with replacement\n- hypergeometric urn - sampling without replacement...\n- urn with sampling with replacement and adding a new ball of the same color\n- polya urn - when a ball is observed the urn is updated with the same color ball and a new ball of the same color\n- beta-binomial when ever a ball is observed the urn is updated with the number of balls of the same color\n- dirichlet\n- hopper urn - the urn has a mutator ball that generates new ball color (a new column) and a mutator state that generates new states (a new row)\n- moran urn \n\n",
    "supporting": [
      "urn_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}