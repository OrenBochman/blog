<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Oren Bochman&#39;s Blog</title>
<link>https://orenbochman.github.io/</link>
<atom:link href="https://orenbochman.github.io/index.xml" rel="self" type="application/rss+xml"/>
<description>Personal website, portfolio and blog</description>
<generator>quarto-1.5.57</generator>
<lastBuildDate>Thu, 26 Sep 2024 15:13:06 GMT</lastBuildDate>
<item>
  <title>Fine-tune llm for Style and Grammar advice.</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/readability.html</link>
  <description><![CDATA[ 





<section id="fine-tuning-llm-for-readability" class="level1">
<h1>Fine tuning LLM for Readability</h1>
<p>Question 1: LLM are amazing - can I fine tune a state of the art LLM like Lama 3.1 with what I consider to be very high quality writing from my private library content to create a writing assistant?</p>
<p>Can I do it in a way that is aware of the writer’s style and the text domain other high level features so that the prompt can be used to condition the output this way.</p>
<p>Can I test it on wikipedia articles and see if it can improve the readability of existing and new articles?</p>
<section id="learning-to-write-well" class="level2">
<h2 class="anchored" data-anchor-id="learning-to-write-well">Learning to write well</h2>
<p>learning to write from:</p>
<ul>
<li>“Best American Science Writing” series</li>
<li>Bast papers - sourced from leading conferences</li>
<li>Authors
<ul>
<li>Oliver Sacks,</li>
<li>Natalie Angier,</li>
<li>Alan Lightman,</li>
<li>Sylvia Nasar,</li>
<li>Matt Ridley
<ul>
<li>Genome</li>
<li>Red Queen</li>
<li>Viral</li>
</ul></li>
<li>Steven Pinker
<ul>
<li>How the Mind Works</li>
<li>The Blank Slate: The Modern Denial of Human Nature</li>
<li>The Language Instinct: How the Mind Creates Language</li>
<li>The Secret Life of Verbs</li>
<li>Words and Rules</li>
<li>Hotheads</li>
</ul></li>
<li>Richard Dawkins
<ul>
<li>Selfish gene</li>
<li></li>
</ul></li>
</ul></li>
<li>Great Explianers
<ul>
<li>Richard Feynman
<ul>
<li>lectures on physics</li>
<li>QED</li>
<li>The pleasure of finding things out</li>
<li>The character of physical law</li>
<li>Surely you’re joking</li>
<li>What do you care about what other people think</li>
<li>Six easy pieces</li>
</ul></li>
<li>Levitt and dunbar
<ul>
<li>Freakonomics</li>
</ul></li>
<li>Michel Foucout
<ul>
<li>Discipline and Punish</li>
<li>The Birth of the Clinic</li>
<li>The Order of Things</li>
<li>The Archaeology of Knowledge</li>
<li>Madness and Civilization<br>
</li>
</ul></li>
<li>Leonard Susskind
<ul>
<li>Theoretical Minimum</li>
</ul></li>
<li>Richard Hawkins</li>
<li>Jared Diamond
<ul>
<li>Guns, Germs, and Steel</li>
<li>Collapse: How Societies Choose to Fail or Succeed</li>
<li>The World Until Yesterday: What Can We Learn from Traditional Societies?</li>
<li>The Invisible Hands: Top Hedge Fund Traders on Bubbles, Crashes, and Real Money</li>
<li>etc</li>
</ul></li>
<li>C.S. Lewis
<ul>
<li>A Grief Observed</li>
<li>The Problem of Pain</li>
<li>The Screwtape Letters</li>
<li>The Great Divorce</li>
<li>Mere Christianity</li>
<li>A Preface to Paradise Lost</li>
</ul></li>
<li>Eric Metaxas
<ul>
<li>Martin Luther</li>
<li>Bonhoffer</li>
<li>Discussing Mere Chritianity</li>
</ul></li>
<li>Yuval Noah Harari
<ul>
<li>Sapiens - A brief history of mankind</li>
<li>Homo Deus</li>
<li>21 Lessons for the 21st Century Audiobook</li>
</ul></li>
<li>Primo Levi
<ul>
<li>The Periodic Kingdom</li>
</ul></li>
<li>Mcluhan Marshall
<ul>
<li>The Medium Is The Massage</li>
</ul></li>
<li>Empire of the Summer moon</li>
<li>Hidden Figures</li>
<li>Art of War</li>
<li>Book of five rings</li>
<li>Adam Smith</li>
<li>The pencil</li>
<li>Dan Ariely</li>
<li>Chris Anderson
<ul>
<li>The long tail</li>
</ul></li>
<li><h2 id="plato" class="anchored">Plato</h2></li>
<li><h2 id="aristotle" class="anchored">Aristotle</h2></li>
<li>Machiavelli
<ul>
<li>The prince</li>
</ul></li>
<li>James Surowiecki
<ul>
<li>The Wisdom of Crowds</li>
</ul></li>
<li>Robert A. Caro
<ul>
<li>The Power Broker: Robert Moses and the Fall of New York</li>
<li>Working</li>
<li>Master of the Senate</li>
</ul></li>
<li>Stephen Jay Gould</li>
<li>Ian Ayres
<ul>
<li>Super Crunchers -</li>
</ul></li>
<li>Giles Milton
<ul>
<li>Nathaniel’s Nutmeg</li>
<li>D-Day The Soldiers’ Story</li>
<li>When Hitler Took Cocaine and Lenin Lost His Brain</li>
<li>Fascinating Footnotes From History</li>
<li>Churchill’s Ministry of Ungentlemanly Warfare</li>
<li>Wolfram The Boy Who Went to War</li>
<li>The Extraordinary Story of Thomas Pellow and Islam’s One Million White Slaves</li>
<li>The Stalin Affair: The Impossible Alliance that Won the War</li>
<li>Samurai William: The Englishman Who Opened Japan</li>
<li>Edward Trencom’s Nose</li>
<li>Russian Roulette - A Deadly Game: How British Spies Thwarted Lenin’s Global Plot</li>
</ul></li>
</ul></li>
</ul>
<p>etc</p>
<p>the ideas here are :</p>
<ol type="1">
<li>the primary text</li>
<li>the wikipedia article on</li>
<li>summaries</li>
</ol>
<p>where we want to focus on the primary text but and also to highlight its structure</p>
<p>The primary text has lots of words but one top level structure a few chapter level structure many paragraph level structure</p>
<p>idealy we want to learn structures:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7Bparagraph%7D%20%5Cto%20%20%5Ccdots%20%5Cto%20%20%5Ctext%7Btop%20level%7D%0A"> and idealy we would like to learn to research</p>
<p>i.e.&nbsp;source the ‘facts’ from reliable sources which we cite inline.</p>
<p>teach an LLM to rewrite text with high fidelity yet increase thier readability.</p>
<p>high quaity data sets:</p>
<ol type="1">
<li>wikipedia v.s. higher quality e.g.&nbsp;britanica, or others</li>
</ol>
<ul>
<li>check this isn’t the best of wikipedia</li>
<li>check the citations (is there a significant overlap we are in the ballpark)</li>
</ul>
<ol start="2" type="1">
<li></li>
</ol>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {Fine-Tune Llm for {Style} and {Grammar} Advice.},
  date = {2024-09-26},
  url = {https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/readability.html},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“Fine-Tune Llm for Style and Grammar
Advice.”</span> September 26, 2024. <a href="https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/readability.html">https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/readability.html</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/readability.html</guid>
  <pubDate>Thu, 26 Sep 2024 15:13:06 GMT</pubDate>
</item>
<item>
  <title>LLM and the missing link</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/the-missing-link.html</link>
  <description><![CDATA[ 





<p>The missing link is my name for a set of agents that should be able to edit wikipedia or at least to significantly reduce the effort needed to contribute to wikipedia.</p>
<ul>
<li>Wikipedia has a number of task and challenges</li>
<li>Wikipedia also offers unique opportunities for learning not available elsewhere (edit histories, talk pages, etc.)</li>
</ul>
<p>tasks:</p>
<ol type="1">
<li>Wikification - use entropy maximize the entropy and mutual information of the wiki - i.e.&nbsp;choose links to other articles that are most likely to be clicked on rather than the the most most famous or like USA - which contributes no information to the reader.</li>
<li>inlining citations</li>
<li>adding missing references</li>
<li>adding missing sections across languages</li>
<li>Improving readability
<ul>
<li>most wikipedia articles are poorly written when compared with the best science writing in the world.</li>
</ul></li>
<li>Addressing biases and COI issues. [^we nay need to train the LLM on material that does not include wikipedia or to create a version that can separate wikipedia and non wikipedia material possibly using CLIP?]
<ul>
<li>with the advent of LLM we can now collect all the material in an articles Sources and use it to rewrite a more complete article and perhaps one with fewer biases.<sup>1</sup> Further more it is fairly easy to source additional material from the web and other sources and thus again allowing a second view of the the articles point of view.</li>
</ul></li>
<li>Addressing vandalism and spam - this can be learned across articles</li>
<li>Extracting wikidata from articles again this can be learned across many articles by mapping the article to the wikidata entries of the primary and secondary entities.</li>
<li>Replace low register terms with high register terms - with an eye to improving readability. One hopes that the higher register terms are more precise and less ambiguous.</li>
<li>Replace highly ambiguous terms with less ambiguous terms. The same perhaps for sentences.</li>
<li>Make use of other media - diagrams, maths, code, images, videos, maps and so on should be more than referenced in the text.</li>
</ol>


<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;LLM inherit and amplify biases from thier training material, so this aspect is an area of active research and may require some creativity</p></div></div>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {LLM and the Missing Link},
  date = {2024-09-26},
  url = {https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/the-missing-link.html},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“LLM and the Missing Link.”</span> September
26, 2024. <a href="https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/the-missing-link.html">https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/the-missing-link.html</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/the-missing-link.html</guid>
  <pubDate>Thu, 26 Sep 2024 15:13:06 GMT</pubDate>
</item>
<item>
  <title>LLM the good the bad and the ugly</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/</link>
  <description><![CDATA[ 





<section id="language-models" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="language-models">Language Models</h2>
<p>Early when I saw the first text by gpt2 I was intrigued that some of the researchers that did not get access to the early model and had to re-create the model based on just the paper reported that that thier model had ‘probabilities’ of generating all those texts given the prompt.</p>
<p>This seems to be a rather <em>weak claim</em> - after all a million blindfolded monkeys banging on type writers would have some probability of generating those texts.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3c/Chimpanzee_seated_at_typewriter.jpg/512px-Chimpanzee_seated_at_typewriter.jpg?20120413234640" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="One of a million IID monkeys at a typewriter   credit"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3c/Chimpanzee_seated_at_typewriter.jpg/512px-Chimpanzee_seated_at_typewriter.jpg?20120413234640" class="img-fluid quarto-figure quarto-figure-left figure-img" width="250" alt="One of a million IID monkeys at a typewriter   credit"></a></p>
</figure>
</div>
<figcaption>One of a million <a href="https://en.wikipedia.org/wiki/Independent_and_identically_distributed_random_variables">IID</a> monkeys at a typewriter <br> <a href="https://commons.wikimedia.org/wiki/File:Chimpanzee_seated_at_typewriter.jpg">credit</a></figcaption>
</figure>
</div>
</div></div><p>One point to make is that the monkeys might have a higher probability of generating the text then the researcher’s model - but that is a different story.</p>
<section id="the-origen-of-seq2seq-models" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="the-origen-of-seq2seq-models">The origen of seq2seq models</h3>
<p>If you learned the pre LLM language modeling you would be familiar with <a href="https://en.wikipedia.org/wiki/N-gram">N-grams</a> you would be better equipped to be critical of LLMs. [N-grams]<sup>1</sup> More generally skip grams allow to model n-grams with gaps i.e.&nbsp;there are some tokens that are not specified or skipped. Another generalization was the introduction of a N-grams n representing unknown tokens.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;is an ordered sequence of tokens. It could be words, characters, or unicode code point.</p></div></div><p>The N-grams abstraction allowed for development of probabilistic models that are the basis of LLMs. However these older models had one significant limitation - they could only model a fixed number of tokens. This is because the number of possible N-grams grows exponentially with the number of tokens.</p>
<p>Related v.s. Similar</p>
</section>
</section>
<section id="the-good" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="the-good">The good</h2>
<p>There are a few powerful ideas in this approach.</p>
<ol type="1">
<li>Capturing co-occurrence statistics.
<ul>
<li>The word ‘the’ is followed by a noun 50% of the time.</li>
<li>Collocations may have gaps and this is where</li>
<li>Skip grams generalize N-grams by allowing for gaps in the sequence.</li>
</ul></li>
<li>Learning from positive examples is the forte of classical language models. You can learn the regular parts of a language using such a probabilistic quite fast. Unfortunately most languages are far from regular.</li>
<li>Generalizing using <a href="https://en.wikipedia.org/wiki/Smoothing">smoothing</a> - When the frequency of N-grams for some words is low enough we don’t expect to see them in a corpus of some given size. You just can’t fit all the N-grams of a given size in a corpus of a given size. but we can use shorter N-grams to estimate the probability of longer N-grams. (And this is how language models can be used to generate text). We call this process smoothing as conceptually we are filling holes in the longer N-grams probability distribution by moving some of the mass from related N-grams - to look more like the distribution of formed by combining shorter N-grams.</li>
<li>Learning negative examples. With enough data we may be infer that the absence of certain trigrams in the distribution where the associated bigrams are common isn’t due to chance but due some excluding factor. They might be linguistic or perhaps censoring. Regardless to detect get to a certain confidence level say 95% we need to see lots of bigrams and no trigram. Note though that we may have some broken english or some clumsy constructions that are in our corpus - they tend to muddy the waters and render these negative examples particularly challenging to infer. In fact it is generally easier to learn more by increasing the size of the corpus and learning more from rarer positive examples and this is what LLM do. not just from the corpus but from the language. However just as children learning to generelize have to be taught that the plural of goose is geese and not gooses, learning from positive -</li>
</ol>
<p>The problems with ngrams is that once n gets big enough and the corpus doesnt scale with it ngrams learn to model the corpus rather than the language. This is because as the ngram gets longer around the central word eventuall the contexts is specific enough that there is only one matching next ngram to for the given context - so the next word is certain.</p>
<blockquote class="blockquote">
<p>The egg hit the wall and <strong>it</strong> broke.</p>
</blockquote>
<ul>
<li>It must be the case that the egg hit the wall and it broke right.</li>
<li>Unless we are in feudal japan where internal walls are made to a large extent from rice paper on a frames.<sup>2</sup></li>
<li>We could also be dealing with a decorative egg and a glass wall.</li>
<li>Or we could be dealing with a metaphorical egg and a metaphorical wall.</li>
</ul>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;some gifted Samorai would need to catch the egg after it broke the wall to avoid <code>they broke</code></p></div></div><p>If the first scenario is correct 99.999% of the time why do we need to consider the other scenarios? The answer is best considered as a black swan problem. If we only consider the most likely scenarios we will be unprepared for the unlikely ones which could be catastrophic.</p>
<p>This suggests perhaps that while LLM should be great for learning a lexicon, a grammar, and some common sense knowledge - three very challanging tasks they are inadquate for making infrences about the world where different types of precise reasoning is required.</p>
</section>
<section id="the-bad" class="level2">
<h2 class="anchored" data-anchor-id="the-bad">the bad</h2>
<ul>
<li>the black swan problem</li>
<li>tokenization</li>
</ul>
</section>
<section id="the-sad" class="level2">
<h2 class="anchored" data-anchor-id="the-sad">the sad</h2>
<ul>
<li>context windows</li>
</ul>
</section>
<section id="the-ugly---where-are-llms-no-good" class="level2">
<h2 class="anchored" data-anchor-id="the-ugly---where-are-llms-no-good">the ugly - Where are LLMs no good?</h2>
<p>Let’s consider an analogy from physics. Classical physics is great for predicting phenomena at macro scales but quantum mechanics is required for the micro scale.</p>
<p>Physicist like to think that quantum physics should converge to classical physics at the macro scale but this is not always the case. There are phenomena that are only explained by quantum mechanics. We may soon discover more phenomena like superconductivity, quantum computers and quantum cryptography manifsting in our macro world</p>
<p>Fooled by randomness….</p>
<p>In the case of LLM there is the effect of stochasticity which is built into the models. We don’t care about this aspect so long as the model gives us good replies. But all replies are inherently stochastic. While humans might express an utternce in many ways they should be able to agree on its meaning, the facts, the options, the reasoning and so on. Neural netowrks are universal function approximators and in the case of LLMs the are approximate the LM from above which are stochastic all the way down - there is no agreement excepts on the most basic probabilities. The nlp researcher can only say that an utterance is likely to be generated by the model - with some probability. Any counter claim also has some probability.The probabilities in these cases are far more dramaicaly affected by the utterance length, word choices, grammarticality, common sense knowledge then factuallity, structured knowledge</p>
<p>This is a problem because we are used to deterministic replies from humans. We are used to deterministic replies from classical language models. We are used to deterministic replies from classical AI systems.</p>
<ul>
<li>hellucinations
<ul>
<li>where there is sparse data or the data used in training isn’t representative of the query we cannot expect the model to perform well.</li>
<li>even where there is good data - if the queries are subtle enough the stochastic nature of the model will manifest.</li>
</ul></li>
<li>prompt engineering</li>
</ul>
</section>
<section id="the-ugly---through-the-hole-in-the-coin" class="level2">
<h2 class="anchored" data-anchor-id="the-ugly---through-the-hole-in-the-coin">the ugly - through the hole in the coin</h2>


</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {LLM the Good the Bad and the Ugly},
  date = {2024-09-26},
  url = {https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“LLM the Good the Bad and the Ugly.”</span>
September 26, 2024. <a href="https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/">https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/</guid>
  <pubDate>Thu, 26 Sep 2024 15:13:06 GMT</pubDate>
</item>
<item>
  <title>NLP with RL</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/rl.html</link>
  <description><![CDATA[ 





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>supervised and unsupervised models are great for most NLP tasks, yet both approaches have their limitations. Supervised models require labeled data, which is usually in short supply, while unsupervised models often lack the precision needed for many applications.</p>
<ul>
<li>Large language models like GPT-3 can provide us with a way to genereate text on demand. They are weak when generating from sparse data (Hellucination) and can be biased.</li>
</ul>
<p>Perhaps RL which is able to learn from mistakes, as well as use supervised as well as unsupervised learning as representations can perhaps bridge the gaps that LLM cannot adress so well.</p>
<p>The main challanges in RL however are difficulty in Trasfer learning, or generalizing between similar and or related tasks. I believe that within the NLP domain transfer learning seems to be a bit easier than in other domains, as the representations learned from one task can be used in another task.</p>
<ul>
<li>NLP is a domain in which skills learned in one task may be transferrable into other task.</li>
<li>Multigoal learning can be used to solve this issue.</li>
<li>Meta learning can be used to learn from multiple tasks and generalize to new tasks.</li>
<li>Curriculum learning can be applied to:
<ul>
<li>identify weaknesses in the model</li>
<li>collect more samples to adress weakness</li>
<li>collect appropriate samples to correct for biases that emerge in the model.</li>
</ul></li>
<li>Evolving language from scratch using lewis siggins games and thier extentions can also be viewed as as from of Meta learning.</li>
<li>Can we define a abstract hamiltonian that can be used for energy/entropy based generation of text using the hamiltonian of the promprts/context
<ul>
<li><p>Can we define a minimalist grammar using this abstract formalism.</p></li>
<li><p>Can we define a resonant solution multiple hamiltonians that interact on differernt levels.</p></li>
<li><p>Can we make this something that is a good fit for multi-headed attention perhaps analagous to how the finit state machine morphology was simplified by understanding that the FSM can be represented as a regular expression and that the generations we bounded by the lexicon. In other words can we create a hamiltonian that introduced contraints on the generation of text using different heads of the transformer model and thereby places bounds on the computational complexity of the model?</p></li>
</ul></li>
</ul>
<p>Rewards for different task can be defined in different ways, and the reward function can be used to guide the model to learn the task. At the start the reward function seems to be the greatest unknown. I believe that this will be the most interesting part of the project and perhaps a driver for innovation.</p>
<ol type="1">
<li>Tasks and components</li>
</ol>
<ul>
<li>Creating a minimalist language model that allows for pretraining and fine tuning with small payloads of data generated by the RL agents.</li>
<li>Augmenting the LLM with sophisticated embeddings that are most amenable for transfer learning.</li>
<li></li>
</ul>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {NLP with {RL}},
  date = {2024-09-26},
  url = {https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/rl.html},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“NLP with RL.”</span> September 26, 2024. <a href="https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/rl.html">https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/rl.html</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/rl.html</guid>
  <pubDate>Thu, 26 Sep 2024 15:13:06 GMT</pubDate>
</item>
<item>
  <title>Rethinking Signaling systems via the lens of compositionality</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/2024-10-10-marco-baoni-composionality/lewis.html</link>
  <description><![CDATA[ 





<p>I was introduced to the subject of language evolution by Brian Skryms in his book “Signals: Evolution, Learning, and Information” where he discusses the evolution of signaling systems and the emergence of language. In it he discusses the role of compositionality in the emergence of language and how it is a key feature of human language. Signals provides a coherent yet multifaceted views of the problem - philosophy, signaling system creation and assimilation via evolution or reinforcement learning. Skryms also considers Logic and complex signaling systems. Yet a unifying theme for this work is a reductionist view of the problem and his attempt to reduce the problem to a model that follows closely the Lewis Signaling Game.</p>
<p>I like this reductionist approach but I like to also to turn it on its head. By looking at how the problem takes form in more challenging and realistic settings can often uncover the true nature of the problem. Since language emergence is so open ended one might also use it to consider how it empowers agents to coordinate on better decision in ever more challenging problems and settings.</p>
<p>I first became frustrated with complex signaling systems when I read the chapters in Signals and realized that unlike the other chapters Skryms had not summarized how researchers in the field had come up with a definitive solution to the problem. I reread it a couple of times and finally realized that although he made some very interesting claims this topic was still unresolved. There are many interesting results but there are at least as many open questions.</p>
<p>The second time I became frustrated was when I tried to convert the simple signaling RL games into complex ones. Just the material in the book had versions with multiple agents signaling in parallel, one agent signaling without sequence, and agents signaling in sequence. The book also hints at cases where agents may make mistakes and that this is important for the evolution of signaling systems.</p>
<p>I also was coming across more and more research that isn’t covered in the book that looks at morphology and syntax in the emergence of language. Further more people were using deep learning to overcome the lewis signaling game inability of of arriving decoders for complex signals.</p>
<p>At this point I realized that there might be three problems that are being conflated in nature and that we might want to consider them separately as well as together.</p>
<ol type="1">
<li>the coordination problem - how agents learn a common convention for signaling and what is the most effective form of the solution.</li>
<li>the serialization problem - how the medium will e.g.&nbsp;a noisy channel can introduce additional desireable contraints like shorter signals, saliency, early decoding, (compression, error detection and correction, easy decoding, signal distributions, ). This problem is one which is solved by a descion tree. But the different options for the settings will lead to different optimal solutions. These are hidden by the symmetric form of the rewards in the lewis game.</li>
<li>the signal composition problem - given a simple signaling systems and a encoder decoder for the channel how can we add aggregation to the signaling system to make it more efficient. (more expressive, easier to learn, easier to extend, more robust to different errors.)</li>
</ol>
<p>This might help answer questions like - why does english use just 39-44 phonems instead of the full we have a languages making a full use of human phonemes (600 consonants and 200 vowels) ?</p>
<p>What became apparent to me is that the nature of a complex signaling system, depends very much on the game being played by the agents.</p>
<p>Metrics:</p>
<ul>
<li><p>Total number of signals</p></li>
<li><p>Minimal set of signals needed to learn the signalling system with n-learners with full observability of signal, action and reward by all learners.</p></li>
<li><p>How long to learn saliency (the distribution states of the world) of signals perhaps adjusted by risk (the distribution of malleuses for wrong action in the each state of the world)</p></li>
<li><p>How long to coordinate on a basic system with N states and N actions</p></li>
<li><p>How to learn to coordinate on a huffman cannonical code to optimize a signaling system</p></li>
<li><p>Learning and Coordinating via templates for complex signals</p>
<ul>
<li>Degree of morphology</li>
<li>Degree of syntax</li>
<li>Degree of contextual meaning</li>
<li>Degree of coordination (and aggreement in templates) and its error correction capacity)</li>
</ul></li>
<li><p>Message entropy</p></li>
<li><p>Robustness to error in sender, receiver, and channel</p></li>
<li><p>Mean</p></li>
<li><p>Regarding complex signaling systems he points out a couple of ideas:</p>
<ul>
<li>Complex signals might be composed by simple signals from multiple senders.
<ul>
<li>The reciever needs to both decode and aggregate the simple signals to infer the state of the world encoded in the complex signal.</li>
<li>This is particularly interesting and less artificial once consider realise it leads to a partially observed markov descion process (PMDP)
<ul>
<li>senders have partial observability of the state of the world and</li>
<li>recievers need to reconstruct the state by aggregatig partial messages</li>
</ul></li>
<li>If we might also give the agents types and make the game a bayesian game.
<ul>
<li>Types are
<ul>
<li>Knights - with messages that are always true as well as thier atoms</li>
<li>Knaves - with messages that are always false.</li>
<li>Normals - with messages that are sometimes true and sometimes false.</li>
<li>Insane - who think that thier messages are always true but are actually always false.</li>
<li>etc</li>
</ul></li>
</ul></li>
</ul></li>
<li>Complex signals might be composed by multiple simple signals from a single sender.
<ul>
<li>The complex signal is a bag of signals (i.e.&nbsp;aggregation is not unordered - buy via a conjunction of signals i.e.&nbsp;A and B = B and A).</li>
<li>The complex signal is ordered sequence of signals sequence of signals i.e.&nbsp;<img src="https://latex.codecogs.com/png.latex?(A,B)%20%5Cneq%20(B,A)"> .</li>
<li>Sequences of sequences can capture morphology.</li>
<li>Natural language adds the notion of recursion - which in terms of mathematically boils down to a a partial ordering of simple signals to form complex signals.</li>
</ul></li>
</ul></li>
<li><p>There is a natural tendency to think about the Chomsky hierarchy of languages at this point.</p></li>
<li><p>Also once there are sequences of signals we will naturally consider ideas from information theory.</p>
<ul>
<li>Entropy of a signal</li>
<li>Error detection</li>
<li>Error correction</li>
<li>Source coding (compression)</li>
<li>Easy decoding of messages</li>
</ul></li>
<li><p>Errors are stated as important in the evolution of signaling systems in the paper of Nowak and Krakauer (1999).</p>
<ul>
<li>we</li>
</ul></li>
<li><p>Compression and easy decoding are also important too but this came up later when people noticed that thier agents were learning very inefficient signaling systems (with very long signals)</p>
<ul>
<li>this suggests that we add a parameter to the game to penalize long signals.</li>
<li>and to reward early decoding of the signal.</li>
</ul></li>
<li><p>Logic is also discussed in the</p></li>
</ul>
<p>has an extensive bibliography and I have been following up on some of the references.</p>
<p>This is a quick summary of a talk by Marco Baroni on the topic of compositionality in language. In it he outlines some of his work and his collegues/students work on the topic and the conclusions he has drawn from it.</p>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {Rethinking {Signaling} Systems via the Lens of
    Compositionality},
  date = {2024-09-26},
  url = {https://orenbochman.github.io/posts/2024/2024-10-10-marco-baoni-composionality/lewis.html},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“Rethinking Signaling Systems via the Lens of
Compositionality .”</span> September 26, 2024. <a href="https://orenbochman.github.io/posts/2024/2024-10-10-marco-baoni-composionality/lewis.html">https://orenbochman.github.io/posts/2024/2024-10-10-marco-baoni-composionality/lewis.html</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/2024-10-10-marco-baoni-composionality/lewis.html</guid>
  <pubDate>Thu, 26 Sep 2024 15:13:06 GMT</pubDate>
</item>
<item>
  <title>Roth Erev learning in Lewis signaling games</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel.html</link>
  <description><![CDATA[ 





<section id="learning-in-lewis-signaling-games" class="level2">
<h2 class="anchored" data-anchor-id="learning-in-lewis-signaling-games">Learning in Lewis signaling games</h2>
<p>I wish now to implement learning in the Lewis signaling game. In the book some reinforcement learning RL algorithms are presented in some detail and a few variations are mentioned. It worthwhile pointing out that the book statement of the algorithms is good enough to understand how the algorithms operate in general. However some of the details required to implement the algorithms were glossed over. As my one time collage Yuri Stool like to point out, “the devil is in the details.”</p>
<p>I ended up implementing the algorithms a number of times - once to get it to work, second time to develop my own algorithm as I gained new insights into the problems. A third time after reading more of the papers whihc suggested how more details on conducting experiments which led to a deeper understanding of enumerating and ranking the partial pooling equilibria. The point here is that natural language is mostly a separating equilibrium - most words are unambiguous but there are a significant subset of words that have multiple meaning and there are many synonyms. Mechanisms in the lexicon seem to eventually resolves some ambiguities while letting others persist indefinitely. So while the separating equilibria are of primary interests in reality users if signaling systems satisfice with a systems that is good enough. This are the much more common partial pooling variants with high degree of separation plus a context based disambiguation mechanism. I consider the erosion of English and Latin conjugation and declination after the classical period as a simpler contextual disambiguation mechanism dismantling a nearly perfect signaling subsystem with a rather degenerate one with high degree of partial pooling. A simulation might show how a few prepositions and auxilary verbs are more efficent to learn and process than fully inflected systems of case and verb ending (especially if modified by phonetics). But my guess is that this happened as more speakers had to master an use a core language, without access to resources for learning the classical forms. I guess the dark ages and a decline in literacy likely speed up the process.</p>
<p>Adding better analysis, estimating expected returns for a set of weights, tracking regret during learning. Considering different path to salience via differntial risks/costs for signals, and non uniform state distribution.</p>
<p>The big question seems to be:</p>
<p>What is a simple rl algorithm to evolve and disseminate a signaling system with certain added requirements like</p>
<ul>
<li><p>complex signals</p>
<ul>
<li><p>conjunctive signal aggregation</p></li>
<li><p>ordered signal aggregation via learning a grammar like SVO.</p></li>
<li><p>recursive signal aggregation replacing linear ordered with a partial order.</p></li>
</ul></li>
<li><p>resolving ambiguity by context</p></li>
<li><p>mechanism for correcting errors (vowel harmony, agreement)</p></li>
<li><p>simple growth of the lexicon (black bead leads to mutation in the urn model)</p></li>
<li><p>sufficient capacity,</p></li>
<li><p>minimal burden for processing (extending inference mechanism to reduce cognitive load, compress messages, erode unneeded structures)</p></li>
<li><p>minimal burden in learning (e.g.&nbsp;by generalization via regularity in morphology, and syntax)</p></li>
<li><p>high accuracy for transmission of messages</p></li>
<li><p>saliencey - a information theoretic measure of more efficient transition subset of states/messages pairs.</p></li>
</ul>
<p>Where the great unknown seems to be to find a minimal extension to the Lewis game in which all these might evlove.</p>
<p>Having stated the problem in detail lets me make the following two observations:</p>
<ol type="1">
<li><p>The aggregation rules for complex signaling should be made to arise by imposing costs on systems under which agents more frequently fail to make good inference with high probability of a partials message’s describing risky states for sender and or receiver.</p></li>
<li><p>A second cost to fitness is the role of mistakes in signaling and or receiving. (ie. adding an small chance for decoding similar sounding signals (homophones, short vs long sounds, hissed and hushed, round, front and back vouwels). This may lead to excluding simple signals from places they might be confused, is it (a,a) (a.a) or (aa,a), (a,_,a) are avoided if signal ‘a’ is excluded from the first positions (say verb class). here dot might be a short pause, comma a long pause, undescore an unmarked slot, and two aa no pause. (either two a or a long a.) if we prefix V with v S with s and P with C</p>
<p>we end up with a system that is much more robust. And we may have the added bonus that we can easily detect a tree formation based on multiple Vprefix in the sentence….</p>
<ol type="1">
<li>word grammar</li>
<li>sub word grammar - a complex morphology - highly regular yet differented complex signals</li>
<li>this could lead to redundancy based Error correction like subject verb agreement, noun adjective agreement or vowel harmony.</li>
<li>Concord - case agreement (nouns pronouns and adjective are in agreement)</li>
</ol></li>
<li><p>Ease of processing</p>
<ol type="1">
<li>agreement can also ease processing</li>
<li>assimilation and elision</li>
<li>limiting processing/disabihation context windows.</li>
<li>word order</li>
<li>however redundencies add overhead, making signals longer and may make learning much longer (this is when we students who generelize are wrong and then need to learn via negative examples.</li>
</ol></li>
<li><p>If many we have different complex signaling systems with minimal mistakes are possible one would prefer a system that is easier to learn. (Shorter lexicon, with lower chances of collision. Shorter grammar, fewer negtive examples, more room for expansion)</p></li>
</ol>
<section id="richard-herrnsteins-matching-law" class="level3">
<h3 class="anchored" data-anchor-id="richard-herrnsteins-matching-law">Richard Herrnstein’s Matching law</h3>
<ol type="1">
<li>we start with some initial weights, perhaps equal.</li>
<li>An act is chosen with probability proportional to its weight.</li>
<li>The payoff gained is added to the weight for the act that was chosen,</li>
<li>and the process repeats</li>
</ol>
</section>
<section id="roth-erev-learning-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="roth-erev-learning-algorithm">Roth-Erev learning algorithm</h3>
<ol type="1">
<li>set starting weight for each option</li>
<li>weights evolve by addition of rewards gotten</li>
<li>probability of choosing an alternative is proportional to its weight.</li>
</ol>
</section>
<section id="bush-mosteller-learning" class="level3">
<h3 class="anchored" data-anchor-id="bush-mosteller-learning">Bush-Mosteller learning</h3>
<ol type="1">
<li>set starting weight for each option</li>
<li>weights evolve by addition of rewards gotten</li>
<li>probability of choosing an alternative is proportional to its weight.</li>
<li>if the reward is 0 the weight is multiplied by a forgetting factor.</li>
</ol>
</section>
<section id="roth-erev-learning-with-forgetting" class="level3">
<h3 class="anchored" data-anchor-id="roth-erev-learning-with-forgetting">Roth-Erev learning with forgetting:</h3>
<ol type="1">
<li>set starting weight for each option</li>
<li>weights evolve by addition of rewards gotten</li>
<li>probability of choosing an alternative is proportional to its weight.</li>
<li>if the reward is 0 the weight is multiplied by a forgetting factor.</li>
</ol>
</section>
<section id="arp-learning" class="level3">
<h3 class="anchored" data-anchor-id="arp-learning">ARP learning</h3>
</section>
<section id="bochman-8-rooks-rl" class="level3">
<h3 class="anchored" data-anchor-id="bochman-8-rooks-rl">Bochman 8-Rooks RL</h3>
<p>this is a special purpose rl algorithm for coordination problems where agents need to establish a convention like in the Lewis signaling game. The idea is that the matrix is similar to a placing 8 rooks on on a chess board with no two under attack. In this case once an option has been chosen we want to exclude all options that shares a row or a collumm. So we set to zero any weights which share the same prefix or suffix as a reward 1 option.</p>
<ol type="1">
<li>set starting weight for each option (state_signal) for the sender and (signal_action) for the receiver, perhaps to 1</li>
<li>weights evolve by</li>
</ol>
<ul>
<li>addition of rewards gotten for a correct choice and</li>
<li>zeroing of options with the same prefix or suffix to exclude them from the choice set.</li>
</ul>
<ol start="3" type="1">
<li>probability of choosing an alternative is proportional to its weight.</li>
</ol>
<div id="dc121222" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> mesa <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Agent, Model</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> mesa.time <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> StagedActivation</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> abc <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ABC, abstractmethod</span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># let's define a lambda to take a list of options and intilize the weights uniformly </span></span>
<span id="cb1-9">uniform_init <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> options, w : {option: w <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> option <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> options}</span>
<span id="cb1-10">random_init  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> options, w : {option: random.uniform(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> option <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> options}</span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># lets make LeaningRule an abstract class with all the methods that are common to all learning rules</span></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># then we can subclass it to implement the specific learning rules</span></span>
<span id="cb1-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> LearningRule(ABC):</span>
<span id="cb1-15">  </span>
<span id="cb1-16">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, options, learning_rate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,verbose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'LearningRule'</span>,init_weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>uniform_init):</span>
<span id="cb1-17">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.verbose <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> verbose</span>
<span id="cb1-18">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>name</span>
<span id="cb1-19">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.learning_rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> learning_rate</span>
<span id="cb1-20">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.verbose:</span>
<span id="cb1-21">          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'LearningRule.__init__(Options: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>options<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)'</span>)</span>
<span id="cb1-22">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.options <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> options</span>
<span id="cb1-23">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> init_weight(options,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Start with one ball per option </span></span>
<span id="cb1-24">        </span>
<span id="cb1-25">        </span>
<span id="cb1-26">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_filtered_weights(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>):</span>
<span id="cb1-27">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.verbose:</span>
<span id="cb1-28">          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'get_filtered_weights(</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)'</span>)</span>
<span id="cb1-29">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># if filter is int convert to string</span></span>
<span id="cb1-30">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>):</span>
<span id="cb1-31">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>)</span>
<span id="cb1-32">        filter_keys <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [k <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> k <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.weights.keys() <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> k.startswith(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>)]</span>
<span id="cb1-33">        weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {opt: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.weights[opt] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> opt <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> filter_keys}</span>
<span id="cb1-34">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> weights</span>
<span id="cb1-35">      </span>
<span id="cb1-36">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb1-37">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> choose_option(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>):</span>
<span id="cb1-38">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">pass</span></span>
<span id="cb1-39">      </span>
<span id="cb1-40">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb1-41">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> update_weights(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, option, reward):</span>
<span id="cb1-42">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">pass</span></span>
<span id="cb1-43">      </span>
<span id="cb1-44"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> HerrnsteinRL(LearningRule):</span>
<span id="cb1-45">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">'''</span></span>
<span id="cb1-46"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                                    The Urn model</span></span>
<span id="cb1-47"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">     nature            sender                 reciever     reward</span></span>
<span id="cb1-48"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                       </span></span>
<span id="cb1-49"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    | (0) | --{0}--&gt;  | (0_a)  | --{a}--&gt; | (a_0) | --{0}--&gt;   1   </span></span>
<span id="cb1-50"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    |     |           | (0_b)  | --{b}    | (a_1) | --{1}--&gt;   0</span></span>
<span id="cb1-51"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    |     |           +--------+    | +--&gt;+-------+</span></span>
<span id="cb1-52"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    |     |                         +-|-+  </span></span>
<span id="cb1-53"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    | (1) | --{1}--&gt;  | (1_a)  | --{a}+ +&gt;| (b_0) | --{1}--&gt;   1</span></span>
<span id="cb1-54"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    |     |           | (1_b)  | --{b}---&gt;| (b_1) | --{0}--&gt;   0</span></span>
<span id="cb1-55"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    +-----+           +--------+          +-------+</span></span>
<span id="cb1-56"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb1-57"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb1-58"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Herrnstein urn algorithm</span></span>
<span id="cb1-59"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    ------------------------</span></span>
<span id="cb1-60"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb1-61"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    1. nature picks a state </span></span>
<span id="cb1-62"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    2. sender  gets the state, chooses a signal by picking a ball in choose_option() from the stat'es urn</span></span>
<span id="cb1-63"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    3. reciver gets the action, chooses an actuion by picking a ball in choose_option()</span></span>
<span id="cb1-64"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    4. the balls in the urns are incremented if action == state</span></span>
<span id="cb1-65"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    5. repeat</span></span>
<span id="cb1-66"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb1-67"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    '''</span></span>
<span id="cb1-68">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, options, learning_rate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>,verbose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Herrnstein matching law'</span>):</span>
<span id="cb1-69">      </span>
<span id="cb1-70">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(verbose <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> verbose, options<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>options, learning_rate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>learning_rate,name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>name)</span>
<span id="cb1-71"></span>
<span id="cb1-72">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> update_weights(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, option, reward):</span>
<span id="cb1-73">      </span>
<span id="cb1-74">        old_weight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.weights[option]</span>
<span id="cb1-75">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.weights[option] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.learning_rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> reward </span>
<span id="cb1-76">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.verbose:</span>
<span id="cb1-77">          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Updated weight for option </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>option<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>old_weight<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> -&gt; </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>weights[option]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-78">          </span>
<span id="cb1-79">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> choose_option(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>):</span>
<span id="cb1-80">      </span>
<span id="cb1-81">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">'''</span></span>
<span id="cb1-82"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb1-83"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        '''</span></span>
<span id="cb1-84">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># subseting the weights by the filter simulates different urns per state or signal</span></span>
<span id="cb1-85">        weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.get_filtered_weights(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>)</span>
<span id="cb1-86"></span>
<span id="cb1-87">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># calculate their probabilities then</span></span>
<span id="cb1-88">        total <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(weights.values())</span>
<span id="cb1-89">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">assert</span> total <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"total weights is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> after </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> on </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>weights<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> "</span></span>
<span id="cb1-90">        probabilities <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [weights[opt] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> total <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> opt <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> weights]</span>
<span id="cb1-91">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># then drawn an option from the filtered option using the probabilities</span></span>
<span id="cb1-92">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.random.choice(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(weights.keys()), p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>probabilities)</span>
<span id="cb1-93"></span>
<span id="cb1-94"></span>
<span id="cb1-95"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> RothErevRL(LearningRule):</span>
<span id="cb1-96"></span>
<span id="cb1-97">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, options, learning_rate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,verbose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Roth Erev RL'</span>):</span>
<span id="cb1-98">      </span>
<span id="cb1-99">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(verbose <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> verbose, options<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>options, learning_rate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>learning_rate,name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>name)</span>
<span id="cb1-100"></span>
<span id="cb1-101">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> update_weights(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, option, reward):</span>
<span id="cb1-102">        old_weight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.weights[option]</span>
<span id="cb1-103">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb1-104">          <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.weights[option] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.learning_rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> reward</span>
<span id="cb1-105">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.verbose:</span>
<span id="cb1-106">          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Updated weight for option </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>option<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>old_weight<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> -&gt; </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>weights[option]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-107"></span>
<span id="cb1-108">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> choose_option(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>):</span>
<span id="cb1-109">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># we subset the weights by the filter, calculate their probabilities then</span></span>
<span id="cb1-110">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># then drawn an option from the filtered option using the probabilities</span></span>
<span id="cb1-111">        weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.get_filtered_weights(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>)</span>
<span id="cb1-112">        total <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(weights.values())</span>
<span id="cb1-113">        probabilities <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [weights[opt] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> total <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> opt <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> weights]</span>
<span id="cb1-114">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.random.choice(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(weights.keys()), p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>probabilities)</span>
<span id="cb1-115">  </span>
<span id="cb1-116"></span>
<span id="cb1-117"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> RothErevForget_RL(LearningRule):</span>
<span id="cb1-118"></span>
<span id="cb1-119">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, options, learning_rate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,verbose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Roth Erev with forgetting'</span>):</span>
<span id="cb1-120">      </span>
<span id="cb1-121">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(verbose <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> verbose, options<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>options, learning_rate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>learning_rate,name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>name)</span>
<span id="cb1-122"></span>
<span id="cb1-123">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> update_weights(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, option, reward):</span>
<span id="cb1-124">        old_weight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.weights[option]</span>
<span id="cb1-125">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb1-126">          <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.weights[option] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.learning_rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> reward</span>
<span id="cb1-127">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb1-128">          <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.weights[option] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.learning_rate </span>
<span id="cb1-129">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.verbose:</span>
<span id="cb1-130">          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Updated weight for option </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>option<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>old_weight<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> -&gt; </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>weights[option]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-131"></span>
<span id="cb1-132">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> choose_option(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>):</span>
<span id="cb1-133">        weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.get_filtered_weights(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>)</span>
<span id="cb1-134">        total <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(weights.values())</span>
<span id="cb1-135">        probabilities <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [weights[opt] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> total <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> opt <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> weights]</span>
<span id="cb1-136">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.random.choice(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(weights.keys()), p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>probabilities)</span>
<span id="cb1-137">  </span>
<span id="cb1-138"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> EightRooksRL(LearningRule):</span>
<span id="cb1-139">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, options, learning_rate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,verbose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Eight Rooks RL'</span>):</span>
<span id="cb1-140">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(verbose <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> verbose, options<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>options, learning_rate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>learning_rate,name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>name)</span>
<span id="cb1-141"></span>
<span id="cb1-142"></span>
<span id="cb1-143">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> update_weights(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, option, reward):</span>
<span id="cb1-144">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prefix <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> option.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'_'</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb1-145">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.suffix <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> option.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'_'</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb1-146">        </span>
<span id="cb1-147">        old_weights<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.weights.copy()</span>
<span id="cb1-148">        </span>
<span id="cb1-149">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> test_option <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.options:</span>
<span id="cb1-150">          <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb1-151">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> test_option <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> option:</span>
<span id="cb1-152">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># increment the weight of the good option </span></span>
<span id="cb1-153">              <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.weights[test_option] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.learning_rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> reward</span>
<span id="cb1-154">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> test_option.startswith(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prefix) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">or</span> test_option.endswith(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.suffix) :</span>
<span id="cb1-155">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># decrement all other options with same prefix  or suffix</span></span>
<span id="cb1-156">               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># if self.weights[test_option] &lt; 0.000001:</span></span>
<span id="cb1-157">               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   self.weights[test_option] = 0.0</span></span>
<span id="cb1-158">               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># else:</span></span>
<span id="cb1-159">                <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.weights[test_option] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.learning_rate </span>
<span id="cb1-160">          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># elif test_option == option:</span></span>
<span id="cb1-161">          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   # decrement the weights of the bad option combo</span></span>
<span id="cb1-162">          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   self.weights[option] *= self.learning_rate </span></span>
<span id="cb1-163"></span>
<span id="cb1-164">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.verbose:</span>
<span id="cb1-165">          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>()</span>
<span id="cb1-166">          <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> option <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.options:</span>
<span id="cb1-167">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> old_weights[option] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.weights[option]:</span>
<span id="cb1-168">              <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>option<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: weight </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>old_weights[option]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> -&gt; </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>weights[option]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-169">          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#print(f"Updated weight {old_weights} -&gt; {self.weights}")</span></span>
<span id="cb1-170"></span>
<span id="cb1-171"></span>
<span id="cb1-172">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> choose_option(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>):</span>
<span id="cb1-173">        weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.get_filtered_weights(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>)</span>
<span id="cb1-174">        total <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(weights.values())</span>
<span id="cb1-175">        probabilities <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [weights[opt] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> total <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> opt <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> weights]</span>
<span id="cb1-176">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># if there is a max weight return it otherwise return a random option from the max wights</span></span>
<span id="cb1-177">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>([opt <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> opt <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> weights <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> weights[opt]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(weights.values())]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb1-178">          <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(weights, key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>weights.get)</span>
<span id="cb1-179">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb1-180">          <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.random.choice([opt <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> opt <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> weights <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> weights[opt]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(weights.values())])</span>
<span id="cb1-181"></span>
<span id="cb1-182"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> LewisAgent(Agent):</span>
<span id="cb1-183">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, unique_id, model, learning_options, learning_rule, verbose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>):</span>
<span id="cb1-184">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(unique_id, model)</span>
<span id="cb1-185">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb1-186">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.action <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb1-187">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb1-188">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.learning_rule <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> learning_rule</span>
<span id="cb1-189">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.verbose <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> verbose</span>
<span id="cb1-190">        </span>
<span id="cb1-191">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> send(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb1-192">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span></span>
<span id="cb1-193">    </span>
<span id="cb1-194">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> receive(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb1-195">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span></span>
<span id="cb1-196">    </span>
<span id="cb1-197">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> calc_reward(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb1-198">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span></span>
<span id="cb1-199"></span>
<span id="cb1-200">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> set_reward(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb1-201">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.reward</span>
<span id="cb1-202">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.verbose:</span>
<span id="cb1-203">          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Agent </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>unique_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> received reward: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>reward<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-204">        </span>
<span id="cb1-205">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> update_learning(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb1-206">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.learning_rule.update_weights(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.option, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.reward)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Update weights based on signals and rewards        </span></span>
<span id="cb1-207"></span>
<span id="cb1-208"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> Sender(LewisAgent):</span>
<span id="cb1-209">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> send(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb1-210">        state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.get_state()</span>
<span id="cb1-211">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#self.message = self.learning_rule.choose_option(filter=state)  # Send a signal based on the learned weights</span></span>
<span id="cb1-212">        </span>
<span id="cb1-213">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.option <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.learning_rule.choose_option(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>state)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send a signal based on the learned weights</span></span>
<span id="cb1-214">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.option.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'_'</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb1-215">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.verbose:</span>
<span id="cb1-216">          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Sender </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>unique_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> sends signal for state </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>state<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>message<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-217"></span>
<span id="cb1-218"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> Receiver(LewisAgent):</span>
<span id="cb1-219">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> receive(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb1-220">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.received_signals <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [sender.message <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> sender <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.senders]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Receive signals from all senders</span></span>
<span id="cb1-221">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#print(f"Receiver {self.unique_id} receives signals: {self.received_signals}")</span></span>
<span id="cb1-222">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.received_signals:</span>
<span id="cb1-223">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> signal <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.received_signals:</span>
<span id="cb1-224">                <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.option <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.learning_rule.choose_option(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>signal)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Choose an action based on received signals and learned weights</span></span>
<span id="cb1-225">                <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.action <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.option.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'_'</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb1-226">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.verbose:</span>
<span id="cb1-227">                  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Receiver </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>unique_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> receives signals: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>received_signals<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> and chooses action: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>action<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-228"></span>
<span id="cb1-229"></span>
<span id="cb1-230">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> calc_reward(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb1-231">        correct_action <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.current_state</span>
<span id="cb1-232">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.action <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> correct_action <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb1-233">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.verbose:</span>
<span id="cb1-234">          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Receiver </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>unique_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> calculated reward: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>reward<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> for action </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>action<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-235"></span>
<span id="cb1-236"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> SignalingGame(Model):</span>
<span id="cb1-237">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, </span>
<span id="cb1-238">                senders_count<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, </span>
<span id="cb1-239">                receivers_count<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb1-240">                learning_rule<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>LearningRule,</span>
<span id="cb1-241">                learning_rate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,</span>
<span id="cb1-242">                verbose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>):</span>
<span id="cb1-243">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>()</span>
<span id="cb1-244">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.verbose <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> verbose</span>
<span id="cb1-245">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.k <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> k</span>
<span id="cb1-246">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.current_state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb1-247">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.learning_rate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>learning_rate</span>
<span id="cb1-248"></span>
<span id="cb1-249">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize the states, signals, and actions mapping</span></span>
<span id="cb1-250">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.states <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(k))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># States are simply numbers</span></span>
<span id="cb1-251">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.signals <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> i) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(k))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Signals are characters</span></span>
<span id="cb1-252">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.actions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(k))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Actions are simply numbers</span></span>
<span id="cb1-253"></span>
<span id="cb1-254">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># generate a list of state_signal keys for the sender's weights</span></span>
<span id="cb1-255">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.states_signals_keys <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>state<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>signal<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> state <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.states <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> signal <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.signals]</span>
<span id="cb1-256">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># generate a list of signal_action keys for the receiver's weights</span></span>
<span id="cb1-257">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.signals_actions_keys <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>signal<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>action<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> signal <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.signals <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> action <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.actions]</span>
<span id="cb1-258">        </span>
<span id="cb1-259">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.senders <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [Sender(i, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, learning_options<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.states_signals_keys, </span>
<span id="cb1-260">                                  learning_rule<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>learning_rule(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.states_signals_keys, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.learning_rate,verbose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.verbose)</span>
<span id="cb1-261">                              ) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(senders_count)]</span>
<span id="cb1-262">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.receivers <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [Receiver(i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> senders_count, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, learning_options<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.signals_actions_keys, </span>
<span id="cb1-263">                                  learning_rule<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>learning_rule(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.signals_actions_keys, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.learning_rate,verbose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.verbose)</span>
<span id="cb1-264">                              ) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(receivers_count)]</span>
<span id="cb1-265">        </span>
<span id="cb1-266">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.schedule <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> StagedActivation(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, </span>
<span id="cb1-267">          agents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.senders <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.receivers, </span>
<span id="cb1-268">          stage_list<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'send'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'receive'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'calc_reward'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'set_reward'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'update_learning'</span>])</span>
<span id="cb1-269"></span>
<span id="cb1-270">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_state(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb1-271">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> random.choice(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.states)</span>
<span id="cb1-272"></span>
<span id="cb1-273">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> step(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb1-274">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.current_state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.get_state()</span>
<span id="cb1-275">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.verbose:</span>
<span id="cb1-276">          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Current state of the world: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>current_state<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-277">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.schedule.step()</span>
<span id="cb1-278"></span>
<span id="cb1-279"></span>
<span id="cb1-280"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># function to plot agent weights side by side</span></span>
<span id="cb1-281"></span>
<span id="cb1-282"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> plot_weights(sender,reciver,title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Agent'</span>):</span>
<span id="cb1-283">    fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb1-284">    weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sender.learning_rule.weights</span>
<span id="cb1-285">    ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].bar(weights.keys(), weights.values())</span>
<span id="cb1-286">    ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Options'</span>)</span>
<span id="cb1-287">    ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Weights'</span>)</span>
<span id="cb1-288">    ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_title(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Sender </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sender<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>unique_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> weights: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>title<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb1-289">    </span>
<span id="cb1-290">    weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> reciver.learning_rule.weights</span>
<span id="cb1-291">    ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].bar(weights.keys(), weights.values())</span>
<span id="cb1-292">    ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Options'</span>)</span>
<span id="cb1-293">    ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Weights'</span>)</span>
<span id="cb1-294">    ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_title(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Receiver </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>reciver<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>unique_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> weights: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>title<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb1-295">    plt.show()</span>
<span id="cb1-296"></span>
<span id="cb1-297"></span>
<span id="cb1-298"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Running the model</span></span>
<span id="cb1-299">k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb1-300">verbose <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span>
<span id="cb1-301"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> LR <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> [HerrnsteinRL,</span>
<span id="cb1-302">           RothErevRL,</span>
<span id="cb1-303">           RothErevForget_RL,</span>
<span id="cb1-304">           EightRooksRL</span>
<span id="cb1-305">           ]:</span>
<span id="cb1-306">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"--- </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>LR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> ---"</span>)</span>
<span id="cb1-307">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> LR <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> HerrnsteinRL:</span>
<span id="cb1-308">    learning_rate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.</span></span>
<span id="cb1-309">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb1-310">    learning_rate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1</span></span>
<span id="cb1-311">  model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SignalingGame(senders_count<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, receivers_count<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>k, learning_rule<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>LR,learning_rate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>learning_rate,verbose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>verbose)</span>
<span id="cb1-312">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>):</span>
<span id="cb1-313">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> verbose:</span>
<span id="cb1-314">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"--- Step </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> ---"</span>)</span>
<span id="cb1-315">      model.step()</span>
<span id="cb1-316">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span></span>
<span id="cb1-317">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#print the agent weights</span></span>
<span id="cb1-318">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#print('Sender weights:',model.senders[0].learning_rule.weights)</span></span>
<span id="cb1-319">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># plot weights side by side</span></span>
<span id="cb1-320">  </span>
<span id="cb1-321">  plot_weights(model.senders[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],model.receivers[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>LR.<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span>)</span>
<span id="cb1-322">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#print('Receiver weights:',model.receivers[0].learning_rule.weights)</span></span>
<span id="cb1-323">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#plot_weights(model.receivers[0],title=LR.__name__)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- HerrnsteinRL ---
--- RothErevRL ---
--- RothErevForget_RL ---
--- EightRooksRL ---</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/oren/work/blog/env/lib/python3.10/site-packages/mesa/time.py:82: FutureWarning:

The AgentSet is experimental. It may be changed or removed in any and all future releases, including patch releases.
We would love to hear what you think about this new feature. If you have any thoughts, share them with us here: https://github.com/projectmesa/mesa/discussions/1919
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="re-rel_files/figure-html/cell-2-output-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel_files/figure-html/cell-2-output-3.png" width="750" height="449" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="re-rel_files/figure-html/cell-2-output-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel_files/figure-html/cell-2-output-4.png" width="742" height="449" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="re-rel_files/figure-html/cell-2-output-5.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel_files/figure-html/cell-2-output-5.png" width="751" height="449" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="re-rel_files/figure-html/cell-2-output-6.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel_files/figure-html/cell-2-output-6.png" width="742" height="449" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>currently only the eight rooks learning rule is producing consistently good signaling systems. The other learning rules are not learning to signal correctly.</p>
<p>Please suggest how to fix this - according to the literature the Roth-Erev with forgetting learning rule should work well in this case.</p>
<p>TODO: implement Bush-Mosteller learning - as this is a match for population dynamics.</p>
<p>TODO: also implement population dynamics as it may not be clear that BM RL is a perfect fit for population dynamics under all lewis game conditions.</p>
<p>TODO: implement ARP learning.</p>
<p>TODO: implement epsilon-greedy, UCB and thompson sampling urn schemes, and Contextual bandits associative search (that’s our multiurn bandit)</p>
</section>
</section>
<section id="estimating-the-gittins-index-for-a-lewis-games." class="level2">
<h2 class="anchored" data-anchor-id="estimating-the-gittins-index-for-a-lewis-games.">Estimating the Gittins index for a Lewis games.</h2>
<div id="c03ee418" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> ContextualBandit:</span>
<span id="cb4-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, n_states, n_actions):</span>
<span id="cb4-6">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.n_states <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n_states</span>
<span id="cb4-7">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.n_actions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n_actions</span>
<span id="cb4-8">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.rewards <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((n_states, n_actions))</span>
<span id="cb4-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.counts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.ones((n_states, n_actions))</span>
<span id="cb4-10"></span>
<span id="cb4-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> update(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state, action, reward):</span>
<span id="cb4-12">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.counts[state, action] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb4-13">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.rewards[state, action] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> reward</span>
<span id="cb4-14"></span>
<span id="cb4-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_gittins_index(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state, action):</span>
<span id="cb4-16">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simplified Gittins index computation</span></span>
<span id="cb4-17">        total_reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.rewards[state, action]</span>
<span id="cb4-18">        total_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.counts[state, action]</span>
<span id="cb4-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> total_reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> total_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.sqrt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.log(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.counts)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> total_count)</span>
<span id="cb4-20"></span>
<span id="cb4-21">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> select_action(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state):</span>
<span id="cb4-22">        gittins_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.get_gittins_index(state, a) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> a <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.n_actions)]</span>
<span id="cb4-23">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.argmax(gittins_indices)</span>
<span id="cb4-24"></span>
<span id="cb4-25"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> sample_state(distribution, n_states):</span>
<span id="cb4-26">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> distribution <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uniform"</span>:</span>
<span id="cb4-27">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.random.randint(n_states)</span>
<span id="cb4-28">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> distribution <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span>:</span>
<span id="cb4-29">        state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>(np.random.normal(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n_states<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n_states<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb4-30">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.clip(state, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, n_states <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-31">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb4-32">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Unsupported distribution type"</span>)</span>
<span id="cb4-33"></span>
<span id="cb4-34"></span>
<span id="cb4-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Example usage</span></span>
<span id="cb4-36">n_states <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb4-37">n_actions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb4-38">n_iterations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb4-39"></span>
<span id="cb4-40">sender_bandit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ContextualBandit(n_states, n_actions)</span>
<span id="cb4-41">receiver_bandit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ContextualBandit(n_actions, n_states)</span>
<span id="cb4-42">state_distribution <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uniform"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Change to "normal" for normal distribution</span></span>
<span id="cb4-43"></span>
<span id="cb4-44">rewards <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb4-45">regrets <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb4-46">total_reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb4-47">total_regret <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb4-48">sender_gittins_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [[] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> _ <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_actions)]</span>
<span id="cb4-49">receiver_gittins_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [[] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> _ <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_states)]</span>
<span id="cb4-50"></span>
<span id="cb4-51"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulate the learning process</span></span>
<span id="cb4-52"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> t <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_iterations):</span>
<span id="cb4-53">    state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sample_state(state_distribution, n_states)</span>
<span id="cb4-54">    sender_action <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sender_bandit.select_action(state)</span>
<span id="cb4-55">    receiver_action <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> receiver_bandit.select_action(sender_action)</span>
<span id="cb4-56">    </span>
<span id="cb4-57">    reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> receiver_action <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> state <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb4-58">    total_reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> reward</span>
<span id="cb4-59">    total_regret <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> reward</span>
<span id="cb4-60">    </span>
<span id="cb4-61">    rewards.append(total_reward)</span>
<span id="cb4-62">    regrets.append(total_regret)</span>
<span id="cb4-63">    </span>
<span id="cb4-64">    sender_bandit.update(state, sender_action, reward)</span>
<span id="cb4-65">    receiver_bandit.update(sender_action, receiver_action, reward)</span>
<span id="cb4-66">    </span>
<span id="cb4-67">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> action <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_actions):</span>
<span id="cb4-68">        sender_gittins_indices[action].append(sender_bandit.get_gittins_index(state, action))</span>
<span id="cb4-69">    </span>
<span id="cb4-70">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> state <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_states):</span>
<span id="cb4-71">        receiver_gittins_indices[state].append(receiver_bandit.get_gittins_index(sender_action, state))</span>
<span id="cb4-72"></span>
<span id="cb4-73"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print final policy</span></span>
<span id="cb4-74"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sender policy:"</span>)</span>
<span id="cb4-75"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> state <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_states):</span>
<span id="cb4-76">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"State </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>state<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: Action </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sender_bandit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>select_action(state)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-77"></span>
<span id="cb4-78"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Receiver policy:"</span>)</span>
<span id="cb4-79"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> action <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_actions):</span>
<span id="cb4-80">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Action </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>action<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: State </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>receiver_bandit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>select_action(action)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-81"></span>
<span id="cb4-82"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the total rewards and regrets over time</span></span>
<span id="cb4-83">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb4-84">plt.plot(rewards, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Total Rewards'</span>)</span>
<span id="cb4-85">plt.plot(regrets, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Total Regret'</span>)</span>
<span id="cb4-86">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time Step'</span>)</span>
<span id="cb4-87">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Total Rewards/Regret'</span>)</span>
<span id="cb4-88">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Total Rewards and Regret Over Time'</span>)</span>
<span id="cb4-89">plt.legend()</span>
<span id="cb4-90">plt.show()</span>
<span id="cb4-91"></span>
<span id="cb4-92"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the Gittins indices over time for the sender</span></span>
<span id="cb4-93">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb4-94"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> action <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_actions):</span>
<span id="cb4-95">    plt.plot(sender_gittins_indices[action], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Sender Gittins Index (Action </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>action<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)'</span>)</span>
<span id="cb4-96">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time Step'</span>)</span>
<span id="cb4-97">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Gittins Index'</span>)</span>
<span id="cb4-98">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Sender Gittins Indices Over Time'</span>)</span>
<span id="cb4-99">plt.legend()</span>
<span id="cb4-100">plt.show()</span>
<span id="cb4-101"></span>
<span id="cb4-102"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the Gittins indices over time for the receiver</span></span>
<span id="cb4-103">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb4-104"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> state <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_states):</span>
<span id="cb4-105">    plt.plot(receiver_gittins_indices[state], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Receiver Gittins Index (State </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>state<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)'</span>)</span>
<span id="cb4-106">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time Step'</span>)</span>
<span id="cb4-107">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Gittins Index'</span>)</span>
<span id="cb4-108">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Receiver Gittins Indices Over Time'</span>)</span>
<span id="cb4-109">plt.legend()</span>
<span id="cb4-110">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sender policy:
State 0: Action 4
State 1: Action 0
State 2: Action 2
State 3: Action 3
State 4: Action 1
Receiver policy:
Action 0: State 1
Action 1: State 4
Action 2: State 2
Action 3: State 3
Action 4: State 0</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="re-rel_files/figure-html/cell-3-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel_files/figure-html/cell-3-output-2.png" width="965" height="523" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="re-rel_files/figure-html/cell-3-output-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel_files/figure-html/cell-3-output-3.png" width="969" height="523" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="re-rel_files/figure-html/cell-3-output-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel_files/figure-html/cell-3-output-4.png" width="969" height="523" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="making-it-bayesian" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="making-it-bayesian">Making it Bayesian</h2>
<p>According to <span class="citation" data-cites="sutton2018reinforcement">(Sutton and Barto 2018)</span> Gitting’s index are usually associated with the Bayesian paradigm.</p>
<div class="no-row-height column-margin column-container"><div id="ref-sutton2018reinforcement" class="csl-entry">
Sutton, R. S., and A. G. Barto. 2018. <em>Reinforcement Learning, Second Edition: An Introduction</em>. Adaptive Computation and Machine Learning Series. MIT Press. <a href="http://incompleteideas.net/book/RLbook2020.pdf">http://incompleteideas.net/book/RLbook2020.pdf</a>.
</div></div><p>As such one should be able to we could use a Bayesian updating scheme to learn expected rewards based on success counts. Since we are tracking successes vs failures we can use beta-binomial conjugate distributions to keep track of successes, failures and their likelihood.</p>
<p>This most basic form is like so:</p>
<div id="tbl-panel" class="quarto-layout-panel anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-panel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: sender &amp; receiver prior
</figcaption>
<div aria-describedby="tbl-panel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-panel" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-sender-prior" class="striped hover quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-sender-prior-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) sender <strong>alpha</strong>, <strong>beta</strong>
</figcaption>
<div aria-describedby="tbl-sender-prior-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-striped table-hover caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">State/Signal</th>
<th style="text-align: left;">0</th>
<th style="text-align: left;">1</th>
<th style="text-align: left;">2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,0</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-panel" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-receiver-prior" class="striped hover quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-receiver-prior-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) receiver <strong>alpha</strong>, <strong>beta</strong>
</figcaption>
<div aria-describedby="tbl-receiver-prior-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-striped table-hover caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Signal/Action</th>
<th style="text-align: left;">0</th>
<th style="text-align: left;">1</th>
<th style="text-align: left;">2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,0</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
<p>Where we have a table of independent beta-binomial priors for each state/signal and signal/action pair.</p>
<p>After 5 failures we update the beta distribution for the sender and receiver as follows:</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-sender-posterior" class="striped hover quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sender-posterior-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: sender <strong>alpha</strong>, <strong>beta</strong>
</figcaption>
<div aria-describedby="tbl-sender-posterior-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-striped table-hover caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">State/Signal</th>
<th style="text-align: left;">0</th>
<th style="text-align: left;">1</th>
<th style="text-align: left;">2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;">0,1</td>
<td style="text-align: left;">0,2</td>
<td style="text-align: left;">0,0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,1</td>
<td style="text-align: left;">0,0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,1</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-receiver-posterior" class="striped hover quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-receiver-posterior-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: receiver <strong>alpha</strong>, <strong>beta</strong>
</figcaption>
<div aria-describedby="tbl-receiver-posterior-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-striped table-hover caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Signal/Action</th>
<th style="text-align: left;">0</th>
<th style="text-align: left;">1</th>
<th style="text-align: left;">2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;">0,1</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,1</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,1</td>
<td style="text-align: left;">0,0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">0,2</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,0</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p>sender &amp; receiver posterior</p>
</div>
</div>
</div>
<p>Failures are outcomes of uncorrelated signal action pairs and are basically like adding noise to the distribution on the loss side. Failures here tend to have a confounding effect - they reduce the probabilities associated with reward signals. And the model is not aware of the order of rewards/failures recency.</p>
<p>Now lets update for 2 success as follows:</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-sender-posterior" class="striped hover quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sender-posterior-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: sender <strong>alpha</strong>, <strong>beta</strong>
</figcaption>
<div aria-describedby="tbl-sender-posterior-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-striped table-hover caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 6%">
<col style="width: 36%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">State/Signal</th>
<th style="text-align: left;">0</th>
<th style="text-align: left;">1</th>
<th style="text-align: left;">2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;">1,1</td>
<td style="text-align: left;"><span style="color: red">1</span>,2</td>
<td style="text-align: left;">0,0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,1</td>
<td style="text-align: left;"><span style="color: green">1</span>,0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,1</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-receiver-posterior" class="striped hover quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-receiver-posterior-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5: receiver <strong>alpha</strong>, <strong>beta</strong>
</figcaption>
<div aria-describedby="tbl-receiver-posterior-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-striped table-hover caption-top table">
<colgroup>
<col style="width: 19%">
<col style="width: 35%">
<col style="width: 38%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Signal/Action</th>
<th style="text-align: left;">0</th>
<th style="text-align: left;">1</th>
<th style="text-align: left;">2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;">0,1</td>
<td style="text-align: left;">0,0</td>
<td style="text-align: left;">0,1</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;"><span style="color: red">1</span>,0</td>
<td style="text-align: left;">0,1</td>
<td style="text-align: left;">0,0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">0,2</td>
<td style="text-align: left;"><span style="color: green">1</span>,0</td>
<td style="text-align: left;">0,0</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p>sender &amp; receiver posterior</p>
</div>
</div>
</div>
<p>The Rewards are for <em>Corralated</em> <strong>signals/action</strong> pairs. However before learning progresses signal/action pairs are picked by chance. And so if different signal/action pairs are picked for the same state we will get a synonym and consequently will be missing a state/signal pair for one of the other states which will need to be shared (homonym).</p>
<p>Note that if we have a ties (between two signal/action pairs for a state then the next success or failure can be a spontaneous symmetry breaking event.</p>
<p>This will result in a a partial pooling equilibrium.</p>
<p>The Gittin’s index might help here by picking an options with the greatest expected return. If we set it up so it can recognize that a separating equilibria have the greatest expected return we should eventual learn these.</p>
<p>The problem is that micommunications (may confound the learning, until the pattern due to rewards are sufficiently reinforced.)</p>
<div id="a4bad961" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb6-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> BayesianContextualBandit:</span>
<span id="cb6-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, n_states, n_actions):</span>
<span id="cb6-6">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.n_states <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n_states</span>
<span id="cb6-7">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.n_actions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n_actions</span>
<span id="cb6-8">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.ones((n_states, n_actions))</span>
<span id="cb6-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.beta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.ones((n_states, n_actions))</span>
<span id="cb6-10"></span>
<span id="cb6-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> update(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state, action, reward):</span>
<span id="cb6-12">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb6-13">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha[state, action] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb6-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb6-15">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.beta[state, action] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb6-16"></span>
<span id="cb6-17">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_expected_reward(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state, action):</span>
<span id="cb6-18">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha[state, action] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha[state, action] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.beta[state, action])</span>
<span id="cb6-19"></span>
<span id="cb6-20">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_gittins_index(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state, action):</span>
<span id="cb6-21">        total_reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha[state, action]</span>
<span id="cb6-22">        total_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha[state, action] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.beta[state, action]</span>
<span id="cb6-23">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> total_reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> total_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.sqrt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.log(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.beta)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> total_count)</span>
<span id="cb6-24"></span>
<span id="cb6-25">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> select_action(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state):</span>
<span id="cb6-26">        gittins_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.get_gittins_index(state, a) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> a <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.n_actions)]</span>
<span id="cb6-27">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.argmax(gittins_indices)</span>
<span id="cb6-28"></span>
<span id="cb6-29"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> sample_state(distribution, n_states):</span>
<span id="cb6-30">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> distribution <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uniform"</span>:</span>
<span id="cb6-31">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.random.randint(n_states)</span>
<span id="cb6-32">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> distribution <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span>:</span>
<span id="cb6-33">        state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>(np.random.normal(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n_states<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n_states<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb6-34">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.clip(state, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, n_states <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-35">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb6-36">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Unsupported distribution type"</span>)</span>
<span id="cb6-37"></span>
<span id="cb6-38"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> run_experiment(n_states, n_actions, n_iterations, state_distribution, k):</span>
<span id="cb6-39">    all_rewards <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((k, n_iterations))</span>
<span id="cb6-40">    all_regrets <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((k, n_iterations))</span>
<span id="cb6-41">    all_sender_gittins_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((k, n_actions, n_iterations))</span>
<span id="cb6-42">    all_receiver_gittins_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((k, n_states, n_iterations))</span>
<span id="cb6-43">    </span>
<span id="cb6-44">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(k):</span>
<span id="cb6-45">        sender_bandit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BayesianContextualBandit(n_states, n_actions)</span>
<span id="cb6-46">        receiver_bandit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BayesianContextualBandit(n_actions, n_states)</span>
<span id="cb6-47">        </span>
<span id="cb6-48">        total_reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb6-49">        total_regret <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb6-50">        </span>
<span id="cb6-51">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> t <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_iterations):</span>
<span id="cb6-52">            state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sample_state(state_distribution, n_states)</span>
<span id="cb6-53">            sender_action <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sender_bandit.select_action(state)</span>
<span id="cb6-54">            receiver_action <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> receiver_bandit.select_action(sender_action)</span>
<span id="cb6-55">            </span>
<span id="cb6-56">            reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> receiver_action <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> state <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb6-57">            total_reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> reward</span>
<span id="cb6-58">            total_regret <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> reward</span>
<span id="cb6-59">            </span>
<span id="cb6-60">            all_rewards[i, t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> total_reward</span>
<span id="cb6-61">            all_regrets[i, t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> total_regret</span>
<span id="cb6-62">            </span>
<span id="cb6-63">            sender_bandit.update(state, sender_action, reward)</span>
<span id="cb6-64">            receiver_bandit.update(sender_action, receiver_action, reward)</span>
<span id="cb6-65">            </span>
<span id="cb6-66">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> action <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_actions):</span>
<span id="cb6-67">                all_sender_gittins_indices[i, action, t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sender_bandit.get_gittins_index(state, action)</span>
<span id="cb6-68">            </span>
<span id="cb6-69">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_states):</span>
<span id="cb6-70">                all_receiver_gittins_indices[i, s, t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> receiver_bandit.get_gittins_index(sender_action, s)</span>
<span id="cb6-71">    </span>
<span id="cb6-72">    mean_rewards <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(all_rewards, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb6-73">    mean_regrets <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(all_regrets, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb6-74">    mean_sender_gittins_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(all_sender_gittins_indices, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb6-75">    mean_receiver_gittins_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(all_receiver_gittins_indices, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb6-76">    </span>
<span id="cb6-77">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> all_rewards, all_regrets, mean_rewards, mean_regrets, mean_sender_gittins_indices, mean_receiver_gittins_indices</span>
<span id="cb6-78"></span>
<span id="cb6-79"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Parameters</span></span>
<span id="cb6-80">n_states <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb6-81">n_actions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb6-82">n_iterations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb6-83">state_distribution <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uniform"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Change to "normal" for normal distribution</span></span>
<span id="cb6-84">k <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of experiment runs</span></span>
<span id="cb6-85"></span>
<span id="cb6-86"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run the experiment</span></span>
<span id="cb6-87">all_rewards, all_regrets, mean_rewards, mean_regrets, mean_sender_gittins_indices, mean_receiver_gittins_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> run_experiment(n_states, n_actions, n_iterations, state_distribution, k)</span>
<span id="cb6-88"></span>
<span id="cb6-89"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the mean total rewards and regrets over time along with individual curves</span></span>
<span id="cb6-90">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb6-91"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(k):</span>
<span id="cb6-92">    plt.plot(all_rewards[i], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb6-93">plt.plot(mean_rewards, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mean Total Rewards'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb6-94"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(k):</span>
<span id="cb6-95">    plt.plot(all_regrets[i], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb6-96">plt.plot(mean_regrets, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mean Total Regret'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb6-97">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time Step'</span>)</span>
<span id="cb6-98">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Total Rewards/Regret'</span>)</span>
<span id="cb6-99">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Total Rewards and Regret Over Time'</span>)</span>
<span id="cb6-100">plt.legend()</span>
<span id="cb6-101">plt.show()</span>
<span id="cb6-102"></span>
<span id="cb6-103"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the mean Gittins indices over time for the sender</span></span>
<span id="cb6-104">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb6-105"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> action <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_actions):</span>
<span id="cb6-106">    plt.plot(mean_sender_gittins_indices[action], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Mean Sender Gittins Index (Action </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>action<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)'</span>)</span>
<span id="cb6-107">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time Step'</span>)</span>
<span id="cb6-108">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Gittins Index'</span>)</span>
<span id="cb6-109">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mean Sender Gittins Indices Over Time'</span>)</span>
<span id="cb6-110">plt.legend()</span>
<span id="cb6-111">plt.show()</span>
<span id="cb6-112"></span>
<span id="cb6-113"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the mean Gittins indices over time for the receiver</span></span>
<span id="cb6-114">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb6-115"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> state <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_states):</span>
<span id="cb6-116">    plt.plot(mean_receiver_gittins_indices[state], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Mean Receiver Gittins Index (State </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>state<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)'</span>)</span>
<span id="cb6-117">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time Step'</span>)</span>
<span id="cb6-118">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Gittins Index'</span>)</span>
<span id="cb6-119">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mean Receiver Gittins Indices Over Time'</span>)</span>
<span id="cb6-120">plt.legend()</span>
<span id="cb6-121">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="re-rel_files/figure-html/cell-4-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel_files/figure-html/cell-4-output-1.png" width="965" height="523" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="re-rel_files/figure-html/cell-4-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel_files/figure-html/cell-4-output-2.png" width="961" height="523" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="re-rel_files/figure-html/cell-4-output-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel_files/figure-html/cell-4-output-3.png" width="961" height="523" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Of course there is no reason to use independent probabilities for for learning.</p>
<p>The schemes described in the book condition state for the sender and on the signal for the receiver. I.E. a success for a signal/action pair implies:</p>
<ol type="1">
<li>a failure for the other state/signals options with the same states for the sender.</li>
<li>a failure for the other signal/action options with the same signal for the receiver.</li>
</ol>
<p>In my algorithm I went further and added the logic that a success for a signals/action pair also implies:</p>
<ol type="1">
<li>a failure for the other state/signals options with the same signal but different states for the sender.</li>
<li>a failure for the other signal/action options with the same action but different signals for the receiver.</li>
</ol>
<p>also implies that the signal wasn’t available for other states.</p>
<p>I’m not sure if there is a distribution that updates like that, though it isn’t that hard to implement either of the two schemes and they should work an extended beta distribution.</p>
</section>
<section id="derichlet-multinomial-variant" class="level2">
<h2 class="anchored" data-anchor-id="derichlet-multinomial-variant">Derichlet-Multinomial variant</h2>
<div id="725ab945" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb7-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> BayesianContextualBandit:</span>
<span id="cb7-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, n_states, n_actions):</span>
<span id="cb7-6">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.n_states <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n_states</span>
<span id="cb7-7">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.n_actions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n_actions</span>
<span id="cb7-8">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.ones((n_states, n_actions))</span>
<span id="cb7-9"></span>
<span id="cb7-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> update(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state, action, reward):</span>
<span id="cb7-11">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb7-12">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha[state, action] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb7-13"></span>
<span id="cb7-14">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_expected_reward(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state, action):</span>
<span id="cb7-15">        alpha_sum <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha[state])</span>
<span id="cb7-16">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha[state, action] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> alpha_sum</span>
<span id="cb7-17"></span>
<span id="cb7-18">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_gittins_index(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state, action):</span>
<span id="cb7-19">        alpha_sum <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha[state])</span>
<span id="cb7-20">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha[state, action] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> alpha_sum <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.sqrt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.log(alpha_sum) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha[state, action] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb7-21"></span>
<span id="cb7-22">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> select_action(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state):</span>
<span id="cb7-23">        gittins_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.get_gittins_index(state, a) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> a <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.n_actions)]</span>
<span id="cb7-24">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.argmax(gittins_indices)</span>
<span id="cb7-25"></span>
<span id="cb7-26"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> sample_state(distribution, n_states):</span>
<span id="cb7-27">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> distribution <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uniform"</span>:</span>
<span id="cb7-28">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.random.randint(n_states)</span>
<span id="cb7-29">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> distribution <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span>:</span>
<span id="cb7-30">        state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>(np.random.normal(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n_states<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n_states<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb7-31">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.clip(state, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, n_states <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb7-32">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb7-33">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Unsupported distribution type"</span>)</span>
<span id="cb7-34"></span>
<span id="cb7-35"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> run_experiment(n_states, n_actions, n_iterations, state_distribution, k):</span>
<span id="cb7-36">    all_rewards <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((k, n_iterations))</span>
<span id="cb7-37">    all_regrets <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((k, n_iterations))</span>
<span id="cb7-38">    all_sender_gittins_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((k, n_actions, n_iterations))</span>
<span id="cb7-39">    all_receiver_gittins_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((k, n_states, n_iterations))</span>
<span id="cb7-40">    </span>
<span id="cb7-41">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(k):</span>
<span id="cb7-42">        sender_bandit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BayesianContextualBandit(n_states, n_actions)</span>
<span id="cb7-43">        receiver_bandit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BayesianContextualBandit(n_actions, n_states)</span>
<span id="cb7-44">        </span>
<span id="cb7-45">        total_reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb7-46">        total_regret <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb7-47">        </span>
<span id="cb7-48">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> t <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_iterations):</span>
<span id="cb7-49">            state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sample_state(state_distribution, n_states)</span>
<span id="cb7-50">            sender_action <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sender_bandit.select_action(state)</span>
<span id="cb7-51">            receiver_action <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> receiver_bandit.select_action(sender_action)</span>
<span id="cb7-52">            </span>
<span id="cb7-53">            reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> receiver_action <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> state <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb7-54">            total_reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> reward</span>
<span id="cb7-55">            total_regret <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> reward</span>
<span id="cb7-56">            </span>
<span id="cb7-57">            all_rewards[i, t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> total_reward</span>
<span id="cb7-58">            all_regrets[i, t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> total_regret</span>
<span id="cb7-59">            </span>
<span id="cb7-60">            sender_bandit.update(state, sender_action, reward)</span>
<span id="cb7-61">            receiver_bandit.update(sender_action, receiver_action, reward)</span>
<span id="cb7-62">            </span>
<span id="cb7-63">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> action <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_actions):</span>
<span id="cb7-64">                all_sender_gittins_indices[i, action, t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sender_bandit.get_gittins_index(state, action)</span>
<span id="cb7-65">            </span>
<span id="cb7-66">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_states):</span>
<span id="cb7-67">                all_receiver_gittins_indices[i, s, t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> receiver_bandit.get_gittins_index(sender_action, s)</span>
<span id="cb7-68">    </span>
<span id="cb7-69">    mean_rewards <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(all_rewards, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb7-70">    mean_regrets <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(all_regrets, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb7-71">    mean_sender_gittins_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(all_sender_gittins_indices, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb7-72">    mean_receiver_gittins_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(all_receiver_gittins_indices, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb7-73">    </span>
<span id="cb7-74">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> all_rewards, all_regrets, mean_rewards, mean_regrets, mean_sender_gittins_indices, mean_receiver_gittins_indices</span>
<span id="cb7-75"></span>
<span id="cb7-76"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Parameters</span></span>
<span id="cb7-77">n_states <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb7-78">n_actions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb7-79">n_iterations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb7-80">state_distribution <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uniform"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Change to "normal" for normal distribution</span></span>
<span id="cb7-81">k <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of experiment runs</span></span>
<span id="cb7-82"></span>
<span id="cb7-83"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run the experiment</span></span>
<span id="cb7-84">all_rewards, all_regrets, mean_rewards, mean_regrets, mean_sender_gittins_indices, mean_receiver_gittins_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> run_experiment(n_states, n_actions, n_iterations, state_distribution, k)</span>
<span id="cb7-85"></span>
<span id="cb7-86"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the mean total rewards and regrets over time along with individual curves</span></span>
<span id="cb7-87">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb7-88"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(k):</span>
<span id="cb7-89">    plt.plot(all_rewards[i], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb7-90">plt.plot(mean_rewards, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mean Total Rewards'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb7-91"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(k):</span>
<span id="cb7-92">    plt.plot(all_regrets[i], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb7-93">plt.plot(mean_regrets, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mean Total Regret'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb7-94">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time Step'</span>)</span>
<span id="cb7-95">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Total Rewards/Regret'</span>)</span>
<span id="cb7-96">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Total Rewards and Regret Over Time'</span>)</span>
<span id="cb7-97">plt.legend()</span>
<span id="cb7-98">plt.show()</span>
<span id="cb7-99"></span>
<span id="cb7-100"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the mean Gittins indices over time for the sender</span></span>
<span id="cb7-101">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb7-102"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> action <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_actions):</span>
<span id="cb7-103">    plt.plot(mean_sender_gittins_indices[action], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Mean Sender Gittins Index (Action </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>action<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)'</span>)</span>
<span id="cb7-104">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time Step'</span>)</span>
<span id="cb7-105">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Gittins Index'</span>)</span>
<span id="cb7-106">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mean Sender Gittins Indices Over Time'</span>)</span>
<span id="cb7-107">plt.legend()</span>
<span id="cb7-108">plt.show()</span>
<span id="cb7-109"></span>
<span id="cb7-110"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the mean Gittins indices over time for the receiver</span></span>
<span id="cb7-111">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb7-112"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> state <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_states):</span>
<span id="cb7-113">    plt.plot(mean_receiver_gittins_indices[state], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Mean Receiver Gittins Index (State </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>state<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)'</span>)</span>
<span id="cb7-114">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time Step'</span>)</span>
<span id="cb7-115">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Gittins Index'</span>)</span>
<span id="cb7-116">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mean Receiver Gittins Indices Over Time'</span>)</span>
<span id="cb7-117">plt.legend()</span>
<span id="cb7-118">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="re-rel_files/figure-html/cell-5-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel_files/figure-html/cell-5-output-1.png" width="965" height="523" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="re-rel_files/figure-html/cell-5-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel_files/figure-html/cell-5-output-2.png" width="961" height="523" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="re-rel_files/figure-html/cell-5-output-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel_files/figure-html/cell-5-output-3.png" width="961" height="523" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="thompson-sampling" class="level2">
<h2 class="anchored" data-anchor-id="thompson-sampling">Thompson sampling</h2>
<div id="4be8ac16" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb8-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> ThompsonSamplingContextualBandit:</span>
<span id="cb8-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, n_states, n_actions):</span>
<span id="cb8-6">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.n_states <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n_states</span>
<span id="cb8-7">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.n_actions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n_actions</span>
<span id="cb8-8">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.ones((n_states, n_actions))</span>
<span id="cb8-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.beta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.ones((n_states, n_actions))</span>
<span id="cb8-10"></span>
<span id="cb8-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> update(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state, action, reward):</span>
<span id="cb8-12">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb8-13">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha[state, action] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb8-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb8-15">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.beta[state, action] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb8-16"></span>
<span id="cb8-17">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> select_action(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state):</span>
<span id="cb8-18">        samples <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [np.random.beta(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha[state, a], <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.beta[state, a]) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> a <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.n_actions)]</span>
<span id="cb8-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.argmax(samples)</span>
<span id="cb8-20"></span>
<span id="cb8-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> sample_state(distribution, n_states):</span>
<span id="cb8-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> distribution <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uniform"</span>:</span>
<span id="cb8-23">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.random.randint(n_states)</span>
<span id="cb8-24">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> distribution <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span>:</span>
<span id="cb8-25">        state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>(np.random.normal(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n_states<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n_states<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb8-26">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.clip(state, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, n_states <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-27">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb8-28">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Unsupported distribution type"</span>)</span>
<span id="cb8-29"></span>
<span id="cb8-30"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> run_experiment(n_states, n_actions, n_iterations, state_distribution, k):</span>
<span id="cb8-31">    all_rewards <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((k, n_iterations))</span>
<span id="cb8-32">    all_regrets <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((k, n_iterations))</span>
<span id="cb8-33">    all_sender_ts_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((k, n_actions, n_iterations))</span>
<span id="cb8-34">    all_receiver_ts_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((k, n_states, n_iterations))</span>
<span id="cb8-35">    </span>
<span id="cb8-36">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(k):</span>
<span id="cb8-37">        sender_bandit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ThompsonSamplingContextualBandit(n_states, n_actions)</span>
<span id="cb8-38">        receiver_bandit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ThompsonSamplingContextualBandit(n_actions, n_states)</span>
<span id="cb8-39">        </span>
<span id="cb8-40">        total_reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb8-41">        total_regret <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb8-42">        </span>
<span id="cb8-43">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> t <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_iterations):</span>
<span id="cb8-44">            state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sample_state(state_distribution, n_states)</span>
<span id="cb8-45">            sender_action <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sender_bandit.select_action(state)</span>
<span id="cb8-46">            receiver_action <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> receiver_bandit.select_action(sender_action)</span>
<span id="cb8-47">            </span>
<span id="cb8-48">            reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> receiver_action <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> state <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb8-49">            total_reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> reward</span>
<span id="cb8-50">            total_regret <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> reward</span>
<span id="cb8-51">            </span>
<span id="cb8-52">            all_rewards[i, t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> total_reward</span>
<span id="cb8-53">            all_regrets[i, t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> total_regret</span>
<span id="cb8-54">            </span>
<span id="cb8-55">            sender_bandit.update(state, sender_action, reward)</span>
<span id="cb8-56">            receiver_bandit.update(sender_action, receiver_action, reward)</span>
<span id="cb8-57">            </span>
<span id="cb8-58">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> action <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_actions):</span>
<span id="cb8-59">                all_sender_ts_indices[i, action, t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.beta(sender_bandit.alpha[state, action], sender_bandit.beta[state, action])</span>
<span id="cb8-60">            </span>
<span id="cb8-61">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_states):</span>
<span id="cb8-62">                all_receiver_ts_indices[i, s, t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.beta(receiver_bandit.alpha[sender_action, s], receiver_bandit.beta[sender_action, s])</span>
<span id="cb8-63">    </span>
<span id="cb8-64">    mean_rewards <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(all_rewards, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb8-65">    mean_regrets <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(all_regrets, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb8-66">    mean_sender_ts_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(all_sender_ts_indices, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb8-67">    mean_receiver_ts_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(all_receiver_ts_indices, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb8-68">    </span>
<span id="cb8-69">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> all_rewards, all_regrets, mean_rewards, mean_regrets, mean_sender_ts_indices, mean_receiver_ts_indices</span>
<span id="cb8-70"></span>
<span id="cb8-71"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Parameters</span></span>
<span id="cb8-72">n_states <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb8-73">n_actions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb8-74">n_iterations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb8-75">state_distribution <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uniform"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Change to "normal" for normal distribution</span></span>
<span id="cb8-76">k <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of experiment runs</span></span>
<span id="cb8-77"></span>
<span id="cb8-78"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run the experiment</span></span>
<span id="cb8-79">all_rewards, all_regrets, mean_rewards, mean_regrets, mean_sender_ts_indices, mean_receiver_ts_indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> run_experiment(n_states, n_actions, n_iterations, state_distribution, k)</span>
<span id="cb8-80"></span>
<span id="cb8-81"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the mean total rewards and regrets over time along with individual curves</span></span>
<span id="cb8-82">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb8-83"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(k):</span>
<span id="cb8-84">    plt.plot(all_rewards[i], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb8-85">plt.plot(mean_rewards, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mean Total Rewards'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb8-86"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(k):</span>
<span id="cb8-87">    plt.plot(all_regrets[i], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb8-88">plt.plot(mean_regrets, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mean Total Regret'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb8-89">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time Step'</span>)</span>
<span id="cb8-90">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Total Rewards/Regret'</span>)</span>
<span id="cb8-91">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Total Rewards and Regret Over Time'</span>)</span>
<span id="cb8-92">plt.legend()</span>
<span id="cb8-93">plt.show()</span>
<span id="cb8-94"></span>
<span id="cb8-95"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the mean Thompson Sampling indices over time for the sender</span></span>
<span id="cb8-96">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb8-97"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> action <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_actions):</span>
<span id="cb8-98">    plt.plot(mean_sender_ts_indices[action], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Mean Sender TS Index (Action </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>action<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)'</span>)</span>
<span id="cb8-99">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time Step'</span>)</span>
<span id="cb8-100">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Thompson Sampling Index'</span>)</span>
<span id="cb8-101">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mean Sender Thompson Sampling Indices Over Time'</span>)</span>
<span id="cb8-102">plt.legend()</span>
<span id="cb8-103">plt.show()</span>
<span id="cb8-104"></span>
<span id="cb8-105"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the mean Thompson Sampling indices over time for the receiver</span></span>
<span id="cb8-106">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb8-107"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> state <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_states):</span>
<span id="cb8-108">    plt.plot(mean_receiver_ts_indices[state], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Mean Receiver TS Index (State </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>state<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)'</span>)</span>
<span id="cb8-109">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Time Step'</span>)</span>
<span id="cb8-110">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Thompson Sampling Index'</span>)</span>
<span id="cb8-111">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mean Receiver Thompson Sampling Indices Over Time'</span>)</span>
<span id="cb8-112">plt.legend()</span>
<span id="cb8-113"></span>
<span id="cb8-114">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="re-rel_files/figure-html/cell-6-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel_files/figure-html/cell-6-output-1.png" width="965" height="523" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="re-rel_files/figure-html/cell-6-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel_files/figure-html/cell-6-output-2.png" width="969" height="523" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="re-rel_files/figure-html/cell-6-output-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel_files/figure-html/cell-6-output-3.png" width="969" height="523" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {Roth {Erev} Learning in {Lewis} Signaling Games},
  date = {2024-09-26},
  url = {https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel.html},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“Roth Erev Learning in Lewis Signaling
Games.”</span> September 26, 2024. <a href="https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel.html">https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel.html</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/2024-05-09-RE-RL/re-rel.html</guid>
  <pubDate>Thu, 26 Sep 2024 15:13:06 GMT</pubDate>
</item>
<item>
  <title>Sine function</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/shinylive/</link>
  <description><![CDATA[ 





<p>The plot below allows you to control parameters used in the sine function. Experiment with the <em>period</em>, <em>amplitude</em>, and <em>phase shift</em> to see how they affect the graph.</p>
<pre class="shinylive-python" data-engine="python"><code>#| standalone: true
#| components: [editor, viewer]
#| layout: horizontal
#| viewerHeight: 800
from shiny import App, render, ui
import numpy as np
import matplotlib.pyplot as plt

app_ui = ui.page_fluid(
    ui.layout_sidebar(
        ui.panel_sidebar(
            ui.input_slider("period", "Period", 0.5, 2, 1, step=0.5),
            ui.input_slider("amplitude", "Amplitude", 0, 2, 1, step=0.25),
            ui.input_slider("shift", "Phase shift", 0, 2, 0, step=0.1),
        ),
        ui.panel_main(
            ui.output_plot("plot"),
        ),
    ),
)


def server(input, output, session):
    @output
    @render.plot(alt="Sine function")
    def plot():
        t = np.arange(0.0, 4.0, 0.01)
        s = input.amplitude() * np.sin(
            (2 * np.pi / input.period()) * (t - input.shift() / 2)
        )
        fig, ax = plt.subplots()
        ax.set_ylim([-2, 2])
        ax.plot(t, s)
        ax.grid()


app = App(app_ui, server)
</code></pre>
<p>this code shows how to access the Shinylive app in from the apps folder using a helper function from the root dierctory.</p>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {Sine Function},
  date = {2024-09-26},
  url = {https://orenbochman.github.io/posts/2024/shinylive/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“Sine Function.”</span> September 26, 2024.
<a href="https://orenbochman.github.io/posts/2024/shinylive/">https://orenbochman.github.io/posts/2024/shinylive/</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/shinylive/</guid>
  <pubDate>Thu, 26 Sep 2024 15:13:06 GMT</pubDate>
</item>
<item>
  <title>deduction evaluation</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/deduction.html</link>
  <description><![CDATA[ 





<p>goal create a deduction data-set for evaluating reasoning capabilities of a man and machine.</p>
<p>tasks:</p>
<ol type="1">
<li>learning graph based representation of arguments from a text</li>
<li>generating a text version of such a graph</li>
<li>identig roles of relations in the graph such as</li>
</ol>
<ul>
<li><p>subject, predicate, copula, quantity, quality, distribution, figure, mood, opposition, conversion</p></li>
<li><p>common sense knowledge, counterfactuals, hypotheticals, conditionals, causality, modality, necessity, possibility, probability, uncertainty, vagueness, ambiguity, contradiction, paradox, tautology, fallacy, sophism, enthymeme, analogy, dilemma, aporia, syllogism, enthymeme, paradox, proposition, argument, inference, deduction, induction, abduction.</p></li>
<li><p>term, proposition, argument, inference, fallacy, tautology, contradiction, paradox, syllogism, enthymeme, sophism, paradox, aporia, dilemma, analogy, deduction, induction, abduction aporias, finding dilemmas</p></li>
<li><p>removing the ambiguity from a text by constructing a graph then rewriting the text to be more precise.</p></li>
<li><p>graph of categories (perhaps drawn from wikidata, or extracted from a text by an LLM)</p></li>
<li><p>statements can be formed genereated from the graph using LLM (large language model)</p></li>
<li><p>we might prefer to genereate statements these using unification with spacy operating on the graph</p></li>
<li><p>use the square of opposition to formulate statements and inferences from the graph</p></li>
<li><p>generate graded deductions based on sylogisms</p>
<ul>
<li>tautologies</li>
<li>falaices with type of fallacy</li>
<li>inferences with type of inference</li>
</ul></li>
<li><p>each sylogism will need a template with designated parts of speech for each term in the sylogism</p></li>
<li><p>the arguments should be composable so that</p></li>
</ul>
<blockquote class="blockquote">
<p>All men are mortal. Socrates is a man. Therefore, Socrates is mortal.[2]</p>
</blockquote>
<p>P belongs to S P is predicated of S P is said of S</p>
<p>There are four different types of categorical sentences: universal affirmative (A), universal negative (E), particular affirmative (I) and particular negative (O).</p>
<p>A - A belongs to every B E - A belongs to no B I - A belongs to some B O - A does not belong to some B</p>
<p>a = belongs to every e = belongs to no i = belongs to some o = does not belong to some</p>
<p>Categorical sentences may then be abbreviated as follows:</p>
<p>AaB = A belongs to every B (Every B is A) AeB = A belongs to no B (No B is A) AiB = A belongs to some B (Some B is A) AoB = A does not belong to some B (Some B is not A)</p>
<p>the ten terms or parts of speech in a categorical sentence, drawn from the Organon are :</p>
<ol type="1">
<li>Subject</li>
<li>Predicate</li>
<li>Copula</li>
<li>Quantity</li>
<li>Quality</li>
<li>Distribution</li>
<li>Figure</li>
<li>Mood</li>
<li>Opposition</li>
<li>Conversion</li>
</ol>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {Deduction Evaluation},
  date = {2024-09-26},
  url = {https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/deduction.html},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“Deduction Evaluation.”</span> September 26,
2024. <a href="https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/deduction.html">https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/deduction.html</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/2024-09-30-LLMs/deduction.html</guid>
  <pubDate>Thu, 26 Sep 2024 15:13:06 GMT</pubDate>
</item>
<item>
  <title>emergent communications</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/2024-05-01-signals/shanon-game.html</link>
  <description><![CDATA[ 





<p>it seems that we might want to look at the emergent communications by considering 1. a Lewis signaling games to model coordination tasks for a basic communication system 2. a Shannon game to model the communication of information between agents in which the learn a shared communication protocol potentially using error detection and correction and corection. 3. a Chomsky game to model development of a shared grammar for complex signals.</p>
<section id="shannon-game" class="level2">
<h2 class="anchored" data-anchor-id="shannon-game">Shannon Game</h2>
<p>Shanon games are about emergence of randomized communication protocols. A randomised communication protocol is a probability distribution over the set of possible deterministic communication protocols.</p>
<p>We can model any deterministic communication protocol as a pair of decision rees, one for the sender and one for the receiver. The sender’s decision tree maps each possible message to a signal, and the receiver’s decision tree maps each possible signal to a message.</p>
<p>messages that the sender can send. The sender samples a message from this distribution and sends it to the receiver. The receiver then uses a decoding function to map the received message back to the original signal. The goal of the game is for the sender and receiver to coordinate on a communication protocol that maximizes their payoff, which is typically based on the accuracy of message transmission and reception. It is a protocol that uses randomness to encode and decode messages. This randomness can be used to introduce redundancy in the message, which can help in error detection and correction.</p>
<div id="f4dc8e19" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> CommunicationAgent:</span>
<span id="cb1-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, num_strategies):</span>
<span id="cb1-5">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.num_strategies <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> num_strategies</span>
<span id="cb1-6">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.q_table <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((num_strategies, num_strategies))</span>
<span id="cb1-7">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.learning_rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span></span>
<span id="cb1-8">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.discount_factor <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span></span>
<span id="cb1-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.epsilon <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span></span>
<span id="cb1-10">    </span>
<span id="cb1-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> choose_strategy(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb1-12">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> np.random.rand() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.epsilon:</span>
<span id="cb1-13">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.random.randint(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.num_strategies)</span>
<span id="cb1-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb1-15">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.argmax(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.q_table.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb1-16">    </span>
<span id="cb1-17">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> update_q_values(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, sender_strategy, receiver_strategy, reward):</span>
<span id="cb1-18">        max_future_q <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.q_table[receiver_strategy])</span>
<span id="cb1-19">        current_q <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.q_table[sender_strategy, receiver_strategy]</span>
<span id="cb1-20">        new_q <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> current_q <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.learning_rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.discount_factor <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> max_future_q <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> current_q)</span>
<span id="cb1-21">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.q_table[sender_strategy, receiver_strategy] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> new_q</span>
<span id="cb1-22"></span>
<span id="cb1-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation parameters</span></span>
<span id="cb1-24">num_strategies <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb1-25">num_iterations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb1-26"></span>
<span id="cb1-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize agents</span></span>
<span id="cb1-28">alice <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CommunicationAgent(num_strategies)</span>
<span id="cb1-29">bob <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CommunicationAgent(num_strategies)</span>
<span id="cb1-30"></span>
<span id="cb1-31"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> _ <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(num_iterations):</span>
<span id="cb1-32">    sender_strategy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> alice.choose_strategy()</span>
<span id="cb1-33">    receiver_strategy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bob.choose_strategy()</span>
<span id="cb1-34">    </span>
<span id="cb1-35">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulate message transmission and reception with noise</span></span>
<span id="cb1-36">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This is a placeholder for actual encoding/decoding logic</span></span>
<span id="cb1-37">    success <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.rand() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Assume 80% chance of success</span></span>
<span id="cb1-38">    </span>
<span id="cb1-39">    reward <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> success <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-40">    alice.update_q_values(sender_strategy, receiver_strategy, reward)</span>
<span id="cb1-41">    bob.update_q_values(receiver_strategy, sender_strategy, reward)</span>
<span id="cb1-42"></span>
<span id="cb1-43"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Alice's Q-Table:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, alice.q_table)</span>
<span id="cb1-44"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bob's Q-Table:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, bob.q_table)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Alice's Q-Table:
 [[ 1.1870612   0.          0.          0.1         0.        ]
 [ 1.56945522  1.54181517  0.97338873  0.82764688  1.00508109]
 [ 0.63863811 -0.02636762  0.          0.19736455  0.1607126 ]
 [ 0.56019999  0.          0.          0.          0.        ]
 [ 0.80594973  0.25923685  0.14809569  0.          0.        ]]
Bob's Q-Table:
 [[ 1.50847687  1.20172521  0.6687741   0.64135768  0.55690049]
 [ 0.          0.7344698  -0.0829      0.          0.15625959]
 [ 0.          0.94187947  0.          0.          0.15028825]
 [ 0.15690016  0.91314851  0.22940322  0.          0.        ]
 [ 0.          0.89534698  0.14117867  0.          0.        ]]</code></pre>
</div>
</div>
<p>This example illustrates a basic game-theoretic approach where the sender and receiver iteratively learn better strategies for encoding and decoding messages over a noisy channel. The reinforcement learning framework allows both parties to adapt and improve their protocols, enhancing the reliability of communication over time. This model can be extended and refined to include more sophisticated encoding/decoding techniques and more complex noise models.</p>
<div id="538b0ef5" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> mesa <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Agent, Model</span>
<span id="cb3-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> mesa.time <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RandomActivation</span>
<span id="cb3-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> mesa.datacollection <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DataCollector</span>
<span id="cb3-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> hamming_distance(a, b):</span>
<span id="cb3-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> b) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(a)</span>
<span id="cb3-8"></span>
<span id="cb3-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> Sender(Agent):</span>
<span id="cb3-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, unique_id, model):</span>
<span id="cb3-11">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(unique_id, model)</span>
<span id="cb3-12">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.protocol <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.random_protocol()</span>
<span id="cb3-13">    </span>
<span id="cb3-14">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> random_protocol(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb3-15">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define a random protocol for encoding</span></span>
<span id="cb3-16">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> msg: msg  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Identity for simplicity</span></span>
<span id="cb3-17">    </span>
<span id="cb3-18">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> step(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb3-19">        message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.randint(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.message_length)</span>
<span id="cb3-20">        encoded_message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.protocol(message)</span>
<span id="cb3-21">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.sent_message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> encoded_message</span>
<span id="cb3-22"></span>
<span id="cb3-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> Receiver(Agent):</span>
<span id="cb3-24">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, unique_id, model):</span>
<span id="cb3-25">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(unique_id, model)</span>
<span id="cb3-26">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.protocol <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.random_protocol()</span>
<span id="cb3-27">    </span>
<span id="cb3-28">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> random_protocol(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb3-29">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define a random protocol for decoding</span></span>
<span id="cb3-30">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> msg: msg  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Identity for simplicity</span></span>
<span id="cb3-31">    </span>
<span id="cb3-32">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> step(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb3-33">        noisy_message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.sent_message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span> np.random.binomial(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.error_rate, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.message_length)</span>
<span id="cb3-34">        recovered_message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.protocol(noisy_message)</span>
<span id="cb3-35">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.recovered_message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> recovered_message</span>
<span id="cb3-36">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.evaluate_performance()</span>
<span id="cb3-37">    </span>
<span id="cb3-38">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> evaluate_performance(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb3-39">        original_message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.original_message</span>
<span id="cb3-40">        recovered_message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.recovered_message</span>
<span id="cb3-41">        distance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> hamming_distance(original_message, recovered_message)</span>
<span id="cb3-42">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.payoff <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.recovery_payoff(distance)</span>
<span id="cb3-43">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.payoff <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.length_payoff(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(recovered_message))</span>
<span id="cb3-44">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.payoff <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.early_recovery_payoff(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.current_step)</span>
<span id="cb3-45">    </span>
<span id="cb3-46"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> NoisyChannelModel(Model):</span>
<span id="cb3-47">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, message_length<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, error_rate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, max_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>):</span>
<span id="cb3-48">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>()</span>
<span id="cb3-49">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.message_length <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> message_length</span>
<span id="cb3-50">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.error_rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> error_rate</span>
<span id="cb3-51">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.current_step <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb3-52">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.max_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> max_steps</span>
<span id="cb3-53">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.payoff <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb3-54">        </span>
<span id="cb3-55">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.schedule <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RandomActivation(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>)</span>
<span id="cb3-56">        </span>
<span id="cb3-57">        sender <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Sender(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>)</span>
<span id="cb3-58">        receiver <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Receiver(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>)</span>
<span id="cb3-59">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.schedule.add(sender)</span>
<span id="cb3-60">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.schedule.add(receiver)</span>
<span id="cb3-61">        </span>
<span id="cb3-62">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.original_message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.randint(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.message_length)</span>
<span id="cb3-63">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.sent_message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb3-64">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.recovered_message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb3-65">        </span>
<span id="cb3-66">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.datacollector <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DataCollector(</span>
<span id="cb3-67">            model_reporters<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Payoff"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"payoff"</span>}</span>
<span id="cb3-68">        )</span>
<span id="cb3-69">    </span>
<span id="cb3-70">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> recovery_payoff(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, distance):</span>
<span id="cb3-71">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> distance</span>
<span id="cb3-72">    </span>
<span id="cb3-73">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> length_payoff(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, length):</span>
<span id="cb3-74">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> length</span>
<span id="cb3-75">    </span>
<span id="cb3-76">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> early_recovery_payoff(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, step):</span>
<span id="cb3-77">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.max_steps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> step) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.max_steps</span>
<span id="cb3-78">    </span>
<span id="cb3-79">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> step(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb3-80">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.current_step <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb3-81">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.schedule.step()</span>
<span id="cb3-82">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.datacollector.collect(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>)</span>
<span id="cb3-83">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.current_step <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.max_steps:</span>
<span id="cb3-84">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.running <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span>
<span id="cb3-85"></span>
<span id="cb3-86"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Example of running the model</span></span>
<span id="cb3-87">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> NoisyChannelModel()</span>
<span id="cb3-88"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span> model.running:</span>
<span id="cb3-89">    model.step()</span>
<span id="cb3-90"></span>
<span id="cb3-91"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Retrieve results</span></span>
<span id="cb3-92">results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.datacollector.get_model_vars_dataframe()</span>
<span id="cb3-93"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(results)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Payoff
0     1.39
1     2.97
2     4.54
3     6.10
4     7.55
..     ...
95  105.44
96  106.07
97  106.89
98  107.40
99  107.90

[100 rows x 1 columns]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/oren/.local/lib/python3.10/site-packages/mesa/time.py:82: FutureWarning:

The AgentSet is experimental. It may be changed or removed in any and all future releases, including patch releases.
We would love to hear what you think about this new feature. If you have any thoughts, share them with us here: https://github.com/projectmesa/mesa/discussions/1919
</code></pre>
</div>
</div>
<p>so this is a variant that uses a noisy channel model to simulate the transmission of messages between a sender and receiver. The agents have protocols for encoding and decoding messages, and the model tracks the performance of the communication system based on the accuracy of message recovery, message length, and early recovery. This example demonstrates how to model and analyze the performance of communication systems in the presence of noise and other challenges.</p>
<p>What we don’t have is a way to pick different protocols or to improve them over time.</p>
<p>I would break this down into a few steps: 1. identify the environmental factors that would encourage the agents to evolve diverse and efficient transmission protocols. a. noisy channels b. limited bandwidth c.&nbsp;limited computational resources d.&nbsp;time constraints e. risks of predation.</p>
<ol start="2" type="1">
<li>allow agents randomly generate candidate protocols and evaluate their performance.</li>
</ol>
<p>def random_protocol(): # Define a random protocol for encoding/decoding return lambda msg: np.random.randint(0, 2, len(msg))</p>
</section>
<section id="which-would-be-used-as-follows" class="level1">
<h1>which would be used as follows</h1>
<p>class Sender(Agent): def <strong>init</strong>(self, unique_id, model): super().__init__(unique_id, model) self.protocol = random_protocol()</p>
<pre><code>def step(self):
    message = np.random.randint(0, 2, self.model.message_length)
    encoded_message = self.protocol(message)
    self.model.sent_message = encoded_message</code></pre>
<p>This could be done by introducing reinforcement learning techniques to allow the agents to adapt and learn better encoding/decoding strategies based on feedback from the environment. This would enable the agents to optimize their protocols for improved communication performance in noisy channels.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {Emergent Communications},
  date = {2024-09-26},
  url = {https://orenbochman.github.io/posts/2024/2024-05-01-signals/shanon-game.html},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“Emergent Communications.”</span> September
26, 2024. <a href="https://orenbochman.github.io/posts/2024/2024-05-01-signals/shanon-game.html">https://orenbochman.github.io/posts/2024/2024-05-01-signals/shanon-game.html</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/2024-05-01-signals/shanon-game.html</guid>
  <pubDate>Thu, 26 Sep 2024 15:13:06 GMT</pubDate>
</item>
<item>
  <title>logic puzzles</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/2024-06-11/logic puzzles.html</link>
  <description><![CDATA[ 





<p>Solve this logic puzzle step by step:</p>
<p>A man was looking at a portrait. Someone asked him, “Whose picture are you looking at?” He replied: “Brothers and sisters have I none, but this man’s father is my father’s son.” Whose picture was the man looking at?</p>
<p>A man was looking at a portrait. Someone asked him, “Whose picture are you looking at?” He replied: “Brothers and sisters have I none, but this man’s son is my father’s son.” Whose picture was the man looking at?</p>
<p>three dozen grey socks and 36 pink socks are lying in a drawer in a dark room. What is the minimum number of socks I must take out of the drawer which will guarantee that I have at least two socks of the same color?</p>
<p>A certain snail takes an hour and a half to crawl clockwise around a certain racetrack, yet when he crawls counter­ clockwise around that same racetrack it takes him only ninety minutes. Why this discrepancy?</p>
<p>If an airplane crashes right on the border of the United States and Canada, in which country would you bury the survivors?</p>
<p>A certain street contains 200 buildings. A sign-maker is called to number the houses from 7 to 207. He has to order numerals to do the job. Without using pencil and paper, can you figure out in your head how many 9’ s he will need?</p>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {Logic Puzzles},
  date = {2024-09-26},
  url = {https://orenbochman.github.io/posts/2024/2024-06-11/logic puzzles.html},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“Logic Puzzles.”</span> September 26, 2024.
<a href="https://orenbochman.github.io/posts/2024/2024-06-11/logic puzzles.html">https://orenbochman.github.io/posts/2024/2024-06-11/logic
puzzles.html</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/2024-06-11/logic puzzles.html</guid>
  <pubDate>Thu, 26 Sep 2024 15:13:06 GMT</pubDate>
</item>
<item>
  <title>replay buffer questions</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/2024-07-01-generalization-in-ML/2024-07-01-replay-buffer-questions.html</link>
  <description><![CDATA[ 





<section id="replay-buffer" class="level2">
<h2 class="anchored" data-anchor-id="replay-buffer">Replay Buffer</h2>
<ol type="1">
<li>for continuous environment we should think about <strong>coverage</strong>.</li>
</ol>
<ul>
<li>given a paramertrization of the value function, for a level of generalization/discrimination we get an induced set of features. Is some set of experiences sufficent to do prediction or control.</li>
<li>if we have an estimate of the coverage can we use it to place a bound on the error of the value function.</li>
<li>can we do better if we also have an estimate <img src="https://latex.codecogs.com/png.latex?%5Cmu(s)"> of the importance/long term probability of the states ?</li>
</ul>
<ol start="2" type="1">
<li>Traces present a highly correlated view of the state space.</li>
</ol>
<ul>
<li>How much do we need to wory about this.</li>
</ul>
<ol type="1">
<li>does replay buffer violate markov state.?</li>
</ol>
<ul>
<li>according to <a href="https://www.linkedin.com/in/shirli-di-castro/">Shirli Di-Castro Shashua</a>
<ul>
<li><a href="https://proceedings.mlr.press/v162/di-castro22a/di-castro22a.pdf">Analysis of Stochastic Processes through Replay Buffers</a></li>
<li><a href="https://arxiv.org/abs/2110.00445">Sim and Real: Better Together</a></li>
<li>the storage operation preserves the markov property</li>
<li>the sampling operation preserves the markov property</li>
<li>the mean operation om the replay buffer violates the markov property…</li>
</ul></li>
</ul>
<ol start="2" type="1">
<li>can reduce correlation between samples ?</li>
<li>can we be more stategic about what we keep in the RB</li>
</ol>
<ul>
<li>say we have a key using a <img src="https://latex.codecogs.com/png.latex?hash%5B%5Cdelta(state),%20action%5D"> neighbourhood
<ul>
<li>we can use the key to decide if to insert/replace the current buffer</li>
<li>we can use it to decide what to discard</li>
</ul></li>
<li>we can use the buffer to estimate mu(s)
<ul>
<li>might also have more info like states we did not insert or deleted.</li>
<li>if we also have mu(mu) - the state importance to decide what to keep</li>
</ul></li>
<li>do we prefer complete recent traces or many partial traces.</li>
</ul>
<ol start="4" type="1">
<li>Can we use options/skills to orgenize the buffer more effectively ?</li>
</ol>
<ul>
<li><p>we should aim to keep full options traces in the buffer</p></li>
<li><p>keep traces in &amp; out or options.</p></li>
<li><p>before and after the options.</p></li>
</ul>
<p>Think of the four room environment - there are different options to get from one room to another. they are composable. Once we have good coverage entry into the op</p>
</section>
<section id="ergodicity" class="level2">
<h2 class="anchored" data-anchor-id="ergodicity">Ergodicity</h2>
<ol type="1">
<li>in an environment is a maze and I have a one way door dividing the left side from the right parts of the maze. is this environment ergodic ?</li>
<li>If not how come we can still learn the optimal policy ?</li>
</ol>
<p>interchip dotan castro - sim to real</p>
</section>
<section id="replay-buffers--" class="level2">
<h2 class="anchored" data-anchor-id="replay-buffers--">Replay buffers -</h2>
<ul>
<li>storing sequence of states</li>
<li>State action state</li>
</ul>
<p>PMDPs</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {Replay Buffer Questions},
  date = {2024-09-26},
  url = {https://orenbochman.github.io/posts/2024/2024-07-01-generalization-in-ML/2024-07-01-replay-buffer-questions.html},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“Replay Buffer Questions.”</span> September
26, 2024. <a href="https://orenbochman.github.io/posts/2024/2024-07-01-generalization-in-ML/2024-07-01-replay-buffer-questions.html">https://orenbochman.github.io/posts/2024/2024-07-01-generalization-in-ML/2024-07-01-replay-buffer-questions.html</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/2024-07-01-generalization-in-ML/2024-07-01-replay-buffer-questions.html</guid>
  <pubDate>Thu, 26 Sep 2024 15:13:06 GMT</pubDate>
</item>
<item>
  <title>RL MindMap</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/2024-03-25-rl-maps/</link>
  <description><![CDATA[ 





<div class="column-screen">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">mindmap
  root((RL))
    Main Concepts
        [MDP]
          Continuing Tasks
          Episodic Tasks
          Markov Property
        [Reward]
        [Action Values]
        [Policy]
            {{maps states to likelihood of actions}}
            Deterministic
              {{one action per state}}
            Stochastic 
              {{multiple actions per state}}
        Exploration 
        Exploitation
        [Policy Ealuation - Predication]
          {}
        Control
          {}
        Dynamic programming
            Synchronous
            Asynchronous
    Learning
        On Policy learning  
          {{Agents learn from their policy}}
        Off Policy learning
          {{Agents lean from another policy or Data}}
        Online
        Offline
        Optimistic initial values
    Math
        Bellman Equations    
            {{State-Value Function}}
            {{Action-Value Function}}
            {{State-Value Optimality Function}}
            {{Action-Value Optimality Function}}
        Policy Improvement Theorem
    Algorithms
      [Bandits]
        Epsilon greedy
        Thompson sampling
        Upper confidence bound
        Contextual
        Regret
          Follow the normalized leader
          Contractual regret
      Greedyfication
      [Policy Iteration]
      [Generalized Policy Iteration]
      [Value Iteration]
      Brute force search
      Monte Carlo
      Bootstrapping
      [Sample Based Methods]
          [Temporal Difference Learning]
          [SARSA]
          [Q-Learning]

      [Function Approximation Methods]
    Others
        Dyna 
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</div>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {RL {MindMap}},
  date = {2024-09-26},
  url = {https://orenbochman.github.io/posts/2024/2024-03-25-rl-maps/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“RL MindMap.”</span> September 26, 2024. <a href="https://orenbochman.github.io/posts/2024/2024-03-25-rl-maps/">https://orenbochman.github.io/posts/2024/2024-03-25-rl-maps/</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/2024-03-25-rl-maps/</guid>
  <pubDate>Thu, 26 Sep 2024 15:13:05 GMT</pubDate>
</item>
<item>
  <title>gradio local model</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/2024-03-31-gradio/gradio_local.html</link>
  <description><![CDATA[ 





<div id="32c1d262" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> gradio <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> gr</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AutoModelForCausalLM, AutoTokenizer, StoppingCriteria, StoppingCriteriaList, TextIteratorStreamer</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> threading <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Thread</span>
<span id="cb1-5"></span>
<span id="cb1-6">tokenizer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AutoTokenizer.from_pretrained(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"togethercomputer/RedPajama-INCITE-Chat-3B-v1"</span>)</span>
<span id="cb1-7">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AutoModelForCausalLM.from_pretrained(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"togethercomputer/RedPajama-INCITE-Chat-3B-v1"</span>, torch_dtype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>torch.float16)</span>
<span id="cb1-8">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cuda:0'</span>)</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> StopOnTokens(StoppingCriteria):</span>
<span id="cb1-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__call__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, input_ids: torch.LongTensor, scores: torch.FloatTensor, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>kwargs) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span>:</span>
<span id="cb1-12">        stop_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb1-13">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> stop_id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> stop_ids:</span>
<span id="cb1-14">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> input_ids[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> stop_id:</span>
<span id="cb1-15">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb1-16">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span>
<span id="cb1-17"></span>
<span id="cb1-18"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> predict(message, history):</span>
<span id="cb1-19">    history_transformer_format <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> history <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> [[message, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>]]</span>
<span id="cb1-20">    stop <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> StopOnTokens()</span>
<span id="cb1-21"></span>
<span id="cb1-22">    messages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>.join([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>.join([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;human&gt;:"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>item[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;bot&gt;:"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>item[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]])</span>
<span id="cb1-23">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> item <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> history_transformer_format])</span>
<span id="cb1-24"></span>
<span id="cb1-25">    model_inputs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tokenizer([messages], return_tensors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt"</span>).to(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cuda"</span>)</span>
<span id="cb1-26">    streamer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TextIteratorStreamer(tokenizer, timeout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.</span>, skip_prompt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, skip_special_tokens<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb1-27">    generate_kwargs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>(</span>
<span id="cb1-28">        model_inputs,</span>
<span id="cb1-29">        streamer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>streamer,</span>
<span id="cb1-30">        max_new_tokens<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>,</span>
<span id="cb1-31">        do_sample<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb1-32">        top_p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>,</span>
<span id="cb1-33">        top_k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,</span>
<span id="cb1-34">        temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>,</span>
<span id="cb1-35">        num_beams<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb1-36">        stopping_criteria<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>StoppingCriteriaList([stop])</span>
<span id="cb1-37">        )</span>
<span id="cb1-38">    t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Thread(target<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>model.generate, kwargs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>generate_kwargs)</span>
<span id="cb1-39">    t.start()</span>
<span id="cb1-40"></span>
<span id="cb1-41">    partial_message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span></span>
<span id="cb1-42">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> new_token <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> streamer:</span>
<span id="cb1-43">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> new_token <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'&lt;'</span>:</span>
<span id="cb1-44">            partial_message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> new_token</span>
<span id="cb1-45">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">yield</span> partial_message</span>
<span id="cb1-46"></span>
<span id="cb1-47">gr.ChatInterface(predict).launch()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running on local URL:  http://127.0.0.1:7860

To create a public link, set `share=True` in `launch()`.</code></pre>
</div>
<div class="cell-output cell-output-display">
<div><iframe src="http://127.0.0.1:7860/" width="100%" height="500" allow="autoplay; camera; microphone; clipboard-read; clipboard-write;" frameborder="0" allowfullscreen=""></iframe></div>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code></code></pre>
</div>
</div>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {Gradio Local Model},
  date = {2024-09-26},
  url = {https://orenbochman.github.io/posts/2024/2024-03-31-gradio/gradio_local.html},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“Gradio Local Model.”</span> September 26,
2024. <a href="https://orenbochman.github.io/posts/2024/2024-03-31-gradio/gradio_local.html">https://orenbochman.github.io/posts/2024/2024-03-31-gradio/gradio_local.html</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/2024-03-31-gradio/gradio_local.html</guid>
  <pubDate>Thu, 26 Sep 2024 15:13:05 GMT</pubDate>
</item>
<item>
  <title>tikz in Quarto!</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2021/2021-04-25-bayesian-agent/test.html</link>
  <description><![CDATA[ 





<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="test_files/figure-html/complete-pooling-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Complete pooling"><img src="https://orenbochman.github.io/posts/2021/2021-04-25-bayesian-agent/test_files/figure-html/complete-pooling-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%" alt="Complete pooling"></a></p>
</figure>
</div>
<figcaption>Complete pooling</figcaption>
</figure>
</div>
</div>
</div>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {Tikz in {Quarto!}},
  date = {2024-09-26},
  url = {https://orenbochman.github.io/posts/2021/2021-04-25-bayesian-agent/test.html},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“Tikz in Quarto!”</span> September 26, 2024.
<a href="https://orenbochman.github.io/posts/2021/2021-04-25-bayesian-agent/test.html">https://orenbochman.github.io/posts/2021/2021-04-25-bayesian-agent/test.html</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2021/2021-04-25-bayesian-agent/test.html</guid>
  <pubDate>Thu, 26 Sep 2024 15:13:05 GMT</pubDate>
</item>
<item>
  <title>Is compositionality overrated? The view from language emergence</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/2024-10-10-marco-baoni-composionality/summary.html</link>
  <description><![CDATA[ 





<section id="tldr" class="level2">
<h2 class="anchored" data-anchor-id="tldr">TL;DR</h2>
<p>In this talk, Marco Baroni discusses the role of compositionality in neural networks and its implications for language emergence. He presents recent work on language emergence in deep networks, where two or more networks are trained with a communication channel to solve a task jointly. Baroni argues that compositionality is not a necessary condition for good generalization in neural networks and suggests that focusing on enhancing generalization directly may be more beneficial than worrying about the compositionality of emergent neural network languages.</p>
<p>It turns out that compositionality means different things to different people in different contexts. This talk doesn’t provide us with an aristotelian definition of compositionality but a pragmatic one that Baroni used in investigation. The notion of language emergence in deep networks is a fascinating yet also vague. With these caveats in mind there are a numbeor of reuslts that Baroni presents that are worth considering.</p>
<p>If I was initially critical of this talk and speaker I soon came to realize that this is just the kind of message that simulates thought and discussion. It is a good talk and I would recommend it to anyone interested in the topic of language emergence in deep networks. <span class="emoji" data-emoji="thumbsup">👍</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
My Insights
</div>
</div>
<div class="callout-body-container callout-body">
<p>My work on this subject shows that by adding compositionality to the lewis signaling game not only significantly increases the ratio of messages to simple signals but also renders the overall systems easier to master by making it more sytematic and predictable. This is greatly affected by form of aggregtion used for signal composition. e.g.&nbsp;using a simple template can create a morphology that is automatic and therefore easy to master.</p>
<p>For example if we add a parameter to the game to penalize long signals and reward early decoding of the signal we can get a more efficient signaling system. This allows agents to learn a larger signaling system faster. It also has more subtle effects- perhaps the most important one is that the pooling equilibria in the lewis game which are far more common then the non-pooling equilibria which we call a signaling system can be allow us to learn more efficient signaling systems if we reinterpret these partial pooling equilibria as leading to categories of signals which are further refined within the complex signal but can lead to an early decoding of the signal.</p>
</div>
</div>
</section>
<section id="questions" class="level2 callout-tim">
<h2 class="anchored" data-anchor-id="questions">Questions</h2>
<p>In this subject we need to ask ourselves what are the main reseach questions and what are the main definitions we can make.</p>
<ul>
<li>what is language emergence</li>
<li>what is compositionality</li>
<li>How are Neural networks used here
<ul>
<li>how were they set up?</li>
<li>what was the task loss function?</li>
</ul></li>
<li>what is generalization in this task?</li>
</ul>
<p>The big question is will learning an emergent language aid agents to achive better generalization? - There is also talk about compositionality in RL where transfer learning is challenging. - Hinton discussed the idea of capsules in neural networks as a way to encode compositional structure in neural networks.</p>
</section>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Definitions
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Simple Compositionality - The idea that the meaning of a complex signal is a function of the meanings of its parts.</li>
<li>Non compositionality - The idea that the meaning of a complex signal is not a function of the meanings of its parts.</li>
<li>Entaglement</li>
</ul>
</div>
</div>
<ul>
<li>By the end of the talk he more or less concludes that the compositionality of emergent neural network languages is not a necessary condition for good generalization.</li>
</ul>
<p>, and there is no reason to expect deep networks to find compositional languages more “natural” than highly entangled ones. Baroni concludes that if fast generalization is the goal, we should focus on enhancing this property without worrying about the compositionality of emergent neural network languages.</p>
<section id="blurb-from-the-talk" class="level2">
<h2 class="anchored" data-anchor-id="blurb-from-the-talk">Blurb from the talk</h2>
<p>Compositionality is the property whereby linguistic expressions that denote new composite meanings are derived by a rule-based combination of expressions denoting their parts. Linguists agree that compositionality plays a central role in natural language, accounting for its ability to express an infinite number of ideas by finite means.</p>
<p>“Deep” neural networks, for all their impressive achievements, often fail to quickly generalize to unseen examples, even when the latter display a predictable composite structure with respect to examples the network is already familiar with. This has led to interest in the topic of compositionality in neural networks: can deep networks parse language compositionally? how can we make them more sensitive to compositional structure? what does “compositionality” even mean in the context of deep learning?</p>
<p>I would like to address some of these questions in the context of recent work on language emergence in deep networks, in which we train two or more networks endowed with a communication channel to solve a task jointly, and study the communication code they develop. I will try to be precise about what “compositionality” mean in this context, and I will report the results of proof-of-concept and larger-scale experiments suggesting that (non-circular) compositionality is not a necessary condition for good generalization (of the kind illustrated in the figure). Moreover, I will show that often there is no reason to expect deep networks to find compositional languages more “natural” than highly entangled ones. I will conclude by suggesting that, if fast generalization is what we care about, we might as well focus directly on enhancing this property, without worrying about the compositionality of emergent neural network languages.</p>
</section>
<section id="references" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li><p>https://cs.stanford.edu/people/karpathy/cnnembed/,</p></li>
<li><p>https://www.inverse.com/article/12664-google-s-alphago-supercomputer-wins-second-go-match-vs-lee-sedol</p></li>
<li><p>https://hackernoon.com/deepmind-relational-networks-demystified-b593e408b643</p></li>
<li><p>Lazaridou et al.&nbsp;ICLR 2017 <a href="https://arxiv.org/abs/1612.07182">Multi-Agent Cooperation and the Emergence of (Natural) Language</a></p></li>
<li><p><span class="citation" data-cites="bouchacourt2018agents">Bouchacourt and Baroni (2018)</span> <a href="https://arxiv.org/pdf/1808.10696v2">How agents see things: On visual representations in an emergent language game</a></p></li>
</ul>
<div class="no-row-height column-margin column-container"><div id="ref-bouchacourt2018agents" class="csl-entry">
Bouchacourt, Diane, and Marco Baroni. 2018. <span>“How Agents See Things: On Visual Representations in an Emergent Language Game.”</span> <em>arXiv Preprint arXiv:1808.10696</em>.
</div></div><p>Are emergent languages compositional?</p>
<ul>
<li>Andreas ICLR 2019,</li>
<li>Choi et al ICLR 2018,</li>
<li>Havrylov &amp; Titov NIPS 2017,</li>
<li>Kottur et al EMNLP 2017,</li>
<li>Mordatch &amp; Abbeel AAAI 2018,</li>
<li>Resnick et al AAMAS 2020</li>
</ul>
<p>A compositional language is one where it is easy to read out which parts of a linguistic expression refer to which components of the input</p>
<dl>
<dt>Naïve compositionality</dt>
<dd>
a language is naïvely compositional if the atomic symbols in its expressions refer to single input elements, independently of either input or linguistic context
</dd>
</dl>
<ul>
<li>Chaabouni, Kharitonov et al.&nbsp;ACL 2020 <a href="https://aclanthology.org/2020.acl-main.407/">Compositionality and Generalization In Emergent Languages</a></li>
</ul>
<p>Quantifying (one type of) naïve compositionality</p>
<p><strong>Positional disentanglement</strong> measures strong form of naïve compositionality: to what extent do symbols in a certain position univocally refer to different values of the same attribute</p>
<p>note - the paper has two other measures</p>
<p>Do emergent languages support generalization?</p>
<p>Is compositionality needed for generalization?</p>
<ul>
<li>kind of obvious, particularly if parameters are shared not but is should help</li>
</ul>
<p>Lazaridou et al ICLR 2018</p>
<ul>
<li><p><a href="https://github.com/facebookresearch/EGG">EGG: Emergence of lanGuage in Games</a></p></li>
<li><p>Kharitonov and Baroni: Emergent Language Generalization and Acquisition Speed are not Tied to Compositionality <a href="https://arxiv.org/abs/2004.03420">Emergent Language Generalization and Acquisition Speed are not tied to Compositionality</a></p></li>
</ul>
</section>
<section id="video" class="level2">
<h2 class="anchored" data-anchor-id="video">Video</h2>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/mi1q3Fbm9zg" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</section>
<section id="slides-and-a-paper" class="level2">
<h2 class="anchored" data-anchor-id="slides-and-a-paper">Slides &amp; and a paper</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./slides.pdf" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="slides"><embed src="./slides.pdf" class="col-page" width="1000" height="800"></a></p>
<figcaption>slides</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./paper.pdf" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Linguistic generalization and compositionality in modern artificial neural networks"><embed src="./paper.pdf" class="col-page" width="800" height="1000"></a></p>
<figcaption>Linguistic generalization and compositionality in modern artificial neural networks</figcaption>
</figure>
</div>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {Is Compositionality Overrated? {The} View from Language
    Emergence},
  date = {2024-09-01},
  url = {https://orenbochman.github.io/posts/2024/2024-10-10-marco-baoni-composionality/summary.html},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“Is Compositionality Overrated? The View from
Language Emergence.”</span> September 1, 2024. <a href="https://orenbochman.github.io/posts/2024/2024-10-10-marco-baoni-composionality/summary.html">https://orenbochman.github.io/posts/2024/2024-10-10-marco-baoni-composionality/summary.html</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/2024-10-10-marco-baoni-composionality/summary.html</guid>
  <pubDate>Sun, 01 Sep 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Six quick tips to improve modeling</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/2024-08-26-six-quick-tips/</link>
  <description><![CDATA[ 





<p>The following tips are from <span class="citation" data-cites="GelmanHill2007Regression">(Gelman and Hill 2007)</span> Data Analysis Using Regression and Multilevel/Hierarchical Models by <a href="http://www.stat.columbia.edu/~gelman/">Andrew Gelman</a> and <a href="https://steinhardt.nyu.edu/people/jennifer-hill">Jennifer Hill</a>.</p>
<div class="no-row-height column-margin column-container"><div id="ref-GelmanHill2007Regression" class="csl-entry">
Gelman, Andrew, and Jennifer Hill. 2007. <em>Data Analysis Using Regression and Multilevel/Hierarchical Models</em>. Vol. Analytical methods for social research. New York: Cambridge University Press.
</div></div><ol type="1">
<li>Fit many models:
<ul>
<li>Start with a baseline</li>
<li>Add more effects</li>
<li>Add interactions</li>
<li>Add non-linearities</li>
<li>Add more levels</li>
<li>Use different priors</li>
<li>Use different algorithms (each has its own inductive biases)</li>
</ul></li>
<li>Do a little work to make your computations faster and more reliable
<ol type="1">
<li>data subsetting is faster than full data set</li>
<li>redundant parameterization (e.g.&nbsp;re-centering and scaling) add some parameters but don’ really change the model yet make it more computationally stable by improving the geometry the sampler has to work with. 3 fake data and predictive simulations help understand if the problems we are facing are due to the model or the data. Fake data creates a version of the data for which we know what to expect.</li>
</ol></li>
<li>Graphing the relevant
<ul>
<li>Graphing the data is fine</li>
<li>Graphing the model is more informative (regression lines and curves)</li>
<li>I like to plot lots of graphs like regression diagnostics, residuals, and posterior predictive checks. But Gelman and Hill suggest that these are not relevant and warn that one should be prepared to explain any graph you show. Some of these diagnostics graphs are kind of hard to explain. e.g.&nbsp;Cook’s distance v.s. leverage plot.</li>
</ul></li>
<li>Transformations
<ul>
<li>Logarithms of all-positive variables (primarily because this leads to multiplicative models on the original scale, which often makes sense)</li>
<li>Standardizing based on the scale or potential range of the data (so that coefficients can be more directly interpreted and scaled); an alternative is to present coefficients in scaled and unscaled forms</li>
<li>Transforming before multilevel modeling (thus attempting to make coefficients more comparable, thus allowing more effective second-level regressions, which in turn improve partial pooling). There is some risk in transformations for real world models.</li>
<li>Can we be certain the predictions are still valid on the original scale?</li>
<li>What happen if new data comes in and the Z-transformation we used is no longer valid?</li>
<li>What if we are working with elasticity (percent change over percent change in response) - does the transformation still make sense?</li>
</ul></li>
<li>Consider all coefficients as potentially varying
<ul>
<li>Practical concerns sometimes limit the feasible complexity of a model</li>
<li>Ideally we would like to have a model that is as complex as the data might be in reality we need a good fit and the ability to understand the model.</li>
</ul></li>
<li>Estimate causal inferences in a targeted way, not as a byproduct of a large regression
<ul>
<li>Least square regression does not care about causality.</li>
<li>If you do you need to go beyond, e.g.&nbsp;sketch the structural model, identify the causal effect and the roles of the confounders. Then use regression to estimate the effects.</li>
</ul></li>
</ol>




<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {Six Quick Tips to Improve Modeling},
  date = {2024-08-26},
  url = {https://orenbochman.github.io/posts/2024/2024-08-26-six-quick-tips/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“Six Quick Tips to Improve Modeling.”</span>
August 26, 2024. <a href="https://orenbochman.github.io/posts/2024/2024-08-26-six-quick-tips/">https://orenbochman.github.io/posts/2024/2024-08-26-six-quick-tips/</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/2024-08-26-six-quick-tips/</guid>
  <pubDate>Mon, 26 Aug 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Stumpy</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/2024-08-08-TS-with-Stumpy/</link>
  <description><![CDATA[ 





<section id="stumpy---time-series-analysis" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="stumpy---time-series-analysis">Stumpy - Time Series Analysis</h2>
<p>Stumpy <span class="citation" data-cites="law2019stumpy">(Law 2019)</span> is a powerful and scalable library for computing a matrix profile which can be used for a variety of time series data mining tasks.</p>
<div class="no-row-height column-margin column-container"><div id="ref-law2019stumpy" class="csl-entry">
Law, Sean M. 2019. <span>“<span class="nocase">STUMPY: A Powerful and Scalable Python Library for Time Series Data Mining</span>.”</span> <em><span>The Journal of Open Source Software</span></em> 4 (39): 1504.
</div><div id="ref-sean2021online" class="csl-entry">
———. 2021. <span>“Modern Time Series Analysis with STUMPY.”</span> <a href="https://youtu.be/XKNdXN-Jfmo" class="uri">https://youtu.be/XKNdXN-Jfmo</a>.
</div></div><p>This post is based on <span class="citation" data-cites="sean2021online">(Law 2021)</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
TLDR <span class="emoji" data-emoji="peanuts">🥜</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Are you <strong>Stomped</strong> on time series analysis, <strong>Stumpy</strong> may be the library for you. <span class="emoji" data-emoji="grinning">😀</span></li>
<li>Stumpy is a FOSS library with scalable algorithms for computing a <code>matrix profile</code> which can be used for a variety of time series data mining tasks.</li>
<li>It is easy to use and has a simple API that makes it easy to get started with time series analysis.</li>
</ul>
</div>
</div>
<section id="introduction" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<p>. It is easy to use and has a simple API that makes it easy to get started with time series analysis.</p>
<p>Under the hood Stumpy calculates the pairwise euclidean distance between two subsequences of a time series. By considering all possible subsequences of a time series of a fixed length, we get a <code>distance matrix</code> which is a matrix of distances between subsequences. However the matrix profile is too slow to compute using brute force and is also memory intensive to store. The research behind Stumpy uses a number of optimizations to make the computation of the <code>matrix profile</code> which is list the nearest neighbors for each subsequence in a time series. This structure is <img src="https://latex.codecogs.com/png.latex?O(n)"> in space and <img src="https://latex.codecogs.com/png.latex?O(n%5E2)"> time complexity.</p>
<p>Note: before computing the matrix profile, Stumpy first normalises the subsequences to have zero mean and unit variance. This is done to ensure that the distance between subsequences is meaningful and that the matrix profile is accurate. <sup>1</sup></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;This is a common step in time series analysis and is done to remove any trends or seasonality in the data. It can also be disabled if needed.</p></div></div><p>why do we need to compute the matrix profile? The matrix profile is a powerful tool for time series analysis that can be used to identify patterns in the data.</p>
<blockquote class="blockquote">
<p>Given the <a href="https://www.cs.ucr.edu/%7Eeamonn/MatrixProfile.html">matrix profile</a>, most time series data mining tasks are trivial or easy to solve in a few lines of code. - Emonnn Keogh</p>
</blockquote>
<p>For example, motif discovery, discord discovery, semantic segmentation, and shapelet discovery can all be solved using the matrix profile.</p>
<p>By comparing the distance between subsequences, Stumpy can identify patterns in the data such as motifs, discords, chains, and other patterns. and then uses the matrix profile to identify motifs, discords, chains, and other patterns in the data.</p>
</section>
<section id="motivation" class="level3">
<h3 class="anchored" data-anchor-id="motivation">Motivation</h3>
<p>You get tasked with analyzing a time series data set there are many (10000+) points what do you do?</p>
<p>Magic Spells for Time Series Analysis:</p>
<ul>
<li>Visualizations
<ul>
<li>great for small data sets</li>
<li>not suitable with more than 1000 data points</li>
</ul></li>
<li>Statistics
<ul>
<li>traditional stats are not as meaningful for time series data</li>
<li>with many points we tend to care more about subsequences than points.</li>
</ul></li>
<li>ARIMA (AutoRegressive Integrated Moving Average)
<ul>
<li>autoregressive model assuming some kind of repeating patterns</li>
</ul></li>
<li>Anomaly Detection
<ul>
<li>assuming that we can agree what is normal</li>
</ul></li>
<li>ML (Predictive Modeling)
<ul>
<li>assuming that we can predict the future</li>
<li>using features to predict values based on a projection or interpolation.</li>
</ul></li>
<li>Forecasting
<ul>
<li>Using trends, historiacal and statistical data.</li>
<li>forecasting is for longer term frames</li>
</ul></li>
<li>Clustering
<ul>
<li>grouping similar parts of a time series together</li>
<li>grouping similar time series together</li>
</ul></li>
<li>Dynamic Time Warping
<ul>
<li>comparing time series that are not aligned</li>
<li>comparing time series that are not the same length</li>
<li>assuming we know enough about the time series to do this.</li>
</ul></li>
<li>Change Detection
<ul>
<li>detecting when a time series changes regimes.</li>
</ul></li>
</ul>
</section>
<section id="stumpys-approach" class="level3">
<h3 class="anchored" data-anchor-id="stumpys-approach">Stumpy’s Approach</h3>
<p>Stumpy tries to answer two questions:</p>
<ol type="1">
<li>Do any subsequences appear more than once in a time series?</li>
<li>If they are such subsequences, what are they and where do they appear?</li>
</ol>
<p>the design goals seem to be</p>
<ul>
<li>be easy to interpret</li>
<li>use/data agnostic</li>
<li>no prior knowledge of the data</li>
<li>parameter free</li>
</ul>
</section>
<section id="features" class="level3">
<h3 class="anchored" data-anchor-id="features">Features</h3>
<p>Stumpy has a number of features that make it a powerful tool for time series analysis. Some of the key features of Stumpy include:</p>
<ul>
<li>High level features:
<ul>
<li>Motif Discovery</li>
<li>Discord Detection</li>
<li>TS Chains</li>
<li>Semantic Segmentation</li>
<li>Shapelet &amp; Snippets</li>
<li>MPdist Clustering</li>
<li>Multi-dimensional TS</li>
</ul></li>
<li>Low level features:
<ul>
<li>Fast and memory efficient computation of matrix profiles.</li>
<li>Support for both univariate and multivariate time series data.</li>
<li>Support for both fixed-length and variable-length time series data.</li>
<li>Support for both Euclidean and DTW distance measures.</li>
<li>Support for both exact and approximate matrix profile computation.</li>
<li>Support for both CPU and GPU computation.</li>
<li>Support for both online and offline matrix profile computation.</li>
</ul></li>
</ul>
</section>
<section id="big-idea" class="level3">
<h3 class="anchored" data-anchor-id="big-idea">Big idea</h3>
</section>
<section id="novelty" class="level3">
<h3 class="anchored" data-anchor-id="novelty">Novelty</h3>
</section>
<section id="papers" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="papers">Papers</h3>
<p>Stumpy is based on a number of research papers that have been published in the field of time series data mining. Some of the key papers that have inspired Stumpy include:</p>
<ul>
<li><span class="citation" data-cites="Yeh2016MatrixProfileI">(Yeh et al. 2016)</span></li>
</ul>
<div class="no-row-height column-margin column-container"><div id="ref-Yeh2016MatrixProfileI" class="csl-entry">
Yeh, Chin-Chia Michael, Yan Zhu, Liudmila Ulanova, Nurjahan Begum, Yifei Ding, Hoang Anh Dau, Diego Furtado Silva, Abdullah Mueen, and Eamonn Keogh. 2016. <span>“Matrix Profile i: All Pairs Similarity Joins for Time Series: A Unifying View That Includes Motifs, Discords and Shapelets.”</span> In <em>2016 IEEE 16th International Conference on Data Mining (ICDM)</em>, 1317–22. <a href="https://doi.org/10.1109/ICDM.2016.0179">https://doi.org/10.1109/ICDM.2016.0179</a>.
</div></div><p>Zhu, Yan, et al.&nbsp;(2016) Matrix Profile II: Exploiting a Novel Algorithm and GPUs to Break the One Hundred Million Barrier for Time Series Motifs and Joins. ICDM:739-748.</p>
<p>Yeh, Chin-Chia Michael, et al.&nbsp;(2017) Matrix Profile VI: Meaningful Multidimensional Motif Discovery. ICDM:565-574.</p>
<p>Zhu, Yan, et al.&nbsp;(2017) Matrix Profile VII: Time Series Chains: A New Primitive for Time Series Data Mining. ICDM:695-704.</p>
<p>Gharghabi, Shaghayegh, et al.&nbsp;(2017) Matrix Profile VIII: Domain Agnostic Online Semantic Segmentation at Superhuman Performance Levels. ICDM:117-126.</p>
<p>Zhu, Yan, et al.&nbsp;(2017) Exploiting a Novel Algorithm and GPUs to Break the Ten Quadrillion Pairwise Comparisons Barrier for Time Series Motifs and Joins. KAIS:203-236.</p>
<p>Zhu, Yan, et al.&nbsp;(2018) Matrix Profile XI: SCRIMP++: Time Series Motif Discovery at Interactive Speeds. ICDM:837-846.</p>
<p>Yeh, Chin-Chia Michael, et al.&nbsp;(2018) Time Series Joins, Motifs, Discords and Shapelets: a Unifying View that Exploits the Matrix Profile. Data Min Knowl Disc:83-123.</p>
<p>Gharghabi, Shaghayegh, et al.&nbsp;(2018) “Matrix Profile XII: MPdist: A Novel Time Series Distance Measure to Allow Data Mining in More Challenging Scenarios.” ICDM:965-970.</p>
<p>Zimmerman, Zachary, et al.&nbsp;(2019) Matrix Profile XIV: Scaling Time Series Motif Discovery with GPUs to Break a Quintillion Pairwise Comparisons a Day and Beyond. SoCC ’19:74-86.</p>
<p>Akbarinia, Reza, and Betrand Cloez. (2019) Efficient Matrix Profile Computation Using Different Distance Functions. arXiv:1901.05708.</p>
<p>Kamgar, Kaveh, et al.&nbsp;(2019) Matrix Profile XV: Exploiting Time Series Consensus Motifs to Find Structure in Time Series Sets. ICDM:1156-1161.</p>



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {Stumpy},
  date = {2024-08-08},
  url = {https://orenbochman.github.io/posts/2024/2024-08-08-TS-with-Stumpy/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“Stumpy.”</span> August 8, 2024. <a href="https://orenbochman.github.io/posts/2024/2024-08-08-TS-with-Stumpy/">https://orenbochman.github.io/posts/2024/2024-08-08-TS-with-Stumpy/</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/2024-08-08-TS-with-Stumpy/</guid>
  <pubDate>Thu, 08 Aug 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>two ideas on generelization</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/2024-07-01-generalization-in-ML/2024-07-01-gen-ml.html</link>
  <description><![CDATA[ 





<section id="feature-selection-problem" class="level2">
<h2 class="anchored" data-anchor-id="feature-selection-problem">Feature selection problem</h2>
<p>the first idea comes from looking at regression and hyperparameter optimization tasks</p>
<p>First we want to investigate the idea of finding the best values of individual parameters or hyperparameters. Next if these are second order effects corresponding to the interaction of two or more parameters, we will want to investigate if there are pairs of hyper/parameters that are more important than others.</p>
<ul>
<li>one way to orgenize this search might be characterised as <strong>a reductionist search</strong>, where we start with a simple model and add complexity as needed.</li>
<li>another way to orgenize this search might be characterised as <strong>a covariance matrix bingo</strong>, where we concieve of all the possible interactions reperesented by the covariance matrix, in reality the covariance matrix is a symmetric and sparse, we may discover that certain features are correlated with each other, or better yet collinear, and we may want to remove these features and retain perhaps better <strong>orthonormal features</strong>. In other words we might be able to plan our model selection by looking at how the covariance matrix evolves as we add features to the model. We will end up with a subset of the matrix similar to a bingo card, where we wish to get to this wininning combination of features faster than the other players.</li>
</ul>
<p>A second reality of this issues adressable by RL is that high order effects tend to be increasingly sparse so that if we have a hint of that certain slots in the covariance matrix are non zero we should defintely explore those efects more than others. This infact suggests an improvement to baysian search.</p>
<p>This aspect of feature selection is not partularly exciting, but suggests a more abstract way of thinking about the problem. This leads to a second perhaps more powerful idea.</p>
</section>
<section id="localised-subspace-embedding" class="level2">
<h2 class="anchored" data-anchor-id="localised-subspace-embedding">Localised subspace embedding</h2>
<p>The idea of embedings which allow us to use a distributed representation instead of a one hot encoding is very powerful. In one sense it is the opposite of the reductionist notion mentioned above. Instead of trying to find the best features we are trying to find the best representation of the features. However if one is familiar with PCA or SVD one knows that the best representation is often some linear combination of the actual features we observe. A reductionist might view these a generlized coordinates that are more useful for inverstigating the feature space.</p>
<p>If our features are built from such embeddings, we learn weights that correspond to the importance of the features in the model. This representation is still subject to the bias variance tradeoff and we generaly have many parameters in Neural Networks. One way to view this is to try and orgeinze the model so that it can use emebeddings of subspaces - corresponding to features that are balance generlization and discrimination.</p>
<p>A second point is that in different contexts we might need to use different features. This is much easier to see in RL and NLP. Building a embedding that is localised to a just some features and some observations/states might allow the model to get good generalization then by considering all the features at once. This is an analogue of the idea of factoring a distribution into a product of marginals, particularly in the case of a much larger bayesian network. In this case though we might be talking about using two such factorizations, with some discriminator selecting the observations that are used in different contexts.</p>
<p>We might think of a neural network as evolving system of that learns to bifurcate the distributed representation of the features of the data set in the input into any number of<br>
smaller and more localised subspaces. The more Localised subspaces are more likely to be linearly separable and thus easier to learn.</p>
<p>However all this happens by breaking symmetries using the random aspects of the learning algorithm. Minibatches present many random samples which carry differnt payloads of information. Certain such payloads may reinforce the current network weights, while the next may require a bifurcation of the representation into two to minimize the loss. Another might require many bifurcations and may not lead to any new bifurcations or reinforcements. Drop out breaks symmetries by shutting down parts of the network temporarily.</p>
<p>On other problems with generalization in RL and in NLP might be resolved using local subspace embedding of the state space. These are features that conflates states that are similar and distinguishes states that are different. By avoiding a full embedding we reduce the variance of the function approximation and thus improve generalization.</p>
</section>
<section id="question" class="level2">
<h2 class="anchored" data-anchor-id="question">Question</h2>
<ul>
<li>How can we encourage the NN model to learn localised subspaces?</li>
<li>Howe can query the model to learn/interpret the localised subspaces?</li>
<li>If the model learns a powerfull feature how can we give access to it to other parts of the model? (this would reduce learning time and increase generalization)
<ul>
<li>all discrminators following the features will be have one use of the feature.</li>
<li>could we let all other nodes in the network have a residual connection to the feature?</li>
</ul></li>
<li>if we wanted to further refine a representation of a localised subspace of verbs to intransitive verbs how would we do that?
<ul>
<li>we would like to lean a discriminator that can tell the difference between transitive and intransitive verbs and then use it to gate the input to the verb feature.</li>
<li>however we might prefer to do better than that and learn a better representation of the<br>
transitive and intransitive verbs. This would need learning different weights for the different verbs. This means we want to bifurcate the verb fearture subnetwork into two replicates but add the discriminator as a gate to the input of the two subnetworks.</li>
<li>another point worth considering is that once we have learned a good representation of both<br>
the transitive and intransitive verbs we can use these as features in the next layers of the network. We sould be able to combine them to get a better representation than just the original verb.</li>
<li>I recon this happens many times in LLMs. What we might want is to have some way for the model to attend to all the subspaces it has learned and use them to guide its learning.</li>
<li>The challange seems to be in identification of the subspaces. We may be using differnt basis for each subspace etc which may lead to difficulty in reusing them.</li>
</ul></li>
</ul>
</section>
<section id="attention-heads" class="level2">
<h2 class="anchored" data-anchor-id="attention-heads">Attention heads</h2>
<p>It seems thogh that attention heads are a good way to orgenize and increase the diversity of the localised subspaces. This is because the attention heads can be trained to focus on different parts of the input and thus can be used to create a localised subspace embedding. This is a very powerful idea and is the basis of the transformer architecture.</p>
</section>
<section id="residual-rerouting" class="level2">
<h2 class="anchored" data-anchor-id="residual-rerouting">Residual rerouting</h2>
</section>
<section id="guided-bifuration-along-side-the-spontaneous-symetry-breaking" class="level2">
<h2 class="anchored" data-anchor-id="guided-bifuration-along-side-the-spontaneous-symetry-breaking">Guided bifuration along side the spontaneous symetry breaking</h2>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {Two Ideas on Generelization},
  date = {2024-07-01},
  url = {https://orenbochman.github.io/posts/2024/2024-07-01-generalization-in-ML/2024-07-01-gen-ml.html},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“Two Ideas on Generelization.”</span> July 1,
2024. <a href="https://orenbochman.github.io/posts/2024/2024-07-01-generalization-in-ML/2024-07-01-gen-ml.html">https://orenbochman.github.io/posts/2024/2024-07-01-generalization-in-ML/2024-07-01-gen-ml.html</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/2024-07-01-generalization-in-ML/2024-07-01-gen-ml.html</guid>
  <pubDate>Mon, 01 Jul 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>mesa &amp; rl</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/2024-06-25-mesa-rl/mesa-rl.html</link>
  <description><![CDATA[ 





<section id="trajectory-trace-replay---based-on-mesa-caching." class="level2">
<h2 class="anchored" data-anchor-id="trajectory-trace-replay---based-on-mesa-caching.">Trajectory trace &amp; replay - based on <code>Mesa</code> caching.</h2>
<section id="tldr" class="level3">
<h3 class="anchored" data-anchor-id="tldr">TLDR:</h3>
<p>Ifs we can store state, action, reward trajectories (to a file) this would facilitate</p>
<ol type="1">
<li>Off-policy sample based learning</li>
<li>model based learning</li>
<li>deep RL learning of NN in certain modern algs.</li>
</ol>
<p>RL Recap for ABM:</p>
<ol type="1">
<li>in RL there is a Markov Decision Process MDP that genereates a sequence</li>
</ol>
<p><img src="https://latex.codecogs.com/png.latex?%0As_0,%20a_0,%20r_0,%20s_1,%20a_1,%20r_1%20%5Cldots%0A"></p>
<p>s is the state. a the action . r the reward.</p>
<p>the goal of RL is to learn an optimal policy <img src="https://latex.codecogs.com/png.latex?%5Cpi"> in the sense of generating the maximum expected total rewards. by picking the the best action at each step.</p>
<p>note: the reward is for getting to the next state s’ using the action a.</p>
<ol start="2" type="1">
<li>In model based RL agents learn a model of the environment to facilitate many quick planning steps between the more expensive/risky interactions with the environment.</li>
</ol>
<p>the model is typically two functions</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?P(s'%7Cs,a,)"> - the Markov chain transitions denoted as T</li>
<li><img src="https://latex.codecogs.com/png.latex?R(r%7Cs,a,s')"> - the reward for the above transition</li>
</ul>
<ol start="3" type="1">
<li>in deep RL agents use ML techinques to approximate with a NeuralNet</li>
</ol>
<p>the action value function <img src="https://latex.codecogs.com/png.latex?Q_%5Cpi(s,a)"> the policy <img src="https://latex.codecogs.com/png.latex?%5Cpi"> or the model.</p>
<ol start="3" type="1">
<li>off policy learning.</li>
</ol>
<p>A more general setting in RL has 2 policies</p>
<ul>
<li>the behavioral policy - which determines the actions of the agents
<ul>
<li>Deterministic random policy - all possible actions have equal probability</li>
<li>Epsilon soft - all possible actions have at least epsilon probability</li>
</ul></li>
<li>the target policy - which is a better
<ul>
<li>pi star - the optimal policy.</li>
</ul></li>
</ul>
<p>the point:</p>
<p>if we generate a trace of S,A,R … from an ABM model and the ABM (plus some techincal caveats - it is an MDP, the ABM behaviour is ergodic etc) Then rl agents can use these traces to train a more optimal agent using off policy sample based learning methods like:</p>
<ul>
<li><p>first visit MC with importance sampling</p></li>
<li><p>any visit MC with importance sampling</p></li>
<li><p>Q-learning,</p></li>
<li><p>Expected Sarsa</p></li>
<li><p><code>Dyna-Q+</code> vcan learn a model and use it for efficent planning.</p>
<ul>
<li>e.g.&nbsp;how to navigate in a maze which changes over time.</li>
</ul></li>
</ul>
</section>
<section id="the-api" class="level3">
<h3 class="anchored" data-anchor-id="the-api">The API</h3>
</section>
<section id="model" class="level3">
<h3 class="anchored" data-anchor-id="model">Model</h3>
<ol type="1">
<li>I don’t think its worth converting all ABM model to RL</li>
<li>many ABM don’t have rewards structure.</li>
<li>some don’t have much states</li>
<li>doing this would mean being creative</li>
</ol>
<p>Say we have a forest fire sim which we could extend as follows</p>
<p>add two new agents:</p>
<pre><code>- fire starter - total rewards trees burnt 
    - can light a fire
- fire fighter - total trees remaining.
    - can cut/move a tree </code></pre>
<ul>
<li><p>fire fighter can cut down k trees before the start of the simulation</p></li>
<li><p>fire starter can light a fire in some location x</p></li>
<li><p>fire fighter can cut down k more trees</p>
<ul>
<li>e.g.&nbsp;can we cut down some trees to stop a forest fire from spreading.</li>
</ul></li>
</ul>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {Mesa \&amp; Rl},
  date = {2024-06-25},
  url = {https://orenbochman.github.io/posts/2024/2024-06-25-mesa-rl/mesa-rl.html},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“Mesa &amp; Rl.”</span> June 25, 2024. <a href="https://orenbochman.github.io/posts/2024/2024-06-25-mesa-rl/mesa-rl.html">https://orenbochman.github.io/posts/2024/2024-06-25-mesa-rl/mesa-rl.html</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/2024-06-25-mesa-rl/mesa-rl.html</guid>
  <pubDate>Tue, 25 Jun 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>zero inflated data</title>
  <dc:creator>Oren Bochman</dc:creator>
  <link>https://orenbochman.github.io/posts/2024/2024-06-23-zero-inflated-data/2024-06-23-zero-inflated-data.html</link>
  <description><![CDATA[ 





<p>Zero inflated data is a type of data that has a large number of zero values.</p>
<p>This type of data is common in many fields, including biology, economics, and social sciences.</p>
<p>In this post, we will explore how to analyze zero inflated data.</p>
<p>Imagine you are creating a regression model to predict the sales for a product as a function of price.</p>
<p>You have a dataset that contains the sales data for the product, as well as the price of the product.</p>
<p>Looking at the data you notice</p>
<ul>
<li>as price increases the number of sales decreases.</li>
<li>there are many days where no sales are made.</li>
<li>the regression line does not fit the data well.</li>
</ul>
<p>when you try to dive deeper into the data you notice that</p>
<ol type="1">
<li>some products when out of stock cannot be bought until the next shipment arrives.</li>
<li>occasionaly the IT system fails and no sales are recorded.</li>
<li>When acounting for 1,2 demand is stochastic. there is always a chance that no sales are made on a certain day.</li>
<li>For high value products, if we are more expensive than the competition by some threshold, chances of zero sales are high.</li>
<li>Sales get canceled but it can also be credited as a negative sale on some other day.</li>
<li>Sales are seasonal, some days for some products are far more likely to have zero sales than others.</li>
<li>There was a marketing campaign that increased sales for a certain period of time but the budget run out and sales dropped to zero.</li>
<li>There was a well marketed promotion that made clients buy more than they needed at a low price and then they did not buy for a long time.</li>
<li>Traffic to our store for some products is mainly from a recommendation engine and that engine may stop recommending our product or drop our product’s ranking leading to zero sales.</li>
<li>When some products might get bad reviews on the site and sales might drop to zero.</li>
</ol>
<ul>
<li>While we can track some of these factors, we cannot track all of them. Also ther effects can be specific to a certain product or a certain day.</li>
<li>In the end though we cannot match cause to effect, we can only speculate why we get zero sales on some days.</li>
<li>However regardless of the root cause, we probably want our model to have a good fit to the real functional relationship between price and sales.</li>
<li>We might also want to be able to predict the stochatic nature of the demand. (i.e.&nbsp;the probability of zero sales on a certain day assuming a stochastic model of demand)</li>
<li>We might also want to know how much more zeros we are getting than we would expect from a simple model of demand.</li>
</ul>
<p>Some approaches to model zero inflated data are:</p>
<ol type="1">
<li>Zero inflated Poisson regression</li>
<li>Zero inflated negative binomial regression</li>
<li>Zero inflated generalized linear models</li>
<li>Zero inflated mixed models</li>
<li>Zero inflated hurdle models</li>
</ol>
<section id="zero-inflated-poisson-regression" class="level2">
<h2 class="anchored" data-anchor-id="zero-inflated-poisson-regression">Zero inflated Poisson regression</h2>
<p>The zero inflated Poisson regression model is a type of regression model that is used to analyze zero inflated data.</p>
<p>This model assumes that the data is generated by a Poisson distribution, but that there are two processes that can generate zeros:</p>
<ol type="1">
<li>A process that generates zeros with a certain probability, even if the Poisson process generates a non-zero value.</li>
<li>A Poisson process that generates zeros with a certain probability.</li>
</ol>
<p>The model is defined as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AY_i%20=%20%5Cbegin%7Bcases%7D%0A0%20&amp;%20%5Ctext%7Bwith%20probability%20%7D%20%5Cpi_i%20%5C%5C%0APoisson(%5Clambda_i)%20&amp;%20%5Ctext%7Bwith%20probability%20%7D%201%20-%20%5Cpi_i%0A%5Cend%7Bcases%7D%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?Y_i"> is the observed value, <img src="https://latex.codecogs.com/png.latex?%5Cpi_i"> is the probability of a zero value, and <img src="https://latex.codecogs.com/png.latex?%5Clambda_i"> is the mean of the Poisson distribution.</p>
<p>The model can be estimated using maximum likelihood estimation.</p>
</section>
<section id="zero-inflated-negative-binomial-regression" class="level2">
<h2 class="anchored" data-anchor-id="zero-inflated-negative-binomial-regression">Zero inflated negative binomial regression</h2>
<p>The zero inflated negative binomial regression model is a type of regression model that is used to analyze zero inflated data.</p>
<p>This model assumes that the data is generated by a negative binomial distribution, but that there are two processes that can generate zeros:</p>
<ol type="1">
<li>A process that generates zeros with a certain probability, even if the negative binomial process generates a non-zero value.</li>
<li>A negative binomial process that generates zeros with a certain probability.</li>
</ol>
<p>The model is defined as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AY_i%20=%20%5Cbegin%7Bcases%7D%0A0%20&amp;%20%5Ctext%7Bwith%20probability%20%7D%20%5Cpi_i%20%5C%5C%0ANegBin(%5Cmu_i,%20%5Ctheta)%20&amp;%20%5Ctext%7Bwith%20probability%20%7D%201%20-%20%5Cpi_i%0A%5Cend%7Bcases%7D%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?Y_i"> is the observed value, <img src="https://latex.codecogs.com/png.latex?%5Cpi_i"> is the probability of a zero value, <img src="https://latex.codecogs.com/png.latex?%5Cmu_i"> is the mean of the negative binomial distribution, and <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> is the dispersion parameter.</p>
<p>The model can be estimated using maximum likelihood estimation.</p>
</section>
<section id="zero-inflated-generalized-linear-models" class="level2">
<h2 class="anchored" data-anchor-id="zero-inflated-generalized-linear-models">Zero inflated generalized linear models</h2>
<p>The zero inflated generalized linear model is a type of regression model that is used to analyze zero inflated data.</p>
<p>This model is a generalization of the zero inflated Poisson and zero inflated negative binomial regression models.</p>
<p>The model is defined as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AY_i%20=%20%5Cbegin%7Bcases%7D%0A0%20&amp;%20%5Ctext%7Bwith%20probability%20%7D%20%5Cpi_i%20%5C%5C%0AGLM(%5Ceta_i)%20&amp;%20%5Ctext%7Bwith%20probability%20%7D%201%20-%20%5Cpi_i%0A%5Cend%7Bcases%7D%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?Y_i"> is the observed value, <img src="https://latex.codecogs.com/png.latex?%5Cpi_i"> is the probability of a zero value, and <img src="https://latex.codecogs.com/png.latex?%5Ceta_i"> is the linear predictor.</p>
<p>The model can be estimated using maximum likelihood estimation.</p>
</section>
<section id="zero-inflated-mixed-models" class="level2">
<h2 class="anchored" data-anchor-id="zero-inflated-mixed-models">Zero inflated mixed models</h2>
<p>The zero inflated mixed model is a type of regression model that is used to analyze zero inflated data.</p>
<p>This model is a generalization of the zero inflated Poisson and zero inflated negative binomial regression models.</p>
<p>The model is defined as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AY_i%20=%20%5Cbegin%7Bcases%7D%0A0%20&amp;%20%5Ctext%7Bwith%20probability%20%7D%20%5Cpi_i%20%5C%5C%0AMixed(%5Ceta_i)%20&amp;%20%5Ctext%7Bwith%20probability%20%7D%201%20-%20%5Cpi_i%0A%5Cend%7Bcases%7D%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?Y_i"> is the observed value, <img src="https://latex.codecogs.com/png.latex?%5Cpi_i"> is the probability of a zero value, and <img src="https://latex.codecogs.com/png.latex?%5Ceta_i"> is the linear predictor.</p>
<p>The model can be estimated using maximum likelihood estimation.</p>
</section>
<section id="zero-inflated-hurdle-models" class="level2">
<h2 class="anchored" data-anchor-id="zero-inflated-hurdle-models">Zero inflated hurdle models</h2>
<p>The zero inflated hurdle model is a type of regression model that is used to analyze zero inflated data.</p>
<p>This model is a generalization of the zero inflated Poisson and zero inflated negative binomial regression models.</p>
<p>The model is defined as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AY_i%20=%20%5Cbegin%7Bcases%7D%0A0%20&amp;%20%5Ctext%7Bwith%20probability%20%7D%20%5Cpi_i%20%5C%5C%0AHurdle(%5Ceta_i)%20&amp;%20%5Ctext%7Bwith%20probability%20%7D%201%20-%20%5Cpi_i%0A%5Cend%7Bcases%7D%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?Y_i"> is the observed value, <img src="https://latex.codecogs.com/png.latex?%5Cpi_i"> is the probability of a zero value, and <img src="https://latex.codecogs.com/png.latex?%5Ceta_i"> is the linear predictor.</p>
<p>The model can be estimated using maximum likelihood estimation.</p>
<p>In conclusion, zero inflated data is a type of data that has a large number of zero values.</p>
<p>There are several approaches to model zero inflated data, including zero inflated Poisson regression, zero inflated negative binomial regression, zero inflated generalized linear models, zero inflated mixed models, and zero inflated hurdle models.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {Zero Inflated Data},
  date = {2024-06-23},
  url = {https://orenbochman.github.io/posts/2024/2024-06-23-zero-inflated-data/2024-06-23-zero-inflated-data.html},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas">
Bochman, Oren. 2024. <span>“Zero Inflated Data.”</span> June 23, 2024.
<a href="https://orenbochman.github.io/posts/2024/2024-06-23-zero-inflated-data/2024-06-23-zero-inflated-data.html">https://orenbochman.github.io/posts/2024/2024-06-23-zero-inflated-data/2024-06-23-zero-inflated-data.html</a>.
</div></div></section></div> ]]></description>
  <guid>https://orenbochman.github.io/posts/2024/2024-06-23-zero-inflated-data/2024-06-23-zero-inflated-data.html</guid>
  <pubDate>Sun, 23 Jun 2024 00:00:00 GMT</pubDate>
</item>
</channel>
</rss>
