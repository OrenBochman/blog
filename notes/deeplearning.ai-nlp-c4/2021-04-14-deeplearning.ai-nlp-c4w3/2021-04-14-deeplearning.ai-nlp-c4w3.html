<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Oren Bochman">
<meta name="dcterms.date" content="2021-04-14">
<meta name="description" content="Concepts, code snippets, slide commentaries for this week’s lesson of the Course notes from the deeplearning.ai natural language programming specialization.">

<title>Oren Bochman’s Blog - NLP with Attention Models Week 3 Question Answering</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  
<style>html{ scroll-behavior: smooth; }</style>


<meta name="twitter:title" content="Oren Bochman’s Blog - NLP with Attention Models Week 3 Question Answering">
<meta name="twitter:description" content="Concepts, code snippets, slide commentaries for this week’s lesson of the Course notes from the deeplearning.ai natural language programming specialization.">
<meta name="twitter:image" content="https://orenbochman.github.io/blog/notes/deeplearning.ai-nlp-c4/2021-04-14-deeplearning.ai-nlp-c4w3/thumbnail_blog.png">
<meta name="twitter:creator" content="@orenbochman">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../images/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Oren Bochman’s Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-book" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-book" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-bi-book">    
        <li>
    <a class="dropdown-item" href="../../../dnn.html">
 <span class="dropdown-text">Neural Networks for Machine Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../model-thinking.html">
 <span class="dropdown-text">Model Thinking</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../xai.html">
 <span class="dropdown-text">XAI</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../rl.html">
 <span class="dropdown-text">rl</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../rhetoric.html">
 <span class="dropdown-text">rhetoric</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../tfp.html">
 <span class="dropdown-text">TFP</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../ab-testing.html">
 <span class="dropdown-text">AB testing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../cognitiveai.html">
 <span class="dropdown-text">cognitive AI</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/orenbochman"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/OrenBochman/blog">
 <span class="dropdown-text">Source Code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/OrenBochman/blog/issues">
 <span class="dropdown-text">Report a Bug</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="../../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../archive.html"> <i class="bi bi-archive" role="img">
</i> 
<span class="menu-text">Archive</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">NLP with Attention Models Week 3 Question Answering</h1>
                  <div>
        <div class="description">
          Concepts, code snippets, slide commentaries for this week’s lesson of the Course notes from the deeplearning.ai natural language programming specialization.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">NLP</div>
                <div class="quarto-category">coursera</div>
                <div class="quarto-category">notes</div>
                <div class="quarto-category">deeplearning.ai</div>
                <div class="quarto-category">course notes</div>
                <div class="quarto-category">DeepLearningAlgorithms</div>
                <div class="quarto-category">transformer</div>
                <div class="quarto-category">teacher forcing</div>
                <div class="quarto-category">positional encoding</div>
                <div class="quarto-category">BERT</div>
                <div class="quarto-category">T5</div>
                <div class="quarto-category">transformer decoder</div>
                <div class="quarto-category">attention</div>
                <div class="quarto-category">dot product attention</div>
                <div class="quarto-category">self attention</div>
                <div class="quarto-category">causal attention</div>
                <div class="quarto-category">multi-head attention</div>
                <div class="quarto-category">question answering task</div>
                <div class="quarto-category">bibliography</div>
                <div class="quarto-category">literature review</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Oren Bochman </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 14, 2021</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#question-answering" id="toc-question-answering" class="nav-link active" data-scroll-target="#question-answering">Question Answering</a>
  <ul class="collapse">
  <li><a href="#video-2-transfer-learning-in-nlp" id="toc-video-2-transfer-learning-in-nlp" class="nav-link" data-scroll-target="#video-2-transfer-learning-in-nlp">Video 2 : Transfer Learning in NLP</a></li>
  <li><a href="#video-3-elmo-gpt-bert-t5" id="toc-video-3-elmo-gpt-bert-t5" class="nav-link" data-scroll-target="#video-3-elmo-gpt-bert-t5">Video 3 : ELMo, GPT, BERT, T5</a></li>
  <li><a href="#video-4-bert-bidirectional-encoder-representations-from-transformers" id="toc-video-4-bert-bidirectional-encoder-representations-from-transformers" class="nav-link" data-scroll-target="#video-4-bert-bidirectional-encoder-representations-from-transformers">Video 4 : BERT Bidirectional Encoder Representations from Transformers</a></li>
  <li><a href="#video-5-bert-objective" id="toc-video-5-bert-objective" class="nav-link" data-scroll-target="#video-5-bert-objective">Video 5 : BERT Objective</a></li>
  <li><a href="#video-6-fine-tuning-bert" id="toc-video-6-fine-tuning-bert" class="nav-link" data-scroll-target="#video-6-fine-tuning-bert">Video 6: Fine tuning BERT</a></li>
  <li><a href="#video-7-transformer-t5" id="toc-video-7-transformer-t5" class="nav-link" data-scroll-target="#video-7-transformer-t5">Video 7: Transformer: T5</a></li>
  <li><a href="#video-8-lecture-multi-task-training-strategy" id="toc-video-8-lecture-multi-task-training-strategy" class="nav-link" data-scroll-target="#video-8-lecture-multi-task-training-strategy">Video 8: Lecture Multi-Task Training Strategy</a></li>
  <li><a href="#video-9-glue-benchmark" id="toc-video-9-glue-benchmark" class="nav-link" data-scroll-target="#video-9-glue-benchmark">Video 9: GLUE Benchmark</a></li>
  <li><a href="#video-10question-answering" id="toc-video-10question-answering" class="nav-link" data-scroll-target="#video-10question-answering">Video 10:Question Answering</a></li>
  <li><a href="#programming-assignment-question-answering" id="toc-programming-assignment-question-answering" class="nav-link" data-scroll-target="#programming-assignment-question-answering">Programming Assignment: Question Answering</a></li>
  <li><a href="#lab-sentencepiece-and-bpe" id="toc-lab-sentencepiece-and-bpe" class="nav-link" data-scroll-target="#lab-sentencepiece-and-bpe">Lab: SentencePiece and BPE</a>
  <ul class="collapse">
  <li><a href="#nfkc-normalization" id="toc-nfkc-normalization" class="nav-link" data-scroll-target="#nfkc-normalization">NFKC Normalization</a></li>
  </ul></li>
  <li><a href="#lossless-tokenization" id="toc-lossless-tokenization" class="nav-link" data-scroll-target="#lossless-tokenization">lossless tokenization</a>
  <ul class="collapse">
  <li><a href="#sentencepiece" id="toc-sentencepiece" class="nav-link" data-scroll-target="#sentencepiece">SentencePiece</a></li>
  <li><a href="#bpe" id="toc-bpe" class="nav-link" data-scroll-target="#bpe">BPE</a></li>
  </ul></li>
  <li><a href="#lab-bert-loss" id="toc-lab-bert-loss" class="nav-link" data-scroll-target="#lab-bert-loss">Lab: BERT Loss</a></li>
  <li><a href="#lab-t5" id="toc-lab-t5" class="nav-link" data-scroll-target="#lab-t5">Lab: T5</a></li>
  <li><a href="#representation.-pdf-bib" id="toc-representation.-pdf-bib" class="nav-link" data-scroll-target="#representation.-pdf-bib">Representation. [pdf] [bib]</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References:</a>
  <ul class="collapse">
  <li><a href="#tokenization" id="toc-tokenization" class="nav-link" data-scroll-target="#tokenization">Tokenization</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><img src="notes-formulas.jpg" class="img-fluid"> :::{.logo} <img src="logo_deeplearning_ai.png" class="img-fluid" alt="deeplearning.ai"> :::</p>
<section id="question-answering" class="level1">
<h1>Question Answering</h1>
Notes for: NLP with Attention Models Week 3 Natural Language Processing with Attention Models - Question Answering ### Week’s Learning Objectives: * [ ] Gain intuition for how transfer learning works in the context of NLP * [ ] Identify two approaches to transfer learning * [ ] Discuss the evolution of language models from CBOW to T5 and Bert * [ ] Fine-tune BERT on a dataset * [ ] Implement context-based question answering with T5 * [ ] Interpret the GLUE benchmark <!-- ## TLDR: Neural Network engineering --> ## Video 1 : Week 3 Overview <img src="V1-001-week-3.png" class="img-fluid" alt="week-3"> In this week you are going to learn about <strong>transfer learning</strong>. More specifically you will understand how <strong>T5</strong> and <strong>BERT</strong> actually work
<hr>
<p><img src="V1-002-question-answering.png" class="img-fluid" alt="question-answering"> Q&amp;A comes in two forms: context based : given a document and a question the model extracts an answer or generates an answer</p>
<p>closed book : the model picks an answer from servral options (classifier)</p>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V1-003-tl.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" data-glightbox="description: .lightbox-desc-1" title="tl"><img src="V1-003-tl.png" class="img-fluid figure-img" alt="tl"></a></p>
<figcaption>tl</figcaption>
</figure>
</div>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V1-004-classical-training.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" data-glightbox="description: .lightbox-desc-2" title="classical-training"><img src="V1-004-classical-training.png" class="img-fluid figure-img" alt="classical-training"></a></p>
<figcaption>classical-training</figcaption>
</figure>
</div>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V1-005-transfer-learning.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" data-glightbox="description: .lightbox-desc-3" title="transfer-learning"><img src="V1-005-transfer-learning.png" class="img-fluid figure-img" alt="transfer-learning"></a></p>
<figcaption>transfer-learning</figcaption>
</figure>
</div>
<hr>
<img src="V1-006-transfer-learning-tasks.png" class="img-fluid" alt="transfer-learning-tasks"> You can see how a model initially trained on some type of sentiment classification, could now be used for question answering. One other model that has state of the art makes use of multi tasking. For example, the same model could be used for sentiment analysis, question answering, and many other things.
<hr>
<img src="V1-007-goals.png" class="img-fluid" alt="goals"> These new types of models make use of a lot of data. For example the C4 (colossal cleaned crawled corpus) is about 800 GB when all of the english wikipedia is just 13 GB! &gt; C4 is a colossal, cleaned version of Common Crawl’s web crawl corpus. It was based on Common Crawl dataset: https://commoncrawl.org. It was used to train the T5 text-to-text Transformer models. &gt; Introduced by Raffel et al.&nbsp;in Exploring the Limits of Transfer Learning with a Unified Text-to-Text Transformer &gt; The dataset can be downloaded in a pre-processed form from <a href="https://github.com/allenai/allennlp/discussions/5056">allennlp</a>. &gt; <a href="https://paperswithcode.com/dataset/c4">C4 $ papers with code</a>
<hr>
<section id="video-2-transfer-learning-in-nlp" class="level2">
<h2 class="anchored" data-anchor-id="video-2-transfer-learning-in-nlp">Video 2 : Transfer Learning in NLP</h2>
<img src="V2-010-transfer-learning-options.png" class="img-fluid" alt="transfer-learning-options"> There are three main advantages to transfer learning: * Reduce training time * Improve predictions * Allows you to use smaller datasets Two methods that you can use for transfer learning are the following: - pre-training - fine tuning
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V2-011-tl-general-purpose.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" data-glightbox="description: .lightbox-desc-4" title="tl-general-purpose"><img src="V2-011-tl-general-purpose.png" class="img-fluid figure-img" alt="tl-general-purpose"></a></p>
<figcaption>tl-general-purpose</figcaption>
</figure>
</div>
<hr>
<img src="V2-012-tl-features-vs-fine-tuning.png" class="img-fluid" alt="tl-features-vs-fine-tuning"> In <strong>feature based</strong>, you can train word embeddings by running a different model and then using those features (i.e.&nbsp;word vectors) on a different task. When <strong>fine tuning</strong>, you can use the exact same model and just run it on a different task. Sometimes when fine tuning, you can keep the model weights fixed and just add a new layer that you will train. Other times you can slowly unfreeze the layers one at a time. You can also use unlabelled data when pre-training, by masking words and trying to predict which word was masked.
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V2-013-tl-fine-tuning.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" data-glightbox="description: .lightbox-desc-5" title="tl-fine-tuning"><img src="V2-013-tl-fine-tuning.png" class="img-fluid figure-img" alt="tl-fine-tuning"></a></p>
<figcaption>tl-fine-tuning</figcaption>
</figure>
</div>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V2-014-tl-pretain-data-performance.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" data-glightbox="description: .lightbox-desc-6" title="tl-pretain-data-performance"><img src="V2-014-tl-pretain-data-performance.png" class="img-fluid figure-img" alt="tl-pretain-data-performance"></a></p>
<figcaption>tl-pretain-data-performance</figcaption>
</figure>
</div>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V2-015-tl-pretain-data-supervision.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" data-glightbox="description: .lightbox-desc-7" title="tl-pretain-data-supervision"><img src="V2-015-tl-pretain-data-supervision.png" class="img-fluid figure-img" alt="tl-pretain-data-supervision"></a></p>
<figcaption>tl-pretain-data-supervision</figcaption>
</figure>
</div>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V2-016-tl-pretain-unsupervised.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" data-glightbox="description: .lightbox-desc-8" title="tl-pretain-unsupervised"><img src="V2-016-tl-pretain-unsupervised.png" class="img-fluid figure-img" alt="tl-pretain-unsupervised"></a></p>
<figcaption>tl-pretain-unsupervised</figcaption>
</figure>
</div>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V2-017-tl-pretrain-selfsupervised.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" data-glightbox="description: .lightbox-desc-9" title="tl-pretrain-selfsupervised"><img src="V2-017-tl-pretrain-selfsupervised.png" class="img-fluid figure-img" alt="tl-pretrain-selfsupervised"></a></p>
<figcaption>tl-pretrain-selfsupervised</figcaption>
</figure>
</div>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V2-018-tl-pretrain-selfsupervised.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10" data-glightbox="description: .lightbox-desc-10" title="tl-pretrain-selfsupervised"><img src="V2-018-tl-pretrain-selfsupervised.png" class="img-fluid figure-img" alt="tl-pretrain-selfsupervised"></a></p>
<figcaption>tl-pretrain-selfsupervised</figcaption>
</figure>
</div>
<hr>
<img src="V2-019-tl-per-task-fine-tuning.png" class="img-fluid" alt="tl-per-task-fine-tuning"> For example, in the drawing above we try to predict the word “friend”. This allows your model to get a grasp of the overall structure of the data and to help the model learn some relationships within the words of a sentence
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V2-020-tl-summary.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11" data-glightbox="description: .lightbox-desc-11" title="tl-summary"><img src="V2-020-tl-summary.png" class="img-fluid figure-img" alt="tl-summary"></a></p>
<figcaption>tl-summary</figcaption>
</figure>
</div>
<hr>
</section>
<section id="video-3-elmo-gpt-bert-t5" class="level2">
<h2 class="anchored" data-anchor-id="video-3-elmo-gpt-bert-t5">Video 3 : ELMo, GPT, BERT, T5</h2>
<p>The models mentioned in the previous video were discovered in the following order.</p>
<ul>
<li>CBOW in Word2Vec - Issue: Fixed window we want all the context
<ul>
<li>2013 Word2Vec Google</li>
<li>CBOW &amp; Skip grams</li>
<li>2014 Glove Stanfor <a href="">GloVe: Global Vectors for Word ()</a></li>
</ul></li>
<li>ElMo - Bidirectional LSTM
<ul>
<li>Solves: fixed window size using a biderectional RNN</li>
<li>Issue: weak long term dependency</li>
</ul></li>
<li>GPT2 - issue: unidirectional. only looks back</li>
<li>BERT - just encoder - biderctional, multi mask learning</li>
<li>T5 - Encoder Decoder - multi-task learning</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V3-030-outline.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12" data-glightbox="description: .lightbox-desc-12" title="outline"><img src="V3-030-outline.png" class="img-fluid figure-img" alt="outline"></a></p>
<figcaption>outline</figcaption>
</figure>
</div>
<hr>
<p><img src="V3-031-CBOW-fixed-window.png" class="img-fluid" alt="CBOW-fixed-window"> ## CBOW</p>
<p>In CBOW, you want to encode a word as a vector. To do this we used the context before the word and the context after the word and we use that model to learn and creates features for the word. CBOW however uses a fixed window C (for the context).</p>
the main isused with CBOW are: - it has a fixed window size - no concept of order
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V3-032-cbow-issues.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13" data-glightbox="description: .lightbox-desc-13" title="CBOW-issues"><img src="V3-032-cbow-issues.png" class="img-fluid figure-img" alt="CBOW-issues"></a></p>
<figcaption>CBOW-issues</figcaption>
</figure>
</div>
<hr>
<img src="V3-033-elmo-solution.png" class="img-fluid" alt="ELMo-solution"> so what do we do when we need more context to model the concept we are looking at?
<hr>
<img src="V3-034-elmo-rnn.png" class="img-fluid" alt="ELMo-RNN"> What ElMo does, it uses a bi-directional LSTM, which is a version of an RNN that looks at the inputs from the left and the right. This has the added benefit that the context size is no longer constrained. But since it is an RNN it has problems propagating information as sequences grow longer.
<hr>
<img src="V3-035-GPT-unidirectional.png" class="img-fluid" alt="GPT-unidirectional"> Then Open AI introduced GPT. GPT unfortunately is uni-directional but it makes use of transformers. Although ElMo was bi-directional, it suffered from some issues such as capturing longer-term dependencies.
<hr>
<p><img src="V3-036-bert.png" class="img-fluid" alt="BERT"> BERT was then introduced which stands for the Bi-directional Encoder Representation from Transformers.</p>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V3-037-multi-mask.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14" data-glightbox="description: .lightbox-desc-14" title="multi-mask"><img src="V3-037-multi-mask.png" class="img-fluid figure-img" alt="multi-mask"></a></p>
<figcaption>multi-mask</figcaption>
</figure>
</div>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V3-038-BERT-pre-training.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15" data-glightbox="description: .lightbox-desc-15" title="BERT-pre-training"><img src="V3-038-BERT-pre-training.png" class="img-fluid figure-img" alt="BERT-pre-training"></a></p>
<figcaption>BERT-pre-training</figcaption>
</figure>
</div>
<hr>
<img src="V3-039-t5-encoder-decoder.png" class="img-fluid" alt="t5-encoder-decoder"> T5 was introduced which makes use of transfer learning and uses the same model to predict on many tasks. - GPT was a transformer decoder - BERT was a transformer encoder - T5 is a decoder encoder
<hr>
<img src="V3-041-t5-text-to-text.png" class="img-fluid" alt="t5-text-to-text"> Here is an illustration of how T5 works:
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V3-042-question.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16" data-glightbox="description: .lightbox-desc-16" title="question"><img src="V3-042-question.png" class="img-fluid figure-img" alt="question"></a></p>
<figcaption>question</figcaption>
</figure>
</div>
<hr>
<img src="V3-043-summary.png" class="img-fluid" alt="summary"> So we can now flesh out the table
<hr>
</section>
<section id="video-4-bert-bidirectional-encoder-representations-from-transformers" class="level2">
<h2 class="anchored" data-anchor-id="video-4-bert-bidirectional-encoder-representations-from-transformers">Video 4 : BERT Bidirectional Encoder Representations from Transformers</h2>
<img src="V4-050-bert-outline.png" class="img-fluid" alt="BERT-outline"> lets dive deeper into BERT There are two steps in the BERT framework: pre-training and fine-tuning. During pre-training, the model is trained on unlabeled data over different pre-training tasks. For fine tuning, the BERT model is first initialized with the pre-trained parameters, and all of the parameters are fine-tuned using labeled data from the downstream tasks. For example, in the figure above, you get the corresponding embeddings for the input words, you run it through a few transformer blocks, and then you make the prediction at each time point T_iT i.
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V4-050-bert-question.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17" data-glightbox="description: .lightbox-desc-17" title="BERT-question"><img src="V4-050-bert-question.png" class="img-fluid figure-img" alt="BERT-question"></a></p>
<figcaption>BERT-question</figcaption>
</figure>
</div>
<hr>
<img src="V4-050-bert-summary.png" class="img-fluid" alt="BERT-summary"> Training procedures: - Choose 15% of the tokens at random: - mask them 80% of the time, - replace them with a random token 10% of the time, - keep as is 10% of the time. There could be multiple masked spans in a sentence. Next sentence prediction is also used when pre-training.
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V4-051-bert.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18" data-glightbox="description: .lightbox-desc-18" title="BERT"><img src="V4-051-bert.png" class="img-fluid figure-img" alt="BERT"></a></p>
<figcaption>BERT</figcaption>
</figure>
</div>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V4-052-bert-spec.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19" data-glightbox="description: .lightbox-desc-19" title="BERT-spec"><img src="V4-052-bert-spec.png" class="img-fluid figure-img" alt="BERT-spec"></a></p>
<figcaption>BERT-spec</figcaption>
</figure>
</div>
Spec and features:
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V4-053-bert-pre-training.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20" data-glightbox="description: .lightbox-desc-20" title="BERT-pre-training"><img src="V4-053-bert-pre-training.png" class="img-fluid figure-img" alt="BERT-pre-training"></a></p>
<figcaption>BERT-pre-training</figcaption>
</figure>
</div>
<hr>
</section>
<section id="video-5-bert-objective" class="level2">
<h2 class="anchored" data-anchor-id="video-5-bert-objective">Video 5 : BERT Objective</h2>
<img src="V5-060-BERT-outline.png" class="img-fluid" alt="BERT-outline"> MLM - masked language modeling. This is the main unsupervised procedure to train the model with context left and right. It’s not clear how the model handles multiple masked items. Does it try to predict them all at once or each one by considering input as context and unknowns.
<hr>
<img src="V5-061-BERT-the-input.png" class="img-fluid" alt="BERT-the-input"> The input embeddings are the sum of the token embeddings, the segmentation embeddings and the position embeddings. The input embeddings: you have a CLS token to indicate the beginning of the sentence and a sep to indicate the end of the sentence The segment embeddings: allows you to indicate whether it is sentence a or b. Positional embeddings: allows you to indicate the word’s position in the sentence.
<hr>
<img src="V5-062-BERT-the-output.png" class="img-fluid" alt="BERT-the-output"> The C token in the image above could be used for classification purposes. The unlabeled sentence A/B pair will depend on what you are trying to predict, it could range from question answering to sentiment. (in which case the second sentence could be just empty).
<hr>
<img src="V5-063-BERT-objectives.png" class="img-fluid" alt="BERT-objectives"> The BERT objective is defined as follows:
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V5-064-BERT-summary.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21" data-glightbox="description: .lightbox-desc-21" title="BERT-summary"><img src="V5-064-BERT-summary.png" class="img-fluid figure-img" alt="BERT-summary"></a></p>
<figcaption>BERT-summary</figcaption>
</figure>
</div>
<hr>
</section>
<section id="video-6-fine-tuning-bert" class="level2">
<h2 class="anchored" data-anchor-id="video-6-fine-tuning-bert">Video 6: Fine tuning BERT</h2>
<img src="V6-070-BERT-fine-tuning-outline.png" class="img-fluid" alt="BERT-fine-tuning-outline"> Once you have a pre-trained model, you can fine tune it on different tasks.
<hr>
<img src="V6-071-inputs.png" class="img-fluid" alt="inputs"> For example, given a hypothesis, you can identify the premise. Given a question, you can find the answer. You can also use it for named entity recognition. Here is a summary of the inputs. - You can replace sentences A/B - Paraphrase from sentence A - Question/passage - Hypothesis premise pairs in entailment - Text and a Ø for classification/sequence tagging - Output tokens are fed into a layer for token level tasks otherwise use [CLS] embedding as input.
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V6-072-summary.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22" data-glightbox="description: .lightbox-desc-22" title="summary"><img src="V6-072-summary.png" class="img-fluid figure-img" alt="summary"></a></p>
<figcaption>summary</figcaption>
</figure>
</div>
<hr>
</section>
<section id="video-7-transformer-t5" class="level2">
<h2 class="anchored" data-anchor-id="video-7-transformer-t5">Video 7: Transformer: T5</h2>
<p><img src="V7-073-t5-outline.png" class="img-fluid" alt="t5-outline"> One of the major techniques that allowed the T5 model to reach state of the art is the concept of masking:</p>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V7-074-t5-text-to-text.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23" data-glightbox="description: .lightbox-desc-23" title="t5-text-to-text"><img src="V7-074-t5-text-to-text.png" class="img-fluid figure-img" alt="t5-text-to-text"></a></p>
<figcaption>t5-text-to-text</figcaption>
</figure>
</div>
<hr>
<img src="V7-075-T5-transformer.png" class="img-fluid" alt="T5-transformer"> For example, you represent the “for inviting” with <x> and last with <y> then the model predicts what the X should be and what the Y should be. This is exactly what we saw in the BERT loss. You can also mask out a few positions, not just one. The loss is only on the mask for BERT, for T5 it is on the target.
<hr>
<img src="V7-076-T5-architecture.png" class="img-fluid" alt="T5-architecture"> So we start with the basic encoder-decoder representation. There you have a fully visible attention in the encoder and then causal attention in the decoder. So light gray lines correspond to causal masking. And dark gray lines correspond to the fully visible masking. In the middle we have the language model which consists of a single transformer layer stack. And it’s being fed the concatenation of the inputs and the target. So it uses causal masking throughout as you can see because they’re all gray lines. And you have X1 going inside, you get X2, X2 goes into the model and you get X3 and so forth. To the right, we have prefix language model which corresponds to allowing fully visible masking over the inputs as you can see with the dark arrows. And then causal masking in the rest.
<hr>
</y></x></section>
<section id="video-8-lecture-multi-task-training-strategy" class="level2">
<h2 class="anchored" data-anchor-id="video-8-lecture-multi-task-training-strategy">Video 8: Lecture Multi-Task Training Strategy</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V8-080-T5-architecture.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24" data-glightbox="description: .lightbox-desc-24" title="T5-architecture"><img src="V8-080-T5-architecture.png" class="img-fluid figure-img" alt="T5-architecture"></a></p>
<figcaption>T5-architecture</figcaption>
</figure>
</div>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V8-081-T5-summary.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25" data-glightbox="description: .lightbox-desc-25" title="T5-summary"><img src="V8-081-T5-summary.png" class="img-fluid figure-img" alt="T5-summary"></a></p>
<figcaption>T5-summary</figcaption>
</figure>
</div>
<hr>
<img src="V8-082-T5-multi-task-training.png" class="img-fluid" alt="T5-multi-task-training"> This is a reminder of how the T5 model works: You can see that you only have to add a small prefix to the input and the model as a result will solve the task for you. There are many tasks that the t5 model can do for you. It is possible to formulate most NLP tasks in a “text-to-text” format – that is, a task where the model is fed some text for context or conditioning and is then asked to produce some output text. This framework provides a consistent training objective both for pre-training and fine-tuning. Specifically, the model is trained with a maximum likelihood objective (using “teacher forcing” ) regardless of the task. ### Training data strategies Examples-proportional mixing: sample in proportion to the size of each task’s dataset <strong>Temperature scaled mixing</strong>: adjust the “temperature” of the mixing rates. This temperature parameter allows you to weight certain examples more than others. To implement temperature scaling with temperature T, we raise each task’s mixing rate rm to the power of 1⁄T and renormalize the rates so that they sum to 1. When T = 1, this approach is equivalent to examples-proportional mixing and as T increases the proportions become closer to equal mixing <strong>Equal mixing</strong>: In this case, you sample examples from each task with equal probability. Specifically, each example in each batch is sampled uniformly at random from one of the datasets you train on.
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V8-083-io-format.png" class="lightbox" data-gallery="quarto-lightbox-gallery-26" data-glightbox="description: .lightbox-desc-26" title="io-format"><img src="V8-083-io-format.png" class="img-fluid figure-img" alt="io-format"></a></p>
<figcaption>io-format</figcaption>
</figure>
</div>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V8-084-multi-task-training.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27" data-glightbox="description: .lightbox-desc-27" title="multi-task-training"><img src="V8-084-multi-task-training.png" class="img-fluid figure-img" alt="multi-task-training"></a></p>
<figcaption>multi-task-training</figcaption>
</figure>
</div>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V8-085-data-training-strategy.png" class="lightbox" data-gallery="quarto-lightbox-gallery-28" data-glightbox="description: .lightbox-desc-28" title="data-training-strategy"><img src="V8-085-data-training-strategy.png" class="img-fluid figure-img" alt="data-training-strategy"></a></p>
<figcaption>data-training-strategy</figcaption>
</figure>
</div>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V8-086-unfreezing-adapter-layers.png" class="lightbox" data-gallery="quarto-lightbox-gallery-29" data-glightbox="description: .lightbox-desc-29" title="unfreezing-adapter-layers"><img src="V8-086-unfreezing-adapter-layers.png" class="img-fluid figure-img" alt="unfreezing-adapter-layers"></a></p>
<figcaption>unfreezing-adapter-layers</figcaption>
</figure>
</div>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V8-087-question.png" class="lightbox" data-gallery="quarto-lightbox-gallery-30" data-glightbox="description: .lightbox-desc-30" title="question"><img src="V8-087-question.png" class="img-fluid figure-img" alt="question"></a></p>
<figcaption>question</figcaption>
</figure>
</div>
<hr>
<img src="V8-088-fine-tuning.png" class="img-fluid" alt="fine-tuning"> You can see how fine tuning on a specific task could work even though you were pre-training on different tasks.
<hr>
</section>
<section id="video-9-glue-benchmark" class="level2">
<h2 class="anchored" data-anchor-id="video-9-glue-benchmark">Video 9: GLUE Benchmark</h2>
<img src="V9-090-GLUE-evaluation.png" class="img-fluid" alt="GLUE-evaluation"> General Language Understanding Evaluation (GLUE) is contains: * A collection used to train, evaluate, analyze natural language understanding systems * Datasets with different genres, and of different sizes and difficulties * Leaderboard Currently T5 is state of the art according to this GLUE benchmark and you will be implementing it for homework this week! This GLUE bench mark is used for research purposes, it is model agnostic, and relies on models that make use of transfer learning.
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V9-091-GLUE-tasks.png" class="lightbox" data-gallery="quarto-lightbox-gallery-31" data-glightbox="description: .lightbox-desc-31" title="GLUE-tasks"><img src="V9-091-GLUE-tasks.png" class="img-fluid figure-img" alt="GLUE-tasks"></a></p>
<figcaption>GLUE-tasks</figcaption>
</figure>
</div>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V9-092-GLUE.png" class="lightbox" data-gallery="quarto-lightbox-gallery-32" data-glightbox="description: .lightbox-desc-32" title="GLUE"><img src="V9-092-GLUE.png" class="img-fluid figure-img" alt="GLUE"></a></p>
<figcaption>GLUE</figcaption>
</figure>
</div>
<hr>
</section>
<section id="video-10question-answering" class="level2">
<h2 class="anchored" data-anchor-id="video-10question-answering">Video 10:Question Answering</h2>
<img src="V9-093-BERT-feed-forward-block.png" class="img-fluid" alt="BERT-feed-forward-block"> You will be implementing an encoder this week. Last week you implemented the decoder. So here it is:
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V9-094-BERT-encoder-Block.png" class="lightbox" data-gallery="quarto-lightbox-gallery-33" data-glightbox="description: .lightbox-desc-33" title="BERT-encoder-Block"><img src="V9-094-BERT-encoder-Block.png" class="img-fluid figure-img" alt="BERT-encoder-Block"></a></p>
<figcaption>BERT-encoder-Block</figcaption>
</figure>
</div>
<hr>
<p><img src="V9-095-BERT-blocks.png" class="img-fluid" alt="BERT-blocks"> You can see there is a feed forward and the encoder-block above. It makes use of two residual connections, layer normalization, and dropout.</p>
The steps you will follow to implement it are: - Load a pre-trained model - Process data to get the required inputs and outputs: “question: Q context: C” as input and “A” as target - Fine tune your model on the new task and input - Predict using your own model
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V9-096-q&amp;a-data-example.png" class="lightbox" data-gallery="quarto-lightbox-gallery-34" data-glightbox="description: .lightbox-desc-34" title="q&amp;a-data-example"><img src="V9-096-q&amp;a-data-example.png" class="img-fluid figure-img" alt="q&amp;a-data-example"></a></p>
<figcaption>q&amp;a-data-example</figcaption>
</figure>
</div>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V9-097-q&amp;a-with-t5.png" class="lightbox" data-gallery="quarto-lightbox-gallery-35" data-glightbox="description: .lightbox-desc-35" title="q&amp;a-with-t5"><img src="V9-097-q&amp;a-with-t5.png" class="img-fluid figure-img" alt="q&amp;a-with-t5"></a></p>
<figcaption>q&amp;a-with-t5</figcaption>
</figure>
</div>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V9-098-t5.png" class="lightbox" data-gallery="quarto-lightbox-gallery-36" data-glightbox="description: .lightbox-desc-36" title="t5"><img src="V9-098-t5.png" class="img-fluid figure-img" alt="t5"></a></p>
<figcaption>t5</figcaption>
</figure>
</div>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="V9-099-t5-question.png" class="lightbox" data-gallery="quarto-lightbox-gallery-37" data-glightbox="description: .lightbox-desc-37" title="t5-question"><img src="V9-099-t5-question.png" class="img-fluid figure-img" alt="t5-question"></a></p>
<figcaption>t5-question</figcaption>
</figure>
</div>
<hr>
</section>
<section id="programming-assignment-question-answering" class="level2">
<h2 class="anchored" data-anchor-id="programming-assignment-question-answering">Programming Assignment: Question Answering</h2>
</section>
<section id="lab-sentencepiece-and-bpe" class="level2">
<h2 class="anchored" data-anchor-id="lab-sentencepiece-and-bpe">Lab: SentencePiece and BPE</h2>
<section id="nfkc-normalization" class="level3">
<h3 class="anchored" data-anchor-id="nfkc-normalization">NFKC Normalization</h3>
<p>unicode normalization - for accents, diacritics and friends</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> unicodedata <span class="im">import</span> normalize</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>norm_eaccent <span class="op">=</span> normalize(<span class="st">'NFKC'</span>, <span class="st">'</span><span class="ch">\u00E9</span><span class="st">'</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>norm_e_accent <span class="op">=</span> normalize(<span class="st">'NFKC'</span>, <span class="st">'</span><span class="ch">\u0065\u0301</span><span class="st">'</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>norm_eaccent<span class="sc">}</span><span class="ss"> = </span><span class="sc">{</span>norm_e_accent<span class="sc">}</span><span class="ss"> : </span><span class="sc">{</span>norm_eaccent <span class="op">==</span> norm_e_accent<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="lossless-tokenization" class="level2">
<h2 class="anchored" data-anchor-id="lossless-tokenization">lossless tokenization</h2>
<p>To ensure this lossless tokenization it replaces white space with _ (U+2581).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>s_ <span class="op">=</span> s.replace(<span class="st">' '</span>, <span class="st">'</span><span class="ch">\u2581</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="sentencepiece" class="level3">
<h3 class="anchored" data-anchor-id="sentencepiece">SentencePiece</h3>
</section>
<section id="bpe" class="level3">
<h3 class="anchored" data-anchor-id="bpe">BPE</h3>
</section>
</section>
<section id="lab-bert-loss" class="level2">
<h2 class="anchored" data-anchor-id="lab-bert-loss">Lab: BERT Loss</h2>
</section>
<section id="lab-t5" class="level2">
<h2 class="anchored" data-anchor-id="lab-t5">Lab: T5</h2>
</section>
<section id="representation.-pdf-bib" class="level2">
<h2 class="anchored" data-anchor-id="representation.-pdf-bib">Representation. [pdf] [bib]</h2>
<ul>
<li><p>2017 fasttext Facebook CBOW</p>
<ul>
<li>morphological via sub words Algorithm of fasttext is based on these two papers:[8]
<ul>
<li>Enriching Word Vectors with Subword Information , Piotr Bojanowski, Edouard Grave, Armand Joulin and Tomas Mikolov, 2016</li>
<li>Bag of Tricks for Efficient Text Classification, Armand Joulin, Edouard Grave, Piotr Bojanowski, Tomas Mikolov, 2016</li>
</ul></li>
</ul></li>
<li><p>2018 ELMO Allen Institute for AI ELMo - Character based Bidirectional LSTM - Issue: long term dependency is weak due to vanishing gradient and information loss.</p></li>
<li><p>GPT Encoder only with left context</p></li>
<li><p>Bert uses</p></li>
<li><p>2020 T5 uses a label to specify task uses task specific bidirectional lstm to build the embeddings</p></li>
<li><p>BERT Decoder only Input Token embedding - the distributed representation of the tokens in one space S with Dim(S)=D</p>
<p>Segment embedding - because the model cannot tell the segment apart</p>
<p>Position embedding because the model cannot discriminate the word position. Note we are trying to mimic RNN behavior but we don’t have recursion: Note these are added - they all live in S. Question: would putting S and P in their own dimensions more interpretable. Questions: how do we know the model does not have embeddings that are similar to E_A and E_0 Output CLS - classification token SEP - separator token convert to embedding C is used for next sentence prediction T_i are used for masked word prediction T</p>
<p>Cross entropy loss + Binary loss</p>
<p>cross entropy loss to compare between two distribution from Softmax</p>
<p>binary loss - could use cross entropy on two cat. Pretraining before feeding data we mask 15% of the tokens. mask 80% of the time: training data generator chooses 15%. of these at random for prediction replace with: mask .8 of the time a random word .1 of the time original world otherwise.</p>
<p>a sentence may have multiple masks.</p>
<p>next sentence prediction also used in pre training. why/how (s1,s2) true/false</p>
<p>BERT_Base 12 layers 12 attention heads 110 million parameters</p></li>
</ul>
<p>Fine tuning BERT<br>
Fine tuning</p>
<p>T5 like BERT does Transfer learning + fine tuning. classification, MT, NE, Sentiment</p>
<pre><code>So you can see over here you have fully visible attention in the encoder and then causal attention in the decoder. 
And then you have the general encoder-decoder representation just as 
notation. 
So light gray lines correspond to causal masking. 
And dark gray lines correspond to the fully visible masking. 
So on the left as I said again, it's the standard encoder-decoder architecture. 
In the middle over here what we have, 
we have the language model which consists of a single transformer layer stack. 
And it's being fed the concatenation of the inputs and the target. 
So it uses causal masking throughout as you can see because they're 
all gray lines. 
And you have X1 going inside over here, get at X2, 
X2 goes into the model X3 and so forth. 
Now over here to the right, 
we have prefix language model which corresponds to allowing fully 
visible masking over the inputs as you can see here in the dark arrows. 
And then causal masking in the rest.
Play video starting at :3:2 and follow transcript3:02
So as you can see over here, it's doing causal masking. 
So the model architecture, it uses encoder/decoder stack. 
It has 12 transformer blocks each. 
So you can think of it as a dozen eggs and then 220 million parameters. 
So in summary, you've seen prefix language model attention. 
You've seen the model architecture for T5. 
And you've seen how the pre-training is done similar to birds, but 
we just use mask language modeling here.


encoder/decoder</code></pre>
<p>1212 transformer blocks 220 million parameters pre training 2^18 steps = 262144</p>
</section>
</section>
<section id="references" class="level1">
<h1>References:</h1>
<section id="tokenization" class="level2">
<h2 class="anchored" data-anchor-id="tokenization">Tokenization</h2>
<ol type="1">
<li><a href="https://www.aclweb.org/anthology/D18-2012.pdf">SentencePiece: A simple and language independent subword tokenizer and detokenizer for Neural Text Processing (Kudo &amp; Richardson 2018)</a> sub-word tokenization</li>
<li><a href="https://www.aclweb.org/anthology/P18-1007.pdf">Subword Regularization: Improving Neural Network Translation Models with Multiple Subword Candidates (Kudo 2018)</a> sub-word tokenization</li>
<li><a href="https://arxiv.org/pdf/1508.07909.pdf">Neural Machine Translation of Rare Words with Subword Units (Sennrich et all 2016)</a> sub-word tokenization</li>
<li><a href="https://www.tensorflow.org/tutorials/tensorflow_text/subwords_tokenizer">Subword tokenizers TF tutorial</a> sub-word tokenization</li>
<li>[https://blog.floydhub.com/tokenization-nlp/]</li>
<li><a href="https://arxiv.org/abs/1602.02215">Swivel: Improving Embeddings by Noticing What’s Missing (Shazeer, 2016)</a> ## Transformers</li>
<li><a href="https://arxiv.org/abs/1910.10683">Exploring the Limits of Transfer Learning with a Unified Text-to-Text Transformer</a> (Raffel et al, 2019)<br>
</li>
<li><a href="https://arxiv.org/abs/2001.04451">Reformer: The Efficient Transformer</a> (Kitaev et al, 2020)</li>
<li><a href="https://arxiv.org/abs/1706.03762">Attention Is All You Need</a> (Vaswani et al, 2017)</li>
<li><a href="https://arxiv.org/pdf/1802.05365.pdf">Deep contextualized word representations</a> (Peters et al, 2018)</li>
<li><a href="https://arxiv.org/abs/1810.04805">BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding</a> (Devlin et al, 2018)</li>
<li><a href="https://arxiv.org/abs/2103.13076" title="(Kasai et all 2021)">Finetuning Pretrained Transformers into RNNs</a> (Kasai et all 2021)</li>
<li><a href="http://jalammar.github.io/illustrated-transformer/">The Illustrated Transformer</a> (Alammar, 2018)</li>
<li><a href="http://jalammar.github.io/illustrated-gpt2/">The Illustrated GPT-2</a> (Alammar, 2019)</li>
<li><a href="http://jalammar.github.io/how-gpt3-works-visualizations-animations/">How GPT3 Works - Visualizations and Animations</a> (Alammar, 2020)</li>
<li><a href="https://lilianweng.github.io/lil-log/2018/06/24/attention-attention.html" title="Lilian Weng, 2018">Attention? Attention!</a> (Lilian Weng, 2018)</li>
<li><a href="https://lilianweng.github.io/lil-log/2020/04/07/the-transformer-family.html" title="(Lilian Weng, 2020)">The Transformer Family</a> (Lilian Weng, 2020)</li>
<li><a href="https://machinelearningmastery.com/teacher-forcing-for-recurrent-neural-networks/">Teacher forcing for RNNs</a> ### Question Answering Task:</li>
<li><a href="https://arxiv.org/pdf/1509.00685.pdf">Title (Author et al., Year)</a> note ## Links</li>
</ol>
<ul>
<li><a href="https://github.com/google/jax">Jax</a></li>
<li><a href="https://trax-ml.readthedocs.io/en/latest/index.html">Trax</a></li>
<li><a href="https://gitter.im/trax-ml/community">Trax community</a> on Gitter</li>
<li><a href="https://github.com/abisee/cnn-dailymail">CNN daily mail dataset</a></li>
</ul>
<p>Lei Mao Machine Learning, Artificial Intelligence, Computer Science. [Byte Pair Encoding (Lei Mao 2021)] (https://leimao.github.io/blog/Byte-Pair-Encoding/) videos: Q&amp;A <iframe width="560" height="315" src="https://www.youtube.com/embed/yIdF-17HwSk?start=223" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> Subword tokenizers <iframe width="560" height="315" src="https://www.youtube.com/embed/hAvtJ516Mw4?start=223" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> Swivel Embeddings https://youtu.be/hAvtJ516Mw4</p>


<div class="hidden" aria-hidden="true">
<span class="glightbox-desc lightbox-desc-1">tl</span>
<span class="glightbox-desc lightbox-desc-2">classical-training</span>
<span class="glightbox-desc lightbox-desc-3">transfer-learning</span>
<span class="glightbox-desc lightbox-desc-4">tl-general-purpose</span>
<span class="glightbox-desc lightbox-desc-5">tl-fine-tuning</span>
<span class="glightbox-desc lightbox-desc-6">tl-pretain-data-performance</span>
<span class="glightbox-desc lightbox-desc-7">tl-pretain-data-supervision</span>
<span class="glightbox-desc lightbox-desc-8">tl-pretain-unsupervised</span>
<span class="glightbox-desc lightbox-desc-9">tl-pretrain-selfsupervised</span>
<span class="glightbox-desc lightbox-desc-10">tl-pretrain-selfsupervised</span>
<span class="glightbox-desc lightbox-desc-11">tl-summary</span>
<span class="glightbox-desc lightbox-desc-12">outline</span>
<span class="glightbox-desc lightbox-desc-13">CBOW-issues</span>
<span class="glightbox-desc lightbox-desc-14">multi-mask</span>
<span class="glightbox-desc lightbox-desc-15">BERT-pre-training</span>
<span class="glightbox-desc lightbox-desc-16">question</span>
<span class="glightbox-desc lightbox-desc-17">BERT-question</span>
<span class="glightbox-desc lightbox-desc-18">BERT</span>
<span class="glightbox-desc lightbox-desc-19">BERT-spec</span>
<span class="glightbox-desc lightbox-desc-20">BERT-pre-training</span>
<span class="glightbox-desc lightbox-desc-21">BERT-summary</span>
<span class="glightbox-desc lightbox-desc-22">summary</span>
<span class="glightbox-desc lightbox-desc-23">t5-text-to-text</span>
<span class="glightbox-desc lightbox-desc-24">T5-architecture</span>
<span class="glightbox-desc lightbox-desc-25">T5-summary</span>
<span class="glightbox-desc lightbox-desc-26">io-format</span>
<span class="glightbox-desc lightbox-desc-27">multi-task-training</span>
<span class="glightbox-desc lightbox-desc-28">data-training-strategy</span>
<span class="glightbox-desc lightbox-desc-29">unfreezing-adapter-layers</span>
<span class="glightbox-desc lightbox-desc-30">question</span>
<span class="glightbox-desc lightbox-desc-31">GLUE-tasks</span>
<span class="glightbox-desc lightbox-desc-32">GLUE</span>
<span class="glightbox-desc lightbox-desc-33">BERT-encoder-Block</span>
<span class="glightbox-desc lightbox-desc-34">q&amp;a-data-example</span>
<span class="glightbox-desc lightbox-desc-35">q&amp;a-with-t5</span>
<span class="glightbox-desc lightbox-desc-36">t5</span>
<span class="glightbox-desc lightbox-desc-37">t5-question</span>
</div>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div>CC SA BY-NC-ND</div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2021,
  author = {Bochman, Oren},
  title = {NLP with {Attention} {Models} {Week} 3 {Question}
    {Answering}},
  date = {2021-04-14},
  url = {https://orenbochman.github.io/blog//notes/deeplearning.ai-nlp-c4/2021-04-14-deeplearning.ai-nlp-c4w3/2021-04-14-deeplearning.ai-nlp-c4w3.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2021" class="csl-entry quarto-appendix-citeas" role="listitem">
Bochman, Oren. 2021. <span>“NLP with Attention Models Week 3 Question
Answering.”</span> April 14, 2021. <a href="https://orenbochman.github.io/blog//notes/deeplearning.ai-nlp-c4/2021-04-14-deeplearning.ai-nlp-c4w3/2021-04-14-deeplearning.ai-nlp-c4w3.html">https://orenbochman.github.io/blog//notes/deeplearning.ai-nlp-c4/2021-04-14-deeplearning.ai-nlp-c4w3/2021-04-14-deeplearning.ai-nlp-c4w3.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("^(?:http:|https:)\/\/www\.quarto\.org\/custom");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="OrenBochman/blogComments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 Copyright 2024, Oren Bochman
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../../about.html">
<p>About</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../../license.html">
<p>License</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../../trademark.html">
<p>Trademark</p>
</a>
  </li>  
</ul>
    <div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"selector":".lightbox","openEffect":"zoom","loop":false,"descPosition":"bottom","closeEffect":"zoom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>