---
date: 2021-09-14
title: Customer Life time value Models
subtitle: CLV and Buy Till You Drop Models
description: "Customer Lifetime Value (CLV) models and Buy Till You Drop (BTYD) models are used to estimate the total value a customer brings to a business over their entire relationship. These models help businesses make informed decisions about customer acquisition, retention, and marketing strategies."
fig-caption: # Marketing Research models
categories: [PPC, data science, digital marketing, quantitative marketing, intelligence] 
keywords: [CLV, BTYD, Pareto/NBD, BG/NBD, customer lifetime value, churn prediction, retention strategies, customer segmentation, predictive analytics]
bibliography: references.bib
resources: 
    - fader2005counting.pdf
    - Schmittlein1987Counting.pdf
---

![](chaotic-time-series.jpg){.column-margin}

## CLV and Buy Till You Die/Drop/Defect (BTYD) Models

Many firms interested in estimating customer lifetime value (CLV) which can be used to decide to qualify or sell a lead, set ranges for PPC campaigns, decide about retention interventions to deter churn etc. Pareto/NBD BTYD model considers repeat-buying behavior in settings where customer churn is not directly observed and assumes customers buy at a randomly at a steady rate until they churn.

-  Time to churn is modelled using the Pareto (exponential-gamma mixture) timing model.

- Repeat-buying behavior while active is modelled using the NBD (Poisson-gamma mixture) counting model. 

The frame work termed "counting your customer" seems to be more about counting the the customer's consumption rather then the customers. 


## Pareto/NBD BTYD model

This is a model from [@Schmittlein1987Counting]

This article is concerned with counting and identifying those customers who are still active. 

The issue is important in at least three settings: 
- monitoring the size and growth rate of a firm's ongoing customer base, 
- evaluating a new product's success based on the pattern of trial and repeat purchases, and 
- targeting a subgroup of customers for advertising and promotions. 

We develop a model based on the number and timing of the customers' previous transactions. This approach allows computation of the probability that any particular customer is still active.

### The behavioral story

- Each customer buys according to a Poisson process until they "die," with heterogeneity across customers in both buying rate and lifetime. 


The model is built on two latent processes for each customer:

1. **Purchasing process (buying while alive):**

   * Each customer  makes repeat transactions according to a **Poisson process** with rate parameter $\lambda$.
   * Different customers have different $\lambda$ values, drawn from a **Gamma distribution**.
   * ‚áí Across customers, this creates a **negative binomial distribution** of transactions (hence "NBD").

2. **Dropout process (becoming inactive / "death"):**

   * Each customer has a dropout probability modeled as an **exponential lifetime** with dropout rate $\mu$.
   * Different customers have different $\mu$ values, drawn from another **Gamma distribution**.
   * ‚áí Survival times are heterogeneous across the population (hence "Pareto").

3. **Observed data:**

   * For each customer, we see the history of transactions up to a calibration window.
   * What we don't see is whether the customer is alive or has already dropped out ‚Äî the model infers this.

So:

* While alive, purchases follow a Poisson process.
* The lifetime of activity follows an exponential process.
* Across customers, heterogeneity in both processes is captured via Gamma distributions.
* Hence, the **Pareto/NBD**.

---

### Hierarchical Model Specification

For customer $i$:

1. **Transaction process (Poisson-Gamma ‚Üí Negative Binomial):**

$$
y_{i}(t) \mid \lambda_i, \, \text{alive} \sim \text{Poisson}(\lambda_i t)
$$

$$
\lambda_i \sim \text{Gamma}(r, \alpha)
$$

2. **Dropout process (Exponential-Gamma ‚Üí Pareto):**

$$
T_i \mid \mu_i \sim \text{Exponential}(\mu_i)
$$

$$
\mu_i \sim \text{Gamma}(s, \beta)
$$

3. **Joint prior (independence across processes):**

$$
p(\lambda_i, \mu_i) = p(\lambda_i) \, p(\mu_i)
$$

4. **Observed data:**
   For each customer, we observe:

   * $x\_i$: number of repeat transactions in calibration period,
   * $t\_{x,i}$: time of last transaction,
   * $T\_i$: length of calibration period.

5. **Posterior inference:**

   * From $(x\_i, t\_{x,i}, T\_i)$, we update beliefs about whether $i$ is still active.
   * We can compute:

     * Probability that customer is still alive.
     * Expected future transactions.
     * CLV (Customer Lifetime Value).

---

‚úÖ In short:


* **Hierarchical model:** Poisson with Gamma heterogeneity for buying, Exponential with Gamma heterogeneity for dropout, yielding the Pareto/NBD mixture.





## beta-geometric/NBD

In [@fader2005counting] the authors developed a new model, the beta-geometric/NBD (BG/NBD), which represents a slight variation in the behavioral "story" associated with the Pareto/NBD but is vastly easier to implement.


### Pareto/NBD BTYD model Assumptions

1. While active, the number of transactions made by a customer in a time period of length $t$ is distributed Poisson with transaction rate $\lambda$. This is equivalent to assuming that the time between transactions is distributed exponential with transaction rate $\lambda$.
2. **Heterogeneity** in transaction rates across customers follows a $\Gamma(r,\alpha)$ where $r$ is the shape parameter $\alpha$ is the scale parameter.
3. Each customer has an unobserved "lifetime" of length $\tau$. This point at which the customer becomes inactive is distributed exponential with dropout rate $\mu$.
4. Heterogeneity in dropout rates across customers follows a $\Gamma(r,\beta)$ distribution with shape parameter $s$ and scale parameter $\beta$.
5. The transaction rate $\lambda$ and the dropout rate $\mu$ vary independently across customers.

In practice parameter estimation is difficult and so BG/NBD was proposed as a "drop in" replacement.

###  BG/NBD model and beta-geometric/NBD (BG/NBD),

1. While active, the number of transactions made by a customer follows a Poisson process with transaction rate $\lambda$ follows a gamma distribution.
3. After any transaction, a customer becomes inactive with probability p. Therefore the point at which the customer ‚Äúdrops out‚Äù is distributed across transactions according to a (shifted) geometric distribution with pmf.
4. Heterogeneity in p follows a beta distribution.

### Intuition from [SO](https://stats.stackexchange.com/questions/251506/is-it-possible-to-understand-pareto-nbd-model-conceptually)

Imagine you're the newly appointed manager of a flower shop. You've got a record of last year's customers ‚Äì the frequency with which they shop and how long since their last visit. You want to predict how much business the listed customers are likely to bring in this year. There are a few things to consider:

1. Customers have different shopping habits.
Some people like having fresh flowers all the time, while others only by them on special occasions. It makes more sense to have a distribution for the transaction rate $\lambda$, rather than assuming that a single $\lambda$ explains everyone‚Äôs behavior.
The distribution needs to have few parameters, to be fairly flexible, and to take values in the positive real numbers. The Gamma distribution ticks all of those boxes, and is well-studied and relatively easy to work with. It‚Äôs often used as a prior for positive parameters in different settings.
2. You may have lost some of the customers on the list.
If Andrea has bought flowers about once a month every month in the last year, it‚Äôs a fairly safe bet she‚Äôll be returning this year. If Ben used to buy flowers weekly, but he hasn‚Äôt been around for months, then maybe he‚Äôs found a different flower shop. In making future business plans, you might want to count on Andrea but not on Ben.
Customers won‚Äôt tell you when they‚Äôve moved on, which is where the "unobserved lifetime" assumption kicks in for both models. Imagine a third customer, Cary. The Pareto/NBD and BG/NBD models give you two different ways to think about Cary dropping out of the shop for good.
For the Pareto/NBD case, imagine that at any point in time, there is a small chance that Cary might come across a better shop than yours. This constant infinitesimal risk gives you the exponential lifetime ‚Äì and the longer it‚Äôs been since Cary‚Äôs last visit, the longer he‚Äôs been exposed to other (potentially better) flower shops.
The BG/NBD case is a little more contrived. Every time Cary arrives in your shop, he‚Äôs committed to buying some flowers. While browsing, he‚Äôll consider the changes in price, quality and variety since his last visit, and that will ultimately make him decide whether to come back again next time, or look for another shop. So rather than being constantly at risk, Cary has some probability p of just deciding to leave after each purchase.
3. Not all customers are equally committed to your shop.
Some customers are regulars, and only death ‚Äì or a sharp price increase ‚Äì will force them to leave. Others might like to explore, and would happily leave you for the sake of the new hipster flower shop across the street. Rather than a single drop-out rate for all customers, it makes more sense to have a distribution of drop-out rates (or probabilities in the BG/NBD case).
This works very much in the same vein as the shopping habits. We‚Äôre after a flexible, well-established distribution with few parameters. In the Pareto/NBD case we use a Gamma, since the rate ùúá is in the positive real numbers. In the BG/NBD case we use a Beta, which is the standard prior for parameters in (0;1).


