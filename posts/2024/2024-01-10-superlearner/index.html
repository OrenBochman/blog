<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.34">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Oren Bochman">
<meta name="description" content="SuperLearner is an ensambeleing library.">

<title>SuperLearner – Oren Bochman’s Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../posts/2024/2024-03-31-sugarscapes/index.html" rel="next">
<link href="../../../posts/2024/2023-02-16-learing-goals/index.html" rel="prev">
<link href="../../../favicon.ico" rel="icon">
<script src="../../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-c8ad9e5dbd60b7b70b38521ab19b7da4.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-befe23ebd2f54d8af2c8a89d1a1611f1.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-c8ad9e5dbd60b7b70b38521ab19b7da4.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-cd2c15051e4e380d82a3a6bf6e2d0429.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-a4771ea619ace3379c9f2bf9b3b10453.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-cd2c15051e4e380d82a3a6bf6e2d0429.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="../../../site_libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.js"></script>
<link href="../../../site_libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.css" rel="stylesheet">
<script src="../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-GYZ17VPVEJ"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-GYZ17VPVEJ', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"headline",
  "consent_type":"express",
  "palette":"dark",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  
<style>html{ scroll-behavior: smooth; }</style>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean",
  "openSidebar": false
}
</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css" integrity="sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP" crossorigin="anonymous">
<script>
  window.WebFontConfig = {
    custom: {
      families: ['KaTeX_AMS', 'KaTeX_Caligraphic:n4,n7', 'KaTeX_Fraktur:n4,n7',
        'KaTeX_Main:n4,n7,i4,i7', 'KaTeX_Math:i4,i7', 'KaTeX_Script',
        'KaTeX_SansSerif:n4,n7,i4', 'KaTeX_Size1', 'KaTeX_Size2', 'KaTeX_Size3',
        'KaTeX_Size4', 'KaTeX_Typewriter'],
    },
  };
</script>
<script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js" integrity="sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6" crossorigin="anonymous"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>


<meta name="twitter:title" content="SuperLearner – Oren Bochman’s Blog">
<meta name="twitter:description" content="SuperLearner is an ensambeleing library.">
<meta name="twitter:image" content="https://orenbochman.github.io//images/calabi_yau_manifold.png">
<meta name="twitter:creator" content="@orenbochman">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="1024">
<meta name="twitter:image-width" content="1024">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../images/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Oren Bochman’s Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/orenbochman"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/OrenBochman/blog">
 <span class="dropdown-text">Source Code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/OrenBochman/blog/issues">
 <span class="dropdown-text">Report a Bug</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="../../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../archive.html"> <i class="bi bi-archive" role="img">
</i> 
<span class="menu-text">Archive</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../index.html">Posts</a></li><li class="breadcrumb-item">Posts</li><li class="breadcrumb-item"><a href="../../../posts/2024/2024-10-11-EGG/index.html">2024</a></li><li class="breadcrumb-item"><a href="../../../posts/2024/2024-01-10-superlearner/index.html">SuperLearner</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../index.html">Posts</a></li><li class="breadcrumb-item">Posts</li><li class="breadcrumb-item"><a href="../../../posts/2024/2024-10-11-EGG/index.html">2024</a></li><li class="breadcrumb-item"><a href="../../../posts/2024/2024-01-10-superlearner/index.html">SuperLearner</a></li></ol></nav>
      <div class="quarto-title-block"><div><h1 class="title">SuperLearner</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                  <div>
        <div class="description">
          SuperLearner is an ensambeleing library.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">demos</div>
                <div class="quarto-category">code</div>
                <div class="quarto-category">r</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Oren Bochman </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Wednesday, January 10, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true"><i class="bi bi-book" role="img">
</i> 
 <span class="menu-text">Notes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://orenbochman.github.io/notes-bayes/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Specialization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://orenbochman.github.io/notes-rl/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reinforcement Learning Specialization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://orenbochman.github.io/notes-model-thinking/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model Thinking</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://orenbochman.github.io/notes-nlp" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NLP Specialization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://orenbochman.github.io/notes-ab-testing" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AB testing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-substack" role="img">
</i> 
 <span class="menu-text">Posts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Posts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">2011</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2011/2011-11-29-npl-python/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text Mining With Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2011/2011-11-29-tidy-text-mining-with-r/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tidy Text Mining With R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2011/2011-11-29-text-mining-with-r/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text Mining With R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2011/2011-08-11-time-management/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Time management Tips</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">2012</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2012/2012-07-26-wikisym-2012_files/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Wikisym 2012</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">2013</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2013/2013-06-07-lifehacks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">life hacks</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false">
 <span class="menu-text">2014</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false">
 <span class="menu-text">2014 10 06 FinTech</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth4 ">  
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false">
 <span class="menu-text">2015</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false">
 <span class="menu-text">2015 02 07 Analytics Checklist</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2015/2015-02-07-analytics-checklist/2015-02-07-analytics-checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analytics Checklist</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false">
 <span class="menu-text">2015 02 07 Optimal Bidding</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth4 ">  
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false">
 <span class="menu-text">2015 04 20 All Things Data</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2015/2015-04-20-all-things-data/2015-04-20-hotjar-heat-map-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HotJar Heat Map Analysis - Dr.&nbsp;David Darmanin</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2015/2015-04-20-all-things-data/2015-04-20-organizational-culture-of-analytics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using Competitive Analysis to Benchmark Your Marketing Efforts Ariel Rosenstein - Similar Web</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2015/2015-04-20-all-things-data/2015-04-20-using-competitive-analysis-to-benchmark Your-Marketing-Efforts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using Competitive Analysis to Benchmark Your Marketing Efforts - Ariel Rosenstein - Similar Web</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="false">
 <span class="menu-text">2016</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2016/2016-12-14-Travel-checklist/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Travel checklist</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" role="navigation" aria-expanded="false">
 <span class="menu-text">2017</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-14" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2017/2017-07-30-experimental-design/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A/B testing cost and risks?</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" role="navigation" aria-expanded="false">
 <span class="menu-text">2018</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-15" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2018/2018-01-16-BRAT/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">text annotation with BRAT</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-16" role="navigation" aria-expanded="false">
 <span class="menu-text">2019</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-16" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-16" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2019/2019-11-24-keys-to-the-kingdom-extracting-api-keys-from-a-json-file-with-jq/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Docker for data science</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2019/2019-07-31-Exploding-and-vanishing-nodes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exploding and vanishing nodes.</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-17" role="navigation" aria-expanded="false">
 <span class="menu-text">2020</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-17" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-17" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2020/2020-06-12-bash-tricks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">brace expansion</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2020/2020-03-04-pandas-challanges/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pandas Productivity Challenge?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2020/2020-02-20-avoid-cross-site-scriptin-errors-with-a-Jupyter-local-runtime/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to avoid cross site scripting (XSS) errors with the Jupyter local runtime for Colab</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2020/2020-11-29-numpy-meltdown/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">numpy melt down</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2020/2020-12-30-meme-bank/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Meme bank</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2020/2020-10-25-deep-learning-relu-intutions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deep Learning Intuitions</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-18" role="navigation" aria-expanded="false">
 <span class="menu-text">2021</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-18" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-18" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-10-15-storytelling-and-other-essentials/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Storytelling and other essentials</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-05-29-djvu-to-pdf/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ebook Hacks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-04-09-modeling-events/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modeling Events</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-09-16-python-graphs/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python Graphs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-09-10-clv-models-1/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Customer Lifetime Value - Pareto/NBD (BTYD) Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-08-13-hackathon-notes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hackathon session link dumps &amp; notes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-09-27-getting-more-from-your-agency/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting more from your agency ?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-08-18-transfer-learning-nlp/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transfer learning in NLP</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-09-22-what-is-in-a-citation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">What is in a citation?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-07-14-type-witness-evolving-idiom/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A type of Witness and an evolving Idiom</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-04-07-ten-tips-to-improve-your-workflow/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10 Tips To Improve Your Workflow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-06-10-layout-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TensorFlow probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-04-27-wingrad-schema/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Q&amp;A and the Winograd schemas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-11-12-language-models-and-explainability/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Language models and explainability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-09-24-statistics-for-marketing-in-python/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Excel 2019 for Marketing Statistics in pandas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-04-25-bayesian-agent/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian agents</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-05-16-mulitlevel-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multilevel Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-09-09-advertising-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advertising Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-08-13-inlining-citations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Inlining Citations for Wikipedia articles</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-04-24-summerization/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Summarization Task</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-09-08-wave-net-review/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">WaveNet</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-07-01-json-ld/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">json-ld</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-19" role="navigation" aria-expanded="false">
 <span class="menu-text">2021 12 07 Attention for Sensor Fusion</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-19" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-19" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2021/2021-12-07-attention-for-sensor-fusion/2021-12-07-attention-for-sensor-fusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Attention for sensor fusion</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-20" role="navigation" aria-expanded="false">
 <span class="menu-text">2022</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-20" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-20" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2022/2022-03-05-m1/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Set Up M1 MacBooks for DS &amp; ML</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2022/2022-09-12-robust-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Robust Regression</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-21" role="navigation" aria-expanded="false">
 <span class="menu-text">2022 04 01 Bandits</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-21" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-21" class="collapse list-unstyled sidebar-section depth4 ">  
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-22" role="navigation" aria-expanded="false">
 <span class="menu-text">2022 05 05 Command Line</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-22" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-22" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2022/2022-05-05-command_line/2022-05-05-command_line.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">command line</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-23" role="navigation" aria-expanded="false">
 <span class="menu-text">2022 09 16 Adaptive Learning Rate</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-23" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-23" class="collapse list-unstyled sidebar-section depth4 ">  
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-24" role="navigation" aria-expanded="false">
 <span class="menu-text">2022 09 16 Loss Engineering</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-24" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-24" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2022/2022-09-16-loss-engineering/2022-09-16-loss-engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loss engineering and uncertainty for multi-task learning</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-25" role="navigation" aria-expanded="false">
 <span class="menu-text">2022 09 22 Entropy for Uncertainty Quantification</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-25" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-25" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2022/2022-09-22-entropy_for_uncertainty_quantification/2022-09-22-entropy_for_uncertainty_quantification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">entropy for uncertainty quantification</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-26" role="navigation" aria-expanded="false">
 <span class="menu-text">2023</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-26" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-26" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2023/2023-04-11-quarto-loves-psudocode/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto loves pseudocode</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2023/2023-12-20-autogluon/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoGluon Cheetsheets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2023/2023-05-10-migration-notes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Great Migration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2023/2023-04-22-mcmc-algs/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MCMC algorithms</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-27" role="navigation" aria-expanded="false">
 <span class="menu-text">2023 02 01 Ds from Scratch</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-27" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-27" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2023/2023-02-01-ds-from-scratch/ols-regression-from-scratch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">OLS regression From Scratch</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-28" role="navigation" aria-expanded="false">
 <span class="menu-text">2023 02 20 Ts Nonlinear</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-28" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-28" class="collapse list-unstyled sidebar-section depth4 ">  
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-29" role="navigation" aria-expanded="false">
 <span class="menu-text">2023 02 28 NLP.IL Booking.com</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-29" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-29" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2023/2023-02-28-NLP.IL-Booking.com/NLP-IL-Booking Text2Topic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text2topic Leverage reviews data for multi-label topics classification in Booking.com</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2023/2023-02-28-NLP.IL-Booking.com/NLP-IL-Booking Validating NLP.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Validating NLP data and models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-30" role="navigation" aria-expanded="false">
 <span class="menu-text">2023 03 01 Braindump</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-30" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-30" class="collapse list-unstyled sidebar-section depth4 ">  
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-31" role="navigation" aria-expanded="false">
 <span class="menu-text">2023 03 01 Spark Emr</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-31" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-31" class="collapse list-unstyled sidebar-section depth4 ">  
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-32" role="navigation" aria-expanded="false">
 <span class="menu-text">2023 03 08 Responsible AI</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-32" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-32" class="collapse list-unstyled sidebar-section depth4 ">  
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-33" role="navigation" aria-expanded="false">
 <span class="menu-text">2023 06 01 Spark</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-33" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-33" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2023/2023-06-01-spark/spark-progress.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spark Tips</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-34" role="navigation" aria-expanded="false">
 <span class="menu-text">2023 06 01 Synthesis and Stabilization</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-34" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-34" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2023/2023-06-01-Synthesis-and-Stabilization/2023-06-01-Synthesis-and-Stabilization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary: Synthesis and Stabilization of Complex Behaviors through Online Trajectory Optimization</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-35" role="navigation" aria-expanded="false">
 <span class="menu-text">S3 Series</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-35" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-35" class="collapse list-unstyled sidebar-section depth4 ">  
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-36" role="navigation" aria-expanded="true">
 <span class="menu-text">2024</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-36" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-36" class="collapse list-unstyled sidebar-section depth3 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-06-11-risk-constrained-MDP/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Risk-constrained Markov decision processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-02-12-mermaid-mindmap/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">😁 Quarto 💖 Mermaid🧜 Mindmaps 🧠</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-05-06-bayesian-perspective/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lewis Game from a Bayesian Perspective</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-10-10-marco-baoni-composionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Is compositionality overrated? The view from language emergence</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-07-01-generalization-in-ML/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">two ideas on generalization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-04-04-rad-repl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RAD REPL</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-06-11-more-sugar-please/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">More Sugar please</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-02-12-post-with-code/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Post With Code</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-05-02-Shanon-Game/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shannon Game</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-12-12-the-valentines-day-massacre/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Villeny pure and simple</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-03-31-mesa-lessons/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mesa Lessons</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2023-03-16-events-generator/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">event generator</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-10-10-lewis-petting-zoo/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lewis Signaling Game for PettingZoo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-05-07-signaling-experiment/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Signals Experiment</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-10-01-topological-alignment/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TL-DR rethinking 💭 topological alignment</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-01-04-understanding-emergent-languages/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Understanding Emergent Languages</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-09-28-missing-link/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">LLM and the missing link</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-02-28-ocr-bd/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">OCR - Brain Dump</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-05-05-complex-signal/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ad hoc complex signaling systems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-09-27-NLP-RL/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NLP with RL</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-02-22-transformations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transformations in Linguistic Representation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-06-18-readings-in-rl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">readings in rl</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-01-02-d3/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">D3.js in in Quarto Observable</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-02-28-ocr/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">OCR building blocks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-09-26-deduction-evaluation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deduction Evaluation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-09-25-readability/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fine-tune llm for Style and Grammar advice.</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-05-12-Evolutionary-games-and-population-dynamics/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Evolutionary Games and Population Dynamics Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-01-10-superlearner/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">SuperLearner</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-03-31-sugarscapes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sugar Scapes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-09-30-LLMs/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">LLM the good the bad and the ugly</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-08-26-six-quick-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Six quick tips to improve modeling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-10-11-Vitter-alg/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vitter’s Algorithm</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-08-08-TS-with-Stumpy/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Stumpy</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-03-03-a-definition-by-p-winston/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A definition by Patrick Henry Winston</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-07-02-replay-buffer-questions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">replay buffer questions</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-37" role="navigation" aria-expanded="false">
 <span class="menu-text">2024 02 01 Quarto Bootstrap</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-37" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-37" class="collapse list-unstyled sidebar-section depth4 ">  
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-38" role="navigation" aria-expanded="false">
 <span class="menu-text">2024 02 19 Rhetoric</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-38" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-38" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-02-19-rhetoric/rhetoric-ideas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Rhetoric NLP Tasks</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-39" role="navigation" aria-expanded="false">
 <span class="menu-text">2024 05 02 Signaling Games Tikz</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-39" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-39" class="collapse list-unstyled sidebar-section depth4 ">  
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-40" role="navigation" aria-expanded="false">
 <span class="menu-text">2024 05 03 Urn Models</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-40" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-40" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-05-03-urn-models/urn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Urn models using Numpy</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-41" role="navigation" aria-expanded="false">
 <span class="menu-text">2024 05 04 Signals Bib</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-41" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-41" class="collapse list-unstyled sidebar-section depth4 ">  
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-42" role="navigation" aria-expanded="false">
 <span class="menu-text">2024 05 09 Roth Erev RL</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-42" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-42" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-05-09-Roth-Erev-RL/re-rel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Roth Erev learning in Lewis signaling games</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-43" role="navigation" aria-expanded="false">
 <span class="menu-text">2024 06 01 Bayesian Agents</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-43" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-43" class="collapse list-unstyled sidebar-section depth4 ">  
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-44" role="navigation" aria-expanded="false">
 <span class="menu-text">2024 06 12 Logic Puzzles</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-44" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-44" class="collapse list-unstyled sidebar-section depth4 ">  
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-45" role="navigation" aria-expanded="false">
 <span class="menu-text">2024 06 13 Hyper</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-45" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-45" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-06-13-hyper/2024-06-13-hyper.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hyperparameter Optimization</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-46" role="navigation" aria-expanded="false">
 <span class="menu-text">2024 06 23 Zero Inflated Data</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-46" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-46" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-06-23-zero-inflated-data/2024-06-23-zero-inflated-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">zero inflated data</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-47" role="navigation" aria-expanded="false">
 <span class="menu-text">2024 06 25 Mesa Rl</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-47" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-47" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-06-25-mesa-rl/mesa-rl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mesa &amp; RL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../posts/2024/2024-11-28-misbahaviour-of-markets/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Misbehavior of Markets and Scaling in financial prices 1-4</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-48" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-48" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-11-28-misbahaviour-of-markets/part1/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Scaling in financial prices 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-11-28-misbahaviour-of-markets/part4/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Scaling in financial prices 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-11-28-misbahaviour-of-markets/part3/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Scaling in financial prices 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2024/2024-11-28-misbahaviour-of-markets/part2/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Scaling in financial prices 2</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-49" role="navigation" aria-expanded="false">
 <span class="menu-text">2025</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-49" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-49" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2025/2025-01-11-a-garden-of-forking-paths/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A garden of forking paths</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2025/2025-09-26-vibe-coding/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vibe coding GPT5 Edition</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2025/2025-01-02-rethinking-signaling-systems/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Rethinking Signaling systems via the lens of compositionality</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2025/2025-01-10-Engineering-RL-Algs/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Engineering Reinforcement Learning Algorithms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2025/2025-04-03-langtalks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Langtalks Resources # 43</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2025/2025-01-04-off-policy-learning/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Off-Policy Learning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2025/2025-03-09-referential-lewis-game/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Referential Lewis Signaling Game</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2025/2025-10-02-Shiny-Mesa-Tutorial/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ShinyLive ❤️ Mesa Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2025/2025-04-02-a-morphology/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Base line Morphology Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2025/2025-01-06-research-notes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Complex Signals Questions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2025/2025-03-11-partial-pooling/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The roles of Partial pooling and mixed strategies in the Lewis signaling game</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2025/2025-10-04-Bag-Of-Tricks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AI a bag of tricks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2025/2025-03-09-planning-in-complex-lewis-game/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Planning in the Complex Lewis Game</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2025/2025-01-01-books/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Books, Courses Tools</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2025/2025-01-14-Desiderata-for-Emergent-Languages/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Emergent Languages</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2025/2025-04-02-research-questions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Research Questions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2025/2025-10-01-Updates-to-the-github-action/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Updates to the github action</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../posts/2025/2025-01-05-bifurcating-paths-to-signaling/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Many Path To A Signaling System</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-50" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-50" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../posts/2025/2025-01-05-bifurcating-paths-to-signaling/podcast.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Podcast</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setup-dataset" id="toc-setup-dataset" class="nav-link active" data-scroll-target="#setup-dataset">Setup dataset</a></li>
  <li><a href="#review-available-models" id="toc-review-available-models" class="nav-link" data-scroll-target="#review-available-models">Review available models</a></li>
  <li><a href="#fit-individual-models" id="toc-fit-individual-models" class="nav-link" data-scroll-target="#fit-individual-models">Fit individual models</a></li>
  <li><a href="#fit-multiple-models" id="toc-fit-multiple-models" class="nav-link" data-scroll-target="#fit-multiple-models">Fit multiple models</a></li>
  <li><a href="#predict-on-new-data" id="toc-predict-on-new-data" class="nav-link" data-scroll-target="#predict-on-new-data">Predict on new data</a></li>
  <li><a href="#fit-ensemble-with-external-cross-validation" id="toc-fit-ensemble-with-external-cross-validation" class="nav-link" data-scroll-target="#fit-ensemble-with-external-cross-validation">Fit ensemble with external cross-validation</a>
  <ul class="collapse">
  <li><a href="#customize-a-model-hyperparameter" id="toc-customize-a-model-hyperparameter" class="nav-link" data-scroll-target="#customize-a-model-hyperparameter">Customize a model hyperparameter</a></li>
  <li><a href="#test-algorithm-with-multiple-hyperparameter-settings" id="toc-test-algorithm-with-multiple-hyperparameter-settings" class="nav-link" data-scroll-target="#test-algorithm-with-multiple-hyperparameter-settings">Test algorithm with multiple hyperparameter settings</a></li>
  <li><a href="#weight-distribution-for-superlearner" id="toc-weight-distribution-for-superlearner" class="nav-link" data-scroll-target="#weight-distribution-for-superlearner">Weight distribution for SuperLearner</a></li>
  <li><a href="#feature-selection-screening" id="toc-feature-selection-screening" class="nav-link" data-scroll-target="#feature-selection-screening">Feature selection (screening)</a></li>
  <li><a href="#optimize-for-auc" id="toc-optimize-for-auc" class="nav-link" data-scroll-target="#optimize-for-auc">Optimize for AUC</a></li>
  <li><a href="#xgboost-hyperparameter-exploration" id="toc-xgboost-hyperparameter-exploration" class="nav-link" data-scroll-target="#xgboost-hyperparameter-exploration">XGBoost hyperparameter exploration</a></li>
  <li><a href="#troubleshooting" id="toc-troubleshooting" class="nav-link" data-scroll-target="#troubleshooting">Troubleshooting</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">






<p>This is a SuperLearner demo.</p>
<p>SuperLearner is an ensambeleing library.</p>
<p>This page is taken out of the documentation</p>
<section id="setup-dataset" class="level2">
<h2 class="anchored" data-anchor-id="setup-dataset">Setup dataset</h2>
<div class="cell">
<div id="lst-mass-data-set" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-mass-data-set-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;1: dataset setup
</figcaption>
<div aria-describedby="lst-mass-data-set-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(c("SuperLearner","caret", "glmnet", "randomForest", "ggplot2", "RhpcBLASctl","xgboost","ranger"))</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Boston, <span class="at">package =</span> <span class="st">"MASS"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>?MASS<span class="sc">::</span>Boston  <span class="co"># Review info on the Boston dataset.&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(Boston)) <span class="co"># Check for any missing data - looks like we don't have any.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   crim      zn   indus    chas     nox      rm     age     dis     rad     tax 
      0       0       0       0       0       0       0       0       0       0 
ptratio   black   lstat    medv 
      0       0       0       0 </code></pre>
</div>
<div id="lst-mass-data-set" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-mass-data-set-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;2: dataset setup
</figcaption>
<div aria-describedby="lst-mass-data-set-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>outcome <span class="ot">=</span> Boston<span class="sc">$</span>medv <span class="co">#Extract our outcome variable from the dataframe.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">subset</span>(Boston, <span class="at">select =</span> <span class="sc">-</span>medv) <span class="co"># Create a dataframe to contain our explanatory variables.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 10%">
<col style="width: 3%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 9%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">crim</th>
<th style="text-align: right;">zn</th>
<th style="text-align: right;">indus</th>
<th style="text-align: right;">chas</th>
<th style="text-align: right;">nox</th>
<th style="text-align: right;">rm</th>
<th style="text-align: right;">age</th>
<th style="text-align: right;">dis</th>
<th style="text-align: right;">rad</th>
<th style="text-align: right;">tax</th>
<th style="text-align: right;">ptratio</th>
<th style="text-align: right;">black</th>
<th style="text-align: right;">lstat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.00632</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">2.31</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.538</td>
<td style="text-align: right;">6.575</td>
<td style="text-align: right;">65.2</td>
<td style="text-align: right;">4.0900</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">296</td>
<td style="text-align: right;">15.3</td>
<td style="text-align: right;">396.90</td>
<td style="text-align: right;">4.98</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.02731</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.07</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.469</td>
<td style="text-align: right;">6.421</td>
<td style="text-align: right;">78.9</td>
<td style="text-align: right;">4.9671</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">242</td>
<td style="text-align: right;">17.8</td>
<td style="text-align: right;">396.90</td>
<td style="text-align: right;">9.14</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.02729</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.07</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.469</td>
<td style="text-align: right;">7.185</td>
<td style="text-align: right;">61.1</td>
<td style="text-align: right;">4.9671</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">242</td>
<td style="text-align: right;">17.8</td>
<td style="text-align: right;">392.83</td>
<td style="text-align: right;">4.03</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.03237</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2.18</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.458</td>
<td style="text-align: right;">6.998</td>
<td style="text-align: right;">45.8</td>
<td style="text-align: right;">6.0622</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">222</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">394.63</td>
<td style="text-align: right;">2.94</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.06905</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2.18</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.458</td>
<td style="text-align: right;">7.147</td>
<td style="text-align: right;">54.2</td>
<td style="text-align: right;">6.0622</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">222</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">396.90</td>
<td style="text-align: right;">5.33</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.02985</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2.18</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.458</td>
<td style="text-align: right;">6.430</td>
<td style="text-align: right;">58.7</td>
<td style="text-align: right;">6.0622</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">222</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">394.12</td>
<td style="text-align: right;">5.21</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="lst-mass-data-set" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-mass-data-set-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3: dataset setup
</figcaption>
<div aria-describedby="lst-mass-data-set-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data) <span class="co"># Check structure of our dataframe.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   506 obs. of  13 variables:
 $ crim   : num  0.00632 0.02731 0.02729 0.03237 0.06905 ...
 $ zn     : num  18 0 0 0 0 0 12.5 12.5 12.5 12.5 ...
 $ indus  : num  2.31 7.07 7.07 2.18 2.18 2.18 7.87 7.87 7.87 7.87 ...
 $ chas   : int  0 0 0 0 0 0 0 0 0 0 ...
 $ nox    : num  0.538 0.469 0.469 0.458 0.458 0.458 0.524 0.524 0.524 0.524 ...
 $ rm     : num  6.58 6.42 7.18 7 7.15 ...
 $ age    : num  65.2 78.9 61.1 45.8 54.2 58.7 66.6 96.1 100 85.9 ...
 $ dis    : num  4.09 4.97 4.97 6.06 6.06 ...
 $ rad    : int  1 2 2 3 3 3 5 5 5 5 ...
 $ tax    : num  296 242 242 222 222 222 311 311 311 311 ...
 $ ptratio: num  15.3 17.8 17.8 18.7 18.7 18.7 15.2 15.2 15.2 15.2 ...
 $ black  : num  397 397 393 395 397 ...
 $ lstat  : num  4.98 9.14 4.03 2.94 5.33 ...</code></pre>
</div>
<div id="lst-mass-data-set" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-mass-data-set-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;4: dataset setup
</figcaption>
<div aria-describedby="lst-mass-data-set-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(data) <span class="co"># Review our dimensions.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 506  13</code></pre>
</div>
<div id="lst-mass-data-set" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-mass-data-set-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;5: dataset setup
</figcaption>
<div aria-describedby="lst-mass-data-set-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)<span class="co"># Set a seed for reproducibility in this random sampling.</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>train_obs <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(data), <span class="dv">150</span>) <span class="co"># Reduce to a dataset of 150 observations to speed up model fitting.</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>x_train <span class="ot">=</span> data[train_obs, ] <span class="co"># X is our training sample.</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>x_holdout <span class="ot">=</span> data[<span class="sc">-</span>train_obs, ] <span class="co"># Create a holdout set for evaluating model performance.</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: cross-validation is even better than a single holdout sample.</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>outcome_bin <span class="ot">=</span> <span class="fu">as.numeric</span>(outcome <span class="sc">&gt;</span> <span class="dv">22</span>) <span class="co"># Create a binary outcome variable: towns in which median home value is &gt; 22,000.</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">=</span> outcome_bin[train_obs]</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>y_holdout <span class="ot">=</span> outcome_bin[<span class="sc">-</span>train_obs]</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(y_train, <span class="at">useNA =</span> <span class="st">"ifany"</span>) <span class="co"># Review the outcome variable distribution.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>y_train
 0  1 
92 58 </code></pre>
</div>
</div>
</section>
<section id="review-available-models" class="level2">
<h2 class="anchored" data-anchor-id="review-available-models">Review available models</h2>
<div class="cell">
<div id="lst-model-review" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-model-review-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;6: model review
</figcaption>
<div aria-describedby="lst-model-review-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SuperLearner)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">listWrappers</span>() <span class="co"># Review available models.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>All prediction algorithm wrappers in SuperLearner:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "SL.bartMachine"      "SL.bayesglm"         "SL.biglasso"        
 [4] "SL.caret"            "SL.caret.rpart"      "SL.cforest"         
 [7] "SL.earth"            "SL.gam"              "SL.gbm"             
[10] "SL.glm"              "SL.glm.interaction"  "SL.glmnet"          
[13] "SL.ipredbagg"        "SL.kernelKnn"        "SL.knn"             
[16] "SL.ksvm"             "SL.lda"              "SL.leekasso"        
[19] "SL.lm"               "SL.loess"            "SL.logreg"          
[22] "SL.mean"             "SL.nnet"             "SL.nnls"            
[25] "SL.polymars"         "SL.qda"              "SL.randomForest"    
[28] "SL.ranger"           "SL.ridge"            "SL.rpart"           
[31] "SL.rpartPrune"       "SL.speedglm"         "SL.speedlm"         
[34] "SL.step"             "SL.step.forward"     "SL.step.interaction"
[37] "SL.stepAIC"          "SL.svm"              "SL.template"        
[40] "SL.xgboost"         </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
All screening algorithm wrappers in SuperLearner:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "All"
[1] "screen.corP"           "screen.corRank"        "screen.glmnet"        
[4] "screen.randomForest"   "screen.SIS"            "screen.template"      
[7] "screen.ttest"          "write.screen.template"</code></pre>
</div>
<div id="lst-model-review" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-model-review-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;7: model review
</figcaption>
<div aria-describedby="lst-model-review-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>SL.glmnet</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>function (Y, X, newX, family, obsWeights, id, alpha = 1, nfolds = 10, 
    nlambda = 100, useMin = TRUE, loss = "deviance", ...) 
{
    .SL.require("glmnet")
    if (!is.matrix(X)) {
        X &lt;- model.matrix(~-1 + ., X)
        newX &lt;- model.matrix(~-1 + ., newX)
    }
    fitCV &lt;- glmnet::cv.glmnet(x = X, y = Y, weights = obsWeights, 
        lambda = NULL, type.measure = loss, nfolds = nfolds, 
        family = family$family, alpha = alpha, nlambda = nlambda, 
        ...)
    pred &lt;- predict(fitCV, newx = newX, type = "response", s = ifelse(useMin, 
        "lambda.min", "lambda.1se"))
    fit &lt;- list(object = fitCV, useMin = useMin)
    class(fit) &lt;- "SL.glmnet"
    out &lt;- list(pred = pred, fit = fit)
    return(out)
}
&lt;bytecode: 0x648245d66b50&gt;
&lt;environment: namespace:SuperLearner&gt;</code></pre>
</div>
</div>
</section>
<section id="fit-individual-models" class="level2">
<h2 class="anchored" data-anchor-id="fit-individual-models">Fit individual models</h2>
<p>Let’s fit 2 separate models: lasso (sparse, penalized OLS) and random forest. We specify family = binomial() because we are predicting a binary outcome, aka classification. With a continuous outcome we would specify family = gaussian().</p>
<div class="cell">
<div id="lst-model-fit-lasso" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-model-fit-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;8: fit lasso
</figcaption>
<div aria-describedby="lst-model-fit-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>) <span class="co"># Set the seed for reproducibility.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>sl_lasso <span class="ot">=</span> <span class="fu">SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">SL.library =</span> <span class="st">"SL.glmnet"</span>) <span class="co"># Fit lasso model.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: glmnet</code></pre>
</div>
<div id="lst-model-fit-lasso" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-model-fit-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;9: fit lasso
</figcaption>
<div aria-describedby="lst-model-fit-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>sl_lasso</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  
SuperLearner(Y = y_train, X = x_train, family = binomial(), SL.library = "SL.glmnet") 

                    Risk Coef
SL.glmnet_All 0.08484849    1</code></pre>
</div>
<div id="lst-model-fit-lasso" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-model-fit-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;10: fit lasso
</figcaption>
<div aria-describedby="lst-model-fit-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sl_lasso)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "call"              "libraryNames"      "SL.library"       
 [4] "SL.predict"        "coef"              "library.predict"  
 [7] "Z"                 "cvRisk"            "family"           
[10] "fitLibrary"        "cvFitLibrary"      "varNames"         
[13] "validRows"         "method"            "whichScreen"      
[16] "control"           "cvControl"         "errorsInCVLibrary"
[19] "errorsInLibrary"   "metaOptimizer"     "env"              
[22] "times"            </code></pre>
</div>
<div id="lst-model-fit-lasso" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-model-fit-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;11: fit lasso
</figcaption>
<div aria-describedby="lst-model-fit-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>sl_lasso<span class="sc">$</span>cvRisk[<span class="fu">which.min</span>(sl_lasso<span class="sc">$</span>cvRisk)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>SL.glmnet_All 
   0.08484849 </code></pre>
</div>
<div id="lst-model-fit-lasso" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-model-fit-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;12: fit lasso
</figcaption>
<div aria-describedby="lst-model-fit-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(sl_lasso<span class="sc">$</span>fitLibrary<span class="sc">$</span>SL.glmnet_All<span class="sc">$</span>object, <span class="at">max.level =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 12
 $ lambda    : num [1:90] 0.317 0.289 0.263 0.24 0.218 ...
 $ cvm       : num [1:90] 1.34 1.28 1.21 1.16 1.1 ...
 $ cvsd      : num [1:90] 0.0359 0.033 0.0304 0.0292 0.0291 ...
 $ cvup      : num [1:90] 1.38 1.31 1.24 1.18 1.13 ...
 $ cvlo      : num [1:90] 1.31 1.24 1.18 1.13 1.08 ...
 $ nzero     : Named int [1:90] 0 1 1 1 1 1 2 2 2 2 ...
  ..- attr(*, "names")= chr [1:90] "s0" "s1" "s2" "s3" ...
 $ call      : language glmnet::cv.glmnet(x = X, y = Y, weights = obsWeights, lambda = NULL, type.measure = loss,      nfolds = nfolds, f| __truncated__
 $ name      : Named chr "Binomial Deviance"
  ..- attr(*, "names")= chr "deviance"
 $ glmnet.fit:List of 13
  ..- attr(*, "class")= chr [1:2] "lognet" "glmnet"
 $ lambda.min: num 0.0161
 $ lambda.1se: num 0.0652
 $ index     : int [1:2, 1] 33 18
  ..- attr(*, "dimnames")=List of 2
 - attr(*, "class")= chr "cv.glmnet"</code></pre>
</div>
<div id="lst-model-fit-lasso" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-model-fit-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;13: fit lasso
</figcaption>
<div aria-describedby="lst-model-fit-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>sl_rf <span class="ot">=</span> <span class="fu">SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">SL.library =</span> <span class="st">"SL.ranger"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: ranger</code></pre>
</div>
<div id="lst-model-fit-lasso" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-model-fit-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;14: fit lasso
</figcaption>
<div aria-describedby="lst-model-fit-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sl_lasso)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "call"              "libraryNames"      "SL.library"       
 [4] "SL.predict"        "coef"              "library.predict"  
 [7] "Z"                 "cvRisk"            "family"           
[10] "fitLibrary"        "cvFitLibrary"      "varNames"         
[13] "validRows"         "method"            "whichScreen"      
[16] "control"           "cvControl"         "errorsInCVLibrary"
[19] "errorsInLibrary"   "metaOptimizer"     "env"              
[22] "times"            </code></pre>
</div>
<div id="lst-model-fit-lasso" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-model-fit-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;15: fit lasso
</figcaption>
<div aria-describedby="lst-model-fit-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>sl_lasso<span class="sc">$</span>cvRisk[<span class="fu">which.min</span>(sl_lasso<span class="sc">$</span>cvRisk)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>SL.glmnet_All 
   0.08484849 </code></pre>
</div>
<div id="lst-model-fit-lasso" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-model-fit-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;16: fit lasso
</figcaption>
<div aria-describedby="lst-model-fit-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here is the raw glmnet result object:</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(sl_lasso<span class="sc">$</span>fitLibrary<span class="sc">$</span>SL.glmnet_All<span class="sc">$</span>object, <span class="at">max.level =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 12
 $ lambda    : num [1:90] 0.317 0.289 0.263 0.24 0.218 ...
 $ cvm       : num [1:90] 1.34 1.28 1.21 1.16 1.1 ...
 $ cvsd      : num [1:90] 0.0359 0.033 0.0304 0.0292 0.0291 ...
 $ cvup      : num [1:90] 1.38 1.31 1.24 1.18 1.13 ...
 $ cvlo      : num [1:90] 1.31 1.24 1.18 1.13 1.08 ...
 $ nzero     : Named int [1:90] 0 1 1 1 1 1 2 2 2 2 ...
  ..- attr(*, "names")= chr [1:90] "s0" "s1" "s2" "s3" ...
 $ call      : language glmnet::cv.glmnet(x = X, y = Y, weights = obsWeights, lambda = NULL, type.measure = loss,      nfolds = nfolds, f| __truncated__
 $ name      : Named chr "Binomial Deviance"
  ..- attr(*, "names")= chr "deviance"
 $ glmnet.fit:List of 13
  ..- attr(*, "class")= chr [1:2] "lognet" "glmnet"
 $ lambda.min: num 0.0161
 $ lambda.1se: num 0.0652
 $ index     : int [1:2, 1] 33 18
  ..- attr(*, "dimnames")=List of 2
 - attr(*, "class")= chr "cv.glmnet"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit random forest.</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>sl_rf <span class="ot">=</span> <span class="fu">SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">SL.library =</span> <span class="st">"SL.ranger"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: ranger</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>sl_rf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  
SuperLearner(Y = y_train, X = x_train, family = binomial(), SL.library = "SL.ranger") 

                    Risk Coef
SL.ranger_All 0.07620479    1</code></pre>
</div>
</div>
</section>
<section id="fit-multiple-models" class="level2">
<h2 class="anchored" data-anchor-id="fit-multiple-models">Fit multiple models</h2>
<div class="cell">
<div id="lst-fit-multiple-models" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-fit-multiple-models-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;17: lst fit multiple models
</figcaption>
<div aria-describedby="lst-fit-multiple-models-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>sl <span class="ot">=</span> <span class="fu">SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, <span class="st">"SL.ranger"</span>))</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>sl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  
SuperLearner(Y = y_train, X = x_train, family = binomial(), SL.library = c("SL.mean",  
    "SL.glmnet", "SL.ranger")) 

                    Risk       Coef
SL.mean_All   0.23773937 0.00000000
SL.glmnet_All 0.08847869 0.02212495
SL.ranger_All 0.07053788 0.97787505</code></pre>
</div>
<div id="lst-fit-multiple-models" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-fit-multiple-models-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;18: lst fit multiple models
</figcaption>
<div aria-describedby="lst-fit-multiple-models-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>sl<span class="sc">$</span>times<span class="sc">$</span>everything</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  1.324   0.016   1.346 </code></pre>
</div>
</div>
<p>Again, the coefficient is how much weight SuperLearner puts on that model in the weighted-average. So if coefficient = 0 it means that model is not used at all. Here we see that random forest is given the most weight, following by lasso.</p>
<p>So we have an automatic ensemble of multiple learners based on the cross-validated performance of those learners, nice!</p>
</section>
<section id="predict-on-new-data" class="level1">
<h1>Predict on new data</h1>
<p>Now that we have an ensemble let’s predict back on our holdout dataset and review the results.</p>
<div class="cell">
<div id="lst-predict" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-predict-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;19: predict
</figcaption>
<div aria-describedby="lst-predict-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># onlySL is set to TRUE so we don't fit algorithms that had weight = 0, saving computation.</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">=</span> <span class="fu">predict</span>(sl, x_holdout, <span class="at">onlySL =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: glmnet</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: ranger</code></pre>
</div>
<div id="lst-predict" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-predict-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;20: predict
</figcaption>
<div aria-describedby="lst-predict-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the structure of this prediction object.</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ pred           : num [1:356, 1] 0.577 0.891 0.939 0.943 0.853 ...
 $ library.predict: num [1:356, 1:3] 0 0 0 0 0 0 0 0 0 0 ...</code></pre>
</div>
<div id="lst-predict" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-predict-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;21: predict
</figcaption>
<div aria-describedby="lst-predict-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Review the columns of $library.predict.</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pred<span class="sc">$</span>library.predict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       V1          V2                 V3           
 Min.   :0   Min.   :0.000008   Min.   :0.0002625  
 1st Qu.:0   1st Qu.:0.026812   1st Qu.:0.0484115  
 Median :0   Median :0.310300   Median :0.3057313  
 Mean   :0   Mean   :0.404139   Mean   :0.4124046  
 3rd Qu.:0   3rd Qu.:0.782474   3rd Qu.:0.8181667  
 Max.   :0   Max.   :0.998259   Max.   :0.9980000  </code></pre>
</div>
<div id="lst-predict" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-predict-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;22: predict
</figcaption>
<div aria-describedby="lst-predict-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(pred<span class="sc">$</span>pred[, <span class="dv">1</span>]) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `qplot()` was deprecated in ggplot2 3.4.0.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/lst-predict-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="index_files/figure-html/lst-predict-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div id="lst-predict" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-predict-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;23: predict
</figcaption>
<div aria-describedby="lst-predict-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="do">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatterplot of original values (0, 1) and predicted values.</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ideally we would use jitter or slight transparency to deal with overlap.</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(y_holdout, pred<span class="sc">$</span>pred[, <span class="dv">1</span>]) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/lst-predict-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="index_files/figure-html/lst-predict-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div id="lst-predict" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-predict-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;24: predict
</figcaption>
<div aria-describedby="lst-predict-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Review AUC - Area Under Curve</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>pred_rocr <span class="ot">=</span> ROCR<span class="sc">::</span><span class="fu">prediction</span>(pred<span class="sc">$</span>pred, y_holdout)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>auc <span class="ot">=</span> ROCR<span class="sc">::</span><span class="fu">performance</span>(pred_rocr, <span class="at">measure =</span> <span class="st">"auc"</span>, <span class="at">x.measure =</span> <span class="st">"cutoff"</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>auc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9443598</code></pre>
</div>
</div>
</section>
<section id="fit-ensemble-with-external-cross-validation" class="level1">
<h1>Fit ensemble with external cross-validation</h1>
<p>What we don’t have yet is an estimate of the performance of the ensemble itself. Right now we are just hopeful that the ensemble weights are successful in improving over the best single algorithm.</p>
<p>In order to estimate the performance of the SuperLearner ensemble we need an “external” layer of cross-validation, also called <strong>nested cross-validation</strong>. We generate a separate holdout sample that we don’t use to fit the SuperLearner, which allows it to be a good estimate of the SuperLearner’s performance on unseen data. Typically we would run 10 or 20-fold external cross-validation, but even 5-fold is reasonable.</p>
<p>Another nice result is that we get standard errors on the performance of the individual algorithms and can compare them to the SuperLearner.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Don't have timing info for the CV.SuperLearner unfortunately.</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># So we need to time it manually.</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This will take about 2x as long as the previous SuperLearner.</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  cv_sl <span class="ot">=</span> <span class="fu">CV.SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># For a real analysis we would use V = 10.</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">V =</span> <span class="dv">3</span>,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, <span class="st">"SL.ranger"</span>))</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: glmnet</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: ranger</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  6.433   0.101   6.510 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We run summary on the cv_sl object rather than simply printing the object.</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  
CV.SuperLearner(Y = y_train, X = x_train, V = 3, family = binomial(), SL.library = c("SL.mean",  
    "SL.glmnet", "SL.ranger")) 

Risk is based on: Mean Squared Error

All risk estimates are based on V =  3 

     Algorithm      Ave       se      Min      Max
 Super Learner 0.074388 0.011392 0.064595 0.084275
   Discrete SL 0.077512 0.011293 0.067146 0.086532
   SL.mean_All 0.251267 0.010352 0.228500 0.289600
 SL.glmnet_All 0.081595 0.014502 0.072729 0.095522
 SL.ranger_All 0.077512 0.011293 0.067146 0.086532</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Review the distribution of the best single learner as external CV folds.</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">simplify2array</span>(cv_sl<span class="sc">$</span>whichDiscreteSL))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
SL.ranger_All 
            3 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the performance with 95% CIs (use a better ggplot theme).</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cv_sl) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"SuperLearner.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
</div>
<section id="customize-a-model-hyperparameter" class="level2">
<h2 class="anchored" data-anchor-id="customize-a-model-hyperparameter">Customize a model hyperparameter</h2>
<p>Hyperparameters are the configuration settings for an algorithm. OLS has no hyperparameters but essentially every other algorithm does.</p>
<p>There are two ways to customize a hyperparameter: make a new learner function, or use create.Learner().</p>
<p>Let’s make a variant of random forest that fits more trees, which may increase our accuracy and can’t hurt it (outside of small random variation).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Review the function argument defaults at the top.</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>SL.ranger</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function(Y, X, newX, family,
           obsWeights,
           num.trees = 500,
           mtry = floor(sqrt(ncol(X))),
           write.forest = TRUE,
           probability = family$family == "binomial",
           min.node.size = ifelse(family$family == "gaussian", 5, 1),
           replace = TRUE,
           sample.fraction = ifelse(replace, 1, 0.632),
           num.threads = 1,
           verbose = T,
           ...) {
  # need write.forest = TRUE for predict method
  .SL.require("ranger")

  if (family$family == "binomial") {
    Y = as.factor(Y)
  }

  # Ranger does not seem to work with X as a matrix, so we explicitly convert to
  # data.frame rather than cbind. newX can remain as-is though.
  if (is.matrix(X)) {
    X = data.frame(X)
  }

  # Use _Y as our outcome variable name to avoid a possible conflict with a
  # variable in X named "Y".
  fit &lt;- ranger::ranger(`_Y` ~ ., data = cbind("_Y" = Y, X),
                        num.trees = num.trees,
                        mtry = mtry,
                        min.node.size = min.node.size,
                        replace = replace,
                        sample.fraction = sample.fraction,
                        case.weights = obsWeights,
                        write.forest = write.forest,
                        probability = probability,
                        num.threads = num.threads,
                        verbose = verbose)

  pred &lt;- predict(fit, data = newX)$predictions

  # For binomial family $predictions is a two-column matrix.
  if (family$family == "binomial") {
    # P(Y = 1 | X) for binomial.
    pred = pred[, "1"]
  }

  fit &lt;- list(object = fit, verbose = verbose)
  class(fit) &lt;- c("SL.ranger")
  out &lt;- list(pred = pred, fit = fit)
  return(out)
}
&lt;bytecode: 0x5da5817c4750&gt;
&lt;environment: namespace:SuperLearner&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new function that changes just the ntree argument.</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (We could do this in a single line.)</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="co"># "..." means "all other arguments that were sent to the function"</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>SL.rf.better <span class="ot">=</span> <span class="cf">function</span>(...) {</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">SL.randomForest</span>(..., <span class="at">num.trees =</span> <span class="dv">1000</span>)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the CV.SuperLearner.</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="co"># We use V = 3 to save computation time; for a real analysis use V = 10 or 20.</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>cv_sl <span class="ot">=</span> <span class="fu">CV.SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">V =</span> <span class="dv">3</span>,</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>                        <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, <span class="st">"SL.rf.better"</span>, <span class="st">"SL.ranger"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better  on full data 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in SuperLearner(Y = cvOutcome, X = cvLearn, newX = cvValid, family =
family, : Coefficients already 0 for all failed algorithm(s)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better  on full data 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) 
Warning in FUN(X[[i]], ...): Coefficients already 0 for all failed algorithm(s)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: randomForest</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error : loading required package (randomForest) failed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(X[[i]], ...): Error in algorithm SL.rf.better  on full data 
  The Algorithm will be removed from the Super Learner (i.e. given weight 0) 
Warning in FUN(X[[i]], ...): Coefficients already 0 for all failed algorithm(s)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Review results.</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  
CV.SuperLearner(Y = y_train, X = x_train, V = 3, family = binomial(), SL.library = c("SL.mean",  
    "SL.glmnet", "SL.rf.better", "SL.ranger")) 

Risk is based on: Mean Squared Error

All risk estimates are based on V =  3 

        Algorithm      Ave       se      Min      Max
    Super Learner 0.074388 0.011392 0.064595 0.084275
      Discrete SL 0.077512 0.011293 0.067146 0.086532
      SL.mean_All 0.251267 0.010352 0.228500 0.289600
    SL.glmnet_All 0.081595 0.014502 0.072729 0.095522
 SL.rf.better_All       NA       NA       NA       NA
    SL.ranger_All 0.077512 0.011293 0.067146 0.086532</code></pre>
</div>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the defaults for random forest.</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>learners <span class="ot">=</span> <span class="fu">create.Learner</span>(<span class="st">"SL.ranger"</span>, <span class="at">params =</span> <span class="fu">list</span>(<span class="at">num.trees =</span> <span class="dv">1000</span>))</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the object.</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>learners</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$grid
NULL

$names
[1] "SL.ranger_1"

$base_learner
[1] "SL.ranger"

$params
$params$num.trees
[1] 1000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List the functions that were created</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>learners<span class="sc">$</span>names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SL.ranger_1"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Review the code that was automatically generated for the function.</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice that it's exactly the same as the function we made manually.</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>SL.ranger_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (...) 
SL.ranger(..., num.trees = 1000)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the CV.SuperLearner.</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We use V = 3 to save computation time; for a real analysis use V = 10 or 20.</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>cv_sl <span class="ot">=</span> <span class="fu">CV.SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">V =</span> <span class="dv">3</span>,</span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, learners<span class="sc">$</span>names, <span class="st">"SL.ranger"</span>))</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Review results.</span></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  
CV.SuperLearner(Y = y_train, X = x_train, V = 3, family = binomial(), SL.library = c("SL.mean",  
    "SL.glmnet", learners$names, "SL.ranger")) 

Risk is based on: Mean Squared Error

All risk estimates are based on V =  3 

       Algorithm      Ave       se      Min      Max
   Super Learner 0.073994 0.010872 0.065059 0.083029
     Discrete SL 0.077243 0.011034 0.065593 0.089188
     SL.mean_All 0.251267 0.010352 0.228500 0.289600
   SL.glmnet_All 0.080148 0.013766 0.076383 0.087422
 SL.ranger_1_All 0.077687 0.011077 0.065593 0.089188
   SL.ranger_All 0.077231 0.011078 0.065675 0.089071</code></pre>
</div>
</div>
</section>
<section id="test-algorithm-with-multiple-hyperparameter-settings" class="level2">
<h2 class="anchored" data-anchor-id="test-algorithm-with-multiple-hyperparameter-settings">Test algorithm with multiple hyperparameter settings</h2>
<p>The performance of an algorithm varies based on its hyperparamters, which again are its configuration settings. Some algorithms may not vary much, and others might have far better or worse performance for certain settings. Often we focus our attention on 1 or 2 hyperparameters for a given algorithm because they are the most important ones.</p>
<p>For random forest there are two particularly important hyperparameters: mtry and maximum leaf nodes. Mtry is how many features are randomly chosen within each decision tree node - in other words, each time the tree considers making a split. Maximum leaf nodes controls how complex each tree can get.</p>
<p>Let’s try 3 different mtry options.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sqrt(p) is the default value of mtry for classification.</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="fu">floor</span>(<span class="fu">sqrt</span>(<span class="fu">ncol</span>(x_train)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's try 3 multiplies of this default: 0.5, 1, and 2.</span></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>(<span class="at">mtry_seq =</span> <span class="fu">floor</span>(<span class="fu">sqrt</span>(<span class="fu">ncol</span>(x_train)) <span class="sc">*</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 3 7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1 3 7</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>learners <span class="ot">=</span> <span class="fu">create.Learner</span>(<span class="st">"SL.ranger"</span>, <span class="at">tune =</span> <span class="fu">list</span>(<span class="at">mtry =</span> mtry_seq))</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Review the resulting object</span></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>learners</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$grid
  mtry
1    1
2    3
3    7

$names
[1] "SL.ranger_1" "SL.ranger_2" "SL.ranger_3"

$base_learner
[1] "SL.ranger"

$params
list()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>SL.ranger_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (...) 
SL.ranger(..., mtry = 1)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>SL.ranger_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (...) 
SL.ranger(..., mtry = 3)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>SL.ranger_3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (...) 
SL.ranger(..., mtry = 7)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the CV.SuperLearner.</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We use V = 3 to save computation time; for a real analysis use V = 10 or 20.</span></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>cv_sl <span class="ot">=</span> <span class="fu">CV.SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, </span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">V =</span> <span class="dv">3</span>, </span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, learners<span class="sc">$</span>names, <span class="st">"SL.ranger"</span>))</span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Review results.</span></span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  
CV.SuperLearner(Y = y_train, X = x_train, V = 3, family = binomial(), SL.library = c("SL.mean",  
    "SL.glmnet", learners$names, "SL.ranger")) 

Risk is based on: Mean Squared Error

All risk estimates are based on V =  3 

       Algorithm      Ave       se      Min      Max
   Super Learner 0.067516 0.011105 0.056210 0.081632
     Discrete SL 0.071761 0.011897 0.057843 0.092998
     SL.mean_All 0.251267 0.010352 0.228500 0.289600
   SL.glmnet_All 0.078227 0.015002 0.070147 0.087422
 SL.ranger_1_All 0.102194 0.011360 0.089415 0.111369
 SL.ranger_2_All 0.078006 0.011196 0.064298 0.093298
 SL.ranger_3_All 0.071761 0.011897 0.057843 0.092998
   SL.ranger_All 0.078469 0.011270 0.065888 0.089501</code></pre>
</div>
</div>
<p>We see here that mtry = 7 performed a little bit better than mtry = 1 or mtry = 3, although the difference is not significant. If we used more data and more cross-validation folds we might see more drastic differences. A higher mtry does better when a small percentage of variables are predictive of the outcome, because it gives each tree a better chance of finding a useful variable.</p>
<p>Note that SL.ranger and SL.ranger_2 have the same settings, and their performance is very similar - statistically a tie. It’s not exactly equivalent due to random variation in the two forests.</p>
<p>A key difference with SuperLearner over caret or other frameworks is that we are not trying to choose the single best hyperparameter or model. Instead, we usually want the best weighted average. So we are including all of the different settings in our SuperLearner, and we may choose a weighted average that includes the same model multiple times but with different settings. That can give us better performance than choosing only the single best settings for a given algorithm, which has some random noise in any case.</p>
<p>Multicore parallelization SuperLearner makes it easy to use multiple CPU cores on your computer to speed up the calculations. We first need to setup R for multiple cores, then tell CV.SuperLearner to divide its computations across those cores.</p>
<p>There are two ways to use multiple cores in R: the “multicore” system and the “snow” system. Windows only supports the “snow” system, which is more difficult to use, whereas macOS and Linux can use either one.</p>
<p>First we show the “multicore” system version:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup parallel computation - use all cores on our computer.</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>(<span class="at">num_cores =</span> RhpcBLASctl<span class="sc">::</span><span class="fu">get_num_cores</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use 2 of those cores for parallel SuperLearner.</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace "2" with "num_cores" (without quotes) to use all cores.</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> <span class="dv">2</span>)</span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check how many parallel workers we are using (on macOS/Linux).</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a><span class="fu">getOption</span>(<span class="st">"mc.cores"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to set a different type of seed that works across cores.</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Otherwise the other cores will go rogue and we won't get repeatable results.</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This version is for the "multicore" parallel system in R.</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>, <span class="st">"L'Ecuyer-CMRG"</span>)</span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a><span class="co"># While this is running check CPU using in Activity Monitor / Task Manager.</span></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>  cv_sl <span class="ot">=</span> <span class="fu">CV.SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># For a real analysis we would use V = 10.</span></span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">V =</span> <span class="dv">3</span>,</span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">parallel =</span> <span class="st">"multicore"</span>,</span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, learners<span class="sc">$</span>names, <span class="st">"SL.ranger"</span>))</span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: parallel</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  2.237   0.242   4.889 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Review results.</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  
CV.SuperLearner(Y = y_train, X = x_train, V = 3, family = binomial(), SL.library = c("SL.mean",  
    "SL.glmnet", learners$names, "SL.ranger"), parallel = "multicore") 

Risk is based on: Mean Squared Error

All risk estimates are based on V =  3 

       Algorithm      Ave        se      Min      Max
   Super Learner 0.089148 0.0149989 0.053080 0.107932
     Discrete SL 0.097739 0.0174582 0.059888 0.125348
     SL.mean_All 0.242600 0.0095617 0.226900 0.260500
   SL.glmnet_All 0.103421 0.0164995 0.059888 0.125348
 SL.ranger_1_All 0.093995 0.0107773 0.070773 0.106005
 SL.ranger_2_All 0.080877 0.0120526 0.053931 0.099784
 SL.ranger_3_All 0.084269 0.0142342 0.044643 0.107982
   SL.ranger_All 0.081619 0.0120937 0.052445 0.101650</code></pre>
</div>
</div>
<p>Here is the “snow” equivalent:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a snow cluster</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Again, replace 2 with num_cores to use all available cores.</span></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>cluster <span class="ot">=</span> parallel<span class="sc">::</span><span class="fu">makeCluster</span>(<span class="dv">2</span>)</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the cluster object.</span></span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a>cluster</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>socket cluster with 2 nodes on host 'localhost'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the SuperLearner package on all workers so they can find</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="co"># SuperLearner::All(), the default screening function which keeps all variables.</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">clusterEvalQ</span>(cluster, <span class="fu">library</span>(SuperLearner))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
 [1] "SuperLearner" "gam"          "foreach"      "splines"      "nnls"        
 [6] "stats"        "graphics"     "grDevices"    "utils"        "datasets"    
[11] "methods"      "base"        

[[2]]
 [1] "SuperLearner" "gam"          "foreach"      "splines"      "nnls"        
 [6] "stats"        "graphics"     "grDevices"    "utils"        "datasets"    
[11] "methods"      "base"        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to explictly export our custom learner functions to the workers.</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">clusterExport</span>(cluster, learners<span class="sc">$</span>names)</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to set a different type of seed that works across cores.</span></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This version is for SNOW parallelization.</span></span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Otherwise the other cores will go rogue and we won't get repeatable results.</span></span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">clusterSetRNGStream</span>(cluster, <span class="dv">1</span>)</span>
<span id="cb207-8"><a href="#cb207-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-9"><a href="#cb207-9" aria-hidden="true" tabindex="-1"></a><span class="co"># While this is running check CPU using in Activity Monitor / Task Manager.</span></span>
<span id="cb207-10"><a href="#cb207-10" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb207-11"><a href="#cb207-11" aria-hidden="true" tabindex="-1"></a>  cv_sl <span class="ot">=</span> <span class="fu">CV.SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb207-12"><a href="#cb207-12" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># For a real analysis we would use V = 10.</span></span>
<span id="cb207-13"><a href="#cb207-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">V =</span> <span class="dv">3</span>,</span>
<span id="cb207-14"><a href="#cb207-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">parallel =</span> cluster,</span>
<span id="cb207-15"><a href="#cb207-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, learners<span class="sc">$</span>names, <span class="st">"SL.ranger"</span>))</span>
<span id="cb207-16"><a href="#cb207-16" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  0.011   0.000   5.540 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Review results.</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  
CV.SuperLearner(Y = y_train, X = x_train, V = 3, family = binomial(), SL.library = c("SL.mean",  
    "SL.glmnet", learners$names, "SL.ranger"), parallel = cluster) 

Risk is based on: Mean Squared Error

All risk estimates are based on V =  3 

       Algorithm      Ave        se      Min      Max
   Super Learner 0.074781 0.0141069 0.063216 0.091040
     Discrete SL 0.070968 0.0132823 0.063216 0.079742
     SL.mean_All 0.238600 0.0091846 0.229300 0.246100
   SL.glmnet_All 0.097299 0.0185871 0.072560 0.120085
 SL.ranger_1_All 0.097233 0.0113360 0.093720 0.101704
 SL.ranger_2_All 0.076001 0.0119746 0.068762 0.082897
 SL.ranger_3_All 0.070968 0.0132823 0.063216 0.079742
   SL.ranger_All 0.076301 0.0118938 0.069590 0.082703</code></pre>
</div>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Stop the cluster workers now that we're done.</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">stopCluster</span>(cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we want to use multiple cores for normal SuperLearner, not CV.SuperLearner (i.e.&nbsp;external cross-validation to estimate performance), we need to change the function name to mcSuperLearner (“multicore” version) or snowSuperLearner (“snow” version).</p>
<p>First the “multicore” version (won’t be parallel on Windows):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set multicore compatible seed.</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>, <span class="st">"L'Ecuyer-CMRG"</span>)</span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the SuperLearner.</span></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>(<span class="at">sl =</span> <span class="fu">mcSuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, learners<span class="sc">$</span>names, <span class="st">"SL.ranger"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  
mcSuperLearner(Y = y_train, X = x_train, family = binomial(), SL.library = c("SL.mean",  
    "SL.glmnet", learners$names, "SL.ranger")) 

                      Risk       Coef
SL.mean_All     0.24253498 0.00000000
SL.glmnet_All   0.09181320 0.02471622
SL.ranger_1_All 0.09498042 0.00000000
SL.ranger_2_All 0.07428239 0.00000000
SL.ranger_3_All 0.07102085 0.92627825
SL.ranger_All   0.07388773 0.04900552</code></pre>
</div>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We see the time is reduced over our initial single-core superlearner.</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>sl<span class="sc">$</span>times<span class="sc">$</span>everything</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  2.862   0.423   2.008 </code></pre>
</div>
</div>
<p>Now the “snow” version, which should be parallel on all operating systems.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a snow cluster</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Reminder: change "2" to "num_cores" (without quotes) to use all available cores.</span></span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>(<span class="at">cluster =</span> parallel<span class="sc">::</span><span class="fu">makeCluster</span>(<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>socket cluster with 2 nodes on host 'localhost'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="do">## socket cluster with 2 nodes on host 'localhost'</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the SuperLearner package on all workers so they can find</span></span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a><span class="co"># SuperLearner::All(), the default screening function which keeps all variables.</span></span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">clusterEvalQ</span>(cluster, <span class="fu">library</span>(SuperLearner))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
 [1] "SuperLearner" "gam"          "foreach"      "splines"      "nnls"        
 [6] "stats"        "graphics"     "grDevices"    "utils"        "datasets"    
[11] "methods"      "base"        

[[2]]
 [1] "SuperLearner" "gam"          "foreach"      "splines"      "nnls"        
 [6] "stats"        "graphics"     "grDevices"    "utils"        "datasets"    
[11] "methods"      "base"        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to explictly export our custom learner functions to the workers.</span></span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">clusterExport</span>(cluster, learners<span class="sc">$</span>names)</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to set a different type of seed that works across cores.</span></span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This version is for SNOW parallelization.</span></span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Otherwise the other cores will go rogue and we won't get repeatable results.</span></span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">clusterSetRNGStream</span>(cluster, <span class="dv">1</span>)</span>
<span id="cb220-8"><a href="#cb220-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-9"><a href="#cb220-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the SuperLearner.</span></span>
<span id="cb220-10"><a href="#cb220-10" aria-hidden="true" tabindex="-1"></a>(<span class="at">sl =</span> <span class="fu">snowSuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb220-11"><a href="#cb220-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cluster =</span> cluster,</span>
<span id="cb220-12"><a href="#cb220-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, learners<span class="sc">$</span>names, <span class="st">"SL.ranger"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  
snowSuperLearner(cluster = cluster, Y = y_train, X = x_train, family = binomial(),  
    SL.library = c("SL.mean", "SL.glmnet", learners$names, "SL.ranger")) 

                      Risk       Coef
SL.mean_All     0.23878189 0.00000000
SL.glmnet_All   0.08486885 0.13188912
SL.ranger_1_All 0.09253551 0.00000000
SL.ranger_2_All 0.07253553 0.01627661
SL.ranger_3_All 0.06974784 0.85183427
SL.ranger_All   0.07397735 0.00000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We see the time is reduced over our initial single-core superlearner.</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>sl<span class="sc">$</span>times<span class="sc">$</span>everything</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  0.461   0.040   2.999 </code></pre>
</div>
</div>
<p>SuperLearner also supports running across multiple computers at a time, called “multi-node” or “cluster” computing. We will skip that for now.</p>
</section>
<section id="weight-distribution-for-superlearner" class="level2">
<h2 class="anchored" data-anchor-id="weight-distribution-for-superlearner">Weight distribution for SuperLearner</h2>
<p>The weights or coefficients of the SuperLearner are stochastic - they will change as the data changes. So we don’t necessarily trust a given set of weights as being the “true” weights, but when we use CV.SuperLearner we at least have multiple samples from the distribution of the weights.</p>
<p>We can write a little function to extract the weights at each CV.SuperLearner iteration and summarize the distribution of those weights. This may be added to the SuperLearner package sometime in the future.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Review meta-weights (coefficients) from a CV.SuperLearner object</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>review_weights <span class="ot">=</span> <span class="cf">function</span>(cv_sl) {</span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>  meta_weights <span class="ot">=</span> <span class="fu">coef</span>(cv_sl)</span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>  means <span class="ot">=</span> <span class="fu">colMeans</span>(meta_weights)</span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a>  sds <span class="ot">=</span> <span class="fu">apply</span>(meta_weights, <span class="at">MARGIN =</span> <span class="dv">2</span>,  <span class="at">FUN =</span> sd)</span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>  mins <span class="ot">=</span> <span class="fu">apply</span>(meta_weights, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> min)</span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a>  maxs <span class="ot">=</span> <span class="fu">apply</span>(meta_weights, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> max)</span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine the stats into a single matrix.</span></span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a>  sl_stats <span class="ot">=</span> <span class="fu">cbind</span>(<span class="st">"mean(weight)"</span> <span class="ot">=</span> means, <span class="st">"sd"</span> <span class="ot">=</span> sds, <span class="st">"min"</span> <span class="ot">=</span> mins, <span class="st">"max"</span> <span class="ot">=</span> maxs)</span>
<span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort by decreasing mean weight.</span></span>
<span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a>  sl_stats[<span class="fu">order</span>(sl_stats[, <span class="dv">1</span>], <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb224-13"><a href="#cb224-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-14"><a href="#cb224-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">review_weights</span>(cv_sl), <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                mean(weight)     sd   min   max
SL.ranger_3_All       0.6907 0.2955 0.411 1.000
SL.glmnet_All         0.2588 0.2295 0.000 0.437
SL.ranger_2_All       0.0504 0.0874 0.000 0.151
SL.mean_All           0.0000 0.0000 0.000 0.000
SL.ranger_1_All       0.0000 0.0000 0.000 0.000
SL.ranger_All         0.0000 0.0000 0.000 0.000</code></pre>
</div>
</div>
<p>Notice that in this case the ensemble never uses the mean nor the randomForest with mtry = 1. Also the LASSO (glmnet) was only used on a subset of the folds. Adding multiple configurations of randomForest was helpful because mtry = 7 was used. However, based on the minimum column we can see that no algorithm was used every single time.</p>
<p>We recommend reviewing the weight distribution for any SuperLearner project to better understand which algorithms are chosen for the ensemble.</p>
</section>
<section id="feature-selection-screening" class="level2">
<h2 class="anchored" data-anchor-id="feature-selection-screening">Feature selection (screening)</h2>
<p>When datasets have many covariates our algorithms may benefit from first choosing a subset of available covariates, a step called feature selection. Then we pass only those variables to the modeling algorithm, and it may be less likely to overfit to variables that are not related to the outcome.</p>
<p>Let’s revisit listWrappers() and check out the bottom section.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">listWrappers</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>All prediction algorithm wrappers in SuperLearner:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "SL.bartMachine"      "SL.bayesglm"         "SL.biglasso"        
 [4] "SL.caret"            "SL.caret.rpart"      "SL.cforest"         
 [7] "SL.earth"            "SL.gam"              "SL.gbm"             
[10] "SL.glm"              "SL.glm.interaction"  "SL.glmnet"          
[13] "SL.ipredbagg"        "SL.kernelKnn"        "SL.knn"             
[16] "SL.ksvm"             "SL.lda"              "SL.leekasso"        
[19] "SL.lm"               "SL.loess"            "SL.logreg"          
[22] "SL.mean"             "SL.nnet"             "SL.nnls"            
[25] "SL.polymars"         "SL.qda"              "SL.randomForest"    
[28] "SL.ranger"           "SL.ridge"            "SL.rpart"           
[31] "SL.rpartPrune"       "SL.speedglm"         "SL.speedlm"         
[34] "SL.step"             "SL.step.forward"     "SL.step.interaction"
[37] "SL.stepAIC"          "SL.svm"              "SL.template"        
[40] "SL.xgboost"         </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
All screening algorithm wrappers in SuperLearner:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "All"
[1] "screen.corP"           "screen.corRank"        "screen.glmnet"        
[4] "screen.randomForest"   "screen.SIS"            "screen.template"      
[7] "screen.ttest"          "write.screen.template"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Review code for corP, which is based on univariate correlation.</span></span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>screen.corP</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function(Y, X, family, obsWeights, id, method = 'pearson', minPvalue = 0.1, minscreen = 2, ...) {
    listp &lt;- apply(X, 2, function(x, Y, method) { 
        ifelse(var(x) &lt;= 0, 1, cor.test(x, y = Y, method = method)$p.value)
    }, Y = Y, method = method)
    whichVariable &lt;- (listp &lt;= minPvalue)
    if (sum(whichVariable) &lt; minscreen) {
      warning('number of variables with p value less than minPvalue is less than minscreen')
        whichVariable[rank(listp) &lt;= minscreen] &lt;- TRUE
    }
    return(whichVariable)
}
&lt;bytecode: 0x5da58078ad40&gt;
&lt;environment: namespace:SuperLearner&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the SuperLearner.</span></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to use list() instead of c().</span></span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>cv_sl <span class="ot">=</span> <span class="fu">CV.SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># For a real analysis we would use V = 10.</span></span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">V =</span> <span class="dv">3</span>,</span>
<span id="cb233-8"><a href="#cb233-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">parallel =</span> <span class="st">"multicore"</span>,</span>
<span id="cb233-9"><a href="#cb233-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">SL.library =</span> <span class="fu">list</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, <span class="fu">c</span>(<span class="st">"SL.glmnet"</span>, <span class="st">"screen.corP"</span>)))</span>
<span id="cb233-10"><a href="#cb233-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  
CV.SuperLearner(Y = y_train, X = x_train, V = 3, family = binomial(), SL.library = list("SL.mean",  
    "SL.glmnet", c("SL.glmnet", "screen.corP")), parallel = "multicore") 

Risk is based on: Mean Squared Error

All risk estimates are based on V =  3 

             Algorithm     Ave        se      Min     Max
         Super Learner 0.10463 0.0168593 0.065549 0.12602
           Discrete SL 0.10492 0.0170909 0.066405 0.12602
           SL.mean_All 0.24260 0.0095617 0.226900 0.26050
         SL.glmnet_All 0.10492 0.0170909 0.066405 0.12602
 SL.glmnet_screen.corP 0.10392 0.0163746 0.066405 0.12303</code></pre>
</div>
</div>
<p>We see a small performance boost by first screening by univarate correlation with our outcome, and only keeping variables with a p-value less than 0.10. Try using some of the other screening algorithms as they may do even better for a particular dataset.</p>
</section>
<section id="optimize-for-auc" class="level2">
<h2 class="anchored" data-anchor-id="optimize-for-auc">Optimize for AUC</h2>
<p>For binary prediction we are typically trying to maximize AUC, which can be the best performance metric when our outcome variable has some imbalance. In other words, we don’t have exactly 50% 1s and 50% 0s in our outcome. Our SuperLearner is not targeting AUC by default, but it can if we tell it to by specifying our method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>cv_sl <span class="ot">=</span> <span class="fu">CV.SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># For a real analysis we would use V = 10.</span></span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">V =</span> <span class="dv">3</span>,</span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">method =</span> <span class="st">"method.AUC"</span>,</span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">SL.library =</span> <span class="fu">list</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, <span class="fu">c</span>(<span class="st">"SL.glmnet"</span>, <span class="st">"screen.corP"</span>)))</span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading required package: cvAUC</span></span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  
CV.SuperLearner(Y = y_train, X = x_train, V = 3, family = binomial(), SL.library = list("SL.mean",  
    "SL.glmnet", c("SL.glmnet", "screen.corP")), method = "method.AUC") 

Risk is based on: Area under ROC curve (AUC)

All risk estimates are based on V =  3 

             Algorithm     Ave se     Min     Max
         Super Learner 0.92045 NA 0.89372 0.95429
           Discrete SL 0.91989 NA 0.89372 0.95429
           SL.mean_All 0.50000 NA 0.50000 0.50000
         SL.glmnet_All 0.92322 NA 0.89372 0.95429
 SL.glmnet_screen.corP 0.91989 NA 0.89372 0.95429</code></pre>
</div>
</div>
<p>This conveniently shows us the AUC for each algorithm without us having to calculate it manually. But we aren’t getting SEs sadly.</p>
<p>Another important optimizer to consider is negative log likelihood, which is intended for binary outcomes and will often work better than NNLS (the default). This is specified by method = “NNloglik”.</p>
</section>
<section id="xgboost-hyperparameter-exploration" class="level2">
<h2 class="anchored" data-anchor-id="xgboost-hyperparameter-exploration">XGBoost hyperparameter exploration</h2>
<p>XGBoost is a version of GBM that is even faster and has some extra settings. GBM’s adaptivity is determined by its configuration, so we want to thoroughly test a wide range of configurations for any given problem. Let’s do 27 now. This will take a good amount of time (~7 minutes on my computer) so we need to at least use multiple cores, if not multiple computers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 * 3 * 3 = 27 different configurations.</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For a real analysis we would do 100, 500, or 1000 trees - this is just a demo.</span></span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>tune <span class="ot">=</span> <span class="fu">list</span>(<span class="at">ntrees =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">50</span>),</span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">max_depth =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">shrinkage =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>))</span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set detailed names = T so we can see the configuration for each function.</span></span>
<span id="cb237-8"><a href="#cb237-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Also shorten the name prefix.</span></span>
<span id="cb237-9"><a href="#cb237-9" aria-hidden="true" tabindex="-1"></a>learners <span class="ot">=</span> <span class="fu">create.Learner</span>(<span class="st">"SL.xgboost"</span>, <span class="at">tune =</span> tune, <span class="at">detailed_names =</span> <span class="cn">TRUE</span>, <span class="at">name_prefix =</span> <span class="st">"xgb"</span>)</span>
<span id="cb237-10"><a href="#cb237-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-11"><a href="#cb237-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 27 configurations - not too shabby.</span></span>
<span id="cb237-12"><a href="#cb237-12" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(learners<span class="sc">$</span>names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 27</code></pre>
</div>
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>learners<span class="sc">$</span>names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "xgb_10_1_0.001" "xgb_20_1_0.001" "xgb_50_1_0.001" "xgb_10_2_0.001"
 [5] "xgb_20_2_0.001" "xgb_50_2_0.001" "xgb_10_3_0.001" "xgb_20_3_0.001"
 [9] "xgb_50_3_0.001" "xgb_10_1_0.01"  "xgb_20_1_0.01"  "xgb_50_1_0.01" 
[13] "xgb_10_2_0.01"  "xgb_20_2_0.01"  "xgb_50_2_0.01"  "xgb_10_3_0.01" 
[17] "xgb_20_3_0.01"  "xgb_50_3_0.01"  "xgb_10_1_0.1"   "xgb_20_1_0.1"  
[21] "xgb_50_1_0.1"   "xgb_10_2_0.1"   "xgb_20_2_0.1"   "xgb_50_2_0.1"  
[25] "xgb_10_3_0.1"   "xgb_20_3_0.1"   "xgb_50_3_0.1"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confirm we have multiple cores configured. This should be &gt; 1.</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getOption</span>(<span class="st">"mc.cores"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remember to set multicore-compatible seed.</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>, <span class="st">"L'Ecuyer-CMRG"</span>)</span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the CV.SuperLearner.</span></span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a>  cv_sl <span class="ot">=</span> <span class="fu">CV.SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># For a real analysis we would use V = 10.</span></span>
<span id="cb243-8"><a href="#cb243-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">V =</span> <span class="dv">3</span>,</span>
<span id="cb243-9"><a href="#cb243-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">parallel =</span> <span class="st">"multicore"</span>,</span>
<span id="cb243-10"><a href="#cb243-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, learners<span class="sc">$</span>names, <span class="st">"SL.ranger"</span>))</span>
<span id="cb243-11"><a href="#cb243-11" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: parallel</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
273.028   0.368  39.877 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Review results.</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  
CV.SuperLearner(Y = y_train, X = x_train, V = 3, family = binomial(), SL.library = c("SL.mean",  
    "SL.glmnet", learners$names, "SL.ranger"), parallel = "multicore") 

Risk is based on: Mean Squared Error

All risk estimates are based on V =  3 

          Algorithm      Ave         se      Min     Max
      Super Learner 0.089735 0.01523004 0.052813 0.11879
        Discrete SL 0.095907 0.01699764 0.064775 0.12535
        SL.mean_All 0.242600 0.00956173 0.226900 0.26050
      SL.glmnet_All 0.104150 0.01673952 0.064775 0.12535
 xgb_10_1_0.001_All 0.247864 0.00022090 0.247406 0.24828
 xgb_20_1_0.001_All 0.245773 0.00043925 0.244861 0.24661
 xgb_50_1_0.001_All 0.239599 0.00103601 0.237065 0.24182
 xgb_10_2_0.001_All 0.247864 0.00022090 0.247406 0.24828
 xgb_20_2_0.001_All 0.245773 0.00043925 0.244861 0.24661
 xgb_50_2_0.001_All 0.239599 0.00103601 0.237065 0.24182
 xgb_10_3_0.001_All 0.247864 0.00022090 0.247406 0.24828
 xgb_20_3_0.001_All 0.245773 0.00043925 0.244861 0.24661
 xgb_50_3_0.001_All 0.239599 0.00103601 0.237065 0.24182
  xgb_10_1_0.01_All 0.229984 0.00200462 0.224800 0.23455
  xgb_20_1_0.01_All 0.213539 0.00380533 0.203477 0.22257
  xgb_50_1_0.01_All 0.179899 0.00791583 0.154434 0.20141
  xgb_10_2_0.01_All 0.229984 0.00200462 0.224800 0.23455
  xgb_20_2_0.01_All 0.213539 0.00380533 0.203477 0.22257
  xgb_50_2_0.01_All 0.179899 0.00791583 0.154434 0.20141
  xgb_10_3_0.01_All 0.229984 0.00200462 0.224800 0.23455
  xgb_20_3_0.01_All 0.213539 0.00380533 0.203477 0.22257
  xgb_50_3_0.01_All 0.179899 0.00791583 0.154434 0.20141
   xgb_10_1_0.1_All 0.149806 0.01102873 0.113512 0.18562
   xgb_20_1_0.1_All 0.138650 0.01162345 0.093478 0.18195
   xgb_50_1_0.1_All 0.139119 0.01173685 0.092681 0.18077
   xgb_10_2_0.1_All 0.149806 0.01102873 0.113512 0.18562
   xgb_20_2_0.1_All 0.138650 0.01162345 0.093478 0.18195
   xgb_50_2_0.1_All 0.139119 0.01173685 0.092681 0.18077
   xgb_10_3_0.1_All 0.149806 0.01102873 0.113512 0.18562
   xgb_20_3_0.1_All 0.138650 0.01162345 0.093478 0.18195
   xgb_50_3_0.1_All 0.139119 0.01173685 0.092681 0.18077
      SL.ranger_All 0.079853 0.01187862 0.049206 0.09760</code></pre>
</div>
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">review_weights</span>(cv_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   mean(weight)        sd       min       max
SL.ranger_All         0.5323384 0.4480376 0.1069165 1.0000000
SL.glmnet_All         0.4676616 0.4480376 0.0000000 0.8930835
SL.mean_All           0.0000000 0.0000000 0.0000000 0.0000000
xgb_10_1_0.001_All    0.0000000 0.0000000 0.0000000 0.0000000
xgb_20_1_0.001_All    0.0000000 0.0000000 0.0000000 0.0000000
xgb_50_1_0.001_All    0.0000000 0.0000000 0.0000000 0.0000000
xgb_10_2_0.001_All    0.0000000 0.0000000 0.0000000 0.0000000
xgb_20_2_0.001_All    0.0000000 0.0000000 0.0000000 0.0000000
xgb_50_2_0.001_All    0.0000000 0.0000000 0.0000000 0.0000000
xgb_10_3_0.001_All    0.0000000 0.0000000 0.0000000 0.0000000
xgb_20_3_0.001_All    0.0000000 0.0000000 0.0000000 0.0000000
xgb_50_3_0.001_All    0.0000000 0.0000000 0.0000000 0.0000000
xgb_10_1_0.01_All     0.0000000 0.0000000 0.0000000 0.0000000
xgb_20_1_0.01_All     0.0000000 0.0000000 0.0000000 0.0000000
xgb_50_1_0.01_All     0.0000000 0.0000000 0.0000000 0.0000000
xgb_10_2_0.01_All     0.0000000 0.0000000 0.0000000 0.0000000
xgb_20_2_0.01_All     0.0000000 0.0000000 0.0000000 0.0000000
xgb_50_2_0.01_All     0.0000000 0.0000000 0.0000000 0.0000000
xgb_10_3_0.01_All     0.0000000 0.0000000 0.0000000 0.0000000
xgb_20_3_0.01_All     0.0000000 0.0000000 0.0000000 0.0000000
xgb_50_3_0.01_All     0.0000000 0.0000000 0.0000000 0.0000000
xgb_10_1_0.1_All      0.0000000 0.0000000 0.0000000 0.0000000
xgb_20_1_0.1_All      0.0000000 0.0000000 0.0000000 0.0000000
xgb_50_1_0.1_All      0.0000000 0.0000000 0.0000000 0.0000000
xgb_10_2_0.1_All      0.0000000 0.0000000 0.0000000 0.0000000
xgb_20_2_0.1_All      0.0000000 0.0000000 0.0000000 0.0000000
xgb_50_2_0.1_All      0.0000000 0.0000000 0.0000000 0.0000000
xgb_10_3_0.1_All      0.0000000 0.0000000 0.0000000 0.0000000
xgb_20_3_0.1_All      0.0000000 0.0000000 0.0000000 0.0000000
xgb_50_3_0.1_All      0.0000000 0.0000000 0.0000000 0.0000000</code></pre>
</div>
</div>
<p>We can see how stochastic the weights are for each individual execution of SuperLearner.</p>
<p>Finally, plot the performance for the different settings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cv_sl) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-13-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="troubleshooting" class="level2">
<h2 class="anchored" data-anchor-id="troubleshooting">Troubleshooting</h2>
<p>If you get an error about predict for xgb.Booster, you probably need to install the latest version of XGBoost from github.</p>


<!-- -->

</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bochman2024,
  author = {Bochman, Oren},
  title = {SuperLearner},
  date = {2024-01-10},
  url = {https://orenbochman.github.io/posts/2024/2024-01-10-superlearner/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bochman2024" class="csl-entry quarto-appendix-citeas" role="listitem">
Bochman, Oren. 2024. <span>“SuperLearner.”</span> January 10, 2024. <a href="https://orenbochman.github.io/posts/2024/2024-01-10-superlearner/">https://orenbochman.github.io/posts/2024/2024-01-10-superlearner/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("^(?:http:|https:)\/\/www\.quarto\.org\/custom");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../posts/2024/2023-02-16-learing-goals/index.html" class="pagination-link" aria-label="Q1 2023 Tasks">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Q1 2023 Tasks</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../posts/2024/2024-03-31-sugarscapes/index.html" class="pagination-link" aria-label="Sugar Scapes">
        <span class="nav-page-text">Sugar Scapes</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb251" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2024-01-10</span></span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> SuperLearner</span></span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> SuperLearner is an ensambeleing library.</span></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [demos,code,r]</span></span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a><span class="an">engine:</span><span class="co"> knitr</span></span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb251-9"><a href="#cb251-9" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb251-10"><a href="#cb251-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: False</span></span>
<span id="cb251-11"><a href="#cb251-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: True</span></span>
<span id="cb251-12"><a href="#cb251-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: True</span></span>
<span id="cb251-13"><a href="#cb251-13" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: kable</span></span>
<span id="cb251-14"><a href="#cb251-14" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb251-15"><a href="#cb251-15" aria-hidden="true" tabindex="-1"></a><span class="co">  cache: True</span></span>
<span id="cb251-16"><a href="#cb251-16" aria-hidden="true" tabindex="-1"></a><span class="co">  capture: True</span></span>
<span id="cb251-17"><a href="#cb251-17" aria-hidden="true" tabindex="-1"></a><span class="co">  freeze: auto  # re-render only when source changes</span></span>
<span id="cb251-18"><a href="#cb251-18" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb251-19"><a href="#cb251-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-20"><a href="#cb251-20" aria-hidden="true" tabindex="-1"></a>This is a SuperLearner demo.</span>
<span id="cb251-21"><a href="#cb251-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-22"><a href="#cb251-22" aria-hidden="true" tabindex="-1"></a>SuperLearner is an ensambeleing library.</span>
<span id="cb251-23"><a href="#cb251-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-24"><a href="#cb251-24" aria-hidden="true" tabindex="-1"></a>This page is taken out of the documentation</span>
<span id="cb251-25"><a href="#cb251-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-26"><a href="#cb251-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setup dataset</span></span>
<span id="cb251-27"><a href="#cb251-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-30"><a href="#cb251-30" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb251-31"><a href="#cb251-31" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lst-mass-data-set</span></span>
<span id="cb251-32"><a href="#cb251-32" aria-hidden="true" tabindex="-1"></a><span class="co">#| lst-label: lst-mass-data-set</span></span>
<span id="cb251-33"><a href="#cb251-33" aria-hidden="true" tabindex="-1"></a><span class="co">#| lst-cap: dataset setup</span></span>
<span id="cb251-34"><a href="#cb251-34" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(c("SuperLearner","caret", "glmnet", "randomForest", "ggplot2", "RhpcBLASctl","xgboost","ranger"))</span></span>
<span id="cb251-35"><a href="#cb251-35" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Boston, <span class="at">package =</span> <span class="st">"MASS"</span>)</span>
<span id="cb251-36"><a href="#cb251-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-37"><a href="#cb251-37" aria-hidden="true" tabindex="-1"></a>?MASS<span class="sc">::</span>Boston  <span class="co"># Review info on the Boston dataset.&gt;</span></span>
<span id="cb251-38"><a href="#cb251-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-39"><a href="#cb251-39" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(Boston)) <span class="co"># Check for any missing data - looks like we don't have any.</span></span>
<span id="cb251-40"><a href="#cb251-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-41"><a href="#cb251-41" aria-hidden="true" tabindex="-1"></a>outcome <span class="ot">=</span> Boston<span class="sc">$</span>medv <span class="co">#Extract our outcome variable from the dataframe.</span></span>
<span id="cb251-42"><a href="#cb251-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-43"><a href="#cb251-43" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">subset</span>(Boston, <span class="at">select =</span> <span class="sc">-</span>medv) <span class="co"># Create a dataframe to contain our explanatory variables.</span></span>
<span id="cb251-44"><a href="#cb251-44" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span>
<span id="cb251-45"><a href="#cb251-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-46"><a href="#cb251-46" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data) <span class="co"># Check structure of our dataframe.</span></span>
<span id="cb251-47"><a href="#cb251-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-48"><a href="#cb251-48" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(data) <span class="co"># Review our dimensions.</span></span>
<span id="cb251-49"><a href="#cb251-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-50"><a href="#cb251-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-51"><a href="#cb251-51" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)<span class="co"># Set a seed for reproducibility in this random sampling.</span></span>
<span id="cb251-52"><a href="#cb251-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-53"><a href="#cb251-53" aria-hidden="true" tabindex="-1"></a>train_obs <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(data), <span class="dv">150</span>) <span class="co"># Reduce to a dataset of 150 observations to speed up model fitting.</span></span>
<span id="cb251-54"><a href="#cb251-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-55"><a href="#cb251-55" aria-hidden="true" tabindex="-1"></a>x_train <span class="ot">=</span> data[train_obs, ] <span class="co"># X is our training sample.</span></span>
<span id="cb251-56"><a href="#cb251-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-57"><a href="#cb251-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-58"><a href="#cb251-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-59"><a href="#cb251-59" aria-hidden="true" tabindex="-1"></a>x_holdout <span class="ot">=</span> data[<span class="sc">-</span>train_obs, ] <span class="co"># Create a holdout set for evaluating model performance.</span></span>
<span id="cb251-60"><a href="#cb251-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: cross-validation is even better than a single holdout sample.</span></span>
<span id="cb251-61"><a href="#cb251-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-62"><a href="#cb251-62" aria-hidden="true" tabindex="-1"></a>outcome_bin <span class="ot">=</span> <span class="fu">as.numeric</span>(outcome <span class="sc">&gt;</span> <span class="dv">22</span>) <span class="co"># Create a binary outcome variable: towns in which median home value is &gt; 22,000.</span></span>
<span id="cb251-63"><a href="#cb251-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-64"><a href="#cb251-64" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">=</span> outcome_bin[train_obs]</span>
<span id="cb251-65"><a href="#cb251-65" aria-hidden="true" tabindex="-1"></a>y_holdout <span class="ot">=</span> outcome_bin[<span class="sc">-</span>train_obs]</span>
<span id="cb251-66"><a href="#cb251-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-67"><a href="#cb251-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-68"><a href="#cb251-68" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(y_train, <span class="at">useNA =</span> <span class="st">"ifany"</span>) <span class="co"># Review the outcome variable distribution.</span></span>
<span id="cb251-69"><a href="#cb251-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb251-70"><a href="#cb251-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-71"><a href="#cb251-71" aria-hidden="true" tabindex="-1"></a><span class="fu">## Review available models</span></span>
<span id="cb251-72"><a href="#cb251-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-75"><a href="#cb251-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb251-76"><a href="#cb251-76" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lst-model-review</span></span>
<span id="cb251-77"><a href="#cb251-77" aria-hidden="true" tabindex="-1"></a><span class="co">#| lst-label: lst-model-review</span></span>
<span id="cb251-78"><a href="#cb251-78" aria-hidden="true" tabindex="-1"></a><span class="co">#| lst-cap: model review</span></span>
<span id="cb251-79"><a href="#cb251-79" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SuperLearner)</span>
<span id="cb251-80"><a href="#cb251-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-81"><a href="#cb251-81" aria-hidden="true" tabindex="-1"></a><span class="fu">listWrappers</span>() <span class="co"># Review available models.</span></span>
<span id="cb251-82"><a href="#cb251-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-83"><a href="#cb251-83" aria-hidden="true" tabindex="-1"></a>SL.glmnet</span>
<span id="cb251-84"><a href="#cb251-84" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb251-85"><a href="#cb251-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-86"><a href="#cb251-86" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fit individual models</span></span>
<span id="cb251-87"><a href="#cb251-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-88"><a href="#cb251-88" aria-hidden="true" tabindex="-1"></a>Let’s fit 2 separate models: lasso (sparse, penalized OLS) and random forest. We specify family = binomial() because we are predicting a binary outcome, aka classification. With a continuous outcome we would specify family = gaussian().</span>
<span id="cb251-89"><a href="#cb251-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-92"><a href="#cb251-92" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb251-93"><a href="#cb251-93" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lst-model-fit-lasso</span></span>
<span id="cb251-94"><a href="#cb251-94" aria-hidden="true" tabindex="-1"></a><span class="co">#| lst-label: lst-model-fit-lasso</span></span>
<span id="cb251-95"><a href="#cb251-95" aria-hidden="true" tabindex="-1"></a><span class="co">#| lst-cap: fit lasso</span></span>
<span id="cb251-96"><a href="#cb251-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-97"><a href="#cb251-97" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>) <span class="co"># Set the seed for reproducibility.</span></span>
<span id="cb251-98"><a href="#cb251-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-99"><a href="#cb251-99" aria-hidden="true" tabindex="-1"></a>sl_lasso <span class="ot">=</span> <span class="fu">SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb251-100"><a href="#cb251-100" aria-hidden="true" tabindex="-1"></a>                        <span class="at">SL.library =</span> <span class="st">"SL.glmnet"</span>) <span class="co"># Fit lasso model.</span></span>
<span id="cb251-101"><a href="#cb251-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-102"><a href="#cb251-102" aria-hidden="true" tabindex="-1"></a>sl_lasso</span>
<span id="cb251-103"><a href="#cb251-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-104"><a href="#cb251-104" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sl_lasso)</span>
<span id="cb251-105"><a href="#cb251-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-106"><a href="#cb251-106" aria-hidden="true" tabindex="-1"></a>sl_lasso<span class="sc">$</span>cvRisk[<span class="fu">which.min</span>(sl_lasso<span class="sc">$</span>cvRisk)]</span>
<span id="cb251-107"><a href="#cb251-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-108"><a href="#cb251-108" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(sl_lasso<span class="sc">$</span>fitLibrary<span class="sc">$</span>SL.glmnet_All<span class="sc">$</span>object, <span class="at">max.level =</span> <span class="dv">1</span>)</span>
<span id="cb251-109"><a href="#cb251-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-110"><a href="#cb251-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-111"><a href="#cb251-111" aria-hidden="true" tabindex="-1"></a>sl_rf <span class="ot">=</span> <span class="fu">SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb251-112"><a href="#cb251-112" aria-hidden="true" tabindex="-1"></a>                     <span class="at">SL.library =</span> <span class="st">"SL.ranger"</span>)</span>
<span id="cb251-113"><a href="#cb251-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-114"><a href="#cb251-114" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sl_lasso)</span>
<span id="cb251-115"><a href="#cb251-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-116"><a href="#cb251-116" aria-hidden="true" tabindex="-1"></a>sl_lasso<span class="sc">$</span>cvRisk[<span class="fu">which.min</span>(sl_lasso<span class="sc">$</span>cvRisk)]</span>
<span id="cb251-117"><a href="#cb251-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-118"><a href="#cb251-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-119"><a href="#cb251-119" aria-hidden="true" tabindex="-1"></a><span class="co"># Here is the raw glmnet result object:</span></span>
<span id="cb251-120"><a href="#cb251-120" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(sl_lasso<span class="sc">$</span>fitLibrary<span class="sc">$</span>SL.glmnet_All<span class="sc">$</span>object, <span class="at">max.level =</span> <span class="dv">1</span>)</span>
<span id="cb251-121"><a href="#cb251-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-122"><a href="#cb251-122" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb251-123"><a href="#cb251-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-126"><a href="#cb251-126" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb251-127"><a href="#cb251-127" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit random forest.</span></span>
<span id="cb251-128"><a href="#cb251-128" aria-hidden="true" tabindex="-1"></a>sl_rf <span class="ot">=</span> <span class="fu">SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">SL.library =</span> <span class="st">"SL.ranger"</span>)</span>
<span id="cb251-129"><a href="#cb251-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-130"><a href="#cb251-130" aria-hidden="true" tabindex="-1"></a>sl_rf</span>
<span id="cb251-131"><a href="#cb251-131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb251-132"><a href="#cb251-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-133"><a href="#cb251-133" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fit multiple models</span></span>
<span id="cb251-134"><a href="#cb251-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-137"><a href="#cb251-137" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb251-138"><a href="#cb251-138" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lst-fit-multiple-models</span></span>
<span id="cb251-139"><a href="#cb251-139" aria-hidden="true" tabindex="-1"></a><span class="co">#| lst-label: lst-fit-multiple-models</span></span>
<span id="cb251-140"><a href="#cb251-140" aria-hidden="true" tabindex="-1"></a><span class="co">#| lst-cap: lst fit multiple models</span></span>
<span id="cb251-141"><a href="#cb251-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-142"><a href="#cb251-142" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb251-143"><a href="#cb251-143" aria-hidden="true" tabindex="-1"></a>sl <span class="ot">=</span> <span class="fu">SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb251-144"><a href="#cb251-144" aria-hidden="true" tabindex="-1"></a>  <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, <span class="st">"SL.ranger"</span>))</span>
<span id="cb251-145"><a href="#cb251-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-146"><a href="#cb251-146" aria-hidden="true" tabindex="-1"></a>sl</span>
<span id="cb251-147"><a href="#cb251-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-148"><a href="#cb251-148" aria-hidden="true" tabindex="-1"></a>sl<span class="sc">$</span>times<span class="sc">$</span>everything</span>
<span id="cb251-149"><a href="#cb251-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-150"><a href="#cb251-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb251-151"><a href="#cb251-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-152"><a href="#cb251-152" aria-hidden="true" tabindex="-1"></a>Again, the coefficient is how much weight SuperLearner puts on that model in the weighted-average. So if coefficient = 0 it means that model is not used at all. Here we see that random forest is given the most weight, following by lasso.</span>
<span id="cb251-153"><a href="#cb251-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-154"><a href="#cb251-154" aria-hidden="true" tabindex="-1"></a>So we have an automatic ensemble of multiple learners based on the cross-validated performance of those learners, nice!</span>
<span id="cb251-155"><a href="#cb251-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-156"><a href="#cb251-156" aria-hidden="true" tabindex="-1"></a><span class="fu">#  Predict on new data</span></span>
<span id="cb251-157"><a href="#cb251-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-158"><a href="#cb251-158" aria-hidden="true" tabindex="-1"></a>Now that we have an ensemble let’s predict back on our holdout dataset and review the results.</span>
<span id="cb251-159"><a href="#cb251-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-162"><a href="#cb251-162" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb251-163"><a href="#cb251-163" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lst-predict</span></span>
<span id="cb251-164"><a href="#cb251-164" aria-hidden="true" tabindex="-1"></a><span class="co">#| lst-label: lst-predict</span></span>
<span id="cb251-165"><a href="#cb251-165" aria-hidden="true" tabindex="-1"></a><span class="co">#| lst-cap: predict</span></span>
<span id="cb251-166"><a href="#cb251-166" aria-hidden="true" tabindex="-1"></a><span class="co">#| # Predict back on the holdout dataset.</span></span>
<span id="cb251-167"><a href="#cb251-167" aria-hidden="true" tabindex="-1"></a><span class="co"># onlySL is set to TRUE so we don't fit algorithms that had weight = 0, saving computation.</span></span>
<span id="cb251-168"><a href="#cb251-168" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">=</span> <span class="fu">predict</span>(sl, x_holdout, <span class="at">onlySL =</span> <span class="cn">TRUE</span>)</span>
<span id="cb251-169"><a href="#cb251-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-170"><a href="#cb251-170" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the structure of this prediction object.</span></span>
<span id="cb251-171"><a href="#cb251-171" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pred)</span>
<span id="cb251-172"><a href="#cb251-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-173"><a href="#cb251-173" aria-hidden="true" tabindex="-1"></a><span class="co"># Review the columns of $library.predict.</span></span>
<span id="cb251-174"><a href="#cb251-174" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pred<span class="sc">$</span>library.predict)</span>
<span id="cb251-175"><a href="#cb251-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-176"><a href="#cb251-176" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb251-177"><a href="#cb251-177" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(pred<span class="sc">$</span>pred[, <span class="dv">1</span>]) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span>
<span id="cb251-178"><a href="#cb251-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-179"><a href="#cb251-179" aria-hidden="true" tabindex="-1"></a><span class="do">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span>
<span id="cb251-180"><a href="#cb251-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-181"><a href="#cb251-181" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatterplot of original values (0, 1) and predicted values.</span></span>
<span id="cb251-182"><a href="#cb251-182" aria-hidden="true" tabindex="-1"></a><span class="co"># Ideally we would use jitter or slight transparency to deal with overlap.</span></span>
<span id="cb251-183"><a href="#cb251-183" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(y_holdout, pred<span class="sc">$</span>pred[, <span class="dv">1</span>]) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span>
<span id="cb251-184"><a href="#cb251-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-185"><a href="#cb251-185" aria-hidden="true" tabindex="-1"></a><span class="co"># Review AUC - Area Under Curve</span></span>
<span id="cb251-186"><a href="#cb251-186" aria-hidden="true" tabindex="-1"></a>pred_rocr <span class="ot">=</span> ROCR<span class="sc">::</span><span class="fu">prediction</span>(pred<span class="sc">$</span>pred, y_holdout)</span>
<span id="cb251-187"><a href="#cb251-187" aria-hidden="true" tabindex="-1"></a>auc <span class="ot">=</span> ROCR<span class="sc">::</span><span class="fu">performance</span>(pred_rocr, <span class="at">measure =</span> <span class="st">"auc"</span>, <span class="at">x.measure =</span> <span class="st">"cutoff"</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb251-188"><a href="#cb251-188" aria-hidden="true" tabindex="-1"></a>auc</span>
<span id="cb251-189"><a href="#cb251-189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb251-190"><a href="#cb251-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-191"><a href="#cb251-191" aria-hidden="true" tabindex="-1"></a><span class="fu"># Fit ensemble with external cross-validation</span></span>
<span id="cb251-192"><a href="#cb251-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-193"><a href="#cb251-193" aria-hidden="true" tabindex="-1"></a>What we don’t have yet is an estimate of the performance of the ensemble itself. Right now we are just hopeful that the ensemble weights are successful in improving over the best single algorithm.</span>
<span id="cb251-194"><a href="#cb251-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-195"><a href="#cb251-195" aria-hidden="true" tabindex="-1"></a>In order to estimate the performance of the SuperLearner ensemble we need an “external” layer of cross-validation, also called **nested cross-validation**. We generate a separate holdout sample that we don’t use to fit the SuperLearner, which allows it to be a good estimate of the SuperLearner’s performance on unseen data. Typically we would run 10 or 20-fold external cross-validation, but even 5-fold is reasonable.</span>
<span id="cb251-196"><a href="#cb251-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-197"><a href="#cb251-197" aria-hidden="true" tabindex="-1"></a>Another nice result is that we get standard errors on the performance of the individual algorithms and can compare them to the SuperLearner.</span>
<span id="cb251-198"><a href="#cb251-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-201"><a href="#cb251-201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb251-202"><a href="#cb251-202" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb251-203"><a href="#cb251-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-204"><a href="#cb251-204" aria-hidden="true" tabindex="-1"></a><span class="co"># Don't have timing info for the CV.SuperLearner unfortunately.</span></span>
<span id="cb251-205"><a href="#cb251-205" aria-hidden="true" tabindex="-1"></a><span class="co"># So we need to time it manually.</span></span>
<span id="cb251-206"><a href="#cb251-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-207"><a href="#cb251-207" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb251-208"><a href="#cb251-208" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This will take about 2x as long as the previous SuperLearner.</span></span>
<span id="cb251-209"><a href="#cb251-209" aria-hidden="true" tabindex="-1"></a>  cv_sl <span class="ot">=</span> <span class="fu">CV.SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb251-210"><a href="#cb251-210" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># For a real analysis we would use V = 10.</span></span>
<span id="cb251-211"><a href="#cb251-211" aria-hidden="true" tabindex="-1"></a>                          <span class="at">V =</span> <span class="dv">3</span>,</span>
<span id="cb251-212"><a href="#cb251-212" aria-hidden="true" tabindex="-1"></a>                          <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, <span class="st">"SL.ranger"</span>))</span>
<span id="cb251-213"><a href="#cb251-213" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb251-214"><a href="#cb251-214" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb251-215"><a href="#cb251-215" aria-hidden="true" tabindex="-1"></a><span class="co"># We run summary on the cv_sl object rather than simply printing the object.</span></span>
<span id="cb251-216"><a href="#cb251-216" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span>
<span id="cb251-217"><a href="#cb251-217" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb251-218"><a href="#cb251-218" aria-hidden="true" tabindex="-1"></a><span class="co"># Review the distribution of the best single learner as external CV folds.</span></span>
<span id="cb251-219"><a href="#cb251-219" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">simplify2array</span>(cv_sl<span class="sc">$</span>whichDiscreteSL))</span>
<span id="cb251-220"><a href="#cb251-220" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb251-221"><a href="#cb251-221" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the performance with 95% CIs (use a better ggplot theme).</span></span>
<span id="cb251-222"><a href="#cb251-222" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cv_sl) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb251-223"><a href="#cb251-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-224"><a href="#cb251-224" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"SuperLearner.png"</span>)</span>
<span id="cb251-225"><a href="#cb251-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-226"><a href="#cb251-226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb251-227"><a href="#cb251-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-228"><a href="#cb251-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-229"><a href="#cb251-229" aria-hidden="true" tabindex="-1"></a><span class="fu">## Customize a model hyperparameter</span></span>
<span id="cb251-230"><a href="#cb251-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-231"><a href="#cb251-231" aria-hidden="true" tabindex="-1"></a>Hyperparameters are the configuration settings for an algorithm. OLS has no hyperparameters but essentially every other algorithm does.</span>
<span id="cb251-232"><a href="#cb251-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-233"><a href="#cb251-233" aria-hidden="true" tabindex="-1"></a>There are two ways to customize a hyperparameter: make a new learner function, or use create.Learner().</span>
<span id="cb251-234"><a href="#cb251-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-235"><a href="#cb251-235" aria-hidden="true" tabindex="-1"></a>Let’s make a variant of random forest that fits more trees, which may increase our accuracy and can’t hurt it (outside of small random variation).</span>
<span id="cb251-236"><a href="#cb251-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-239"><a href="#cb251-239" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb251-240"><a href="#cb251-240" aria-hidden="true" tabindex="-1"></a><span class="co"># Review the function argument defaults at the top.</span></span>
<span id="cb251-241"><a href="#cb251-241" aria-hidden="true" tabindex="-1"></a>SL.ranger</span>
<span id="cb251-242"><a href="#cb251-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-243"><a href="#cb251-243" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new function that changes just the ntree argument.</span></span>
<span id="cb251-244"><a href="#cb251-244" aria-hidden="true" tabindex="-1"></a><span class="co"># (We could do this in a single line.)</span></span>
<span id="cb251-245"><a href="#cb251-245" aria-hidden="true" tabindex="-1"></a><span class="co"># "..." means "all other arguments that were sent to the function"</span></span>
<span id="cb251-246"><a href="#cb251-246" aria-hidden="true" tabindex="-1"></a>SL.rf.better <span class="ot">=</span> <span class="cf">function</span>(...) {</span>
<span id="cb251-247"><a href="#cb251-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">SL.randomForest</span>(..., <span class="at">num.trees =</span> <span class="dv">1000</span>)</span>
<span id="cb251-248"><a href="#cb251-248" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb251-249"><a href="#cb251-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-250"><a href="#cb251-250" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb251-251"><a href="#cb251-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-252"><a href="#cb251-252" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the CV.SuperLearner.</span></span>
<span id="cb251-253"><a href="#cb251-253" aria-hidden="true" tabindex="-1"></a><span class="co"># We use V = 3 to save computation time; for a real analysis use V = 10 or 20.</span></span>
<span id="cb251-254"><a href="#cb251-254" aria-hidden="true" tabindex="-1"></a>cv_sl <span class="ot">=</span> <span class="fu">CV.SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">V =</span> <span class="dv">3</span>,</span>
<span id="cb251-255"><a href="#cb251-255" aria-hidden="true" tabindex="-1"></a>                        <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, <span class="st">"SL.rf.better"</span>, <span class="st">"SL.ranger"</span>))</span>
<span id="cb251-256"><a href="#cb251-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-257"><a href="#cb251-257" aria-hidden="true" tabindex="-1"></a><span class="co"># Review results.</span></span>
<span id="cb251-258"><a href="#cb251-258" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span>
<span id="cb251-259"><a href="#cb251-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-260"><a href="#cb251-260" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the defaults for random forest.</span></span>
<span id="cb251-261"><a href="#cb251-261" aria-hidden="true" tabindex="-1"></a>learners <span class="ot">=</span> <span class="fu">create.Learner</span>(<span class="st">"SL.ranger"</span>, <span class="at">params =</span> <span class="fu">list</span>(<span class="at">num.trees =</span> <span class="dv">1000</span>))</span>
<span id="cb251-262"><a href="#cb251-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-263"><a href="#cb251-263" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the object.</span></span>
<span id="cb251-264"><a href="#cb251-264" aria-hidden="true" tabindex="-1"></a>learners</span>
<span id="cb251-265"><a href="#cb251-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-266"><a href="#cb251-266" aria-hidden="true" tabindex="-1"></a><span class="co"># List the functions that were created</span></span>
<span id="cb251-267"><a href="#cb251-267" aria-hidden="true" tabindex="-1"></a>learners<span class="sc">$</span>names</span>
<span id="cb251-268"><a href="#cb251-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-269"><a href="#cb251-269" aria-hidden="true" tabindex="-1"></a><span class="co"># Review the code that was automatically generated for the function.</span></span>
<span id="cb251-270"><a href="#cb251-270" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice that it's exactly the same as the function we made manually.</span></span>
<span id="cb251-271"><a href="#cb251-271" aria-hidden="true" tabindex="-1"></a>SL.ranger_1</span>
<span id="cb251-272"><a href="#cb251-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-273"><a href="#cb251-273" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb251-274"><a href="#cb251-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-275"><a href="#cb251-275" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the CV.SuperLearner.</span></span>
<span id="cb251-276"><a href="#cb251-276" aria-hidden="true" tabindex="-1"></a><span class="co"># We use V = 3 to save computation time; for a real analysis use V = 10 or 20.</span></span>
<span id="cb251-277"><a href="#cb251-277" aria-hidden="true" tabindex="-1"></a>cv_sl <span class="ot">=</span> <span class="fu">CV.SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb251-278"><a href="#cb251-278" aria-hidden="true" tabindex="-1"></a>                        <span class="at">V =</span> <span class="dv">3</span>,</span>
<span id="cb251-279"><a href="#cb251-279" aria-hidden="true" tabindex="-1"></a>                        <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, learners<span class="sc">$</span>names, <span class="st">"SL.ranger"</span>))</span>
<span id="cb251-280"><a href="#cb251-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-281"><a href="#cb251-281" aria-hidden="true" tabindex="-1"></a><span class="co"># Review results.</span></span>
<span id="cb251-282"><a href="#cb251-282" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span>
<span id="cb251-283"><a href="#cb251-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-284"><a href="#cb251-284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb251-285"><a href="#cb251-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-286"><a href="#cb251-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-287"><a href="#cb251-287" aria-hidden="true" tabindex="-1"></a><span class="fu">## Test algorithm with multiple hyperparameter settings</span></span>
<span id="cb251-288"><a href="#cb251-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-289"><a href="#cb251-289" aria-hidden="true" tabindex="-1"></a>The performance of an algorithm varies based on its hyperparamters, which again are its configuration settings. Some algorithms may not vary much, and others might have far better or worse performance for certain settings. Often we focus our attention on 1 or 2 hyperparameters for a given algorithm because they are the most important ones.</span>
<span id="cb251-290"><a href="#cb251-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-291"><a href="#cb251-291" aria-hidden="true" tabindex="-1"></a>For random forest there are two particularly important hyperparameters: mtry and maximum leaf nodes. Mtry is how many features are randomly chosen within each decision tree node - in other words, each time the tree considers making a split. Maximum leaf nodes controls how complex each tree can get.</span>
<span id="cb251-292"><a href="#cb251-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-293"><a href="#cb251-293" aria-hidden="true" tabindex="-1"></a>Let’s try 3 different mtry options.</span>
<span id="cb251-294"><a href="#cb251-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-297"><a href="#cb251-297" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb251-298"><a href="#cb251-298" aria-hidden="true" tabindex="-1"></a><span class="co"># sqrt(p) is the default value of mtry for classification.</span></span>
<span id="cb251-299"><a href="#cb251-299" aria-hidden="true" tabindex="-1"></a><span class="fu">floor</span>(<span class="fu">sqrt</span>(<span class="fu">ncol</span>(x_train)))</span>
<span id="cb251-300"><a href="#cb251-300" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3</span></span>
<span id="cb251-301"><a href="#cb251-301" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's try 3 multiplies of this default: 0.5, 1, and 2.</span></span>
<span id="cb251-302"><a href="#cb251-302" aria-hidden="true" tabindex="-1"></a>(<span class="at">mtry_seq =</span> <span class="fu">floor</span>(<span class="fu">sqrt</span>(<span class="fu">ncol</span>(x_train)) <span class="sc">*</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">2</span>)))</span>
<span id="cb251-303"><a href="#cb251-303" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1 3 7</span></span>
<span id="cb251-304"><a href="#cb251-304" aria-hidden="true" tabindex="-1"></a>learners <span class="ot">=</span> <span class="fu">create.Learner</span>(<span class="st">"SL.ranger"</span>, <span class="at">tune =</span> <span class="fu">list</span>(<span class="at">mtry =</span> mtry_seq))</span>
<span id="cb251-305"><a href="#cb251-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-306"><a href="#cb251-306" aria-hidden="true" tabindex="-1"></a><span class="co"># Review the resulting object</span></span>
<span id="cb251-307"><a href="#cb251-307" aria-hidden="true" tabindex="-1"></a>learners</span>
<span id="cb251-308"><a href="#cb251-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-309"><a href="#cb251-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-310"><a href="#cb251-310" aria-hidden="true" tabindex="-1"></a>SL.ranger_1</span>
<span id="cb251-311"><a href="#cb251-311" aria-hidden="true" tabindex="-1"></a>SL.ranger_2</span>
<span id="cb251-312"><a href="#cb251-312" aria-hidden="true" tabindex="-1"></a>SL.ranger_3</span>
<span id="cb251-313"><a href="#cb251-313" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb251-314"><a href="#cb251-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-315"><a href="#cb251-315" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the CV.SuperLearner.</span></span>
<span id="cb251-316"><a href="#cb251-316" aria-hidden="true" tabindex="-1"></a><span class="co"># We use V = 3 to save computation time; for a real analysis use V = 10 or 20.</span></span>
<span id="cb251-317"><a href="#cb251-317" aria-hidden="true" tabindex="-1"></a>cv_sl <span class="ot">=</span> <span class="fu">CV.SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, </span>
<span id="cb251-318"><a href="#cb251-318" aria-hidden="true" tabindex="-1"></a>                        <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">V =</span> <span class="dv">3</span>, </span>
<span id="cb251-319"><a href="#cb251-319" aria-hidden="true" tabindex="-1"></a>                        <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, learners<span class="sc">$</span>names, <span class="st">"SL.ranger"</span>))</span>
<span id="cb251-320"><a href="#cb251-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-321"><a href="#cb251-321" aria-hidden="true" tabindex="-1"></a><span class="co"># Review results.</span></span>
<span id="cb251-322"><a href="#cb251-322" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span>
<span id="cb251-323"><a href="#cb251-323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb251-324"><a href="#cb251-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-325"><a href="#cb251-325" aria-hidden="true" tabindex="-1"></a>We see here that mtry = 7 performed a little bit better than mtry = 1 or mtry = 3, although the difference is not significant. If we used more data and more cross-validation folds we might see more drastic differences. A higher mtry does better when a small percentage of variables are predictive of the outcome, because it gives each tree a better chance of finding a useful variable.</span>
<span id="cb251-326"><a href="#cb251-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-327"><a href="#cb251-327" aria-hidden="true" tabindex="-1"></a>Note that SL.ranger and SL.ranger_2 have the same settings, and their performance is very similar - statistically a tie. It’s not exactly equivalent due to random variation in the two forests.</span>
<span id="cb251-328"><a href="#cb251-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-329"><a href="#cb251-329" aria-hidden="true" tabindex="-1"></a>A key difference with SuperLearner over caret or other frameworks is that we are not trying to choose the single best hyperparameter or model. Instead, we usually want the best weighted average. So we are including all of the different settings in our SuperLearner, and we may choose a weighted average that includes the same model multiple times but with different settings. That can give us better performance than choosing only the single best settings for a given algorithm, which has some random noise in any case.</span>
<span id="cb251-330"><a href="#cb251-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-331"><a href="#cb251-331" aria-hidden="true" tabindex="-1"></a>Multicore parallelization</span>
<span id="cb251-332"><a href="#cb251-332" aria-hidden="true" tabindex="-1"></a>SuperLearner makes it easy to use multiple CPU cores on your computer to speed up the calculations. We first need to setup R for multiple cores, then tell CV.SuperLearner to divide its computations across those cores.</span>
<span id="cb251-333"><a href="#cb251-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-334"><a href="#cb251-334" aria-hidden="true" tabindex="-1"></a>There are two ways to use multiple cores in R: the “multicore” system and the “snow” system. Windows only supports the “snow” system, which is more difficult to use, whereas macOS and Linux can use either one.</span>
<span id="cb251-335"><a href="#cb251-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-336"><a href="#cb251-336" aria-hidden="true" tabindex="-1"></a>First we show the “multicore” system version:</span>
<span id="cb251-337"><a href="#cb251-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-340"><a href="#cb251-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb251-341"><a href="#cb251-341" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup parallel computation - use all cores on our computer.</span></span>
<span id="cb251-342"><a href="#cb251-342" aria-hidden="true" tabindex="-1"></a>(<span class="at">num_cores =</span> RhpcBLASctl<span class="sc">::</span><span class="fu">get_num_cores</span>())</span>
<span id="cb251-343"><a href="#cb251-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-344"><a href="#cb251-344" aria-hidden="true" tabindex="-1"></a><span class="co"># Use 2 of those cores for parallel SuperLearner.</span></span>
<span id="cb251-345"><a href="#cb251-345" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace "2" with "num_cores" (without quotes) to use all cores.</span></span>
<span id="cb251-346"><a href="#cb251-346" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> <span class="dv">2</span>)</span>
<span id="cb251-347"><a href="#cb251-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-348"><a href="#cb251-348" aria-hidden="true" tabindex="-1"></a><span class="co"># Check how many parallel workers we are using (on macOS/Linux).</span></span>
<span id="cb251-349"><a href="#cb251-349" aria-hidden="true" tabindex="-1"></a><span class="fu">getOption</span>(<span class="st">"mc.cores"</span>)</span>
<span id="cb251-350"><a href="#cb251-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-351"><a href="#cb251-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-352"><a href="#cb251-352" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to set a different type of seed that works across cores.</span></span>
<span id="cb251-353"><a href="#cb251-353" aria-hidden="true" tabindex="-1"></a><span class="co"># Otherwise the other cores will go rogue and we won't get repeatable results.</span></span>
<span id="cb251-354"><a href="#cb251-354" aria-hidden="true" tabindex="-1"></a><span class="co"># This version is for the "multicore" parallel system in R.</span></span>
<span id="cb251-355"><a href="#cb251-355" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>, <span class="st">"L'Ecuyer-CMRG"</span>)</span>
<span id="cb251-356"><a href="#cb251-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-357"><a href="#cb251-357" aria-hidden="true" tabindex="-1"></a><span class="co"># While this is running check CPU using in Activity Monitor / Task Manager.</span></span>
<span id="cb251-358"><a href="#cb251-358" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb251-359"><a href="#cb251-359" aria-hidden="true" tabindex="-1"></a>  cv_sl <span class="ot">=</span> <span class="fu">CV.SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb251-360"><a href="#cb251-360" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># For a real analysis we would use V = 10.</span></span>
<span id="cb251-361"><a href="#cb251-361" aria-hidden="true" tabindex="-1"></a>                          <span class="at">V =</span> <span class="dv">3</span>,</span>
<span id="cb251-362"><a href="#cb251-362" aria-hidden="true" tabindex="-1"></a>                          <span class="at">parallel =</span> <span class="st">"multicore"</span>,</span>
<span id="cb251-363"><a href="#cb251-363" aria-hidden="true" tabindex="-1"></a>                          <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, learners<span class="sc">$</span>names, <span class="st">"SL.ranger"</span>))</span>
<span id="cb251-364"><a href="#cb251-364" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb251-365"><a href="#cb251-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-366"><a href="#cb251-366" aria-hidden="true" tabindex="-1"></a><span class="co"># Review results.</span></span>
<span id="cb251-367"><a href="#cb251-367" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span>
<span id="cb251-368"><a href="#cb251-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb251-369"><a href="#cb251-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-370"><a href="#cb251-370" aria-hidden="true" tabindex="-1"></a>Here is the “snow” equivalent:</span>
<span id="cb251-371"><a href="#cb251-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-374"><a href="#cb251-374" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb251-375"><a href="#cb251-375" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a snow cluster</span></span>
<span id="cb251-376"><a href="#cb251-376" aria-hidden="true" tabindex="-1"></a><span class="co"># Again, replace 2 with num_cores to use all available cores.</span></span>
<span id="cb251-377"><a href="#cb251-377" aria-hidden="true" tabindex="-1"></a>cluster <span class="ot">=</span> parallel<span class="sc">::</span><span class="fu">makeCluster</span>(<span class="dv">2</span>)</span>
<span id="cb251-378"><a href="#cb251-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-379"><a href="#cb251-379" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the cluster object.</span></span>
<span id="cb251-380"><a href="#cb251-380" aria-hidden="true" tabindex="-1"></a>cluster</span>
<span id="cb251-381"><a href="#cb251-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-382"><a href="#cb251-382" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the SuperLearner package on all workers so they can find</span></span>
<span id="cb251-383"><a href="#cb251-383" aria-hidden="true" tabindex="-1"></a><span class="co"># SuperLearner::All(), the default screening function which keeps all variables.</span></span>
<span id="cb251-384"><a href="#cb251-384" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">clusterEvalQ</span>(cluster, <span class="fu">library</span>(SuperLearner))</span>
<span id="cb251-385"><a href="#cb251-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-386"><a href="#cb251-386" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to explictly export our custom learner functions to the workers.</span></span>
<span id="cb251-387"><a href="#cb251-387" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">clusterExport</span>(cluster, learners<span class="sc">$</span>names)</span>
<span id="cb251-388"><a href="#cb251-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-389"><a href="#cb251-389" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to set a different type of seed that works across cores.</span></span>
<span id="cb251-390"><a href="#cb251-390" aria-hidden="true" tabindex="-1"></a><span class="co"># This version is for SNOW parallelization.</span></span>
<span id="cb251-391"><a href="#cb251-391" aria-hidden="true" tabindex="-1"></a><span class="co"># Otherwise the other cores will go rogue and we won't get repeatable results.</span></span>
<span id="cb251-392"><a href="#cb251-392" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">clusterSetRNGStream</span>(cluster, <span class="dv">1</span>)</span>
<span id="cb251-393"><a href="#cb251-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-394"><a href="#cb251-394" aria-hidden="true" tabindex="-1"></a><span class="co"># While this is running check CPU using in Activity Monitor / Task Manager.</span></span>
<span id="cb251-395"><a href="#cb251-395" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb251-396"><a href="#cb251-396" aria-hidden="true" tabindex="-1"></a>  cv_sl <span class="ot">=</span> <span class="fu">CV.SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb251-397"><a href="#cb251-397" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># For a real analysis we would use V = 10.</span></span>
<span id="cb251-398"><a href="#cb251-398" aria-hidden="true" tabindex="-1"></a>                          <span class="at">V =</span> <span class="dv">3</span>,</span>
<span id="cb251-399"><a href="#cb251-399" aria-hidden="true" tabindex="-1"></a>                          <span class="at">parallel =</span> cluster,</span>
<span id="cb251-400"><a href="#cb251-400" aria-hidden="true" tabindex="-1"></a>                          <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, learners<span class="sc">$</span>names, <span class="st">"SL.ranger"</span>))</span>
<span id="cb251-401"><a href="#cb251-401" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb251-402"><a href="#cb251-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-403"><a href="#cb251-403" aria-hidden="true" tabindex="-1"></a><span class="co"># Review results.</span></span>
<span id="cb251-404"><a href="#cb251-404" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span>
<span id="cb251-405"><a href="#cb251-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-406"><a href="#cb251-406" aria-hidden="true" tabindex="-1"></a><span class="co"># Stop the cluster workers now that we're done.</span></span>
<span id="cb251-407"><a href="#cb251-407" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">stopCluster</span>(cluster)</span>
<span id="cb251-408"><a href="#cb251-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb251-409"><a href="#cb251-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-410"><a href="#cb251-410" aria-hidden="true" tabindex="-1"></a>If we want to use multiple cores for normal SuperLearner, not CV.SuperLearner (i.e. external cross-validation to estimate performance), we need to change the function name to mcSuperLearner (“multicore” version) or snowSuperLearner (“snow” version).</span>
<span id="cb251-411"><a href="#cb251-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-412"><a href="#cb251-412" aria-hidden="true" tabindex="-1"></a>First the “multicore” version (won’t be parallel on Windows):</span>
<span id="cb251-413"><a href="#cb251-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-416"><a href="#cb251-416" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb251-417"><a href="#cb251-417" aria-hidden="true" tabindex="-1"></a><span class="co"># Set multicore compatible seed.</span></span>
<span id="cb251-418"><a href="#cb251-418" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>, <span class="st">"L'Ecuyer-CMRG"</span>)</span>
<span id="cb251-419"><a href="#cb251-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-420"><a href="#cb251-420" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the SuperLearner.</span></span>
<span id="cb251-421"><a href="#cb251-421" aria-hidden="true" tabindex="-1"></a>(<span class="at">sl =</span> <span class="fu">mcSuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb251-422"><a href="#cb251-422" aria-hidden="true" tabindex="-1"></a>                    <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, learners<span class="sc">$</span>names, <span class="st">"SL.ranger"</span>)))</span>
<span id="cb251-423"><a href="#cb251-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-424"><a href="#cb251-424" aria-hidden="true" tabindex="-1"></a><span class="co"># We see the time is reduced over our initial single-core superlearner.</span></span>
<span id="cb251-425"><a href="#cb251-425" aria-hidden="true" tabindex="-1"></a>sl<span class="sc">$</span>times<span class="sc">$</span>everything</span>
<span id="cb251-426"><a href="#cb251-426" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb251-427"><a href="#cb251-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-428"><a href="#cb251-428" aria-hidden="true" tabindex="-1"></a>Now the “snow” version, which should be parallel on all operating systems.</span>
<span id="cb251-429"><a href="#cb251-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-432"><a href="#cb251-432" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb251-433"><a href="#cb251-433" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a snow cluster</span></span>
<span id="cb251-434"><a href="#cb251-434" aria-hidden="true" tabindex="-1"></a><span class="co"># Reminder: change "2" to "num_cores" (without quotes) to use all available cores.</span></span>
<span id="cb251-435"><a href="#cb251-435" aria-hidden="true" tabindex="-1"></a>(<span class="at">cluster =</span> parallel<span class="sc">::</span><span class="fu">makeCluster</span>(<span class="dv">2</span>))</span>
<span id="cb251-436"><a href="#cb251-436" aria-hidden="true" tabindex="-1"></a><span class="do">## socket cluster with 2 nodes on host 'localhost'</span></span>
<span id="cb251-437"><a href="#cb251-437" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the SuperLearner package on all workers so they can find</span></span>
<span id="cb251-438"><a href="#cb251-438" aria-hidden="true" tabindex="-1"></a><span class="co"># SuperLearner::All(), the default screening function which keeps all variables.</span></span>
<span id="cb251-439"><a href="#cb251-439" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">clusterEvalQ</span>(cluster, <span class="fu">library</span>(SuperLearner))</span>
<span id="cb251-440"><a href="#cb251-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-441"><a href="#cb251-441" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to explictly export our custom learner functions to the workers.</span></span>
<span id="cb251-442"><a href="#cb251-442" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">clusterExport</span>(cluster, learners<span class="sc">$</span>names)</span>
<span id="cb251-443"><a href="#cb251-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-444"><a href="#cb251-444" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to set a different type of seed that works across cores.</span></span>
<span id="cb251-445"><a href="#cb251-445" aria-hidden="true" tabindex="-1"></a><span class="co"># This version is for SNOW parallelization.</span></span>
<span id="cb251-446"><a href="#cb251-446" aria-hidden="true" tabindex="-1"></a><span class="co"># Otherwise the other cores will go rogue and we won't get repeatable results.</span></span>
<span id="cb251-447"><a href="#cb251-447" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">clusterSetRNGStream</span>(cluster, <span class="dv">1</span>)</span>
<span id="cb251-448"><a href="#cb251-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-449"><a href="#cb251-449" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the SuperLearner.</span></span>
<span id="cb251-450"><a href="#cb251-450" aria-hidden="true" tabindex="-1"></a>(<span class="at">sl =</span> <span class="fu">snowSuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb251-451"><a href="#cb251-451" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cluster =</span> cluster,</span>
<span id="cb251-452"><a href="#cb251-452" aria-hidden="true" tabindex="-1"></a>                      <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, learners<span class="sc">$</span>names, <span class="st">"SL.ranger"</span>)))</span>
<span id="cb251-453"><a href="#cb251-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-454"><a href="#cb251-454" aria-hidden="true" tabindex="-1"></a><span class="co"># We see the time is reduced over our initial single-core superlearner.</span></span>
<span id="cb251-455"><a href="#cb251-455" aria-hidden="true" tabindex="-1"></a>sl<span class="sc">$</span>times<span class="sc">$</span>everything</span>
<span id="cb251-456"><a href="#cb251-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-457"><a href="#cb251-457" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb251-458"><a href="#cb251-458" aria-hidden="true" tabindex="-1"></a>SuperLearner also supports running across multiple computers at a time, called “multi-node” or “cluster” computing. We will skip that for now.</span>
<span id="cb251-459"><a href="#cb251-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-460"><a href="#cb251-460" aria-hidden="true" tabindex="-1"></a><span class="fu">## Weight distribution for SuperLearner</span></span>
<span id="cb251-461"><a href="#cb251-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-462"><a href="#cb251-462" aria-hidden="true" tabindex="-1"></a>The weights or coefficients of the SuperLearner are stochastic - they will change as the data changes. So we don’t necessarily trust a given set of weights as being the “true” weights, but when we use CV.SuperLearner we at least have multiple samples from the distribution of the weights.</span>
<span id="cb251-463"><a href="#cb251-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-464"><a href="#cb251-464" aria-hidden="true" tabindex="-1"></a>We can write a little function to extract the weights at each CV.SuperLearner iteration and summarize the distribution of those weights. This may be added to the SuperLearner package sometime in the future.</span>
<span id="cb251-465"><a href="#cb251-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-468"><a href="#cb251-468" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb251-469"><a href="#cb251-469" aria-hidden="true" tabindex="-1"></a><span class="co"># Review meta-weights (coefficients) from a CV.SuperLearner object</span></span>
<span id="cb251-470"><a href="#cb251-470" aria-hidden="true" tabindex="-1"></a>review_weights <span class="ot">=</span> <span class="cf">function</span>(cv_sl) {</span>
<span id="cb251-471"><a href="#cb251-471" aria-hidden="true" tabindex="-1"></a>  meta_weights <span class="ot">=</span> <span class="fu">coef</span>(cv_sl)</span>
<span id="cb251-472"><a href="#cb251-472" aria-hidden="true" tabindex="-1"></a>  means <span class="ot">=</span> <span class="fu">colMeans</span>(meta_weights)</span>
<span id="cb251-473"><a href="#cb251-473" aria-hidden="true" tabindex="-1"></a>  sds <span class="ot">=</span> <span class="fu">apply</span>(meta_weights, <span class="at">MARGIN =</span> <span class="dv">2</span>,  <span class="at">FUN =</span> sd)</span>
<span id="cb251-474"><a href="#cb251-474" aria-hidden="true" tabindex="-1"></a>  mins <span class="ot">=</span> <span class="fu">apply</span>(meta_weights, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> min)</span>
<span id="cb251-475"><a href="#cb251-475" aria-hidden="true" tabindex="-1"></a>  maxs <span class="ot">=</span> <span class="fu">apply</span>(meta_weights, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> max)</span>
<span id="cb251-476"><a href="#cb251-476" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine the stats into a single matrix.</span></span>
<span id="cb251-477"><a href="#cb251-477" aria-hidden="true" tabindex="-1"></a>  sl_stats <span class="ot">=</span> <span class="fu">cbind</span>(<span class="st">"mean(weight)"</span> <span class="ot">=</span> means, <span class="st">"sd"</span> <span class="ot">=</span> sds, <span class="st">"min"</span> <span class="ot">=</span> mins, <span class="st">"max"</span> <span class="ot">=</span> maxs)</span>
<span id="cb251-478"><a href="#cb251-478" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort by decreasing mean weight.</span></span>
<span id="cb251-479"><a href="#cb251-479" aria-hidden="true" tabindex="-1"></a>  sl_stats[<span class="fu">order</span>(sl_stats[, <span class="dv">1</span>], <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb251-480"><a href="#cb251-480" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb251-481"><a href="#cb251-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-482"><a href="#cb251-482" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">review_weights</span>(cv_sl), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb251-483"><a href="#cb251-483" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb251-484"><a href="#cb251-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-485"><a href="#cb251-485" aria-hidden="true" tabindex="-1"></a>Notice that in this case the ensemble never uses the mean nor the randomForest with mtry = 1. Also the LASSO (glmnet) was only used on a subset of the folds. Adding multiple configurations of randomForest was helpful because mtry = 7 was used. However, based on the minimum column we can see that no algorithm was used every single time.</span>
<span id="cb251-486"><a href="#cb251-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-487"><a href="#cb251-487" aria-hidden="true" tabindex="-1"></a>We recommend reviewing the weight distribution for any SuperLearner project to better understand which algorithms are chosen for the ensemble.</span>
<span id="cb251-488"><a href="#cb251-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-489"><a href="#cb251-489" aria-hidden="true" tabindex="-1"></a><span class="fu">## Feature selection (screening)</span></span>
<span id="cb251-490"><a href="#cb251-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-491"><a href="#cb251-491" aria-hidden="true" tabindex="-1"></a>When datasets have many covariates our algorithms may benefit from first choosing a subset of available covariates, a step called feature selection. Then we pass only those variables to the modeling algorithm, and it may be less likely to overfit to variables that are not related to the outcome.</span>
<span id="cb251-492"><a href="#cb251-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-493"><a href="#cb251-493" aria-hidden="true" tabindex="-1"></a>Let’s revisit listWrappers() and check out the bottom section.</span>
<span id="cb251-494"><a href="#cb251-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-497"><a href="#cb251-497" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb251-498"><a href="#cb251-498" aria-hidden="true" tabindex="-1"></a><span class="fu">listWrappers</span>()</span>
<span id="cb251-499"><a href="#cb251-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-500"><a href="#cb251-500" aria-hidden="true" tabindex="-1"></a><span class="co"># Review code for corP, which is based on univariate correlation.</span></span>
<span id="cb251-501"><a href="#cb251-501" aria-hidden="true" tabindex="-1"></a>screen.corP</span>
<span id="cb251-502"><a href="#cb251-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-503"><a href="#cb251-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-504"><a href="#cb251-504" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb251-505"><a href="#cb251-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-506"><a href="#cb251-506" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the SuperLearner.</span></span>
<span id="cb251-507"><a href="#cb251-507" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to use list() instead of c().</span></span>
<span id="cb251-508"><a href="#cb251-508" aria-hidden="true" tabindex="-1"></a>cv_sl <span class="ot">=</span> <span class="fu">CV.SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb251-509"><a href="#cb251-509" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># For a real analysis we would use V = 10.</span></span>
<span id="cb251-510"><a href="#cb251-510" aria-hidden="true" tabindex="-1"></a>                        <span class="at">V =</span> <span class="dv">3</span>,</span>
<span id="cb251-511"><a href="#cb251-511" aria-hidden="true" tabindex="-1"></a>                        <span class="at">parallel =</span> <span class="st">"multicore"</span>,</span>
<span id="cb251-512"><a href="#cb251-512" aria-hidden="true" tabindex="-1"></a>                        <span class="at">SL.library =</span> <span class="fu">list</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, <span class="fu">c</span>(<span class="st">"SL.glmnet"</span>, <span class="st">"screen.corP"</span>)))</span>
<span id="cb251-513"><a href="#cb251-513" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span>
<span id="cb251-514"><a href="#cb251-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb251-515"><a href="#cb251-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-516"><a href="#cb251-516" aria-hidden="true" tabindex="-1"></a>We see a small performance boost by first screening by univarate correlation with our outcome, and only keeping variables with a p-value less than 0.10. Try using some of the other screening algorithms as they may do even better for a particular dataset.</span>
<span id="cb251-517"><a href="#cb251-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-518"><a href="#cb251-518" aria-hidden="true" tabindex="-1"></a><span class="fu">## Optimize for AUC</span></span>
<span id="cb251-519"><a href="#cb251-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-520"><a href="#cb251-520" aria-hidden="true" tabindex="-1"></a>For binary prediction we are typically trying to maximize AUC, which can be the best performance metric when our outcome variable has some imbalance. In other words, we don’t have exactly 50% 1s and 50% 0s in our outcome. Our SuperLearner is not targeting AUC by default, but it can if we tell it to by specifying our method.</span>
<span id="cb251-521"><a href="#cb251-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-524"><a href="#cb251-524" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb251-525"><a href="#cb251-525" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb251-526"><a href="#cb251-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-527"><a href="#cb251-527" aria-hidden="true" tabindex="-1"></a>cv_sl <span class="ot">=</span> <span class="fu">CV.SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb251-528"><a href="#cb251-528" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># For a real analysis we would use V = 10.</span></span>
<span id="cb251-529"><a href="#cb251-529" aria-hidden="true" tabindex="-1"></a>                        <span class="at">V =</span> <span class="dv">3</span>,</span>
<span id="cb251-530"><a href="#cb251-530" aria-hidden="true" tabindex="-1"></a>                        <span class="at">method =</span> <span class="st">"method.AUC"</span>,</span>
<span id="cb251-531"><a href="#cb251-531" aria-hidden="true" tabindex="-1"></a>                        <span class="at">SL.library =</span> <span class="fu">list</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, <span class="fu">c</span>(<span class="st">"SL.glmnet"</span>, <span class="st">"screen.corP"</span>)))</span>
<span id="cb251-532"><a href="#cb251-532" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading required package: cvAUC</span></span>
<span id="cb251-533"><a href="#cb251-533" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span>
<span id="cb251-534"><a href="#cb251-534" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb251-535"><a href="#cb251-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-536"><a href="#cb251-536" aria-hidden="true" tabindex="-1"></a>This conveniently shows us the AUC for each algorithm without us having to calculate it manually. But we aren’t getting SEs sadly.</span>
<span id="cb251-537"><a href="#cb251-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-538"><a href="#cb251-538" aria-hidden="true" tabindex="-1"></a>Another important optimizer to consider is negative log likelihood, which is intended for binary outcomes and will often work better than NNLS (the default). This is specified by method = “NNloglik”.</span>
<span id="cb251-539"><a href="#cb251-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-540"><a href="#cb251-540" aria-hidden="true" tabindex="-1"></a><span class="fu">## XGBoost hyperparameter exploration</span></span>
<span id="cb251-541"><a href="#cb251-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-542"><a href="#cb251-542" aria-hidden="true" tabindex="-1"></a>XGBoost is a version of GBM that is even faster and has some extra settings. GBM’s adaptivity is determined by its configuration, so we want to thoroughly test a wide range of configurations for any given problem. Let’s do 27 now. This will take a good amount of time (~7 minutes on my computer) so we need to at least use multiple cores, if not multiple computers.</span>
<span id="cb251-543"><a href="#cb251-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-546"><a href="#cb251-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb251-547"><a href="#cb251-547" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 * 3 * 3 = 27 different configurations.</span></span>
<span id="cb251-548"><a href="#cb251-548" aria-hidden="true" tabindex="-1"></a><span class="co"># For a real analysis we would do 100, 500, or 1000 trees - this is just a demo.</span></span>
<span id="cb251-549"><a href="#cb251-549" aria-hidden="true" tabindex="-1"></a>tune <span class="ot">=</span> <span class="fu">list</span>(<span class="at">ntrees =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">50</span>),</span>
<span id="cb251-550"><a href="#cb251-550" aria-hidden="true" tabindex="-1"></a>            <span class="at">max_depth =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb251-551"><a href="#cb251-551" aria-hidden="true" tabindex="-1"></a>            <span class="at">shrinkage =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>))</span>
<span id="cb251-552"><a href="#cb251-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-553"><a href="#cb251-553" aria-hidden="true" tabindex="-1"></a><span class="co"># Set detailed names = T so we can see the configuration for each function.</span></span>
<span id="cb251-554"><a href="#cb251-554" aria-hidden="true" tabindex="-1"></a><span class="co"># Also shorten the name prefix.</span></span>
<span id="cb251-555"><a href="#cb251-555" aria-hidden="true" tabindex="-1"></a>learners <span class="ot">=</span> <span class="fu">create.Learner</span>(<span class="st">"SL.xgboost"</span>, <span class="at">tune =</span> tune, <span class="at">detailed_names =</span> <span class="cn">TRUE</span>, <span class="at">name_prefix =</span> <span class="st">"xgb"</span>)</span>
<span id="cb251-556"><a href="#cb251-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-557"><a href="#cb251-557" aria-hidden="true" tabindex="-1"></a><span class="co"># 27 configurations - not too shabby.</span></span>
<span id="cb251-558"><a href="#cb251-558" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(learners<span class="sc">$</span>names)</span>
<span id="cb251-559"><a href="#cb251-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-560"><a href="#cb251-560" aria-hidden="true" tabindex="-1"></a>learners<span class="sc">$</span>names</span>
<span id="cb251-561"><a href="#cb251-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-562"><a href="#cb251-562" aria-hidden="true" tabindex="-1"></a><span class="co"># Confirm we have multiple cores configured. This should be &gt; 1.</span></span>
<span id="cb251-563"><a href="#cb251-563" aria-hidden="true" tabindex="-1"></a><span class="fu">getOption</span>(<span class="st">"mc.cores"</span>)</span>
<span id="cb251-564"><a href="#cb251-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-565"><a href="#cb251-565" aria-hidden="true" tabindex="-1"></a><span class="co"># Remember to set multicore-compatible seed.</span></span>
<span id="cb251-566"><a href="#cb251-566" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>, <span class="st">"L'Ecuyer-CMRG"</span>)</span>
<span id="cb251-567"><a href="#cb251-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-568"><a href="#cb251-568" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the CV.SuperLearner.</span></span>
<span id="cb251-569"><a href="#cb251-569" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb251-570"><a href="#cb251-570" aria-hidden="true" tabindex="-1"></a>  cv_sl <span class="ot">=</span> <span class="fu">CV.SuperLearner</span>(<span class="at">Y =</span> y_train, <span class="at">X =</span> x_train, <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb251-571"><a href="#cb251-571" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># For a real analysis we would use V = 10.</span></span>
<span id="cb251-572"><a href="#cb251-572" aria-hidden="true" tabindex="-1"></a>                          <span class="at">V =</span> <span class="dv">3</span>,</span>
<span id="cb251-573"><a href="#cb251-573" aria-hidden="true" tabindex="-1"></a>                          <span class="at">parallel =</span> <span class="st">"multicore"</span>,</span>
<span id="cb251-574"><a href="#cb251-574" aria-hidden="true" tabindex="-1"></a>                          <span class="at">SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.mean"</span>, <span class="st">"SL.glmnet"</span>, learners<span class="sc">$</span>names, <span class="st">"SL.ranger"</span>))</span>
<span id="cb251-575"><a href="#cb251-575" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb251-576"><a href="#cb251-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-577"><a href="#cb251-577" aria-hidden="true" tabindex="-1"></a><span class="co"># Review results.</span></span>
<span id="cb251-578"><a href="#cb251-578" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cv_sl)</span>
<span id="cb251-579"><a href="#cb251-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-580"><a href="#cb251-580" aria-hidden="true" tabindex="-1"></a><span class="fu">review_weights</span>(cv_sl)</span>
<span id="cb251-581"><a href="#cb251-581" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb251-582"><a href="#cb251-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-583"><a href="#cb251-583" aria-hidden="true" tabindex="-1"></a>We can see how stochastic the weights are for each individual execution of SuperLearner.</span>
<span id="cb251-584"><a href="#cb251-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-585"><a href="#cb251-585" aria-hidden="true" tabindex="-1"></a>Finally, plot the performance for the different settings.</span>
<span id="cb251-588"><a href="#cb251-588" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb251-589"><a href="#cb251-589" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cv_sl) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb251-590"><a href="#cb251-590" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb251-591"><a href="#cb251-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-592"><a href="#cb251-592" aria-hidden="true" tabindex="-1"></a><span class="fu">## Troubleshooting</span></span>
<span id="cb251-593"><a href="#cb251-593" aria-hidden="true" tabindex="-1"></a>If you get an error about predict for xgb.Booster, you probably need to install the latest version of XGBoost from github.</span>
<span id="cb251-594"><a href="#cb251-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-595"><a href="#cb251-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-596"><a href="#cb251-596" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 Copyright 2025, Oren Bochman
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../../about.html">
<p>About</p>
</a>
  </li>  
</ul>
    <div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
    <script type="text/javascript">
    (function(d) {
      d.querySelectorAll(".pseudocode-container").forEach(function(el) {
        let pseudocodeOptions = {
          indentSize: el.dataset.indentSize || "1.2em",
          commentDelimiter: el.dataset.commentDelimiter || "//",
          lineNumber: el.dataset.lineNumber === "true" ? true : false,
          lineNumberPunc: el.dataset.lineNumberPunc || ":",
          noEnd: el.dataset.noEnd === "true" ? true : false,
          titlePrefix: el.dataset.captionPrefix || "Algorithm"
        };
        pseudocode.renderElement(el.querySelector(".pseudocode"), pseudocodeOptions);
      });
    })(document);
    (function(d) {
      d.querySelectorAll(".pseudocode-container").forEach(function(el) {
        let captionSpan = el.querySelector(".ps-root > .ps-algorithm > .ps-line > .ps-keyword")
        if (captionSpan !== null) {
          let captionPrefix = el.dataset.captionPrefix + " ";
          let captionNumber = "";
          if (el.dataset.pseudocodeNumber) {
            captionNumber = el.dataset.pseudocodeNumber + " ";
            if (el.dataset.chapterLevel) {
              captionNumber = el.dataset.chapterLevel + "." + captionNumber;
            }
          }
          captionSpan.innerHTML = captionPrefix + captionNumber;
        }
      });
    })(document);
    </script>
  
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>